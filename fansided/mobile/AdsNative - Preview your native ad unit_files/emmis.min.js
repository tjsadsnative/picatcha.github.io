/*! Emmis - v0.1.0 - 2014-12-09
 * htpp://10up.com
 * Copyright (c) 2014; * Licensed GPLv2+ */
(function(e,t){var i=function(e,t,i){var n;return function(){function a(){i||e.apply(o,r),n=null}var o=this,r=arguments;n?clearTimeout(n):i&&e.apply(o,r),n=setTimeout(a,t||100)}};jQuery.fn[t]=function(e){return e?this.bind("resize",i(e)):this.trigger(t)}})(jQuery,"smartresize"),function(e,t){"use strict";var i=function(){return 768>t(e).width()},n=function(){return 1024>t(e).width()},a=function(){return"ontouchstart"in e||navigator.msMaxTouchPoints};a()&&t("html").removeClass("no-touch").addClass("touch");var o=function(){if(t(".search-form").length){var e=t(".search-form");""!==e.find("input").val()&&e.find("input").prev("label").hide(),e.find("input").on("blur",function(){""!==t(this).val()?t(this).prev("label").hide():t(this).prev("label").show()}).on("focus",function(){t(this).prev("label").hide()})}},r=t("#mobile-navigation-toggle"),s=t("#navigation"),l=function(){r.on("click",function(e){e.preventDefault(),s.slideToggle(),r.toggleClass("menu-open")}),a()&&(s.find("#navigation-main > ul > li.menu-item-has-children > a").on("click",function(e){e.preventDefault(),t(this).parent().hasClass("dropdown-open")?t(this).parent().removeClass("dropdown-open"):t(this).parent().addClass("dropdown-open").siblings().removeClass("dropdown-open")}),t(".dropdown-close").on("click",function(e){e.preventDefault(),t(this).closest(".dropdown-open").removeClass("dropdown-open")}))},d=!1,h=t(".masthead-height-js"),c=t(".masthead-height-gutter-js"),f=t("#masthead"),u=t("#masthead-center"),g=t("#masthead-right"),p=t("#masthead-left"),v=10,m=function(){var e=f.width(),n=Math.floor(.5*e+v),a=n>=625?625:n;h.length&&!i()?(300>=g.width()?(u.css("right","300px"),u.css("width",e-p.width()-g.width())):u.attr("style",""),g.find(".cover-ad").length&&(300==g.width()&&250>=g.find(".cover-ad").height()?g.find(".cover-story").css({top:"250px",height:a-250+"px"}):g.find(".cover-story").attr("style","")),h.height(a),c.height(a-v),d&&(t(".owl-item").each(function(e){var i=t(this).find(".mobile-slide");0===e||1===e?t("#masthead-left").append(i):2===e?t("#masthead-center").append(i):t("#masthead-right").append(i),t(this).remove()}),f.trigger("destroy.owl.carousel"),t(".owl-stage").remove(),d=!1)):(h.attr("style",""),c.attr("style",""),d||(f.owlCarousel({items:1,startPosition:2,nestedItemSelector:"mobile-slide"}),d=!0))},y=t("#header"),w=y.offset().top,b=0,x=function(){var n=t(e).scrollTop(),a=f.height(),o=s.offset().top;f.length&&!i()&&(n>=a?(y.addClass("emmis-fixed"),s.addClass("emmis-fixed")):o>=n&&(y.removeClass("emmis-fixed"),s.removeClass("emmis-fixed"))),f.length||i()||!t("body").hasClass("indianapolis")&&!t("body").hasClass("emmis-children/indianapolis")?(y.removeClass("indy-nav-fixed"),t("#navigation").removeClass("indy-nav-fixed-show")):(n>w&&!t(".dropdown-open").length?(y.addClass("indy-nav-fixed"),n>b?t("#navigation").removeClass("indy-nav-fixed-show"):t("#navigation").addClass("indy-nav-fixed-show")):(y.removeClass("indy-nav-fixed"),t("#navigation").removeClass("indy-nav-fixed-show")),b=n)},C=function(){t(".module-featuredgrid").length&&!i()&&t(".module-featuredgrid").each(function(){var e=t(this).find(".feat-grid-1-2");if(t(this).find(".feat-grid-2-2").length){var i=t(this).find(".feat-grid-2-2").find(".story");i.height(e.height()/2-5)}else if(t(this).find(".feat-grid-3-2").length){var n=t(this).find(".feat-grid-3-2").find(".story");n.height(e.height()/3-7)}})},k=function(e,t){var i=e/t;return i},T=function(){if(t(".gallery").length){var e=t(".gallery-main");e.find("> div").length>1&&(e.owlCarousel({items:1,nav:!0,dots:!1,navText:!1,animateOut:"fadeOut",animateIn:"fadeIn",lazyLoad:!0,responsive:{0:{autoHeight:!0},768:{autoHeight:!1}}}),e.find(".gallery-ad").length&&e.on("changed.owl.carousel",function(e){loadGalleryAd(e.item.index)})),e.find("img").each(function(){var e=t(this),i=e.data("width"),n=e.data("height");k(i,n)>1?e.addClass("image-landscape"):1>k(i,n)?e.addClass("image-portrait"):e.addClass("image-square")}),e.magnificPopup({delegate:"a",type:"image",gallery:{enabled:!0},closeOnContentClick:!0}),t(".gallery-thumbnails").find("a").on("click",function(i){i.preventDefault();var n=t(this).index();if(e.find(".gallery-ad").length){var a=n/5;0!==Math.floor(a)&&(n+=Math.floor(a))}e.trigger("to.owl.carousel",[n])}),t(".gallery-caption-toggle").on("click",function(e){e.preventDefault(),t(".gallery-caption > div").toggle()})}},_=t(".content-left"),P=t(".sidebar-right"),D=t(".sticky-ad"),j=t("#pre-footer"),I=function(){if(D.length&&!n()&&D.prev(".module").length&&!a()){var i=D.prev(".module").offset().top+D.prev(".module").outerHeight(),o=j.offset().top-t(".sticky-ad").outerHeight(!0);t(e).scrollTop()>=i&&_.height()>P.height()&&o>=t(e).scrollTop()?D.addClass("ad-fixed").attr("style",""):t(e).scrollTop()>=i&&_.height()>P.height()&&t(e).scrollTop()>o?(D.attr("style","position: absolute; top: "+o+"px; width: 300px !important;"),D.removeClass("ad-fixed")):D.removeClass("ad-fixed")}else n()&&D.removeClass("ad-fixed")},M=function(){t("#content .related-posts").each(function(){var e=t(this).find('> [class*="col-"] a');e.height(e.width())}),t("#content .module-gallery-row").each(function(){var e=t(this).find('> a[class*="col-"]');e.each(function(){t(this).hasClass("col-2-4")&&!i()?t(this).height(t(this).outerWidth(!0)+10):t(this).hasClass("col-3-4")&&!i()?t(this).height(t(this).outerWidth(!0)+20):t(this).height(t(this).outerWidth(!0))})}),t("#content .row").not(".related-posts").not(".module-gallery-row").each(function(){var e=t(this).find('> [class*="col-"]'),a=[];if(i()||n())e.css("min-height","0");else{e.css("min-height","0"),e.each(function(){var e=t(this).height();a.push(e)});var o=Math.max.apply(Math,a);e.css("min-height",o)}})},S=function(){t(".image-lightbox").length&&t(".image-lightbox").magnificPopup({type:"image"}),t(".iframe-lightbox").length&&t(".iframe-lightbox").magnificPopup({type:"iframe"}),t(".inline-lightbox").length&&t(".inline-lightbox").magnificPopup({type:"inline"})},O=function(){if(t("#tab-links").length){var i=t("#tab-links"),n=t("#tab-container"),a=e.location.hash;a&&t(a).length&&(i.find(".active-tab").removeClass("active-tab"),i.find('a[href="'+a+'"]').addClass("active-tab"),n.find("> div").hide(),t(a).fadeIn("fast")),i.find("a").on("click",function(i){i.preventDefault();var a=t(this),o=a.attr("href");if(a.addClass("active-tab").parent("li").siblings("li").find("a").removeClass("active-tab"),n.find("> div").hide(),t(o).fadeIn("fast"),e.history.pushState){var r=o;e.history.pushState({},"",r)}}),t(".tab-link").length&&t(".tab-link").on("click",function(e){e.preventDefault();var n=t(this).attr("href");i.find('a[href="'+n+'"]').trigger("click")})}},z=function(){t('a[href="#comments"]').on("click",function(i){i.preventDefault();var n=t("#comments").offset().top;t(e).scrollTop(n-y.height()-100)})};t(document).ready(function(){t(".entry-content").fitVids({ignore:".BrightcoveExperience"}),o(),Q(),R(),W(),z()}),t(e).load(function(){var e=t("#rating");e.length&&e.barrating("show",{showValues:!0,showSelectedRating:!1,onSelect:function(i){var n=e.data("entry");t.ajax({type:"POST",url:emmis_favoriting.ajaxurl,data:{action:"emmis_entry_vote",_article_favoriting_nonce:emmis_favoriting.favoriting_nonce,entry_id:n,value:i},success:function(e){if(e.success===!0){var t=new Date;t.setTime(t.getTime()+864e5);var i="; expires="+t.toGMTString(),a="voted-"+n,o="yes";document.cookie=a+"="+o+i+"; path=/",alert("Vote recorded!")}else alert("Vote not recorded! Try again later.")}})}}),l(),O(),T(),S(),H(),m(),C(),M()}),t(e).smartresize(function(){m(),C(),M(),I()}),t(e).scroll(function(){x(),I()});var F=function(e,i){t("body:first").append('<iframe style="position:fixed;top:100px;left:100px;height:1px;width:1px;border:none;" id="printFrame-'+e+'" name="printFrame-'+e+'" src="'+i+'" onload="frames[\'printFrame-'+e+"'].focus();frames['printFrame-"+e+"'].print();\"></iframe>")};t(".business-utils .icon-print").on("click",function(){var e=t(this).attr("href"),i=function(){if(-1==e.indexOf("#print")){var t=(new Date).getTime();F(t,e)}else print()};return i(),!1});var H=function(){var e=t(".entry-sort input"),i=t(".entry-sort select");e.length&&e.on("click",function(e){e.preventDefault();var t=i.val();V("sort",t)})},V=function(e,t){e=encodeURI(e),t=encodeURI(t);for(var i,n=document.location.search.substr(1).split("&"),a=n.length;a--;)if(i=n[a].split("="),i[0]==e){i[1]=t,n[a]=i.join("=");break}0>a&&(n[n.length]=[e,t].join("=")),document.location.search=n.join("&")},Q=function(){var e=t("#signup_username"),i=t("#signup_email"),n=t("#signup_submit");e.length&&n.length&&n.on("click",function(){e.val(i.val())})},R=function(){var e=t("#newsletter");if(e.length){var i=t("#nl-email"),n=t("#nl-subscribe"),a=t("#nl-insider");a.on("change",function(){e.find(".insider").slideToggle()}),n.on("click",function(){return""===i.val()?(alert("Please enter an email"),!1):t("#newsletter form ul input[type=checkbox]:checked").length?(a.prop("checked")&&e.find(":text").each(function(){return""===t(this).val()?(alert("Please fill in all fields"),!1):undefined}),undefined):(alert("Please choose at least one newsletter"),!1)})}},W=function(){var e=t("#loginform");if(e.length){var i=t("#user_login"),n=t("#user_pass"),a=t("#wp-submit");a.on("click",function(){return""===i.val()?(alert("Please enter your username"),!1):""===n.val()?(alert("Please enter your password"),!1):undefined})}}}(this,jQuery);