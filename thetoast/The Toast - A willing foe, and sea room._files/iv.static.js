window.pp.inview=function(a){this.adSlotId=a.adSlotId;this.ad=document.getElementById(this.adSlotId);this.logEndpoint=a.logEndpoint;this.sampleTime=a.sampleTime?a.sampleTime:50;this.partialSegmentSize=a.partialSegmentSize?a.partialSegmentSize:10;this.context=a.context;this.result={sessionTime:0,pageInView:0,adHover:0,partialInView:[],areaInViewOnUnload:0};this.pageFocus=!0};
window.pp.inview.prototype={initialize:function(){if(null!=this.ad){var a=this;this.adPosition=this.getAdPosition(this.ad);this.adSize=this.getAdSize(this.ad);this.attachMouseHover(this.ad);this.attachMouseClick(this.ad);this.attachPageBlur(window);this.attachUnloadEvent();this.createPartialInViewSegments(this.partialSegmentSize);a.timer=setInterval(function(){a.evaluate()},this.sampleTime)}},evaluate:function(){this.result.sessionTime+=this.sampleTime;if(this.pageFocus){this.result.pageInView+=this.sampleTime;
var a=this.getAdInViewData();0<a.areaInView&&(a=this.findPartialSegment(a.areaInView,this.partialSegmentSize),0<=a&&(this.result.partialInView[a]+=this.sampleTime));this.mouseOver&&(this.result.adHover+=this.sampleTime)}},getAdInViewData:function(){var a=this.adPosition,b=this.adSize,c=this.getPagePosition(),f=this.getPageSize(),d=[a.x,a.x+b.x],e=[c.x,c.x+f.x],a=[a.y,a.y+b.y],c=[c.y,c.y+f.y],g=f=0;d[0]>=e[0]&&d[1]<=e[1]?f=b.x:d[0]>=e[0]&&d[0]<=e[1]?f=e[1]-d[0]:d[1]>=e[0]&&d[1]<=e[1]&&(f=d[1]-e[0]);
a[0]>=c[0]&&a[1]<=c[1]?g=b.y:a[0]>=c[0]&&a[0]<=c[1]?g=c[1]-a[0]:a[1]>=c[0]&&a[1]<=c[1]&&(g=a[1]-c[0]);return{areaInView:Math.floor(100*(f*g/(b.x*b.y)))}},attachUnloadEvent:function(){var a=this;this.attachEvent(window,"beforeunload",function(){a.logData()})},logData:function(){var a=this.getAdInViewData().areaInView,a=isNaN(a)?0:a;this.result.areaInViewOnUnload=a;window.XDomainRequest?xmlhttp=new XDomainRequest:window.XMLHttpRequest&&(xmlhttp=new XMLHttpRequest);xmlhttp&&(xmlhttp.open("GET",this.logEndpoint+
this.generateQueryString(),!1),xmlhttp.send())},generateQueryString:function(){var a="?";if(this.context)for(attr in this.context)a+=this.qs(attr,this.context[attr]);for(var a=a+this.qs("hv",this.result.adHover),a=a+this.qs("piv",this.result.pageInView),b=100/this.partialSegmentSize,c=1;c<=b;c++)a+=this.qs("p"+10*c,this.result.partialInView[c-1]);a+=this.qs("iv_unl",this.result.areaInViewOnUnload);return a+=this.qs("stime",this.result.sessionTime,!0)},qs:function(a,b,c){return a+"="+encodeURIComponent(b)+
(c?"":"&")},attachMouseHover:function(a){var b=this;this.attachEvent(a,"mouseover",function(){b.mouseOver=!0});this.attachEvent(a,"mouseout",function(){b.mouseOver=!1})},attachMouseClick:function(a){var b=this;this.attachEvent(a,"click",function(a){b.result.interaction={x:a.pageX-b.adPosition.x,y:a.pageY-b.adPosition.y}})},attachPageBlur:function(a){var b=this;this.attachEvent(a,"focus",function(){b.pageFocus=!0});this.attachEvent(a,"blur",function(){b.pageFocus=!1})},getAdPosition:function(a){for(var b=
0,c=0;null!=a;b+=a.offsetLeft,c+=a.offsetTop,a=a.offsetParent);return{x:b,y:c}},getPagePosition:function(){var a=document.documentElement,b=document.body;return{x:a&&a.scrollLeft||b&&b.scrollLeft||0,y:a&&a.scrollTop||b&&b.scrollTop||0}},getPageSize:function(){return window.innerWidth?{x:window.innerWidth,y:window.innerHeight}:document.all?{x:document.body.clientWidth,y:document.body.clientHeight}:{x:0,y:0}},getAdSize:function(a){a=a.getBoundingClientRect();return{x:a.width,y:a.height}},attachEvent:function(a,
b,c){this.isDefined(a.addEventListener)?a.addEventListener(b,c,!1):this.isDefined(a.attachEvent)&&a.attachEvent("on"+b,c)},createPartialInViewSegments:function(a){for(var a=100/a,b=0;b<a;b++)this.result.partialInView.push(0)},findPartialSegment:function(a,b){for(var c=100/b;1<=c;c--)if(a>=c*b)return c-1;return-1},isDefined:function(a){return"undefined"!=typeof a}};"undefined"!=typeof pp_iv_ctx&&(new pp.inview(pp_iv_ctx)).initialize();