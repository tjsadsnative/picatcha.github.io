var BFUtils={protocol:"",prefixes:["webkit","moz","ms","o"],isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},isTouchDevice:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?!0:!1},bindEvent:function(n,t,i,r){n==window&&t=="load"&&document.readyState=="complete"?i(null):n.addEventListener?n.addEventListener(t,i,r):n.attachEvent&&n.attachEvent("on"+t,i)},setVendorStyle:function(n,t,i,r){for(var f=t.charAt(0).toUpperCase()+t.slice(1),u=0;u<this.prefixes.length;u++)n.style[this.prefixes[u]+f]=r?"-"+this.prefixes[u]+"-"+i:i;n.style[t]=i},unbindEvent:function(n,t,i){n.removeEventListener?n.removeEventListener(t,i):n.detachEvent&&n.detachEvent("on"+t,i)},trackingData:function(n,t){for(var r=[],u=[],i=0;i<t.length;i++)r.push(t[i].id),u.push(t[i].bannerset);return{account:n.account.id,brand:n.brand.id,placement:n.id,ad:n.ad.id,bannerset:u.join(),banner:r.join(),cb:(new Date).getMilliseconds()}},getImpressionPixelUrl:function(n,t){if(!n.bftracking.preview){var i=this.trackingData(n,t);return this.protocol+n.bftracking.url+encodeURIComponent(this.toJsonString(i))}},loadPixel:function(n){var t=new Image;t.src=n},getClickPixelUrl:function(n,t,i){var r,u;return n.bftracking.preview?"":(r=this.trackingData(n,[t]),r.spotIndexes=i.index,r.bannerIds=t.id,u=encodeURIComponent(this.toJsonString(r)),n.bftracking.clickUrl+u)},trackImpression:function(n,t){var i,r,u;n.bftracking&&!n.bftracking.preview&&this.loadPixel(this.getImpressionPixelUrl(n,[n.$bannersToDisplay[0]],this.protocol));t.impressionpixel&&(i=decodeURIComponent(t.impressionpixel),i=i+(i.indexOf("?")>-1?"&":"?")+"cb="+(new Date).getTime(),this.loadPixel(i));t.impressionscript&&(r=document.createElement("script"),r.type="text/javascript",r.async=!0,r.src=decodeURIComponent(t.impressionscript),u=document.getElementsByTagName("script"),u.length>0&&u[0].parentNode.insertBefore(r,u[0]));n.network&&n.network.tag.patternImpressionPixel&&this.loadPixel(this.protocol+this.resolveMacros(n.network.tag.patternImpressionPixel,this.getMacros(t)))},click:function(n,t,i){var o,s,r,e,u,f;i||(i=0);o=this.getClickPixelUrl(n,n.ad.spots[i].selectedBanner,n.ad.spots[i]);o&&this.loadPixel(o);t.clickpixel&&(s=new Image,s.src=decodeURIComponent(t.clickpixel));t.clickscript&&(r=document.createElement("script"),r.type="text/javascript",r.async=!0,r.src=decodeURIComponent(t.clickscript),e=document.getElementsByTagName("script"),e.length>0&&e[0].parentNode.insertBefore(r,e[0]));u=n.ad.spots[i].selectedBanner.targeturl;f=n.targetUrl||u;f=f.replace(/\[target_url\]/gi,u).replace(/\[target_url_esc\]/gi,encodeURIComponent(u)).replace(/\[target_url_esc_esc\]/gi,encodeURIComponent(encodeURIComponent(u)));f&&window.open(f,n.targetWindow||"_blank")},resolveMacros:function(n,t){var f=["_double-escaped%","_escaped%","%"],i,u,r;for(n=n.replace("%random%",(new Date).getTime()),i=0;i<f.length;i++)for(u in t)r=t[u],i==0?r=encodeURIComponent(encodeURIComponent(r)):i==1&&(r=encodeURIComponent(r)),n=n.replace(new RegExp("%"+u+f[i],"gi"),r);return n},getMacros:function(n){var t={};for(var i in n)t["parameter_"+i]=n[i];return t},toJsonString:function(n){var i,u,t,f,r;try{return JSON.stringify(n)}catch(e){if(i=typeof n,i!="object"||n===null)return i=="string"&&(n='"'+n+'"'),String(n);f=[];r=n&&n.constructor==Array;for(u in n)t=n[u],i=typeof t,i=="string"?t='"'+t+'"':i=="object"&&t!==null&&(t=JSON.stringify(t)),f.push((r?"":'"'+u+'":')+String(t));return(r?"[":"{")+String(f)+(r?"]":"}")}},dispatchEvent:function(n,t,i){var r,f,u,e;try{r=new Event(n)}catch(o){r=document.createEvent("Event");r.initEvent(n,!0,!1)}if(r.data=t,i&&document.createEvent)i.dispatchEvent(r);else if(vars._listeners[r.type]instanceof Array)for(f=vars._listeners[r.type],u=0,e=f.length;u<e;u++)f[u].call(vars,r,t)},urlParametersToJson:function(n){for(var i,f=n.indexOf("?")>-1?n.split("?")[1]:n,r=f.split("&"),u={},t=0;t<r.length;t++)i=r[t].split("="),u[i[0]]=i[1];return u},isInView:function(n,t){return n.getBoundingClientRect?t?this.viewGrade(n)>0:this.viewGrade(n)>=1:!1},viewGrade:function(n){if(!n.getBoundingClientRect)return 0;var t=n.getBoundingClientRect(),i=window.innerWidth||document.documentElement.clientWidth,r=window.innerHeight||document.documentElement.clientHeight,u=Math.min(t.width,Math.max(0,t.left+t.width))/t.width,f=Math.min(t.width,Math.max(0,i-t.left))/t.width,e=Math.min(t.height,Math.max(0,t.top+t.height))/t.height,o=Math.min(t.height,Math.max(0,r-t.top))/t.height;return u*f*e*o},getTrackingData:function(n){n.$sid=n.$sid||Date.now()+"_"+Math.floor(Math.random()*1e3);var t=n.$bannersToDisplay;return{u:{s:n.$sid,d:{r:window.screen.availHeigh+"x"+window.screen.availWidth},r:window.location!=window.parent.location?document.referrer:document.location.href},a:{a:n.account.id,br:n.brand.id,c:t&&t[0]?t[0].bannerset:0,ad:n.ad.id,p:n.id,b:t&&t[0]?t[0].id:0,pl:n.politeloading?1:0,r:n.responsive?1:0,an:n.displayType=="animated"?1:0}}},queueTrackingEvent:function(n,t,i,r){var u=this;n.$tq=n.$tq||[];n.$tq.push({t:t,v:i});r?(n.$tto&&clearTimeout(n.$tto),n.$tto=null,u.sendTrackingData(n)):n.$tto||(n.$tto=setTimeout(function(){n.$tto=null;u.sendTrackingData(n)},2e3))},sendTrackingData:function(n){if(!n.bftracking.preview){for(var t=n.$tq,r=this.getTrackingData(n),e="http://requestb.in/1hlmmq21?data="+encodeURIComponent(this.toJsonString(r)),o=e.length;t.length;){for(var i=t.length,u=t.slice(0,i),f=encodeURIComponent(this.toJsonString(u));o+f.length>2e3&&i>1;)i--,u=t.slice(0,i),f=encodeURIComponent(this.toJsonString(u));r.e=t.splice(0,i);this.loadPixel("http://requestb.in/1hlmmq21?data="+encodeURIComponent(this.toJsonString(r)))}n.$tq=[]}},supportsHtml5:function(){var e,i,r,u,f,t;if(navigator.userAgent.indexOf("Android")>-1&&((e=Number(navigator.userAgent.match(/Android\s(.*?);/i)[1].split(".").slice(0,2).join(".")),e<4.1)||navigator.userAgent.indexOf("Firefox")>-1)||(i=function(){for(var i,n=3,t=document.createElement("div"),r=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+ ++n+"]><i><\/i><![endif]-->",r[0];);return n>4?n:i}(),i&&i<10))return!1;if(navigator.appVersion)try{if(r=navigator.appVersion.split("/"),u=r[r.length-2],u.indexOf("Safari")>-1&&Number(u.split(".")[0])<=5)return!1}catch(h){}var s=document.body||document.documentElement,o=s.style,n="transition";if(typeof o[n]=="string")return!0;for(f=["Moz","webkit","Webkit","Khtml","O","ms"],n=n.charAt(0).toUpperCase()+n.substr(1),t=0;t<f.length;t++)if(typeof o[f[t]+n]=="string")return!0;return!1}},BannerFlowRender=function(n,t,i){function f(n,t){var i;document.createEvent?(i=document.createEvent("HTMLEvents"),i.initEvent(t,!0,!0)):(i=document.createEventObject(),i.eventType=t);i.eventName=t;document.createEvent&&n.dispatchEvent(i)}function p(){e(window,"message",w);this.eventListenerInitiated=!0}function w(n){var t,i;if(n.data){if(t=n.data.toString().split(";"),t.length<5)return;i={containerId:t[0],spotId:t[1],bannerId:t[2],type:t[3],data:t[4],source:n.target};i.containerId==r.id&&f(r.firstChild.children[i.spotId],i.type)}}function e(n,t,i){n==window&&t=="load"&&document.readyState=="complete"?i(null):n==document&&t=="ready"&&(document.readyState=="interactive"||document.readyState=="complete")?i(null):n.addEventListener?n.addEventListener(t,i,!1):n.attachEvent&&n.attachEvent("on"+t,i)}function a(){var t=r.firstChild,l=t.firstChild.children[0],c=!1,s=r.offsetWidth/parseInt(n.ad.spots[0].size.width),h=o(n.ad.size.width)/o(n.ad.size.height),i,f,e;if(n.$vars.$scale=s||1,i=n.ad.type.dependencies,i.length>1)for(f=1;f<i.length;f++)e=i[f],e.func&&this[e.func+"Resize"]&&this[e.func+"Resize"](r,n,s)&&(c=!0);c||(u.supportsHtml5()&&(u.setVendorStyle(t,"transform","scale("+s+")translate3d(0,0,0)"),u.setVendorStyle(t,"transformOrigin","0 0")),t.style.width=r.offsetWidth+"px",t.style.height=t.parentNode.offsetWidth/h+"px",r.style.height=r.parentNode.offsetWidth/h+"px",r.style.height=t.style.height=r.offsetWidth/h+"px")}function b(){var i="";for(var n in t)",targetwindow,targeturl,display,responsive,politeloading,".indexOf(","+n+",")==-1&&(i+="&"+n+"="+t[n]);return i}function v(n,t,i){p();f(i,"loaded");t.politeloading&&(n.politeLoading=t.politeloading!="off");t.targeturl&&(n.targetUrl=t.targeturl);t.targetwindow&&(n.targetWindow=t.targetwindow);t.display&&(n.displayType=t.display);t.responsive&&(n.responsive=t.responsive=="on");r=g(n.ad.size,i);n.responsive&&e(window,"load",function(){e(window,"resize",a)});n.targetUrl&&n.targetUrl.length>0&&(n.targetUrl.toLowerCase().indexOf("www")==0&&(n.targetUrl="http://"+n.targetUrl),n.targetUrl.substring(n.targetUrl.length-1)=="="&&(n.targetUrl+="[target_url_esc]"),n.targetUrl.substring(n.targetUrl.length-3)=="%3D"&&(n.targetUrl+="[target_url_esc_esc]"));n.displayType!="animated"||u.supportsHtml5()||(n.displayType="image");/firefox/i.test(navigator.userAgent)&&(n.politeLoading=!1);nt()||(n.ad.type.$unsupported=!0);n.$bannersToDisplay=d(n,t.localization);k(n.$bannersToDisplay,n,r.firstChild);var o=function(){var t=u.isInView(r,!0),e=u.viewGrade(r),i;n.$iv&&!t&&(n.$iv=t,f(r,"notinview"));n.hasOwnProperty("inView")&&n.$iv||!t||(n.$iv=t,f(r,"inview"));i=n.ad.size.width*n.ad.size.height>121e3?.3:.5;n.$tii&&clearInterval(n.$tii);n.$vt&&(n.$tiv=(n.$tiv||0)+(Date.now()-n.$vt),n.$tiv>1e3&&!n.$tivf?(u.queueTrackingEvent(n,3,{}),n.$tivf=!0):n.$tivf||(n.$tii=setInterval(o,1e3)));n.$vt=null;e>=i&&(n.$vt=Date.now())};n.ad.type.settings.stopRender||u.trackImpression(n,t);f(i,"rendered");n.$it=Date.now()}function k(n,t,i){function b(){var n=y.length;l&&p=="animated"&&n++;w==n&&(l&&f(i,"politedone"),f(i,"bannersloaded"))}function k(){for(var u,f=l&&p=="animated"?0:1,r=f;r<y.length;r++)u=h(t.ad.spots[r],n[r],t.displayType),u.style.opacity=0,i.children[r].appendChild(u),u.onload=function(){var n,t;w++;this.onload=null;n=parseInt(this["data-index"]||0);i.children[n].firstChild&&n==0&&(t=i.children[n].firstChild,t.style.zIndex="1",t.style.opacity=0,setTimeout(function(){t.style.display="none"},300));this.style.opacity="1";b()}}for(var c,y=[],g=t.ad.type.$unsupported?1:n.length,l=t.politeLoading,p=t.displayType,w=0,v=0;v<g;v++){var d=n[v],s=t.ad.spots[v],r=document.createElement("div");r.style.width=t.responsive&&!u.supportsHtml5()?o(s.size.width)/o(t.ad.size.width)*100+"%":s.size.width;r.style.height=t.responsive&&!u.supportsHtml5()?o(s.size.height)/o(t.ad.size.height)*100+"%":s.size.height;v==0?(c=p=="image"||l&&p=="animated"?h(s,d,"image"):h(s,d,"animated"),e(c,"load",function(){w++;c.style.opacity=1;b()}),c.style.transition="opacity 0.2s",c.style.opacity=0,r.appendChild(c)):(r.style.display="none",r.style.position="absolute",r.style.top="0",r.style.left="0");y.push(r);i.appendChild(r)}return l?e(window,"load",k):k(),t.responsive&&a(),y}function h(i,r,f){var e=document.createElement("iframe"),o=f=="image"?r.srcImage:r.srcAnimated,c=n.network.tag,s=u.getClickPixelUrl(n,r,i),a=n.network.tag,h=(o.indexOf("?")>-1?"&":"?")+"clickpixel="+encodeURIComponent(s)+(n.targetUrl?"&targeturl="+encodeURIComponent(n.targetUrl):"")+"&targetwindow="+n.targetWindow+b();return e.src=(o.indexOf("http")==0||o.indexOf("/api")==0?"":l)+o+h,e.className="bf_"+f,e.setAttribute("style","max-width: none !important;max-height: none !important;"),e.style.width=n.responsive&&!u.supportsHtml5()?"100%":i.size.width,e.style.height=n.responsive&&!u.supportsHtml5()?"100%":i.size.height,e.style.position="absolute",e.style.top=e.style.left="0",e.style.backgroundColor=t["background-color"]?t["background-color"]:"transparent",e.frameBorder=0,e.allowtransparency="true",e.style.border="none",e.scrolling="no",e["data-index"]=i.index,e}function d(n,t){for(var r,i,s,v,l,f,y,c,u,o,e,a=[],h=0;h<n.ad.spots.length;h++){r=n.ad.spots[h];switch(r.type){case"regular":s=r.selections[0];break;case"ab-test":for(v=Math.random(),l=0,u=0;u<r.selections.length;u++)if(l+=r.selections[u].weight,v<=l){s=r.selections[u];break}break;default:console.log("Incorrect ad type: "+r.id+" - "+r.type.name)}if(s){if(f=s.banners,f.length>1)if(s.localization==null){for(y=t?t.substr(0,2):(navigator.userLanguage?navigator.userLanguage.toLowerCase():window.navigator.language?window.navigator.language.toLowerCase():n.brand.defaultLocalization).substr(0,2),o=0;o<f.length;o++)for(e=f[o],c=e.localization.split(","),u=0;u<c.length;u++)if(c[u].split("-")[0]==y){i=e;break}else c[u]!=n.brand.defaultLocalization||i||(i=e);i||(i=f[0])}else for(o=0;o<f.length;o++)if(e=f[o],r.localization.indexOf(e.localization)>-1){i=e;break}else e.localization!=n.brand.defaultLocalization||i||(i=e);else f.length==1?i=f[0]:console.log("No banner available in selection for spot: "+r.id);i?a.push(i):console.log("No banner was selected/found for spot: "+r.id);n.ad.spots[h].selectedBanner=i}}return a}function g(t,i){var r,u=y.container||n.container,f;return u||!c?u?(r=document.getElementById(u),r.innerHTML=""):r=document.body:(r=document.createElement("div"),r.id="bf"+(new Date).getTime(),r.style.width=n.responsive?"100%":t.width,r.style.height=n.responsive?"100%":t.height,r.style.overflow="hidden",r.style.position="relative",n.ad.type.settings.stopRender||i.parentNode.insertBefore(r,i.nextSibling)),f=document.createElement("div"),r.appendChild(f),r}function nt(){var r=n.ad.type.dependencies,t,i;if(r.length>1)for(t=1;t<r.length;t++)if(i=r[t],i.func&&this[i.func+"Compatible"]&&!this[i.func+"Compatible"](n))return!1;return!0}function o(n){return n.replace(/\D/g,"")}var u=BFUtils,s;n.$vars=n.$vars||{};try{n.account&&n.account.id=="mr-green"&&myFT&&(s=document.getElementById("banner"),s&&(s.style.opacity="0",s.style.background="#fff"))}catch(tt){}var r,c=!0,y=u.urlParametersToJson(i.src),l=i.src.indexOf("http")==0?i.src.split("/")[0]:"";return u.protocol=l,i.parentNode.nodeName!="HEAD"?v(n,t,i):e(document,"ready",function(){c=!1;v(n,t,i)}),r};window.BFUtils=BFUtils;window.BannerFlowRender=BannerFlowRender;