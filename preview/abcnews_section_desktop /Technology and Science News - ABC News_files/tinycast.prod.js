/*! tinycast 2015-11-02 */
!function(){if(window.WEB_SOCKET_FORCE_FLASH);else{if(window.WebSocket)return;if(window.MozWebSocket)return void(window.WebSocket=MozWebSocket)}var logger;return logger=window.WEB_SOCKET_LOGGER?WEB_SOCKET_LOGGER:window.console&&window.console.log&&window.console.error?window.console:{log:function(){},error:function(){}},swfobject.getFlashPlayerVersion().major<10?void logger.error("Flash Player >= 10.0.0 is required."):("file:"==location.protocol&&logger.error("WARNING: web-socket-js doesn't work in file:///... URL unless you set Flash Security Settings properly. Open the page via Web server i.e. http://..."),window.WebSocket=function(url,protocols,proxyHost,proxyPort,headers){var self=this;self.__id=WebSocket.__nextId++,WebSocket.__instances[self.__id]=self,self.readyState=WebSocket.CONNECTING,self.bufferedAmount=0,self.__events={},protocols?"string"==typeof protocols&&(protocols=[protocols]):protocols=[],self.__createTask=setTimeout(function(){WebSocket.__addTask(function(){self.__createTask=null,WebSocket.__flash.create(self.__id,url,protocols,proxyHost||null,proxyPort||0,headers||null)})},0)},WebSocket.prototype.send=function(data){if(this.readyState==WebSocket.CONNECTING)throw"INVALID_STATE_ERR: Web Socket connection has not been established";var result=WebSocket.__flash.send(this.__id,encodeURIComponent(data));return 0>result?!0:(this.bufferedAmount+=result,!1)},WebSocket.prototype.close=function(){return this.__createTask?(clearTimeout(this.__createTask),this.__createTask=null,void(this.readyState=WebSocket.CLOSED)):void(this.readyState!=WebSocket.CLOSED&&this.readyState!=WebSocket.CLOSING&&(this.readyState=WebSocket.CLOSING,WebSocket.__flash.close(this.__id)))},WebSocket.prototype.addEventListener=function(type,listener,useCapture){type in this.__events||(this.__events[type]=[]),this.__events[type].push(listener)},WebSocket.prototype.removeEventListener=function(type,listener,useCapture){if(type in this.__events)for(var events=this.__events[type],i=events.length-1;i>=0;--i)if(events[i]===listener){events.splice(i,1);break}},WebSocket.prototype.dispatchEvent=function(event){for(var events=this.__events[event.type]||[],i=0;i<events.length;++i)events[i](event);var handler=this["on"+event.type];handler&&handler.apply(this,[event])},WebSocket.prototype.__handleEvent=function(flashEvent){"readyState"in flashEvent&&(this.readyState=flashEvent.readyState),"protocol"in flashEvent&&(this.protocol=flashEvent.protocol);var jsEvent;if("open"==flashEvent.type||"error"==flashEvent.type)jsEvent=this.__createSimpleEvent(flashEvent.type);else if("close"==flashEvent.type)jsEvent=this.__createSimpleEvent("close"),jsEvent.wasClean=flashEvent.wasClean?!0:!1,jsEvent.code=flashEvent.code,jsEvent.reason=flashEvent.reason;else{if("message"!=flashEvent.type)throw"unknown event type: "+flashEvent.type;var data=decodeURIComponent(flashEvent.message);jsEvent=this.__createMessageEvent("message",data)}this.dispatchEvent(jsEvent)},WebSocket.prototype.__createSimpleEvent=function(type){if(document.createEvent&&window.Event){var event=document.createEvent("Event");return event.initEvent(type,!1,!1),event}return{type:type,bubbles:!1,cancelable:!1}},WebSocket.prototype.__createMessageEvent=function(type,data){if(window.MessageEvent&&"function"==typeof MessageEvent&&!window.opera)return new MessageEvent("message",{view:window,bubbles:!1,cancelable:!1,data:data});if(document.createEvent&&window.MessageEvent&&!window.opera){var event=document.createEvent("MessageEvent");return event.initMessageEvent("message",!1,!1,data,null,null,window,null),event}return{type:type,data:data,bubbles:!1,cancelable:!1}},WebSocket.CONNECTING=0,WebSocket.OPEN=1,WebSocket.CLOSING=2,WebSocket.CLOSED=3,WebSocket.__isFlashImplementation=!0,WebSocket.__initialized=!1,WebSocket.__flash=null,WebSocket.__instances={},WebSocket.__tasks=[],WebSocket.__nextId=0,WebSocket.loadFlashPolicyFile=function(url){WebSocket.__addTask(function(){WebSocket.__flash.loadManualPolicyFile(url)})},WebSocket.__initialize=function(){if(!WebSocket.__initialized){if(WebSocket.__initialized=!0,WebSocket.__swfLocation&&(window.WEB_SOCKET_SWF_LOCATION=WebSocket.__swfLocation),!window.WEB_SOCKET_SWF_LOCATION)return void logger.error("[WebSocket] set WEB_SOCKET_SWF_LOCATION to location of WebSocketMain.swf");if(!window.WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR&&!WEB_SOCKET_SWF_LOCATION.match(/(^|\/)WebSocketMainInsecure\.swf(\?.*)?$/)&&WEB_SOCKET_SWF_LOCATION.match(/^\w+:\/\/([^\/]+)/)){var swfHost=RegExp.$1;location.host!=swfHost&&logger.error("[WebSocket] You must host HTML and WebSocketMain.swf in the same host ('"+location.host+"' != '"+swfHost+"'). See also 'How to host HTML file and SWF file in different domains' section in README.md. If you use WebSocketMainInsecure.swf, you can suppress this message by WEB_SOCKET_SUPPRESS_CROSS_DOMAIN_SWF_ERROR = true;")}var container=document.createElement("div");container.id="webSocketContainer",container.style.position="absolute",WebSocket.__isFlashLite()?(container.style.left="0px",container.style.top="0px"):(container.style.left="-100px",container.style.top="-100px");var holder=document.createElement("div");holder.id="webSocketFlash",container.appendChild(holder),document.body.appendChild(container),swfobject.embedSWF(WEB_SOCKET_SWF_LOCATION,"webSocketFlash","1","1","10.0.0",null,null,{hasPriority:!0,swliveconnect:!0,allowScriptAccess:"always"},null,function(e){e.success||logger.error("[WebSocket] swfobject.embedSWF failed")})}},WebSocket.__onFlashInitialized=function(){setTimeout(function(){WebSocket.__flash=document.getElementById("webSocketFlash"),WebSocket.__flash.setCallerUrl(location.href),WebSocket.__flash.setDebug(!!window.WEB_SOCKET_DEBUG);for(var i=0;i<WebSocket.__tasks.length;++i)WebSocket.__tasks[i]();WebSocket.__tasks=[]},0)},WebSocket.__onFlashEvent=function(){return setTimeout(function(){try{for(var events=WebSocket.__flash.receiveEvents(),i=0;i<events.length;++i)WebSocket.__instances[events[i].webSocketId].__handleEvent(events[i])}catch(e){logger.error(e)}},0),!0},WebSocket.__log=function(message){logger.log(decodeURIComponent(message))},WebSocket.__error=function(message){logger.error(decodeURIComponent(message))},WebSocket.__addTask=function(task){WebSocket.__flash?task():WebSocket.__tasks.push(task)},WebSocket.__isFlashLite=function(){if(!window.navigator||!window.navigator.mimeTypes)return!1;var mimeType=window.navigator.mimeTypes["application/x-shockwave-flash"];return mimeType&&mimeType.enabledPlugin&&mimeType.enabledPlugin.filename&&mimeType.enabledPlugin.filename.match(/flashlite/i)?!0:!1},void(window.WEB_SOCKET_DISABLE_AUTO_INITIALIZATION||swfobject.addDomLoadEvent(function(){WebSocket.__initialize()})))}();var TinyCast={config:{host:"stg.fastcast.go.com",pid:"11001",ws_url:"/FastcastService/pubsub/profiles/",topic:"",sid:"",hasSubscribed:!1,lastB:0,intervalChecker:null,ws:null,onMessage:null},connectedChecker:function(){TinyCast.config.intervalChecker=setInterval(function(){var t=(new Date).getTime()/1e3,d=TinyCast.config.lastB;if(0!=parseInt(d)){var diff=parseInt(t)-parseInt(d);parseInt(diff)>=45&&(TinyCast.config.ws.onclose=function(){},TinyCast.config.ws.close(),TinyCast.easyInit({},TinyCast.config.onMessage))}},35e3)},easyInit:function(obj,onMessage){obj.path&&(WEB_SOCKET_SWF_LOCATION=obj.path+"/assets/fastcast/swf/WebSocketMain.swf"),obj.pid&&(TinyCast.config.pid=obj.pid),obj.topic?TinyCast.config.topic=obj.topic:"preview.abcnews.go.com"==window.location.hostname?TinyCast.config.topic="BREAKINGNEWSTEST":TinyCast.config.topic="BREAKINGNEWS",obj.host?TinyCast.config.host=obj.host:"preview.abcnews.go.com"==window.location.hostname?TinyCast.config.host="stg.fastcast.go.com":TinyCast.config.host="fastcast.go.com";var ws=new WebSocket("ws://"+TinyCast.config.host+TinyCast.config.ws_url+TinyCast.config.pid);TinyCast.config.ws=ws,TinyCast.config.onMessage=onMessage,ws.onopen=function(){ws.send(JSON.stringify({op:"C"}))},ws.onclose=function(){clearInterval(TinyCast.config.intervalChecker),TinyCast.config.hasSubscribed=!1,TinyCast.easyInit({},onMessage)},ws.onmessage=function(data){if(data.data){var jsonData=JSON.parse(data.data);if(jsonData.op)switch(jsonData.op){case"C":if(TinyCast.config.sid=jsonData.sid,!TinyCast.config.hasSubscribed){var sendObj={op:"S",tc:TinyCast.config.topic,sid:TinyCast.config.sid};ws.send(JSON.stringify(sendObj))}break;case"S":TinyCast.config.hasSubscribed=!0,TinyCast.connectedChecker();break;case"P":if("function"==typeof onMessage){var objToRet={data:JSON.parse(jsonData.pl),info:{tc:jsonData.tc,mid:jsonData.mid,op:jsonData.op}};onMessage(objToRet)}break;case"R":if("function"==typeof onMessage){var objToRet={data:JSON.parse(jsonData.pl),info:{tc:jsonData.tc,mid:jsonData.mid,op:jsonData.op}};onMessage(objToRet)}break;case"B":var d=(new Date).getTime()/1e3;TinyCast.config.lastB=d}}}}};