define(["jquery","version!fly/managers/debug","version!fly/managers/components","components/global-modal","components/loading","version!fly/components/form-validate"],function(e,t,n){t=t.init("modalAsync");var r=e.support.touch?"vclick":"click";e.widget("cnet.modalAsync",e.cnet.globalModal,{options:{url:null,data:null},_create:function(){this._super(),this.setContent('<a class="close" data-close="modal"></a>'),this._setupLoader()},_setupLoader:function(){var t=this;this.loader=e.cnet.loading(),this.loader.$element.addClass("modal-content")},open:function(){if(!this.isOpen&&this.options.url){var t=this;this.setContent(""),this.loader.$element.appendTo(this.$element),this.loader.add(),e.ajax({url:this.options.url,data:this.options.data}).done(function(r){t.loader.remove(),t.setContent(r),t.position(),n.process(t.$element),t._trigger("contentLoaded",null,e.extend({},this.eventData,{content:r}))}).always(function(){t.loader.remove()}),this._super()}}}),e(document).on(r+".modalAsync-api.data-api",'[data-open="modalAsync"]',function(t){var n=e(this),r=n.data(),i=r.$modal,s;t.preventDefault(),i?i.open():(s=n.data("modalAsyncOptions")||n.dataPrefix("modalAsync"),n.data("$modal",e.cnet.modalAsync(e.extend(s,{openOnInit:!0,destroy:function(){n.data("$modal",null)}}))))})})