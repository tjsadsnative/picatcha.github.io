/*
 Copyright 2014 Xaxis.
 All rights reserved.
 oas_manager.js
 http://www.xaxis.com/
 Author: Matt Kendall
 Version: 1.1.1
*/
oas_tag=function(p,j){var f={};f.url=oas_tag.url;f.sizes=oas_tag.sizes||{};f.site_page=oas_tag.site_page||"";f.query=oas_tag.query;f.taxonomy=oas_tag.taxonomy||"";f.anchorElementPrefix=oas_tag.anchorElementPrefix||"oas";f.implMode=oas_tag.implMode||{};f.callbackHandler=oas_tag.callbackHandler;f.analytics=oas_tag.analytics||!1;f.allowSizeOverride=oas_tag.allowSizeOverride||!1;f.logging=oas_tag.logging||!1;f.lazyload=oas_tag.lazyload||!1;f.enableRTB=oas_tag.enableRTB||!1;f.enableBackgroundLoading=oas_tag.enableBackgroundLoading||
!1;f.adStyles=oas_tag.adStyles||{};var n="",q={},C=!1,k={},h=[],m={},D=!1,A=!1,x={},E=!0,F=!1,r=[],G={},H=!1,s={},d={SCRIPT_ID_PREFIX:"oas_dx_",DIV_WRAPPER_ID_PREFIX:"oas_div_",IFRAME_ID_PREFIX:"oas_frame_",IMG_TRACK_ID_PREFIX:"oas_img_pixel_",JSONP_CALLBACK:"_RM_HTML_CALLBACK_=oas_tag.displayAds",DX_PATH:"/jp/",DX_PATH_RTB:"/jpl/",DEBUG_MODE:"oas_tag_debug",LOG_INFO:"INFO",LOG_WARN:"WARN",LOG_ERROR:"ERROR",AD:"Ad",CAMPAIGN_ID:"AccCampId",CAMPAIGN_KEY:"CampKey",CAMPAIGN_EXCLUDE_KEY:"ExclCamp",AD_HEIGHT:"H",
AD_WIDTH:"W",AD_POSITION:"Pos",AD_TYPE:"AdType",AD_CLICK_URL:"ClkUrl",AD_IMP_URL:"ImpUrl",AD_FILE_URL:"FileUrl",AD_ALT:"Alt",AD_EXTRA_HTML:"ExtraHT",AD_EXTRA_TEXT:"ExtraTx",AD_TARGET:"TargW",AD_CREATIVE_ID:"CreId",AD_CREATIVE:"Text",REFERRAL:"Ref",BT_SEGMENT:"BTSeg",CPA:"CPA",ECPM:"eCPM",CPC:"CPC",CPM:"CPM",IO:"IO",ADVERTISER:"AdvId"},v=function(a){return"[object Array]"===Object.prototype.toString.call(a)},I=function(){if(!1===f.logging&&!1===C){var a=f,b;b=RegExp("[\\?&]"+d.DEBUG_MODE+"=([^&#]*)").exec(p.location.search);
b=null===b?"":decodeURIComponent(b[1].replace(/\+/g," "));a.logging=!!b;C=!0}return f.logging?!0:!1},g=function(a,b){var c=p,e;if(I())if(b){e=new Date;e=e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()+":"+e.getMilliseconds()+":"+b+":"+a+" - ";var f;f=(new Date).getTime()-G.initialLoad;a=e+ +f+"ms from DX library loading initially";b===d.LOG_INFO?c.console&&c.console.info?c.console.info(a):c.console&&c.console.log&&c.console.log(a):b===d.LOG_WARN?c.console&&c.console.warn?c.console.warn(a):c.console&&
c.console.log&&c.console.log(a):b===d.LOG_ERROR&&(c.console&&c.console.error?c.console.error(a):c.console&&c.console.log&&c.console.log(a))}else c.console&&c.console.log&&c.console.log(a)},J=function(a){this.height=a[d.AD_HEIGHT];this.width=a[d.AD_WIDTH];this.position=a[d.AD_POSITION];this.clickUrl=a[d.AD_CLICK_URL];this.fileUrl=a[d.AD_FILE_URL];this.impUrl=a[d.AD_IMP_URL];this.type=a[d.AD_TYPE];this.alt=a[d.AD_ALT];this.extraHtml=a[d.AD_EXTRA_HTML];this.extraText=a[d.AD_EXTRA_TEXT];this.campaignId=
a[d.CAMPAIGN_ID];this.target=a[d.AD_TARGET];this.creativeId=a[d.AD_CREATIVE_ID];this.creative=a[d.AD_CREATIVE];this.referral=a[d.REFERRAL];this.btSegment=a[d.BT_SEGMENT];this.cpa=a[d.CPA];this.ecpm=a[d.ECPM];this.cpm=a[d.CPC];this.cpc=a[d.CPM];this.io=a[d.IO];this.advertiser=a[d.ADVERTISER]},V=function(a,b,c){this.id=a;this.fn=b;this.event=c},K=function(a){var b;if("function"===typeof a)for(b=0;b<r.length;b++)a(r[b])},L=function(a){return k[a]&&k[a].size?k[a].size[1]:0},M=function(a){return k[a]&&
k[a].size?k[a].size[0]:0},y=function(a){return k[a]&&k[a].displayAd?k[a].displayAd:!1},N=function(a){var b;try{b=a.contentWindow?a.contentWindow.document:a.contentDocument.document?a.contentDocument.document:a.contentDocument}catch(c){}return b},O=function(a){for(var b=N(a).getElementsByTagName("a"),a=0;a<b.length;a++)"_self"===b[a].target&&(b[a].target="_top")},B=function(a){return j.getElementById(f.anchorElementPrefix+"_"+a)||j.getElementById(f.anchorElementPrefix.toUpperCase()+"_"+a)},z=function(a,
b,c){var e;a&&(e=new Image,e.id=d.IMG_TRACK_ID_PREFIX+c,""!==b&&(e.src=b),e.height=0,e.width=0,e.style.display="none",e.onload=function(){try{this.parentNode.removeChild(this)}catch(a){}},a.insertBefore(e,a.firstChild),g("Impression tracking for position: "+c,d.LOG_INFO))},w=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!0):a.attachEvent&&a.attachEvent("on"+b,c)},P=function(a,b){for(var c=0;c<b.length;c++){var e=b[c].split(":");1<e.length&&(g("attemping for these values: "+e[0]+" "+e[1],
d.INFO),a.style[e[0]]=e[1])}},Q=function(a,b){if(void 0!==f.adStyles[b]||void 0!==f.adStyles.all)if("none"===f.adStyles[b]||"none"===f.adStyles.all)a.removeAttribute("style");else if(""===f.adStyles[b]||""===f.adStyles.all)a.removeAttribute("style");else{a.removeAttribute("style");try{var c=[];f.adStyles.all&&(c=f.adStyles.all.split(";"));1<c.length&&P(a,c);c=[];f.adStyles[b]&&(c=f.adStyles[b].split(";"));1<c.length&&P(a,c)}catch(e){g("problem with div style. Check for proper syntax. Error: "+e.message,
d.LOG_WARN)}}},X=function(a,b){if(!b.deployed){var c=b[d.AD_POSITION],e,i=0,l=0,u;if(!1===y(c))g("Do not display Ad for Pos: "+c,d.LOG_INFO),b.deployed=!0;else if(l=i=0,f.allowSizeOverride?(i=b[d.AD_HEIGHT],"0"===i&&(i=L(c)||a.style.height),l=b[d.AD_WIDTH],"0"===l&&(l=M(c)||a.style.width)):(i=L(c)||a.style.height,l=M(c)||a.style.width),0===i||0===l||""===i||""===l)g("OAS Ad position "+c+" does not have a size set on the container div or in the Creative. Ignoring this placement",d.LOG_ERROR);else{g("Deploying Ad for "+
c+" with Campaign Id: "+b[d.CAMPAIGN_ID]+", Creative ID: "+b[d.AD_CREATIVE_ID],d.LOG_INFO);if(A)for(;a.hasChildNodes();)a.removeChild(a.firstChild);var k=b[d.AD_TYPE]&&"redirect"===b[d.AD_TYPE].toLowerCase()||b[d.AD_TYPE]&&-1!==b[d.AD_TYPE].toLowerCase().indexOf("image");if(k&&!1===f.enableRTB)e=b[d.AD_TARGET]||"_top",u='<a href="'+b[d.AD_CLICK_URL]+'" target="'+e+'"><img src="'+b[d.AD_FILE_URL]+'" width="'+l+'" height="'+i+'" alt="'+b[d.AD_ALT]+'" border=0 /></a>',e=j.createElement("div"),e.id=d.DIV_WRAPPER_ID_PREFIX+
c,e.style.width=l,e.style.height=i,a.insertBefore(e,a.firstChild),e.innerHTML=u,Q(e,c),z(a,b[d.AD_IMP_URL],c);else if("div"===f.implMode[c]?(e=j.createElement("div"),e.id=d.DIV_WRAPPER_ID_PREFIX+c,f.enableRTB||z(a,b[d.AD_IMP_URL],c)):(e=j.createElement("iframe"),e.id=d.IFRAME_ID_PREFIX+b[d.AD_POSITION],e.style.height=b.H,e.style.width=b.W,e.border="0px",e.hspace="0",e.vspace="0",e.marginWidth="0",e.marginHeight="0",e.style.border="0",e.scrolling="no",e.frameBorder="0"),e.setAttribute("height",i),
e.setAttribute("width",l),e.style.width=l+"px",e.style.height=i+"px",Q(e,c),a.insertBefore(e,a.firstChild),"div"===f.implMode[c])e.removeAttribute("height"),e.removeAttribute("width"),e.innerHTML=b[d.AD_CREATIVE],f.enableRTB||z(a,b[d.AD_IMP_URL],c);else{f.enableRTB||w(e,"load",function(){z(a,b[d.AD_IMP_URL],c)});var h=e,i='<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><base target="_top" /><script>inDapIF=true;<\/script></head><body>'+
b[d.AD_CREATIVE],i=i+"</body></html>",l=/(opera)(?:.*version)?[ \/]([\w.]+)/,n=/(msie) ([\w.]+)/,q=/(mozilla)(?:.*? rv:([\w.]+))?/,t=navigator.userAgent,t=t.toLowerCase(),l=(/(webkit)[ \/]([\w.]+)/.exec(t)||l.exec(t)||n.exec(t)||0>t.indexOf("compatible")&&q.exec(t)||[])[1];if("msie"===l||"opera"===l)try{p.frames[h.id].text=i,h.src='javascript:window["text"]',w(h,"load",function(){O(h)})}catch(r){g("failed to load iframe content in IE browser: "+r.message,d.LOG_ERROR)}else try{u=N(h),u.open("text/html",
"replace"),u.write(i),u.close(),w(h,"load",function(){O(h)})}catch(s){g("failed to load iframe content using DOM method: "+s.message,d.LOG_ERROR)}}var v=x[c]=e;K(function(a){"onload"===a.event?w(v,"load",function(){a.fn(m,c);a.executed=!0}):"onload"===a.event&&("div"===f.implMode[c]||k)&&a.fn(m,c)});b.deployed=!0}}},R=function(a,b){var c,e,i,l,g,j=q||{};for(c=0;c<j[d.AD].length;c++)e=j[d.AD][c],i=a[b],e.deployed||(l=i.id.substr(f.anchorElementPrefix.length+1),g=y(l),(l===e[d.AD_POSITION]||!g)&&X(i,
e))},S=function(a){var b,c=[];if(k[a]&&H&&(b=B(a)))g("attempting to deploy ad immediately for position: "+a,d.LOG_INFO),c.push(b),R(c,0)},Y=function(a){s[a]||(s[a]=p.setInterval(function(){g("checkIfDivIsAvailable for position:"+a,"INFO");B(a)&&(S(a),p.clearInterval(s[a]))},25),g("adding event handler now for position:"+a,d.LOG_INFO))},T=function(){var a;a=q||{};var b;var c,e,i;if(h){c=[];e=[];for(b=0;b<h.length;b++)i=B(h[b]),null!==i?(c.push(i),e.push(h[b])):f.enableBackgroundLoading&&Y(h[b]);if(0===
c.length&&("complete"===j.readyState||"interactive"===j.readyState))g("document ready state: "+j.readyState,d.LOG_INFO),g("No OAS anchor divs were found. Ads may not display correctly. Check for proper OAS DIV placements",d.LOG_WARN);b={divList:c,implementedPosList:e}}else b=void 0;c=b.divList;if(0!==c.length&&a[d.AD]){for(a=0;a<c.length;a++)R(c,a);if(!D&&I()){a=b.implementedPosList;b=h;for(c=0;c<b.length;c++)if(Array.prototype.indexOf)-1===a.indexOf(b[c])&&y(b[c])&&g("OAS Ad Position "+b[c]+" was requested but does not have a defined anchor point on the page. Ignoring this placement.",
d.LOG_WARN);else{i=!1;for(e=0;e<a.length;e++)if(a[e]===b[c]){i=!0;break}!i&&y(b[c])&&g("OAS Ad Position "+b[c]+" was requested but does not have a defined anchor point on the page. Ignoring this placement.",d.LOG_WARN)}D=!0}}},Z=function(){function a(a,b){h="&XE";""!==f.taxonomy&&(h+="&"+f.taxonomy);""!==b&&(h+="&"+b);return h+="&if_nt_CookieAccept="+a+"&XE"}if(!f.analytics)return"";var b="",c,e,d,g,h;j.referrer&&"[unknown origin]"!==j.referrer&&(-1===j.referrer.indexOf("?")?b+="tax23_RefDocLoc="+
j.referrer.toString():(c=j.referrer,e=c.indexOf("?"),c=c.substring(0,e),b+="tax23_RefDocLoc="+c));c=new Date;e=c.getTime();j.cookie="OAS_SC1="+e.toString()+";path=/;";var k=j.cookie;d=k.indexOf("OAS_SC1=");-1===d?d="":(d+=8,g=k.indexOf(";",d),-1===g&&(g=k.length),d=k.substring(d,g));d!==e.toString()?c=!1:(c.setTime(e+36E5),c=!0);return c?a.call(this,"Y",b):a.call(this,"N",b)},U=function(){if(E){E=!1;G.initialLoad=(new Date).getTime();g("OAS Manager file loaded succesfully. version: 1.1.1 modified date: 6/23/2014",
d.LOG_INFO);if("function"===typeof f.sizes){if(f.sizes(),0===h.length){g('Ad Position and sizes must be defined. Check the "oas_tag.sizes" parameter in the setup script',d.LOG_ERROR);return}}else{g('Ad Position and sizes must be defined. Check the "oas_tag.sizes" parameter in the setup script',d.LOG_ERROR);return}"function"===typeof f.callbackHandler&&f.callbackHandler();if(""===f.site_page){g("site_page paramater must not be blank",d.LOG_ERROR);return}F=!0}if(F){var a=d.SCRIPT_ID_PREFIX+f.url,b,
c,e;j.getElementById(a)?T():(b=(Math.random()+"").substring(2,11),c=j.createElement("script"),c.id=a,c.async=!0,c.type="text/javascript",a="https:"===j.location.protocol?"https://":"http://",e=f.enableRTB?d.DX_PATH_RTB:d.DX_PATH,c.src=a+f.url+e+f.site_page+"/"+b+"/@"+n+"?"+d.JSONP_CALLBACK+(f.query?"&"+f.query:"")+Z(),b=j.getElementsByTagName("script")[0],b.parentNode.insertBefore(c,b))}};f.addEvent=w;f.bindLoad=function(a){function b(){if(!c&&(c=!0,a.call(d),f.enableBackgroundLoading)){var b;g("clear interval loading function executing",
"INFO");for(b in s)s.hasOwnProperty(b)&&p.clearInterval(s[b])}}var c=!1,d=this,i;if("complete"===j.readyState)b();else if(j.addEventListener)j.addEventListener("DOMContentLoaded",b,!1),p.addEventListener("load",b,!1);else if(j.attachEvent){j.attachEvent("onreadystatechange",b);p.attachEvent("onload",b);i=!1;try{i=null===p.frameElement}catch(h){}j.documentElement.doScroll&&i&&function W(){try{j.documentElement.doScroll("left")}catch(a){setTimeout(W,1);return}b()}()}};f.loadScript=U;f.definePos=function(a,
b,c){c=0!==c;g("calling definePos with position: "+a+" size: "+b+" Display Ad : "+c,d.LOG_INFO);if(a){if(!A){if(!v(b)){g("Cannot define an ad spot without a proper ad size. Please check setup script",d.LOG_ERROR);return}if(2!==b.length){g("Cannot define an ad spot without a height and width dimension. Please check setup script",d.LOG_ERROR);return}}b&&(b={size:b,displayAd:c},k[a]||(n=""===n?a:n+","+a,h.push(a)),k[a]=b)}else g("Cannot define an ad spot without a position. Please check setup script",
d.LOG_ERROR)};f.displayAds=function(a){q=a;H=!0;var b,c;if(a&&q[d.AD])for(a=0;a<q[d.AD].length;a++)if(b=q[d.AD][a])c=b[d.AD_POSITION],m[c]=new J(b);for(a=0;a<h.length;a++)b=h[a],void 0===m[b]&&(g("No eligible ad response for position requested :"+b,d.LOG_INFO),c={},c[d.AD_CREATIVE_ID]="empty.gif",c[d.AD_POSITION]=b,m[b]=new J(c));T();var e;a=m.constructor();if(null===m||"object"!==typeof m)e=m;else{for(e in m)m.hasOwnProperty(e)&&(a[e]=m[e]);e=a}var f=e;K(function(a){"onload"!==a.event&&(a.fn(f),
a.executed=!0)})};f.getAdMetaData=function(a){if(a)return m[a];g("Need to specify a position to get ad meta data",d.LOG_ERROR)};f.reloadAds=function(a){var b;b=j.getElementById(d.SCRIPT_ID_PREFIX+f.url);b.parentNode.removeChild(b);A=!0;"function"===typeof f.sizes&&(k={},n="",h=[],f.sizes(),0===h.length&&g('Ad Position and sizes must be defined. Check the "oas_tag.sizes" parameter in the setup script',d.LOG_ERROR));if(v(a)){n="";h=[];for(b=0;b<a.length;b++)k[a[b]]?(n=""===n?a[b]:n+","+a[b],h.push(a[b])):
g("Cannot reload ad position that was not initially loaded: "+a[b],d.LOG_ERROR)}U()};f.resizeAd=function(a,b,c){a&&x[a]&&(a=x[a],v(b)&&(c=b[0],b=b[1]),a.style.height=b+"px",a.style.width=c+"px")};f.addHandler=function(a,b,c){a&&b&&"function"===typeof b?r.push(new V(a,b,c)):g("Callback Handler not properly defined. Please check for proper syntax.",d.LOG_WARN)};f.removeHandler=function(a){var b,c;if(a)for(b=0;b<r.length;b++)c=r[b],c.id===a&&r.splice(b,1)};f.loadAd=S;f.getOasAdElement=function(a){if(a)return x[a]};
return f}(window,document);oas_tag.lazyload?"complete"===document.readyState?oas_tag.loadScript():oas_tag.addEvent(window,"load",oas_tag.loadScript):(oas_tag.bindLoad(oas_tag.loadScript),oas_tag.loadScript());
