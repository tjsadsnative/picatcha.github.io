!function(e){e.widget("ui.stars",{options:{inputType:"select",split:0,disabled:!1,cancelTitle:"Cancel Rating",cancelValue:0,cancelShow:!1,disableValue:!0,oneVoteOnly:!1,showTitles:!0,captionEl:null,callback:null,starWidth:16,cancelClass:"ui-stars-cancel",starClass:"ui-stars-star",starOnClass:"ui-stars-star-on",starHoverClass:"ui-stars-star-hover",starDisabledClass:"ui-stars-star-disabled",cancelHoverClass:"ui-stars-cancel-hover",cancelDisabledClass:"ui-stars-cancel-disabled"},_create:function(){function s(e,s){if(-1!=e){var i=s?l.starHoverClass:l.starOnClass,n=s?l.starOnClass:l.starHoverClass;t.$stars.eq(e).prevAll("."+l.starClass).andSelf().removeClass(n).addClass(i),t.$stars.eq(e).nextAll("."+l.starClass).removeClass(l.starHoverClass+" "+l.starOnClass),0!=e&&t.$stars.eq(0).hasClass(l.cancelClass)&&t.$stars.eq(0).removeClass([l.starOnClass,l.starHoverClass].join(" ")),t._showCap(l.id2title[e])}else a()}function a(){t.$stars.removeClass(l.starOnClass+" "+l.starHoverClass),t._showCap("")}var t=this,l=this.options,i=0,n=0;this.element.data("former.stars",this.element.html()),l.isSelect="select"==l.inputType,this.$form=e(this.element).closest("form"),this.$selec=l.isSelect?e("select",this.element):null,this.$rboxs=l.isSelect?e("option",this.$selec):e(":radio",this.element),this.$stars=this.$rboxs.map(function(s){var a={value:this.value,title:(l.isSelect?this.text:this.title)||this.value,isDefault:l.isSelect&&this.defaultSelected||this.defaultChecked};if(0==s&&(l.split="number"!=typeof l.split?0:l.split,l.val2id=[],l.id2val=[],l.id2title=[],l.name=l.isSelect?t.$selec.get(0).name:this.name,l.disabled=l.disabled||(l.isSelect?e(t.$selec).attr("disabled"):e(this).attr("disabled"))),a.value==l.cancelValue)return l.cancelTitle=a.title,null;l.val2id[a.value]=i,l.id2val[i]=a.value,l.id2title[i]=a.title,a.isDefault&&(l.checked=i,l.value=l.defaultValue=a.value,l.title=a.title);var c=e("<div/>").addClass("na"==l.id2val[s]?l.cancelClass:l.starClass).css("margin-left",(0==s&&"na"!=l.id2val[s]?l.starWidth+1:0)+"px"),r=e("<a/>").attr("title",l.showTitles?a.title:"").text(a.value);if(l.split){var d=(i+n)%l.split;if("na"!=l.id2val[s]){var o=Math.floor(l.starWidth/l.split);c.width(o),r.css("margin-left","-"+d*o+"px")}else n++,c.width(l.starWidth)}return i++,c.append(r).get(0)}),l.items=i,l.isSelect?this.$selec.remove():this.$rboxs.remove(),this.$cancel=e("<div/>").addClass(l.cancelClass).append(e("<a/>").attr("title",l.showTitles?l.cancelTitle:"").text(l.cancelValue)),l.cancelShow&=!l.disabled&&!l.oneVoteOnly,l.cancelShow&&this.element.append(this.$cancel),this.element.append(this.$stars),void 0===l.checked&&(l.checked=-1,l.value=l.defaultValue=l.cancelValue,l.title=""),this.$value=e("<input type='hidden' name='"+l.name+"' value='"+l.value+"' />"),this.element.append(this.$value),this.$stars.bind("click.stars",function(e){if(!l.forceSelect&&l.disabled)return!1;var a=t.$stars.index(this);l.checked=a,l.value=l.id2val[a],l.title=l.id2title[a],t.$value.attr({disabled:l.disabled?"disabled":"",value:l.value}),l.disabled||t.$value.removeAttr("disabled"),s(a,!1),t._disableCancel(),!l.forceSelect&&t.callback(e,"star")}).bind("mouseover.stars",function(){if(l.disabled)return!1;var e=t.$stars.index(this);s(e,!0)}).bind("mouseout.stars",function(){return l.disabled?!1:void s(t.options.checked,!1)}),this.$cancel.bind("click.stars",function(e){return l.forceSelect||!l.disabled&&l.value!=l.cancelValue?(l.checked=-1,l.value=l.cancelValue,l.title="",t.$value.val(l.value),l.disableValue&&t.$value.attr({disabled:"disabled"}),a(),t._disableCancel(),void(!l.forceSelect&&t.callback(e,"cancel"))):!1}).bind("mouseover.stars",function(){return t._disableCancel()?!1:(t.$cancel.addClass(l.cancelHoverClass),a(),void t._showCap(l.cancelTitle))}).bind("mouseout.stars",function(){return t._disableCancel()?!1:(t.$cancel.removeClass(l.cancelHoverClass),void t.$stars.triggerHandler("mouseout.stars"))}),this.$form.bind("reset.stars",function(){!l.disabled&&t.select(l.defaultValue)}),e(window).unload(function(){t.$cancel.unbind(".stars"),t.$stars.unbind(".stars"),t.$form.unbind(".stars"),t.$selec=t.$rboxs=t.$stars=t.$value=t.$cancel=t.$form=null}),this.select(l.value),l.disabled&&this.disable()},_disableCancel:function(){var e=this.options,s=e.disabled||e.oneVoteOnly||e.value==e.cancelValue;return s?this.$cancel.removeClass(e.cancelHoverClass).addClass(e.cancelDisabledClass):this.$cancel.removeClass(e.cancelDisabledClass),this.$cancel.css("opacity",s?.5:1),s},_disableAll:function(){var e=this.options;this._disableCancel(),e.disabled?this.$stars.filter("div").addClass(e.starDisabledClass):this.$stars.filter("div").removeClass(e.starDisabledClass)},_showCap:function(e){var s=this.options;s.captionEl&&s.captionEl.text(e)},value:function(){return this.options.value},select:function(e){var s=this.options,a=e==s.cancelValue?this.$cancel:this.$stars.eq(s.val2id[e]);s.forceSelect=!0,a.triggerHandler("click.stars"),s.forceSelect=!1},selectID:function(e){var s=this.options,a=-1==e?this.$cancel:this.$stars.eq(e);s.forceSelect=!0,a.triggerHandler("click.stars"),s.forceSelect=!1},enable:function(){this.options.disabled=!1,this._disableAll()},disable:function(){this.options.disabled=!0,this._disableAll()},destroy:function(){return this.$form.unbind(".stars"),this.$cancel.unbind(".stars").remove(),this.$stars.unbind(".stars").remove(),this.$value.remove(),this.element.unbind(".stars").html(this.element.data("former.stars")).removeData("stars"),this},callback:function(e,s){var a=this.options;a.callback&&a.callback(this,s,a.value,e),a.oneVoteOnly&&!a.disabled&&this.disable()}}),e.extend(e.ui.stars,{version:"3.0.1"})}(jQuery);