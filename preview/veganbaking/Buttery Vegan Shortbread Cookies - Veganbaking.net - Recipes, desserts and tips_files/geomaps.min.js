!function(e){var t,o,n,i,a=e("div.jr-page");jreviews.geomaps=jreviews.geomaps||{},jreviews.geomaps.__api_loading=!1,jreviews.geomaps.__api_loadfn={},jreviews.geomaps.__api_loaded=!1,jreviews.geomaps.__api_callback_fn={},jreviews.geomaps.setAPILoaded=function(){jreviews.geomaps.__api_loaded=!0},jreviews.geomaps.loadAPI=function(t,o){jreviews.geomaps.__api_loading||"undefined"!=typeof google&&"undefined"!=typeof google.maps?"undefined"!=typeof google&&"undefined"!=typeof google.maps&&("undefined"==typeof google.maps.places&&console.log("GeoMaps: Google Maps Places API not loaded"),jreviews.geomaps.__api_loaded=!0):(e.getScript(jreviews.geomaps.google_api_url+"&callback=jreviews.geomaps.setAPILoaded"),jreviews.geomaps.__api_loading=!0),jreviews.geomaps.__api_loadfn[t]=setInterval(function(){jreviews.geomaps.__api_callback_fn[t]=o,jreviews.geomaps.__api_loaded&&(clearInterval(jreviews.geomaps.__api_loadfn[t]),"function"==typeof jreviews.geomaps.__api_callback_fn[t]&&jreviews.geomaps.__api_callback_fn[t]())},50)},jreviews.geomaps.startup=function(){if(a=a.length>0?a:e("div.jr-page"),t=e(".jr-map-canvas")||[],o=a.find("form.jr-form-adv-search-module")||[],n=a.find("#jr-form-adv-search")||[],i=""!==jreviews.geomaps.fields.proximity&&o.length?o.find("."+jreviews.geomaps.fields.proximity):[],o.length){var s={},r=jreviews.geomaps.fields.lat,l=jreviews.geomaps.fields.lon;if(window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(e,t,o){s[t]=o}),r in s&&l in s||window.location.href.replace(/([^\/:]+):([^\/]*)/gi,function(e,t,o){s[t]=o}),r in s&&l in s){var d=s[r],p=s[l],c=o.find('[name="data[Field][Listing]['+r+']"]'),g=o.find('[name="data[Field][Listing]['+l+']"]');c.length||g.length||o.append('<input type="hidden" name="data[Field][Listing]['+r+']" value="'+d+'" />').append('<input type="hidden" name="data[Field][Listing]['+l+']" value="'+p+'" />')}}jreviews.geomaps.fields.mapit&&a.on("jrListingFieldsLoaded","#jr-form-listing",function(){var t=e(this),o=t.find("."+jreviews.geomaps.fields.mapit);o.length&&jreviews.geomaps.loadAPI("mapit",function(){t.jrMapIt({fields:jreviews.geomaps.fields})})}),(t.length>0||i.length>0||n.length>0)&&jreviews.geomaps.loadAPI("init",jreviews.geomaps.init)},jreviews.geomaps.init=function(){if(t.each(function(){var t=e(this),o=t.data("referrer");o in jreviews.geomaps.mapData&&t.jrMaps(jreviews.geomaps.mapData[o])}),jreviews.geomaps.fields.proximity){if(i.length&&"undefined"!=typeof google){var n=jreviews.geomaps.autocomplete&&"undefined"!=typeof google.maps.places;o.jrProximitySearch({fields:jreviews.geomaps.fields,autocomplete:n}),i.jrGeolocation({lat_input_name:jreviews.geomaps.fields.lat,lon_input_name:jreviews.geomaps.fields.lon})}a.on("jrSearchFormLoaded","#jr-form-adv-search",function(){var t=e(this),o=t.find("."+jreviews.geomaps.fields.proximity);o.length&&(jreviews.geomaps.loadAPI("adv-search",function(){var e=jreviews.geomaps.autocomplete&&"undefined"!=typeof google.maps.places;t.jrProximitySearch({fields:jreviews.geomaps.fields,autocomplete:e})}),o.jrGeolocation({lat_input_name:jreviews.geomaps.fields.lat,lon_input_name:jreviews.geomaps.fields.lon}))})}},jreviews.addOnload("geomaps-startup",jreviews.geomaps.startup)}(jQuery),function(e){e.fn.jrGeolocation=function(t){var o={lat_input_name:"jr_latitude",lon_input_name:"jr_longitude",persistent:!1},n=e.extend(o,t),i=function(t,o){if(t.wrap('<span class="jrInputButtonRow"></span>'),navigator.geolocation){if(n.persistent){var i=jreviews.dispatch({method:"get",type:"json",controller:"geomaps",action:"getLocation"});i.done(function(e){e&&a(t,o,e)})}var s=e('<button class="jr-geolocation jrLinkButton jrInputButton jrSmall jrIconOnly"><span class="jrIconLocate"></span></button>');s.on("click",function(n){n.preventDefault();var i=e(this).find("span");i.switchClass("jrIconLocate","jrLoadingSmall",0);var s=function(){i.switchClass("jrLoadingSmall","jrIconLocate",0)},r=function(e){a(t,o,{lat:e.coords.latitude,lon:e.coords.longitude,onComplete:s})},l=function(t){t.code==t.POSITION_UNAVAILABLE&&e.jrAlert(jreviews.__t("GEOMAPS_GEOLOCATION_POSITION_UNAVAILABLE")),s()};navigator.geolocation.getCurrentPosition(r,l,{maximumAge:6e4,timeout:1e4})}),t.after(s)}},a=function(t,o,i){if(i=e.extend({onComplete:function(){}},i),o.length&&s(o,i.lat,i.lon),void 0!==i.address&&i.address.length)t.val(i.address);else{var a=new google.maps.LatLng(i.lat,i.lon),r=new google.maps.Geocoder;r.geocode({latLng:a},function(e){if(e[0]){var o=e[0].formatted_address;t.val(o),i.onComplete.call(this),n.persistent&&jreviews.dispatch({method:"get",controller:"geomaps",action:"saveLocation",data:{lat:i.lat,lon:i.lon,address:o}})}})}},s=function(e,t,o){var i=e.find('[name="data[Field][Listing]['+n.lat_input_name+']"]'),a=e.find('[name="data[Field][Listing]['+n.lon_input_name+']"]');i.length||a.length?(i.val(t),a.val(o)):e.append('<input type="hidden" name="data[Field][Listing]['+n.lat_input_name+']" value="'+t+'" />').append('<input type="hidden" name="data[Field][Listing]['+n.lon_input_name+']" value="'+o+'" />'),e.trigger("onLiveSearch")};return this.each(function(){var t=e(this),o=t.parents("form");return t.data("jrGeolocation")?this:(i(t,o),t.data("jrGeolocation",!0),this)})}}(jQuery),function(e){e.widget("jreviews.jrMapIt",{options:{width:"700px",zoom:15,lang:{mapit:jreviews.__t("GEOMAPS_MAPIT"),clear_coord:jreviews.__t("GEOMAPS_CLEAR_COORDINATES"),geocode_fail:jreviews.__t("GEOMAPS_CANNOT_GEOCODE"),drag_marker:jreviews.__t("GEOMAPS_DRAG_MARKER")},fields:{}},page:null,buttons:{},inputs:{},_create:function(t){var o=this;o.page=o.element,e.extend(o.options,t),o.buttons={map:e('<button class="jrButton">').html('<span class="jrIconPin"></span>'+o.options.lang.mapit),clearVal:e('<button class="jrButton">').html('<span class="jrIconRemove"></span>'+o.options.lang.clear_coord)},o.inputs={lat:e('<input type="hidden" name="data[Field][Listing]['+o.options.fields.lat+']" >'),lon:e('<input type="hidden" name="data[Field][Listing]['+o.options.fields.lon+']" >')}},_init:function(){var e=this,t=e.buttons,o=e.inputs;t.map.on("click",function(t){t.preventDefault(),e.open()}),t.clearVal.on("click",function(t){t.preventDefault(),e.page.find("."+e.options.fields.lat).length&&(o.lat=e.page.find("."+e.options.fields.lat),o.lon=e.page.find("."+e.options.fields.lon)),o.lat.val(""),o.lon.val("")}),e.page.find("."+e.options.fields.mapit).after(t.map,"&nbsp;",t.clearVal)},open:function(){var t=this,o=t.inputs;0===t.page.find("."+t.options.fields.lat).length?t.page.append(o.lat,o.lon):(o.lat=t.page.find("."+t.options.fields.lat),o.lon=t.page.find("."+t.options.fields.lon));var n=[o.lat.val(),o.lon.val()],i=t.getAddress(t.page);if(""!==i){var a={width:t.options.width,height:"auto",open:function(){var a=e(this);if(""===o.lat.val()&&""===o.lat.val()){if(""!==i){var s=new google.maps.Geocoder;s.geocode({address:i},function(i,s){if(google.maps.GeocoderStatus.OK!=s)e.jrAlert(t.options.lang.geocode_fail);else{var r=i[0].geometry.location;center=r.toUrlValue(),n=center.split(","),o.lat.val(n[0]),o.lon.val(n[1]),t._createMap(t.page,a,n)}})}}else t._createMap(t.page,a,n)}},s='<div class="jrInfo">'+t.options.lang.drag_marker+'</div><div class="jr-geomaps-map jrMapItCanvas jrMapLoading"></div>';e.jrDialog(s,a)}},getAddress:function(t){var o,n=this,i=[],a="";return e.each(n.options.fields.address,function(e,n){var s,r=t.find("."+n),l=t.find(".jr-cat-select");if(o=r.prop("type"),"category"==n&&l.length>0){var d=l.last().find(":selected").text();d!==jreviews.__t("LISTING_SELECT_CAT")&&(a=d)}else if("parent_category"==n&&l.length>1){var p=l.last().prev().find(":selected").text();p!==jreviews.__t("LISTING_SELECT_CAT")&&(a=p)}else"select-one"==o||"select-multiple"==o?(s=r.find("option:selected").first(),a=""!==s.val()?s.text():null):a=r.val();null!==a&&void 0!==a&&""!==a&&"undefined"!=a&&i.push(a)}),0===t.find("."+n.options.fields.address.country).length&&void 0!==n.options.fields.default_country&&""!==n.options.fields.default_country&&i.push(n.options.fields.default_country),i.join(" ")},_createMap:function(e,t,o){var n=this,i=n.inputs,a={zoom:n.options.zoom,center:new google.maps.LatLng(o[0],o[1]),mapTypeId:google.maps.MapTypeId.ROADMAP},s=t.find(".jr-geomaps-map");map=new google.maps.Map(s[0],a),marker=new google.maps.Marker({position:new google.maps.LatLng(o[0],o[1]),draggable:!0}),google.maps.event.addListener(map,"idle",function(){s.removeClass("jrMapLoading")}),google.maps.event.addListener(marker,"dragend",function(){i.lat.val(marker.getPosition().lat()),i.lon.val(marker.getPosition().lng())}),marker.setMap(map)}})}(jQuery),function(e){e.widget("jreviews.jrProximitySearch",{options:{eventTrigger:"jrBeforeSearch",fields:{},autocomplete:!1},proximityField:null,page:null,ac_option_selected:!1,_create:function(t){var o=this;e.extend(o.options,t),o.page=o.element,o.searchButton=o.page.find(".jr-search")},_init:function(){var t=this,o={types:["geocode"]};if(""!==jreviews.geomaps.autocomplete_country&&(o.componentRestrictions={country:jreviews.geomaps.autocomplete_country}),t.proximityField=t.page.find("."+t.options.fields.proximity),t.options.autocomplete===!0&&"text"==t.proximityField.prop("type")){var n=new google.maps.places.Autocomplete(t.proximityField[0],o);google.maps.event.addListener(n,"place_changed",function(){var e=n.getPlace(),o=e.geometry.location.lat(),i=e.geometry.location.lng();t._addCoordinateInputs(o,i),t.ac_option_selected=!0});var i=document.createElement("input");t.proximityField.attr("placeholder","placeholder"in i?jreviews.__t("GEOMAPS_ENTER_LOCATION"):"").on("keydown",function(e){return 13==e.keyCode?(e.preventDefault(),!1):void 0})}var a="text"==t.proximityField.prop("type")?"keyup":"change";t.page.on(a,"."+t.options.fields.proximity,function(){setTimeout(function(){t.ac_option_selected||t._mapSearchAddress(),t.ac_option_selected=!1},250)}),t.proximityField.on("focus",function(){t.ac_option_selected=!1,t.searchButton.prop("disabled",!0)}),e(document).on("mousedown",function(){t.searchButton.prop("disabled",!1)})},_getInputVal:function(e){var t,o=this,n=o.page.find("."+e),i=n.prop("type");return"select-one"==i?(t=n.find("option:selected"),inputVal=""!==n.val()?t.text():null):inputVal=n.val(),inputVal},_mapSearchAddress:function(){var e=this,t=[],o="";if(void 0!==e.options.fields.proximity&&(o=e._getInputVal(e.options.fields.proximity),null!==o&&void 0!==o&&""!==o&&"undefined"!=o?t.push(o):e._clearCoordinates()),t.length>0){0===e.page.find("."+e.options.fields.address.country).length?void 0!==e.options.fields.default_country&&""!==e.options.fields.default_country&&t.push(e.options.fields.default_country):(o=e._getInputVal(e.options.fields.address.country),null!==o&&void 0!==o&&""!==o&&"undefined"!=o&&t.push(o)),t=t.join(" ");var n=new google.maps.Geocoder;n.geocode({address:t},function(t,o){if(google.maps.GeocoderStatus.OK==o){var n=t[0].geometry.location;e._addCoordinateInputs(n.lat(),n.lng())}})}else e.searchButton.prop("disabled",!1)},_addCoordinateInputs:function(t,o){var n=this,i=n.options.fields.lat,a=n.options.fields.lon,s='input[name="data[Field][Listing]['+i+']"]',r='input[name="data[Field][Listing]['+a+']"]',l=e('<input type="hidden" name="data[Field][Listing]['+i+']" />'),d=e('<input type="hidden" name="data[Field][Listing]['+a+']" />');0===n.page.find(s).length?(l.appendTo(n.page),d.appendTo(n.page)):(l=n.page.find(s),d=n.page.find(r)),l.val(t),d.val(o),n.searchButton.prop("disabled",!1),n.page.trigger("onLiveSearch")},_clearCoordinates:function(){var e=this,t=e.options.fields.lat,o=e.options.fields.lon,n='input[name="data[Field][Listing]['+t+']"]',i='input[name="data[Field][Listing]['+o+']"]';e.page.find(n+","+i).val("")}})}(jQuery),function(e){e.widget("jreviews.jrMaps",{options:{zoom:15,container_class:"jr-page",external_trigger_id:"jr-listing-title-",resize_class:"jr-map-resize",streetview_canvas:"jr-streetview-canvas",directions_canvas:"jr-directions-canvas",scroller:!1,cluster:{gridSize:60,maxZoom:15},iwMaxWidth:250},init:!0,page:null,referrer:null,tabs:null,map:null,kmlLayers:{},d:null,directions:null,directionsCanvas:null,streetview:null,sv:null,streetviewCanvas:null,streetviewStatus:!1,markerClusterer:null,bounds:null,center:null,infowindow:null,default_width:null,_gicons:{},_markers:{},_icons:{"default":{type:"custom",url:"//chart.googleapis.com/chart?chst=d_map_spin&chld=0.6|0|FE766A|12|_|",size:[23,41]},default_hover:{type:"custom",url:"//chart.googleapis.com/chart?chst=d_map_spin&chld=0.6|0|FDFF0F|12|_|",size:[23,41]},default_featured:{type:"custom",url:"//chart.googleapis.com/chart?chst=d_map_spin&chld=0.6|0|5F8AFF|12|_|",size:[23,41]},numbered:{type:"numbered",url:"//chart.googleapis.com/chart?chst=d_map_spin&chld=0.6|0|FE766A|12|_|{index}",size:[23,41]},numbered_hover:{type:"numbered",url:"//chart.googleapis.com/chart?chst=d_map_spin&chld=0.6|0|FDFF0F|12|_|{index}",size:[23,41]},numbered_featured:{type:"numbered",url:"//chart.googleapis.com/chart?chst=d_map_spin&chld=0.6|0|5F8AFF|12|_|{index}",size:[23,41]},numbered_featured_hover:{type:"numbered",url:"//chart.googleapis.com/chart?chst=d_map_spin&chld=0.6|0|FDFF0F|12|_|{index}",size:[23,41]}},_create:function(t){var o=this,n=o.element;o._markers={},o._gicons={},e.extend(o.options,t),o.referrer=n.data("referrer"),o.page=n.closest("."+o.options.container_class);for(var i in o.options.icons)o._icons[i]=o.options.icons[i];o.streetviewCanvas=o.page.find("."+o.options.streetview_canvas),o.directionsCanvas=o.page.find("."+o.options.directions_canvas),o.defaultWidth=o.element.width()},_init:function(){var t=this,o=t.element,n=t.element.closest(".jr-tabs");if(n.length&&null===t.tabs)return t.tabs=!0,void n.bind("tabsshow",function(e,n){n.panel.id==t.element.closest(".ui-tabs-panel").attr("id")&&void 0===o.data("initialized")&&(t._init(),o.data("initialized",!0))});var i=t.element.closest(".wk-slideshow");if(i.length&&null===t.tabs){t.tabs=!0;var a=t.element.parents("li"),s=(a.parent("ul").find("li"),i.find("ul.nav")),r=s.index(l),l=s.eq(r);return void l.on("click",function(){t._init(),o.data("initialized",!0)})}t.bounds=new google.maps.LatLngBounds,t.map=new google.maps.Map(o[0],{zoom:t.options.zoom,styles:t.options.styles});var d=t.page.find('.jr-attachments [data-file-type="kml"]');if(d.length&&d.each(function(o){var n=e(this).data("file-path");t.kmlLayers[o]=new google.maps.KmlLayer({url:n}),t.kmlLayers[o].setMap(t.map)}),t._setMapOptions(),t.options.count>0&&t._addMarkers(),1==t.options.count)t.map.setCenter(t.getCenter());else if(t.options.center){var p=new google.maps.LatLng(t.options.center.lat,t.options.center.lon);t.map.setCenter(p)}else t.map.fitBounds(t.bounds);google.maps.event.addListener(this.map,"idle",function(){o.removeClass("jrMapLoading").css({"overflow-x":"visible","overflow-y":"visible"})}),google.maps.event.addListener(t.map,"dragstart",function(){"google"!=t.options.infowindow&&t._closeInfowindow()}),google.maps.event.addListener(t.map,"dblclick",function(){"google"!=t.options.infowindow&&t._closeInfowindow()}),google.maps.event.addListener(t.map,"zoom_changed",function(){"google"!=t.options.infowindow&&t._closeInfowindow()}),google.maps.event.addListener(t.map,"visible_changed",function(){"google"!=t.options.infowindow&&t._closeInfowindow()}),google.maps.event.addListener(t.map,"resize",function(){"google"!=t.options.infowindow&&t._closeInfowindow()}),t._createAddressBar(),t._bindListingTitles(),t._bindMapResize(),t._bindMapScroller(),t._bindStreetview(!0),t._bindDirections()},_bindListingTitles:function(){var e=this;e.page.on("mouseover",'[id^="'+e.options.external_trigger_id+'"]',function(){var t=this.id.replace(e.options.external_trigger_id,""),o=e._markers[t];"google"!=e.options.infowindow&&e._closeInfowindow(),o&&(e.map.setCenter(o.payload.latlng),e._toggleIcon(o,"_hover"),e._loadInfoWindow(o))}).on("mouseout",'[id^="'+e.options.external_trigger_id+'"]',function(){var t=this.id.replace(e.options.external_trigger_id,""),o=e._markers[t];o&&e._toggleIcon(o,"")})},_bindMapResize:function(){var e=this;e.page.on("click","."+e.options.resize_class+" a.jr-map-large, ."+e.options.resize_class+" a.jr-map-small",function(){var t,o;mapLinks=e.page.find("."+e.options.resize_class+" a"),mapLinks.toggle();var n=e.element.width()<=e.defaultWidth;t=n?600:e.defaultWidth,o=n?500:e.defaultWidth,e.element.closest("#jr-map-column").animate({width:t},"fast"),e.element.siblings().animate({width:t},"fast"),e.element.animate({width:t,height:o},"fast",function(){e.resizeMap()})})},_bindMapScroller:function(){var t=this;if(t.options.scroller){var o=t.page.find("div#jr-map-results-wrapper"),n=t.page.find("div#jr-map-column"),i=t.page.find("div#jr-listing-column");n.width(t.defaultWidth);{i.width()}i.width(i.parent().width()-n.width()-12);var a=o.offset().top,s=i.height()+a-o.height()-5;e(window).scroll(function(){var t=e(this).scrollTop();if(t>=a){o.addClass("fixed").removeClass("top bottom");var i=e(this).width()-(n.offset().left+o.outerWidth());o.css("right",i)}else o.addClass("top").removeClass("fixed bottom");t>=s&&o.addClass("bottom").removeClass("top fixed")}).resize(function(){var t=e(this).width()-(n.offset().left+o.outerWidth());o.css("right",t),i.width(i.parent().width()-n.width()-12)})}},_bindStreetview:function(){var e=this;if(e.map.get("streetViewControl")!==!1)if(e.streetviewCanvas.length)e.streetview=e.streetview||new google.maps.StreetViewPanorama(e.streetviewCanvas[0]),google.maps.event.addListener(e.streetview,"visible_changed",function(){e.streetview.getVisible()&&!e.init&&(e.element.css("width","49%"),e.resizeMap(),e.streetviewCanvas.show()),e.init=!1}),e.map.setStreetView(e.streetview),e._checkStreetviewStatus(e.map.getCenter()),google.maps.event.addListener(e.streetview,"position_changed",function(){e.map.setCenter(e.streetview.getPosition())}),google.maps.event.addListener(e.map,"click",function(t){e._checkStreetviewStatus(t.latLng)});else{var t=e.map.getStreetView();google.maps.event.addListener(t,"visible_changed",function(){"google"!=e.options.infowindow&&e._closeInfowindow(),e.element.css("overflow","visible")})}},_checkStreetviewStatus:function(e){var t=this;null!==t.streetview&&(t.sv=t.sv||new google.maps.StreetViewService,t.sv.getPanoramaByLocation(e,50,function(o,n){if(n==google.maps.StreetViewStatus.OK){t.element.css("width","49%"),t.resizeMap();var i=t._computeAngle(e,o.location.latLng),a={position:o.location.latLng,pov:{heading:i,pitch:10,zoom:1}};t.streetview.setOptions(a),t.streetviewCanvas.show()}}))},_computeAngle:function(e,t){var o=57.2957795,n=.017453,i=e.lat()-t.lat(),a=e.lng()-t.lng(),s=Math.atan2(a*Math.cos(e.lat()*n),i)*o;return this._wrapAngle(s)},_wrapAngle:function(e){return e>=360?e-=360:0>e&&(e+=360),e},_bindDirections:function(){{var e=this,t=e.page.find(".jr-directions-address");t.find(".jr-validation")}if(t.length&&e.options.directions){var o=t.find(".jr-directions-origin"),n=t.find(".jr-directions-destination");o.jrGeolocation(),t.show().on("click",".jr-directions-submit",function(i){var a;a=n.val()==e.directionsCanvas.data("destAddr")?e.directionsCanvas.data("destCoord"):n.val(),i.preventDefault(),e.directionsCanvas.hide(),e.directions=e.directions||new google.maps.DirectionsRenderer({map:e.map,panel:e.directionsCanvas[0]}),e.d=e.d||new google.maps.DirectionsService;var s={origin:o.val(),destination:a,travelMode:google.maps.TravelMode[t.find(".jr-directions-travelmode").val()],region:e.directionsCanvas.data("locale")||"en"};e.d.route(s,function(t,o){o==google.maps.DirectionsStatus.OK?(e.directionsCanvas.removeClass("jrError").fadeIn(),e.directions.setDirections(t)):e.directionsCanvas.addClass("jrError").html(jreviews.__t("PROCESS_REQUEST_ERROR")).fadeIn()})}),t.on("click",".jr-directions-swap",function(){var e=o.val();o.val(n.val()),n.val(e)})}},_setMapOptions:function(){var e=this;e.options.mapUI.zoom=0===e.options.mapUI.zoom?e.options.zoom:e.options.mapUI.zoom,jreviews.mobi&&delete e.options.mapUI.panControl,e.map.setOptions(e.options.mapUI)},_addMarkers:function(){var t=this,o=[];e.each(t.options.payload,function(e,n){var i=t._createMarker(n);t._markers[n.id]=i,t.options.clustering?o.push(i):i.setMap(t.map)}),t.options.clustering&&(t.markerClusterer=new MarkerClusterer(t.map,o,{maxZoom:t.options.cluster.maxZoom,gridSize:t.options.cluster.gridSize}))},_createMarker:function(e){var t=this,o=new google.maps.LatLng(e.lat,e.lon),n=t._createIcon(e),i=new google.maps.Marker({position:o,icon:n,title:e.title});return 1==e.featured&&i.setZIndex(google.maps.Marker.MAX_ZINDEX+1),t.bounds.extend(o),n.data&&n.data.shadow&&i.setShadow(n.data.shadow),i.icon_name=e.icon,i.id=e.id,i.payload=e,i.payload.latlng=o,google.maps.event.addListener(i,"click",function(e){t._loadInfoWindow(i,e.latLng),t._checkStreetviewStatus(i.position)}),google.maps.event.addListener(i,"mouseover",function(){return t._toggleIcon(i,"_hover"),!1}),google.maps.event.addListener(i,"mouseout",function(){t._toggleIcon(i,"")}),i},_toggleIcon:function(e,t){var o=this,n=e.icon_name;1===e.payload.featured&&n+"_featured"+t in o._icons&&(n+="_featured"),void 0!==e&&n+t in o._icons&&e.setIcon(o._icons[n+t].url.replace("{index}",e.payload.index))},_createIcon:function(e){var t,o=this,n=e.icon,i=e.index;if(o._gicons.length&&void 0!==o._gicons[n]&&"numbered"!==n)return o._gicons[n];switch(void 0===o._icons[n]&&(n="default"),1===e.featured&&n+"_featured"in o._icons&&(n+="_featured"),o._icons[n].type){case"custom":t=o._createCustomIcon(o._icons[n]);break;case"numbered":case"numbered_featured":t=o._createNumberedIcon(o._icons[n],i);break;case"default":t=o._createDefaultIcon(o._icons[n]);break;default:t=o._createDefaultIcon(o._icons[n])}return o._gicons[n]=t,t},_createCustomIcon:function(e){var t=new google.maps.MarkerImage(e.url);return t.size=new google.maps.Size(e.size[0],e.size[1]),t},_createDefaultIcon:function(e){var t=new google.maps.MarkerImage(e.url);t.size=new google.maps.Size(23,41),t.data={shadow:new google.maps.MarkerImage("http://www.google.com/mapfiles/shadow50.png",new google.maps.Size(37,34),null,new google.maps.Point(9,37))};var o=new google.maps.MarkerImage(e.url,t.size);return o.data=t.data,o},_createNumberedIcon:function(e,t){var o=new google.maps.MarkerImage(e.url);o.size=new google.maps.Size(23,41),o.data={shadow:new google.maps.MarkerImage("http://www.google.com/mapfiles/shadow50.png",new google.maps.Size(37,34),null,new google.maps.Point(9,37))};var n;return n=""!==t?new google.maps.MarkerImage(e.url.replace("{index}",0+t),o.size):new google.maps.MarkerImage(e.url.replace("{index}",""),o.size),n.data=o.data,n},_createAddressBar:function(){var t=this,o=new google.maps.Geocoder,n=e('<div class="jrRoundedPanel jrMapAddressBar"><input type="text" size="50" name="jr-map-address-search" placeholder="'+jreviews.__t("GEOMAPS_ENTER_LOCATION")+'" /><button class="jrButton jrSmall"><span class="jrIconSearch"></span></button></div>');t.options.search&&(t.map.controls[google.maps.ControlPosition.TOP_LEFT].push(n[0]),n.css({"z-index":1,"-moz-user-select":""}).on("keyup","input",function(e){13==e.keyCode&&n.find(".jrButton").trigger("click")}),n.on("click",".jrButton",function(e){e.preventDefault();var i=n.find("input").val();return""===i?!1:void o.geocode({address:i},function(e,o){google.maps.GeocoderStatus.OK==o&&(t.map.setZoom(11),t.map.setCenter(e[0].geometry.location))})}))},_loadInfoWindow:function(e,t){var o=this,n=o._renderInfoWindowContent(e.payload);"google"==o.options.infowindow?(o.infowindow=o.infowindow||new google.maps.InfoWindow({maxWidth:o.options.iwMaxWidth}),o.infowindow.setContent(n[0]),o.infowindow.open(o.map,e)):(n.css("display","none"),o._closeInfowindow(),setTimeout(function(){o._positionInfowindow(n,e,t)},10)),e.setZIndex(google.maps.Marker.MAX_ZINDEX+1)},_renderInfoWindowContent:function(t){var o=this,n=1,i=e(o.options.iwTheme);o.options.mapUI.title.trim===!0&&o.options.mapUI.title.trimchars>0&&(t.title=t.title.substring(0,o.options.mapUI.title.trimchars)),i.find(".jr-map-title").html(t.title),i.find(".jr-map-title").attr("href",t.url),!1!==t.image&&i.find(".jr-map-image").html('<img src="'+t.image+'" />');var a=i.find(".jrOverallUser"),s=i.find(".jrOverallEditor"),r=i.find(".jrOverallRatings");void 0===t.rating_scale?r.hide():(r.show(),void 0===t.user_rating?a.hide():(a.show(),i.find(".jr-map-user-rating").css("width",t.user_rating/t.rating_scale*100+"%"),i.find(".jr-map-user-rating-val").html(Math.round(0+t.user_rating*Math.pow(10,n))/Math.pow(10,n)),i.find(".jr-map-user-rating-count").html(Number(0+t.user_rating_count))),void 0===t.editor_rating?s.css("display","none"):(s.show(),i.find(".jr-map-editor-rating").css("width",t.editor_rating/t.rating_scale*100+"%"),i.find(".jr-map-editor-rating-val").html(Math.round(0+t.editor_rating*Math.pow(10,n))/Math.pow(10,n))));for(var l in t.field)i.find(".jr-map-"+l).html(t.field[l]);return i.on("click",".jr-close",function(){o._closeInfowindow()}),i},_positionInfowindow:function(e,t,o){var n=this,i=n.map.getBounds(),a=o||t.getPosition(),s=new google.maps.OverlayView;s.draw=function(){},s.setMap(n.map),setTimeout(function(){var t,o,r=s.getProjection(),l=r.fromLatLngToContainerPixel(a);i.contains(a)||n.map.setCenter(a),e.appendTo(n.element),e.hasClass("jrMapCustom")?(t=l.x+parseInt(e.css("left"),10)+4,o=l.y+parseInt(e.css("top"),10)+15):(t=l.x+parseInt(e.css("left"),10),o=l.y+parseInt(e.css("top"),10)),e.css({left:t+"px",top:o+"px",position:"absolute"}).show()},100)},_closeInfowindow:function(){this.element.find(".jrInfowindow").remove()},getMap:function(){return this.map},getMarkers:function(){return this._markers},getCenter:function(){var e=this,t=(e.bounds.getNorthEast().lat()+e.bounds.getSouthWest().lat())/2,o=(e.bounds.getNorthEast().lng()+e.bounds.getSouthWest().lng())/2;return e.bounds.getNorthEast().lng()<e.bounds.getSouthWest().lng()&&(o+=180),new google.maps.LatLng(t,o)},resizeMap:function(){google.maps.event.trigger(this.map,"resize")},destroy:function(){e.Widget.prototype.destroy.call(this)}})}(jQuery);