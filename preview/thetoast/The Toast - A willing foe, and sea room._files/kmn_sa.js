var kmn_data=kmn_data||{},kmn_iframe=kmn_iframe||0,kmn_ts=new Date().getTime(),kmn_cb=kmn_cb||Math.floor((kmn_ts%65536)+(Math.floor(Math.random()*65536)*65536)),kmn_cstat=kmn_cstat||new function(){var a=this;a.async_js=function(f,d){try{var g,b=kmn_sa,c=document.createElement("script");b.setAttributes(c,b.extend(d||{},{src:f,async:true,type:"text/javascript"}));g=document.getElementsByTagName("head")[0];if(g){g.appendChild(c)}return c}catch(h){}};a.stat_src=function(b,e){var c,d="?",e=e||{};for(c in e){d+=encodeURIComponent(c)+"="+encodeURIComponent(e[c])+"&"}return(b+d.slice(0,-1))};a.save=function(c,g){try{var f=a.stat_src(c,g),b=a.async_js(f,{});b.onload=b.onreadystatechange=function(){if(!b.readyState||b.readyState==="loaded"||b.readyState==="complete"){b.onload=b.onreadystatechange=null;if(b.parentNode){b.parentNode.removeChild(b)}}};return b}catch(d){}}}(),kmn_sa=kmn_sa||new function(){var a=".komoona.com/",c="border:none;padding:0;margin:0;background:transparent;",e="kmn_tag_",f="kmn-debug=true";var b=this,d=kmn_cstat,h=document,g=window;b.options={base_url:"//a"+a,ext_src:"//cdn"+a+"scripts/kmn",debug:false,stat_url:"//stat"+a+"s",np:"//s"+a+"passback/np/",v:"2.40",cs:{}};b.tags={};b.stMx=100;b.ifrmMx=6;b.o=b.options;b.is_iframe=function(){var i=0;try{i=(g.location!==g.parent.location)}catch(j){}return i};b.build_js=function(j,i){return('<script type="text/javascript"'+(i?">"+j:' src="'+j+'">')+"<\/script>")};b.write_js=function(i){h.write(b.build_js(i,0))};b.extend=function(){var l=0,k,j={};for(;l<arguments.length;l++){for(k in arguments[l]){j[k]=j[k]||arguments[l][k]}}return j};b.setAttributes=function(k,j){try{for(var i in j){k.setAttribute(i,j[i])}return k}catch(l){}};b.cssClass=function(k){try{var m=h.createElement("style"),j="",i=h.getElementsByTagName("head")[0];for(var l in k){j+="."+l+"{"+k[l]+"}"}m.appendChild(h.createTextNode(j));m.setAttribute("type","text/css");if(i){i.appendChild(m)}}catch(n){}};b.create_iframe=function(l,j,i){var k=h.createElement("iframe");b.setAttributes(k,b.extend(i||{},{src:l,marginHeight:0,marginWidth:0,frameBorder:0,scrolling:"no"}));if(j){j.appendChild(k)}return k};b.get_np=function(i){if(g.kmn_passbacks&&kmn_passbacks[i]){kmn_np.next(i)}else{b.write_js(b.o.np+i+".js")}};b.getDoc=function(){try{return(b.is_iframe()?g.frameElement.contentDocument||g.frameElement.contentWindow.document:h)}catch(i){}return null};b.callS2s=function(j,l){if(l.s2sBaseUrl){var i,k,m=b.getDoc(),n={layoutid:j,chain:l.codes,cb:kmn_cb,index:l.full_index-1,uts:new Date().getTime(),inFrame:b.is_iframe()?1:0,url:b.site_url(),tz:new Date().getTimezoneOffset()};if(m){k=(m.characterSet?m.characterSet:m.charset);if(k){n.ch=k}}i=d.stat_src(l.s2sBaseUrl+"GetAd",n);b.log("s2s["+i+"]");return b.build_js(i,0)}return""};b.s2sServerIncrement=function(l,j){if(j>1&&kmn_data[l]){var q=kmn_data[l],o=q.full_index,n=o,m=(o+j-1),k=q.order,p=q.codes;for(;n<m;n++){k=p[n].split("").reverse().join("")+"|"+k}q.order=k;q.full_index=m}};b.useS2sOn=function(j,k){try{var l=kmn_data[j]||{};if(l.s2sCodes){var i=l.s2sCodes.indexOf(k.charAt(0))>-1;if(i&&l.s2sExcludedTags){i=!(l.s2sExcludedTags.indexOf(k)>-1)}return i}}catch(m){}return 0};b.site_url=function(){var j="",i;if(g.kmn_siteurl){j=kmn_siteurl}else{j=i=(b.is_iframe()&&h.referrer!=="")?h.referrer:g.location.href;if(j.indexOf("javascript:window")!==-1||j.indexOf("about:blank")!==-1){try{j=g.parent.location.href}catch(k){j=i}}}if(j.length>1024){j=j.replace(/([^:]+:\/\/[^\/]+).*/,"$1")}return j};b.is_dbg=function(){try{var l=0,m=0,k=g.location.href,j=k.slice(k.indexOf("?")+1).split("&");for(;l<j.length;l++){if(j[l]===f){m=1}}b.o.debug=m;if(m&&!g.console){g.console={log:function(){}}}}catch(n){}};b.live_tags=function(k){var i,j=[];try{for(i in b.tags){if(i!==k){j.push(i)}}}catch(l){}return j};b.spark=function(j,m){try{var k=b.extend({tagid:j,v:b.o.v,cb:kmn_cb,ds:h.readyState,ts:b.get_ts(j)},m||{}),i=b.live_tags(j);if(i.length){k.p=i.join(";")}if(!k.l){k.d=b.site_url()}b.log("sprk"+b.stringify(k));d.save(b.o.stat_url,k);return k}catch(l){}};b.get_ts=function(i){var j=-1;try{if(b.tags[i]){j=(new Date().getTime()-b.tags[i].ts)}}catch(k){}return j};b.log=function(k){if(b.o.debug){var j=new Date(),i=j.getHours()+":"+j.getMinutes()+":"+j.getSeconds()+":"+j.getMilliseconds();g.console.log("["+i+"] "+k)}};b.console=function(i){b.log(i)};b.initTagParams=function(i){try{b.xd=b.xd||komoona_xd.receive(function(k){b.handle(k.data)});if(!Array.prototype.indexOf&&!g.kmn_bc){b.write_js(b.o.ext_src+"-bc.js")}}catch(j){}b.tags[i]={srvEnded:0,stTimer:null,ifrmWait:0,stCnt:0,ts:kmn_ts,cnt:1};b.statTimer(i)};b.replaceTagParams=function(j,i){if(b.tags[j]){g.clearInterval(b.tags[j].stTimer);b.tags[i]=b.tags[j];delete b.tags[j];b.statTimer(i)}};b.elemHeight=function(l){var k=-1;try{if(l){var j=l.clientHeight||0,m=l.offsetHeight||0,i=l.scrollHeight||0;k=Math.max(m,j,i)}}catch(n){}return k};b.statsParams=function(i){var k={h:b.elemHeight(h.getElementById(e+i))},j=kmn_data[i];if(g.kmn_siteurl){k.um=kmn_siteurl}if(j){k.o=j.order;k.ch=j.codes.join("|")}return k};b.stats=function(i,j){if(!b.tags[i].srvEnded){b.tags[i].srvEnded=1;b.log("end:tid["+i+"]o["+j.o+"]h["+j.h+"]");j.l=b.site_url();b.spark(i,j)}};b.statTimer=function(i){b.tags[i].stTimer=g.setInterval(function(){b.statHandler(i)},500)};b.statHandler=function(k){if(b.tags[k].srvEnded){g.clearInterval(b.tags[k].stTimer)}else{b.tags[k].stCnt+=1;var n=b.statsParams(k),l=n.o||"",u=0,t=b.getDataVar(k,"h",50);if(b.tags[k].stCnt===b.stMx){b.spark(k,{o:l,h:n.h,err:"timeout@stats"})}else{if(l.indexOf("h")!==-1){u=1}else{if(n.h>=t){var j=h.getElementById(e+k),r=(j?j.getElementsByTagName("iframe"):[]);if(r.length===0){u=1}else{var p,q=0;for(p=0;p<r.length;p++){q=(r[p].offsetHeight!==0&&r[p].style.display!=="none")||q}if(q){var m=l.split("|");if(m[0].indexOf("x")!==-1){u=(b.tags[k].ifrmWait++>=b.ifrmMx)}else{u=1}}else{u=1}}}}if(u){if(l.indexOf("h")===-1){var v=b.tags[k],o=kmn_data[k];if(o&&v.lbl){var s=h.createElement("a"),j=h.getElementById(e+k);if(j){s.appendChild(h.createTextNode(v.lbl.txt));b.setAttributes(s,{"class":"kmn-lbl",target:"_blank",href:v.lbl.lnk});j.style.width=o.w+"px";j.style.height=o.h+"px";j.appendChild(s)}}}b.stats(k,n)}}}};b.cookieSync=function(i,j){if(!b.o.cs.js){b.o.cs.js=d.async_js(b.o.ext_src+"-cs.js",{})}if(!g.kmn_cs&&!b.o.cs[i]){b.o.cs[i]=g.setInterval(function(){b.cookieSync(i,j)},100)}else{if(g.kmn_cs){g.clearInterval(b.o.cs[i]);kmn_cs.cookieSync(i,j)}}};b.heartbeat=function(i){if(!g.kmn_hb&&!b.o.hb){d.async_js(b.o.ext_src+"-hb.js",{});b.o.hb=g.setInterval(function(){b.heartbeat(i)},50)}else{if(g.kmn_hb){g.clearInterval(b.o.hb);kmn_hb.start(i)}}};b.getDataVar=function(j,i,k){if(kmn_data[j]&&kmn_data[j][i]){return kmn_data[j][i]}return k||null};b.tag=function(i){try{b.is_dbg();var m,l=b.tags;for(m in l){if(!h.getElementById(e+m)){g.clearInterval(b.tags[m].stTimer);delete b.tags[m]}}var j=g.kmn_size?"stag":"dtag";this[j](i)}catch(k){b.spark(i,{err:k.message+"@tag"})}};b.dtag=function(j){var l=b.live_tags(j),p={l:b.site_url(),v:b.o.v,cb:kmn_cb};if(g.kmn_siteurl){p.um=kmn_siteurl}if(l.length){var m,k=[];for(m in l){k.push(b.getDataVar(l[m],"codes",""))}p.s=l.join(";");p.codes=k.join(";")}var o={},n=d.stat_src(b.o.base_url+"tag/"+j+".js",p);if(b.o.debug){n+="&"+f}if(!b.tags[j]){b.initTagParams(j)}else{p.n=++b.tags[j].cnt;o=b.extend(o,{err:"duplicate",c:p.n});n=n.replace("tag/","passback/hp/")+"&n="+p.n}b.spark(j,o);b.log("tag["+n+"]");if(h.readyState!=="complete"&&!kmn_iframe){b.write_js(n)}else{b.atag(j,n)}};b.stag=function(i){try{var j=kmn_size.split("x");delete kmn_size;b.dtag(i+"_"+j[0]+"_"+j[1])}catch(k){}};b.atag=function(k,o){kmn_iframe=0;b.tags[k].srvEnded=1;try{var j=h.getElementsByTagName("script"),l=j[j.length-1];var p=b.setAttributes(h.createElement("div"),{id:"kmni_"+k,style:c});l.parentNode.appendChild(p);var m=b.create_iframe("about:blank",p,{});if(m){var i=b.build_js(o+"&asmk=true",0);b.iframe_content(m,i,k)}}catch(n){}};b.xtag=function(k){var l=k.tid||k.nptid;try{if(!h.getElementById("kmnx_"+l)&&kmn_data[l]){var m,q=h.getElementById(e+l),o=(q?q.getElementsByTagName(k.e||"ins"):[]);for(m=0;m<o.length;m++){o[m].style.display="none";o[m].style.height="0px"}var n=b.create_iframe("about:blank",q,{id:"kmnx_"+l,width:k.w,height:k.h});if(n){var j=b.build_js("kmn_data['"+l+"']="+b.stringify(kmn_data[l])+";kmn_sa.get_np('"+l+"')",1);b.iframe_content(n,j,l)}b.tags[l].srvEnded=1;b.log("xtag["+l+"]")}}catch(p){b.spark(l,{err:p.message+"xtag"})}};b.iframe_content=function(k,i,j){var n=b.build_js("var kmn_cb="+kmn_cb+",kmm_ts="+kmn_ts+(b.o.debug?";kmn_sa.o.debug=1":"")+";kmn_sa.initTagParams('"+j+"');",1),l='<!DOCTYPE HTML><html><head><meta name="robots" content="noindex,nofollow">'+b.build_js(b.o.ext_src+"_sa.js",0)+n+'</head><body style="'+c+'">'+i+"</body></html>";var m=(k.contentDocument?k.contentDocument:(k.contentWindow?k.contentWindow.document:(k.document?k.document:0)));if(m){m.open();m.write(l);m.close()}};b.handle=function(k){b.log("hndl["+k+"]");try{var i=b.parseJson(k);if(i.w&&i.h){if(i.tid){b.xtag(i)}else{if(i.nptid){kmn_data[i.nptid].full_index+=1;b.xtag(i)}else{if(i.tagid){var j,m=h.getElementById("kmni_"+i.tagid);if(m){j=m.getElementsByTagName("iframe")[0];j.style.display="block";b.setAttributes(j,{width:i.w+"px",height:i.h+"px"})}}}}}}catch(l){}};b.parseJson=function(j){var i;try{i=g.JSON&&g.JSON.parse?g.JSON.parse(j):(new Function("return "+j))()}catch(k){}return i||{}};b.stringify=function(m){if(g.JSON&&g.JSON.stringify){return g.JSON.stringify(m)}else{var l=typeof(m);if(l!=="object"||m===null){if(l==="string"){m='"'+m+'"'}return String(m)}else{var o,j,k=[],i=(m&&m.constructor===Array);for(o in m){if(m.hasOwnProperty(o)){j=m[o];l=typeof(j);if(l==="string"){j='"'+j+'"'}else{if(l==="object"&&j!==null){j=b.stringify(j)}}k.push((i?"":'"'+o+'":')+String(j))}}return(i?"[":"{")+String(k)+(i?"]":"}")}}}}(),komoona_xd=komoona_xd||(function(){var a=window;return{post:function(b,d,c){if(a.postMessage){c.postMessage(b,d.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}},receive:function(c){if(a.postMessage){var b=function(d){return c(d)};if(a.addEventListener){a.addEventListener("message",b,false)}else{a.attachEvent("onmessage",b)}return b}}}}());if(window.kmn_placement){var tag=kmn_placement;delete kmn_placement;kmn_sa.tag(tag)};