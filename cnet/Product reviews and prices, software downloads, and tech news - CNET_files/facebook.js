define(["jquery","version!fly/managers/debug","managers/third-party/social-flags","managers/client-storage","managers/tealium","components/global-modal"],function(e,t,n,r,i){t=t.init("facebook");var s=!1,o={fbOptions:{appId:"16995676698",channelUrl:"//"+document.domain+"/html/facebook/channel.html",status:!0,cookie:!0,oauth:!0,xfbml:!0},onInit:null,debug:!1},u=-1;return{init:function(r){var i=this;n.enabled.facebook&&(e.extend(!0,o,r),s?o.onInit&&o.onInit():(window.fbAsyncInit=function(){FB.init(o.fbOptions),s=!0,i.setupEvents(),o.onInit&&o.onInit(),t.log("Initialized"),delete window.fbAsyncInit},require(["facebook"+(o.debug?"-debug":"")])))},parse:function(e){if(s)try{e?FB.XFBML.parse(e):FB.XFBML.parse()}catch(n){t.log("FB failed to parse the page",n)}else t.log("Parse failed -- not initialized yet")},isInitialized:function(){return s},promptLikeCnet:function(t){var n=this;if(!r.read("dontShowLikeCnet")){var i=e.cnet.globalModal({content:'                        <p>Join the conversation.</p>                        <p>Like CNET on Facebook for the latest in tech news and reviews.</p>                        <div class="fb-like" data-href="http://www.facebook.com/CNETenEspanol" data-layout="button_count" data-width="450" data-show-faces="false" ref="'+(t||"")+'"></div>                        <p><label><input type="checkbox" class="dont-show" /> Don\'t show this again</label></p>'});i.$element.on("modalopened",function(t){n.parse(i.$element[0]);var s=e(".dont-show",i.$element);s.on("click",function(e){r.write("dontShowLikeCnet",s[0].checked)})}),i.open()}},checkLikes:function(e,n){if(s)try{FB.api("/me/likes/"+e,n)}catch(r){t.log("FB failed to check likes for the user",r)}else t.log("Check likes failed -- not initialized yet")},setupEvents:function(){var n=this;FB.Event.subscribe("edge.create",function(r,i){t.log("Liked");var s={wdloc:i._attr.ref};r==="http://www.facebook.com/CNETenEspanol"?e.extend(s,{eventt:"fblikecnet"}):r==="http://www.facebook.com/CNETenEspanol#reg"?e.extend(s,{eventt:"fblikecnetreg"}):n.promptLikeCnet(),n.trackLike(s)}),FB.Event.subscribe("edge.remove",function(r,i){t.log("Unliked");var s={wdloc:i._attr.ref};r==="http://www.facebook.com/CNETenEspanol"&&e.extend(s,{eventt:"fbunlikecnet"}),n.trackUnlike(s)})},trackLike:function(t){i.trackSocial(e.extend({socialService:"facebook",event:"connect",levtEventType:"share",eventt:"fblike",socialId:2},t))},trackUnlike:function(t){i.trackSocial(e.extend({socialService:"facebook",event:"disconnect",eventt:"fbunlike"},t))},isLoggedIn:function(e){var n=this;s?u===-1?FB.getLoginStatus(function(t){u=t.status,e(n.authStatusToBoolean(u))},!0):e(n.authStatusToBoolean(u)):t.log("isLoggedIn failed -- not initialized yet")},getLoginStatus:function(e){var n=this;s?u===-1?FB.getLoginStatus(function(t){u=t.status,e(u)},!0):e(u):t.log("getLoginInStatus failed -- not initialized yet")},isLoggedInSync:function(){var e=this;if(s)return u===-1&&(u=FB.getAuthResponse().status),e.authStatusToBoolean(u);t.log("isLoggedInSync failed -- not initialized yet")},authStatusToBoolean:function(e){var t=!1;return e==="connected"?t=!0:e==="not_authorized"?t=!0:t=!1,t}}})