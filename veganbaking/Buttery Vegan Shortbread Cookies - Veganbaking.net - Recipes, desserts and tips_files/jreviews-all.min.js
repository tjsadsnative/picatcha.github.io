jreviews=jreviews||{},function(t,e,i){var a=t("div.jr-page");t(document).ajaxStop(function(){setTimeout(function(){e.addOnloadAjax("datepicker",e.datepicker),e.addOnloadAjax("popup",e.popup),e.addOnloadAjax("tabs",e.tabs),e.addOnloadAjax("listing-manager",e.listing.manager),t.each(e._onloadFnAjax,function(t,e){e!==i&&e()})},10)}),e=t.extend(e,{lang:e.lang||{},_onloadFn:[],_onloadFnAjax:[],_onloadFnKeys:[],_onloadFnAjaxKeys:[]}),e.addOnload=function(i,a){-1==t.inArray(i,e._onloadFnKeys)&&(e._onloadFn.push(a),e._onloadFnKeys.push(i))},e.addOnloadAjax=function(i,a){-1==t.inArray(i,e._onloadFnAjaxKeys)&&(e._onloadFnAjax.push(a),e._onloadFnAjaxKeys.push(i))},e.onload=function(){a=a.length>0?a:t("div.jr-page"),e.addOnload("datepicker",e.datepicker),e.addOnload("popup",e.popup),e.addOnload("showmore",e.showmore),e.addOnload("lightbox",e.lightbox),e.addOnload("favorite",e.listing.favorite),e.addOnload("tabs",e.tabs),e.addOnload("login",e.login.init),e.addOnload("social-sharing",e.socialSharing),e.addOnload("pagenav",e.pageNav),e.addOnload("listing-create",e.listing.formSetup),e.addOnload("listing-manager",e.listing.manager),e.addOnload("listing-widgets",e.listing.widgets),e.addOnload("listing-claim",e.claim.init),e.addOnload("listing-inquiry",e.inquiry.init),e.addOnload("listing-masonry",e.masonry),e.addOnload("review-init",e.review.init),e.addOnload("review-edit",e.review.edit),e.addOnload("review-vote",e.review.vote),e.addOnload("review-reply",e.review.reply),e.addOnload("report",e.report.init),e.addOnload("comment-manager",e.discussion.manager),e.addOnload("comment-new",e.discussion.init),e.addOnload("comment-reply",e.discussion.reply),e.addOnload("comment-earlier",e.discussion.earlierComment),e.addOnload("media-init",e.media.init),e.addOnload("media-thumbs",e.media.generateThumbs),e.addOnload("media-manager",e.media.manager),e.addOnload("media-download",e.media.download),e.addOnload("search-simple",e.search.simple),e.addOnload("search-adv-page",e.search.advancedPage),e.addOnload("search-adv-module",e.search.advancedModule),e.addOnload("directory-tree",e.directoryTree),e.addOnload("facebook",e.facebook.load),e.addOnload("comparison",e.compare),e.addOnload("module-slider",e.module.init),t.each(e._onloadFn,function(t,e){e!==i&&e()})},"function"==typeof head?head.ready(function(){e.onload()}):t(function(){e.onload()}),e.getScript=function(e,a){return t.ajax({type:"GET",url:e,success:function(){i!==a&&a()},dataType:"script",cache:!0})},e.__t=function(i,a){var n={add_ul:!0};if(a=t.extend(n,a),"string"==typeof i)return e.lang[i]||i;var o=[];return t.each(i,function(t,i){var a,n,r;"string"==typeof i?a=e.lang[i]||i:(r=i.shift(),n=e.lang[r]||r,i.unshift(n),a=window.sprintf.apply(null,i)),o.push("<li>"+a+"</li>")}),a.add_ul?"<ul>"+o.join("")+"</ul>":o.join("")},e.dispatch=function(e){e=e||{};var a=e.form_id!==i||e.form!==i?"POST":"GET";i!==e.method&&(a=e.method);{var n=e.controller!==i?t.param({"data[controller]":e.controller,"data[action]":e.action}):{};e.type||"json"}if(i!==e.form_id||i!==e.form){var o=e.form||t("#"+e.form_id);i!==e.controller&&o.find("input[name=data\\[controller\\]], input[name=data\\[action\\]]").remove(),n=o.serialize()+"&"+n}return e.data&&(n=n+"&"+t.param(e.data)),t.ajax({type:a,url:s2AjaxUri,data:n,dataType:e.type})},e.compare=function(){"undefined"!=typeof jreviewsCompare&&jreviewsCompare.init()},e.datepicker=function(){if(t().datepicker){try{e.datepickerClear()}catch(i){}t.datepicker.setDefaults({showOn:"both",buttonImage:e.calendar_img,showButtonPanel:!0,buttonImageOnly:!0,buttonText:"Calendar",dateFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0}),t('.jr-date:not(".jr_ready")').addClass("jr-ready").each(function(){t(this).datepicker({yearRange:t(this).data("yearrange"),minDate:t(this).data("mindate"),maxDate:t(this).data("maxdate")})})}},e.datepickerClear=function(){var i=t.datepicker._updateDatepicker;t.datepicker._updateDatepicker=function(a){i.call(this,a);var n=t(this).datepicker("widget").find(".ui-datepicker-buttonpane");0===n.find(".clearDate").length&&t("<button class='clearDate' type='button' class='ui-datepicker-clean ui-state-default ui-priority-primary ui-corner-all'>"+e.__t("CLEAR_DATE")+"</button>").appendTo(n).click(function(){t.datepicker._clearDate(a.input)})}},e.directoryTree=function(){t().treeview&&t(".jr-directory-tree").treeview({animated:"fast",unique:!0,collapsed:!1}).each(function(){var e=t(this),i=e.data("cat-id"),a=e.data("dir-id"),n=e.data("show-dir"),o=null;i?o=t(".jr-tree-cat-"+i):a&&n&&(o=t(".jr-tree-dir-"+a)),null!==o&&(o.removeClass("closed").swapClass("expandable","collapsable").swapClass("expandable-hitarea","collapsable-hitarea").swapClass("lastExpandable-hitarea","lastCollapsable-hitarea").swapClass("lastExpandable","lastCollapsable"),o.parents("ul, li").show().removeClass("closed").swapClass("expandable","collapsable").swapClass("expandable-hitarea","collapsable-hitarea").swapClass("lastExpandable-hitarea","lastCollapsable-hitarea").swapClass("lastExpandable","lastCollapsable"),o.children("ul, li").show().removeClass("closed"),o.children("div").swapClass("expandable","collapsable").swapClass("expandable-hitarea","collapsable-hitarea"),o.parents("ul, li").children("div").swapClass("expandable-hitarea","collapsable-hitarea").swapClass("lastExpandable-hitarea","lastCollapsable-hitarea"))})},e.tabs=function(e){if("undefined"!=typeof t().tabs){e=e||t('div.jr-page .jr-tabs:not(".jr-ready")');var a=t("base").attr("href");a!==i&&a.length&&e.find("ul:eq(0) li a").each(function(){t(this).attr("href",t(location).attr("href").split("#")[0]+t(this).attr("href"))}),e.addClass("jr-ready").tabs()}},e.pageNav=function(){a.on("click",'div.jr-pagenav[data-ajax="1"] a',function(e){e.preventDefault(),t(this).trigger("jrPageNav")}),a.on("change",'div.jr-pagenav[data-ajax="1"] select.jr-pagenav-limit',function(e){e.preventDefault(),t(this).trigger("jrPageNav")}),a.on("jrPageNav",'div.jr-pagenav[data-ajax="1"] a, div.jr-pagenav[data-ajax="1"] select.jr-pagenav-limit',function(i){i.preventDefault();var n=t(this),o=n.closest("form"),r=a.find("div.jr-pagenav"),s=Number(t("div.jr-pagenav select.jr-pagenav-limit").first().find(":selected").text()),d=1,l=Number(r.find("a.jr-pagenav-page").last().html()),c=[],u=o.find('input[name="data[controller]"]').val(),f=o.find('input[name="data[action]"]').val()||"index";0===s&&(s=o.find('input[name="data[limit]"]').val()||10),n.hasClass("jr-pagenav-page")?d=Number(n.html()):n.hasClass("jr-pagenav-next")?(d=Number(n.siblings("span.jr-pagenav-current").html())+1,d=d>l?d:d):n.hasClass("jr-pagenav-prev")&&(d=Number(n.siblings("span.jr-pagenav-current").html())-1,d=0>d?1:d),c.push({name:e.qvars.pg,value:d}),c.push({name:"limit",value:s});var p=e.dispatch({method:"get",type:"html",controller:u,action:f,data:c});p.done(function(t){n.closest(".jr-page-inner, .jr-page").first().html(t)})})},e.socialSharing=function(){a.find(".jr-tweet").length&&!function(t,e,i){var a,n=t.getElementsByTagName(e)[0];t.getElementById(i)||(a=t.createElement(e),a.src="//platform.twitter.com/widgets.js",n.parentNode.insertBefore(a,n))}(document,"script","twitter-jssdk");var t=a.find(".jr-gplusone");t.length&&(t.remove(),function(t,e,i){var a,n=t.getElementsByTagName(e)[0];t.getElementById(i)||(a=t.createElement(e),a.id=i,a.src="//apis.google.com/js/plusone.js",n.parentNode.insertBefore(a,n))}(document,"script","google-jssdk"));var e=a.find(".jr-linkedin");e.length&&(e.remove(),function(t,e,i){var a,n=t.getElementsByTagName(e)[0];t.getElementById(i)||(a=t.createElement(e),a.id=i,a.src="//platform.linkedin.com/in.js",n.parentNode.insertBefore(a,n))}(document,"script","linkedin-jssdk")),a.find(".jr-pinterest").length&&!function(t,e,i){var a,n=t.getElementsByTagName(e)[0];t.getElementById(i)||(a=t.createElement(e),a.id=i,a.src="//assets.pinterest.com/js/pinit.js",n.parentNode.insertBefore(a,n))}(document,"script","pinterest-jssdk")},e.login={init:function(){a.on("click",".jr-show-login",function(){t("#jr-login-form").toggle()})}},e.discussion={init:function(){var a=t("div.jr-form-comment-outer"),n=a.find('form[id^="jr-form-comment"]'),o=n.attr("id"),r=(n.data("discussion-id"),n.find(".jr-buttons")),s=n.find(".jr-validation"),d=t("button.jr-comment-add");d.on("click",function(e){e.preventDefault();var i=t(this);a.slideDown(),i.fadeOut()}),d.one("click",function(){e.common.initForm(o,!0),e.common.validateUsername(n)}).trigger("click"),n.on("click","button.jr-comment-cancel",function(t){t.preventDefault(),a.slideUp(),d.fadeIn()}),n.on("click","button.jr-comment-submit",function(o){o.preventDefault();var d=t(".jr-review-comments");r.find("button").prop("disabled",!0),r.append('<span class="jrLoadingSmall">'),s.hide();var l=e.dispatch({form:n});l.done(function(t){if(t.success){a.slideUp().remove();var o='<div class="jr-message jrSuccess">'+e.__t(t.moderation?"DISCUSSION_SUBMIT_MODERATED":"DISCUSSION_SUBMIT_NEW")+"</div>";d.prepend('<div class="jr-new-comment jrHidden">'+o+t.html+"</div>").jrScrollTo({duration:500,offset:-50}).delay().find(".jr-new-comment").slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500),e.discussion.manager(),e.discussion.earlierComment()}else{t.str.length&&s.html(e.__t(t.str)).show();var r=n.find("div.jr-captcha img");t.captcha!==i&&r.length&&(r.attr("src",t.captcha),n.find("input.jr-captcha-code").val(""))}}),l.always(function(){r.find(".jrLoadingSmall").remove(),r.find("button").prop("disabled",!1)})})},reply:function(){t('button.jr-comment-reply:not(".jr-ready")').on("click",function(i){i.preventDefault();var a=t(this),n=a.find("span").eq(1),o=a.data("discussion-id"),r=a.data("review-id"),s=e.dispatch({method:"get",type:"html",controller:"discussions",action:"reply",data:{discussion_id:o,review_id:r}});s.done(function(i){var o={},r=function(){var i=t(this),a=i.find("form").last();e.common.initForm(a.attr("id"),!0),e.common.validateUsername(a),i.on("click",".jr-show-login",function(){i.find(".jr-login-form").toggle()})};o[e.__t("SUBMIT")]=function(){e.discussion.submitReply(a,t(this))},o[e.__t("CANCEL")]=function(){t(this).dialog("close")};var s=t.jrDialog(i,{buttons:o,title:n.html(),open:r,width:"640px"});s.find(".jr-form-comment-outer").show()})}).addClass("jr-ready")},manager:function(){var i=t('ul.jr-comment-manager:not(".jr-ready")').addClass("jr-ready");i.on("click","a.jr-comment-edit",function(){var i=t(this),a=i.find("span").eq(1),n=i.data("discussion-id"),o=e.dispatch({method:"get",type:"html",controller:"discussions",action:"edit",data:{discussion_id:n}});o.done(function(n){var o={};o[e.__t("SUBMIT")]=function(){e.discussion.submitEdit(i,t(this))},o[e.__t("CANCEL")]=function(){t(this).dialog("close")};var r=t.jrDialog(n,{buttons:o,title:a.html(),width:"640px"});r.find(".jr-form-comment-outer").show()})}),i.on("click","a.jr-comment-delete",function(){var i=t(this),a=i.data("discussion-id"),n=i.data("token"),o=i.find("span").eq(1),r=new t.Deferred;r.done(function(t){var o={id:a,token:n},r=e.dispatch({method:"get",type:"json",controller:"discussions",action:"_delete",data:o});r.done(function(a){a.success?(t.dialog("close"),i.closest(".jr-layout-outer").html('<div class="jrSuccess">'+e.__t("DISCUSSION_DELETED")+"</div>").jrScrollTo()):(t.dialog("option","buttons",[]),a.str.length&&t.html(e.__t(a.str)))})});var s={};s[o.html()]=function(){r.resolve(t(this))},s[e.__t("CANCEL")]=function(){t(this).dialog("close")},t.jrDialog(e.__t("DISCUSSION_DELETE_CONFIRM"),{buttons:s,title:o.html(),width:"640px"})})},submitReply:function(a,n){var o=n.find("form").last(),r=(o.attr("id"),o.find(".jr-validation"));r.hide();var s=e.dispatch({form:o});s.done(function(s){if(s.success){n.dialog("close");var d='<div class="jr-message jrSuccess">'+e.__t(s.moderation?"DISCUSSION_SUBMIT_MODERATED":"DISCUSSION_SUBMIT_NEW")+"</div>",l=t('<div class="jr-new-comment jrHidden">'+d+s.html+"</div>");a.closest(".jr-layout-outer").after(l),l.jrScrollTo({duration:500,offset:-50}).delay().slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500)}else if(s.str.length){r.html(e.__t(s.str)).show();var c=o.find("div.jr-captcha img");s.captcha!==i&&c.length&&(c.attr("src",s.captcha),o.find("input.jr-captcha-code").val(""))}e.discussion.manager()})},submitEdit:function(i,a){var n=a.find("form"),o=(n.attr("id"),n.find(".jr-validation"));o.hide();var r=e.dispatch({form:n});r.done(function(n){if(n.success){a.dialog("close");var r=t('<div class="jr-message jrSuccess" style="margin-top:10px;">'+e.__t(n.moderation?"DISCUSSION_SUBMIT_MODERATED":"DISCUSSION_SUBMIT_EDIT")+"</div>"),s=t('<div class="jr-new-comment jrClear jrHidden">'+n.html+"</div>"),d=i.closest(".jr-layout-inner");d.html(r).prepend(s),s.jrScrollTo({duration:500,offset:-50}).delay().slideDown(1500)}else n.str.length&&o.html(e.__t(n.str)).show();e.discussion.manager(),e.discussion.earlierComment()})},earlierComment:function(){t(".jr-earlier-comment").each(function(){var i=t(this),a=i.data("post-id"),n=i.next(".jr-earlier-comment-content"),o=t.Deferred();o.done(function(){var t=e.dispatch({method:"get",type:"html",controller:"discussions",action:"getPost",data:{id:a}});t.done(function(t){n.html(t)})}),i.jrPopup({className:"jrPopup",delay:500,onBeforeShow:function(){""===n.html()&&(n.html('<span class="jrLoadingMedium"></span>'),o.resolve())}})})}},e.module={init:function(){t("div.jr-module-slider, div.jr-plugin-slider").not(".jr-ready").addClass("jr-ready").each(function(){var e=t(this),i=e.find(".jrModuleItems"),a=e.data("options");if(!(a.page_count<2)){e.removeClass("jrSliderSinglePage"),"vertical"==a.orientation&&e.addClass("jrSliderVertical"),"side"==a.nav_position&&e.addClass("jrSliderSideArrows");var n,o,r={mode:a.orientation,speed:600,easing:"swing",oneToOneTouch:!0,auto:parseInt(a.slideshow,10),pause:1e3*a.slideshow_interval,autoHover:!0,pager:!0},s=e.closest(".jr-tabs"),d=e.closest(".tab-pane"),l=e.closest(".joms-tab__content");s.length?(n=s.find("li a").eq(0).attr("href").split("#")[1],n&&i.parents("#"+n).length?i.bxSlider(r):s.on("tabsshow",function(t,a){a.panel.id==e.closest(".ui-tabs-panel").attr("id")&&i.bxSlider(r)})):d.length?setTimeout(function(){if(o=d.parent().prev("ul").find("li a").eq(0).attr("href"),n=o?o.split("#")[1]:null,n&&i.parents("#"+n).length)i.bxSlider(r);else{t('a[data-toggle="tab"]').on("shown.bs.tab",function(){i.bxSlider(r)});var e=d.attr("id").match(/[\d]+$/);e&&t("#cbtabnav"+e+" a").one("click",function(){i.bxSlider(r)})}},550):l.length?(n=l.parent().find(".joms-tab__bar a").eq(0).attr("href").split("#")[1],n&&i.parents("#"+n).length?i.bxSlider(r):l.parent().on("click",".joms-tab__bar a",function(){i.bxSlider(r)})):i.bxSlider(r)}})}},e.lightbox=function(){t(".jrPage a.fancyvideo").length>0&&t("a.fancyvideo").magnificPopup({type:"iframe",callbacks:{elementParse:function(t){t.src=t.src+"&lightbox=1&tmpl=component"}}}),t(".jrPage a.fancybox").length>0&&(t(".jrPage").magnificPopup({delegate:'a.fancybox[rel="gallery"]',type:"image",mainClass:"mfp-fade",zoom:{enabled:!0,duration:300},gallery:{enabled:!0,preload:[0,2],navigateByImgClick:!0,arrowMarkup:'<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir%"></button>',tCounter:'<span class="mfp-counter">%curr% of %total%</span>'}}),t(".jrReviewContainer .jrMediaContainer").each(function(){t(this).magnificPopup({delegate:"a.fancybox",type:"image",mainClass:"mfp-fade",zoom:{enabled:!0,duration:150},gallery:{enabled:!0,preload:[0,2],navigateByImgClick:!0,arrowMarkup:'<button title="%title%" type="button" class="mfp-arrow mfp-arrow-%dir%"></button>',tCounter:'<span class="mfp-counter">%curr% of %total%</span>'}})}))},e.media={init:function(){if("undefined"==typeof jreviewsMedia)return!1;e.media.formSetup();var i=t("div.jr-listing-media"),a=i.find(".jr-tabs-media"),n=["photo","photo_owner","photo_user","video","video_owner","video_user","audio","attachment"];i.find("div.jr-media-sortable").sortable({axis:"y",containment:"parent",handle:".jr-sort-handle",cursor:"move",stop:jreviewsMedia.reorder}),t(n).each(function(t,e){i.find("div#"+e).length?i.find('a[href="#'+e+'"]').closest("li").show():i.find('a[href="#'+e+'"]').closest("li").remove()}),e.tabs(a),jreviewsMedia.videoGallery.init(),jreviewsMedia.photoGallery.init(),jreviewsMedia.audioPlayer()},generateThumbs:function(){t('img[data-thumbnail="1"]').not(".jr-ready").each(function(){var i=t(this);i.addClass("jr-ready");var a={"data[media_id]":t(this).data("media-id"),"data[size]":t(this).data("size"),"data[mode]":t(this).data("mode")},n=e.dispatch({method:"post",type:"json",controller:"media_upload",action:"generateThumb",data:a});n.done(function(t){if(t.success&&""!==t.url){var e=i.closest("div");i.css("none"!=e.css("max-width")?{width:e.css("max-width"),height:"auto"}:{width:t.width+"px",height:t.height+"px"}),i.attr("src",t.url)}})})},formSetup:function(){var i=t("div.jr-media-upload"),a=i.find("#jr-media-uploader"),n=a.data("android");if(i.length){var o=i.find("form#jr-user-info");try{if(e.paid.plan.plan_selected){var r=t('<input type="hidden" name="data[plan_id]">').val(e.paid.plan.plan_selected);i.find("form").append(r)}}catch(s){}e.common.validateUsername(o),e.common.initForm("jr-user-info",!0);var d=i.find("form#jr-form-media-upload"),l=d.data("file-validation");jreviewsMedia.initUploader("jr-media-uploader",{fileValidation:l,multiple:n?!1:!0});var c=i.find(".jr-upload-button"),u=c.find("input"),f=i.find(".jr-upload-mobile-options");f.length&&(c.hide(),f.on("change",function(){var e=t(this).val();u.removeAttr("multiple"),"multiple"==e&&u.attr("multiple","multiple"),""!==e&&u.trigger("click")}).buttongroup())}},manager:function(){var i=t(".jr-page");i.on("click",".jr-media-edit",function(){var i=t(this),a=i.data("media-id"),n=i.find("span").eq(1),o=e.dispatch({method:"get",type:"html",controller:"media",action:"_edit",data:{media_id:a}});o.done(function(a){var o={};o[e.__t("SUBMIT")]=function(){e.media.editSubmit(i,t(this))},o[e.__t("CANCEL")]=function(){t(this).find("#jr-video-player").trigger("jrVideoDestroy"),t(this).find("#jr-audio-player").remove(),t(this).dialog("close")};{var r=function(){t(this).find("#jr-video-player").trigger("jrVideoDestroy"),t(this).find("#jr-audio-player").remove()},s=function(){var i=t(this),a=i.find("div.jr-video-gallery"),n=i.find("#jr-audio-player"),o=i.find(".jr-thumbnails");o.length&&o.find(".jr-thumb-del").on("click",function(){var i=t(this);if(1==i.data("delete")){i.data("delete",0);var a={id:i.data("id"),size:i.data("size")},n=i.data("token");n&&(a[n]=1);var o=e.dispatch({method:"get",type:"json",controller:"media",action:"_deleteThumb",data:a});o.done(function(a){a.success?i.fadeOut(500):a.str.length&&t.jrAlert(e.__t(a.str))})}}).on("mouseenter",function(){var e=(t(this),t('<span class="jrIconDelete jrIconOnly">'));t(this).data("delete",1).data("contents",t(this).html()).css("width",t(this).width()+"px").css("height",t(this).height()+"px").html(e)}).on("mouseleave",function(){t(this).data("delete",0).html(t(this).data("contents"))}),a.length&&jreviewsMedia.videoGallery.init(),n.length&&jreviewsMedia.audioPlayer(),e.common.userAutocomplete(i.find("form"))};t.jrDialog(a,{buttons:o,title:n.html(),open:s,close:r,width:"800px"})}})}),i.on("click",".jr-media-delete",function(){var i=t(this),a=i.data("media-id"),n=i.data("token"),o=(i.data("lang"),i.find("span").eq(1)),r={},s=new t.Deferred;s.done(function(o){r[n]=1,r["data[Media][media_id]"]=a;var s=e.dispatch({method:"get",type:"json",controller:"media",action:"_delete",data:r});s.done(function(a){a.success?(o.dialog("close"),i.closest(".jr-layout-outer").css("background-image","none").animate({backgroundColor:"#f7f1ac"},600).promise().done(function(){t(this).slideUp(600,function(){t(this).remove()})})):(o.dialog("option","buttons",[]),o.html(e.__t(a.str)))})});var d={};d[e.__t("DELETE")]=function(){s.resolve(t(this))},d[e.__t("CANCEL")]=function(){t(this).dialog("close")},t.jrDialog(e.__t("MEDIA_DELETE_CONFIRM"),{buttons:d,title:o.html(),width:"640px"})}),i.on("click",".jr-media-publish",function(){var i=t(this),a=i.find("span").eq(0),n=i.data("media-id"),o=i.data("token"),r=i.data("states"),s={on:e.__t("PUBLISHED"),off:e.__t("UNPUBLISHED")},d={media_id:n};d[o]=1;var l=e.dispatch({method:"get",type:"json",controller:"media",action:"_publish",data:d});l.done(function(i){i.success?(a.attr("class",1==i.state?r.on:r.off),a.next().is("span")?a.next().html(1==i.state?s.on:s.off):a.attr("title",1==i.state?s.on:s.off)):t.jrAlert(e.__t(i.str))})}),i.on("click","button.jr-media-main",function(){var a=t(this),n=a.find("span").eq(0),o=a.data("listing-id"),r=a.data("media-id"),s=a.data("token"),d=a.data("states"),l={listing_id:o,media_id:r};l[s]=1,a.attr("disabled","disabled");var c=e.dispatch({method:"get",type:"json",controller:"media",action:"setMainMedia",data:l});c.done(function(e){if(e.success===!0){var o=function(){i.find("button.jr-media-main").not(a).removeAttr("disabled").each(function(){t(this).find("span").eq(0).attr("class",d.off)})};t.when(o()).done(function(){n.attr("class",d.on)})}})})},editSubmit:function(t,i){var a=i.find("form"),n=e.dispatch({form:a});n.done(function(a){a.success?(i.dialog("close"),t.closest(".jr-layout-inner").find(".jr-media-title a").html(a.title)):(i.dialog("option","buttons",[]),i.html(e.__t(a.str)))})},download:function(){t(".jr-page").on("click","button.jr-media-download",function(){var i=t(this),a=i.data("media-id"),n=i.data("token-s"),o=i.data("token-i");if(e.iOS)window.open(s2AjaxUri+"&url=media/download&"+e.qvars.mc+"="+a+"&"+n+"=1&"+o+"=1");else{t("#jr-download-"+a).remove();var r=t('<iframe id="jr-download-'+a+'" style="display:none;"></iframe>');r.attr("src",s2AjaxUri+"&url=media/download&"+e.qvars.mc+"="+a+"&"+n+"=1&"+o+"=1").appendTo("body")}})}},e.inquiry={init:function(){var i=t("button.jr-send-inquiry-embedded,a.jr-send-inquiry-embedded");i.length&&(e.common.initForm("jr-form-inquiry"),i.on("click",function(t){t.preventDefault(),e.inquiry.submit()})),t("button.jr-send-inquiry,a.jr-send-inquiry").on("click",function(i){i.preventDefault();var a=t(this),n=a.data("listing-id"),o=a.find("span").eq(1),r=e.dispatch({method:"get",type:"html",controller:"inquiry",action:"create",data:{id:n}});r.done(function(i){var a={};a[e.__t("SUBMIT")]=function(){e.inquiry.submit(t(this))},a[e.__t("CANCEL")]=function(){t(this).dialog("close")},t.jrDialog(i,{buttons:a,title:o.html(),width:"640px"}),e.common.initForm("jr-form-inquiry",!0)})})},submit:function(a){var n,o=t("#jr-form-inquiry-outer"),r=o.find(".jr-validation");n=a?a.find("form"):o.find("form"),o.find(".jr-validation").hide(),r.hide().html("");var s=e.dispatch({form:n});s.done(function(i){i.success?(a&&a.dialog("option","buttons",[]),o.html(e.__t("INQUIRY_SUBMIT"))):(i.str.length&&r.html(e.__t(i.str)).show(),t.each(i.inputs,function(t,e){o.find("#jr-inquiry-"+e).siblings("label").find(".jr-validation-input").show()}),a&&a.trigger("failedValidation"))}),s.always(function(t){var e=n.find("div.jr-captcha img");t.captcha!==i&&e.length&&(e.attr("src",t.captcha),n.find("input.jr-captcha-code").val(""))})}},e.masonry=function(){var e,i,n,o,r,s=function(){e=d.parent().width(),i=Math.floor(l>150?e/l:e/150),n=12*(i-1),o=2*i,r=(e-n-o)/i,d.find(".jrListItem").css({width:r})},d=a.find(".jr-masonry-results"),l=d.find(".jrListItem:first").data("thumbwidth"),c=d.find(".jrListItem:first").data("rtl");d.length&&t().jrMasonry&&(s(),d.jrMasonry({itemSelector:".jrListItem",columnWidth:function(t){return t/i},gutterWidth:0,isFitWidth:!0,isResizable:!0,isRTL:c,isAnimated:!0,animationOptions:{duration:300}}),t(window).on("resize",function(){s(),d.jrMasonry("reload")}))},e.claim={init:function(){t("button.jr-listing-claim,a.jr-listing-claim").on("click",function(i){i.preventDefault();var a=t(this),n=a.data("listing-id"),o=a.data("state"),r=a.find("span").eq(1);if("no-access"==o)t.jrAlert(e.__t("CLAIM_REGISTER"));else{var s=e.dispatch({method:"get",type:"html",controller:"claims",action:"create",data:{listing_id:n}});s.done(function(i){var a={};a[e.__t("SUBMIT")]=function(){e.claim.submit(t(this))},a[e.__t("CANCEL")]=function(){t(this).dialog("close")},t.jrDialog(i,{buttons:a,title:r.html(),width:"640px"})})}})},submit:function(t){var i=t.find("form"),a=i.find(".jr-validation");a.html("").hide();var n=e.dispatch({form:i});n.done(function(n){n.success?(t.dialog("option","buttons",[]),i.html(e.__t("CLAIM_SUBMIT"))):n.str.length?a.html(e.__t(n.str)).show():(t.trigger("failedValidation"),a.html(e.__t("CLAIM_VALIDATE_MESSAGE")).show())})}},e.listing={favorite:function(){t("button.jr-listing-favorite").on("click",function(i){i.preventDefault();var a=t(this),n=a.find("span").eq(0),o=a.find("span").eq(1),r=a.data("states"),s=a.data("listing-id");switch(a.attr("disabled","disabled"),a.data("state")){case"favored":var d=e.dispatch({method:"get",type:"json",controller:"listings",action:"_favoritesDelete",data:{"data[listing_id]":s}});d.done(function(i){i.success?(a.data("state","not_favored"),n.attr("class",r.not_favored),o.html(e.__t("FAVORITE_ADD")),t(".jr-favorite-"+s).html(i.count).effect("highlight",{},1e3)):t.jrAlert(e.__t(i.str))}),d.always(function(){a.removeAttr("disabled")});break;case"not_favored":var l=e.dispatch({method:"get",type:"json",controller:"listings",action:"_favoritesAdd",data:{"data[listing_id]":s}});l.done(function(i){i.success?(a.data("state","favored"),n.attr("class",r.favored),o.html(e.__t("FAVORITE_REMOVE")),t(".jr-favorite-"+s).html(i.count).effect("highlight",{},1e3)):t.jrAlert(e.__t(i.str))}),l.always(function(){a.removeAttr("disabled")});break;case"no_access":t.jrAlert(e.__t("FAVORITE_REGISTER"))}})},manager:function(){var i=t('ul.jr-listing-manager:not(".jr-ready")').addClass("jr-ready");i.on("click","a.jr-listing-publish,a.jr-listing-feature",function(){var i,a,n=t(this),o=n.find("span").eq(0),r=n.find("span").eq(1),s=n.data("states"),d=n.data("listing-id"),l=n.data("token"),c={id:d};switch(c[l]=1,n.attr("class")){case"jr-listing-publish":i="_publish",a={on:e.__t("PUBLISHED"),off:e.__t("UNPUBLISHED")};break;case"jr-listing-feature":i="_feature",a={on:e.__t("FEATURED"),off:e.__t("NOT_FEATURED")}}var u=e.dispatch({method:"get",type:"json",controller:"listings",action:i,data:c});u.done(function(i){i.success?(o.attr("class",1==i.state?s.on:s.off),r.html(1==i.state?a.on:a.off)):t.jrAlert(e.__t(i.str))})}),i.on("click","a.jr-listing-delete",function(){var i=t(this),a=i.find("span").eq(1),n=i.data("listing-id"),o=i.data("token"),r={id:n};r[o]=1;var s=new t.Deferred;s.done(function(t){var a=e.dispatch({method:"get",type:"json",controller:"listings",action:"_delete",data:r});a.done(function(a){a.success?(t.dialog("close"),i.closest(".jr-layout-outer").html('<div class="jrSuccess">'+e.__t("LISTING_DELETED")+"</div>").jrScrollTo()):(t.dialog("option","buttons",[]),t.html(e.__t(a.str)))})});var d={};d[a.html()]=function(){s.resolve(t(this))},d[e.__t("CANCEL")]=function(){t(this).dialog("close")},t.jrDialog(e.__t("LISTING_DELETE_CONFIRM"),{buttons:d,title:a.html(),width:"640px"})})},formSetup:function(){var n=a.find("form#jr-form-listing"),o=n.find(".jr-form-categories-outer"),r=n.find(".jr-form-listing-fields"),s=o.find(".jr-cat-select"),d=n.data("listing-id"),l=parseInt(n.data("cat-id"),10);if(d){var c=t('<span class="jrLoadingSmall">'),u=n.jreviewsFields({entry_id:t("#listing_id","#jr-form-listing").val(),value:!1,page_setup:!0,referrer:"listing"});o.append(c),u?u.done(function(){r.show().find(".jr-wysiwyg-editor").tinyMCE(),c.remove()}):(r.show().find(".jr-wysiwyg-editor").tinyMCE(),c.remove())}if(e.listing.submitCategory(n),l){{s.last().removeAttr("disabled").trigger("change")}d||s.attr("disabled","disabled")}n.on("change","input#jr-review-optional",function(){a.find(".jr-form-review").slideToggle()}),n.on("click","button.jr-cancel-listing",function(t){t.preventDefault(),history.go(-1)}),n.on("click","button.jr-submit-listing",function(a){a.preventDefault();var r=t(this),s=n.closest(".jr-form-listing-outer"),c=n.find(".jr-buttons"),u=n.find(".jr-wysiwyg-editor"),f=n.find(".jr-validation"),p=0,m=[];t("select[id^=cat_id]").each(function(){var e=t(this).val();e>0&&m.push(t(this))}),p=m.length,1==p?n.find("#category").val(m[0].find("option:selected").text().replace(/(- )+/,"")):p>1&&(n.find("#category").val(m[p-1].find("option:selected").text().replace(/(- )+/,"")),n.find("#parent_category").val(m[p-2].find("option:selected").text().replace(/(- )+/,"")));try{u.SaveTinyMCE()}catch(h){}n.jrSetValidFields().join(","),c.find("button").attr("disabled","disabled"),c.append('<span class="jrLoadingSmall">'),f.hide(),(l||d)&&o.find("select").removeAttr("disabled");var v=e.dispatch({form:n});v.done(function(t){if(t.success===!0){if(t.facebook&&t.moderation===!1){var a={id:t.listing_id};a[t.token]=1,e.facebook.addTokenAndPost("_postListing","html",a)}if(t.plgBeforeRenderListingSave)return r.trigger("plgBeforeRenderListingSave",t),!1;s.jrScrollTo({duration:400,offset:-100},function(){s.html(function(){var a="",n="",o="";return t.moderation===!1?(o=e.__t(t.is_new?"LISTING_SUBMIT_NEW":"LISTING_SUBMIT_EDIT"),a='<div class="jrSuccess">'+o+'&nbsp;<a class="jrButton" href="'+t.url+'">'+e.__t("LISTING_GO_TO")+"</a></div>"):a='<div class="jrSuccess">'+e.__t("LISTING_SUBMIT_MODERATED")+"</div>",t.mediaForm!==i&&(n=t.mediaForm),a+n}),e.tabs(s.find(".jr-tabs")),e.media.formSetup()})}else{t.str&&t.str.length&&f.html(e.__t(t.str)).show();var o=n.find("div.jr-captcha img");t.captcha!==i&&o.length&&(o.attr("src",t.captcha),n.find("input.jr-captcha-code").val(""))}}),v.always(function(){(l||d)&&o.find("select").attr("disabled","disabled"),n.find("#valid_fields").remove(),c.find(".jrLoadingSmall").remove(),n.find("button").removeAttr("disabled")})})},submitCategory:function(a){var n=t('<div class="jrRoundedPanel" style="text-align:center;"><span class="jrLoadingMedium" style="display:inline;padding:20px;"></span>'+e.__t("LOADING")+"</div>");a.on("change",".jr-cat-select",function(){var o=t(this);formChooser=a.find(".jr-form-categories-outer"),formFields=a.find(".jr-form-listing-fields"),formCategories=a.find(".jr-form-categories"),listing_id=parseInt(a.data("listing-id"),10),selected_cat_id=parseInt(a.find(".jr-cat-select").last().val(),10),editing=listing_id>0;var r=formCategories.find("select").index(o)+1;if(editing)return!1;a.find(".jr-wysiwyg-editor").RemoveTinyMCE();var s=[];t(".jr-form-categories").find('select[disabled="disabled"]').each(function(){s.push(t(this))});var d=formChooser.find("select,input").removeAttr("disabled").serializeArray();t(s).each(function(){t(this).attr("disabled","disabled")}),d.push({name:"data[level]",value:r}),d.push({name:"data[catid]",value:o.val()});var l=e.dispatch({method:"get",type:"json",controller:"listings",action:"_loadForm",data:d});n.insertAfter(formChooser);var c=new t.Deferred;c.done(function(t,e){try{t.jreviewsFields(e)}catch(i){}});var u=new t.Deferred;u.done(function(t){var i=formFields.jreviewsFields(t);try{i.done(function(){e.common.validateUsername(a);var t=a.find("fieldset.jr-form-review");t.length&&c.resolve(t,{fieldLocation:"Review",entry_id:0,value:!1,page_setup:!0,referrer:"review"},selected_cat_id,"listingFormReview")})}catch(n){}}),u.always(function(){n.remove(),formFields.show()}),l.done(function(o){if(o.level!==i){var r=formCategories.children("select");r.each(function(e){e>o.level&&t(this).remove()})}switch(o.select!==i&&formCategories.append(o.select),o.action){case"show_form":formFields.html(o.html);try{formFields.find(".jr-wysiwyg-editor").tinyMCE()}catch(s){}u.resolve({entry_id:listing_id,value:!1,page_setup:!0,referrer:"listing",res:o}),e.facebook.init(a),e.review.starRating(a);break;case"hide_form":n.remove(),formFields.hide();break;case"no_access":n.remove(),formFields.html(e.__t("LISTING_SUBMIT_DISALLOWED")).show()}})})},widgets:function(){var n=a.filter(".jr-listing-detail"),o=[];n.length&&(n.find(".jr-tabs").find("li>a").each(function(e,i){var a=t(i).attr("href"),n=a.substring(a.indexOf("#")+1);o["#"+n]=t(i).parent("li")}),"undefined"!=typeof jrRelatedWidgets&&jrRelatedWidgets.length&&t(jrRelatedWidgets).each(function(a,n){var r=n.favorites?"module_favorite_users":"module_listings",s=e.dispatch({method:"get",type:"html",controller:r,action:"index",data:n});
s.done(function(a){var r=""!==n.target_class?n.target_class:n.target_id,s=t(""!==n.target_class?"."+n.target_class:"#"+n.target_id);if(""!==a){var d=t('<div id="'+r+"Widget"+n.key+'"></div>').addClass("jrWidget");n.title&&d.append('<h3 class="jrHeading">'+n.title+"</h3>"),d.append(a),s.append(d);for(var l=[0,1,2,3,4],c=0;c<l.length;c++)l[c]=t("#"+r+"Widget"+l[c]);for(var c=0;c<l.length;c++)s.append(l[c]);o["#"+r]!==i&&""!==s.html()&&o["#"+r].show()}else o["#"+r]!==i&&""===s.html()&&o["#"+r].hide();e.module.init(),e.media.generateThumbs()})}))}},e.review={setup:function(i,a){var n=t("form#"+i),o=n.closest("div.jr-form-review-outer");e.review.starRating(o),e.common.validateUsername(o),e.common.initForm(i,!0),e.facebook.init(n);var r=n.jreviewsFields({fieldLocation:"Review",entry_id:a,value:!1,page_setup:!0,referrer:"review"});r&&r.done(function(){0===a&&o.slideDown().delay().jrScrollTo({duration:500,offset:-50})})},init:function(){var n=a.find("div.jr-form-review-outer"),o=a.find(".jr-tabs"),r=n.find('form[id^="jr-form-review"]'),s=r.attr("id"),d=r.data("review-id"),l=r.find(".jr-buttons"),c=r.find("div.jr-validation"),u=a.find("#userReviews"),f=a.find("button.jr-review-add, div.jr-review-add"),p=u.find(".jr-login-box"),m=a.find(".jr-owner-reply-del"),h=document.URL;f.on("click",function(e){e.preventDefault();var i=t(this),o=u.parents(".jr-page").find(".jr-tabs");o.length&&o.tabs("select","#reviewsTab"),r.length&&!p.length?(r.jrScrollTo(),a.find('button.jr-review-add:not(".jr-listing-info")').fadeOut(),n.slideDown("fast").jrScrollTo({duration:500,offset:-50})):u.jrScrollTo(),p.length&&!i.hasClass("jr-listing-info")&&p.slideToggle(100)}),r.on("click","button.jr-review-cancel",function(t){t.preventDefault(),n.slideUp(),a.find('button.jr-review-add:not(".jr-listing-info")').fadeIn().delay().jrScrollTo({duration:500,offset:-50})}),f.one("click",function(){r.length&&e.review.setup(s,d)}),r.on("click","button.jr-review-submit",function(a){a.preventDefault();var o=t(".jr-user-reviews");r.jrSetValidFields().join(","),l.find("button").attr("disabled","disabled"),l.append('<span class="jrLoadingSmall">'),c.hide();var s=e.dispatch({form:r});s.done(function(t){if(t.success){if(n.slideUp().remove(),t.facebook&&t.moderation===!1){var a={id:t.review_id};a[t.token]=1,e.facebook.addTokenAndPost("_postReview","html",a)}var s="";t.moderation===!1&&(s='<div class="jr-message jrSuccess">'+e.__t("user"==t.review_type?"REVIEW_SUBMIT_NEW":"REVIEW_SUBMIT_NEW_REFRESH")+"</div>"),o.prepend('<div class="jr-new-review jrHidden">'+s+t.html+"</div>").jrScrollTo({duration:500,offset:-50}).delay().find(".jr-new-review").slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500),e.review.edit(),e.review.vote(),e.popup()}else{t.str.length&&c.html(e.__t(t.str)).show();var d=r.find("div.jr-captcha img");t.captcha!==i&&d.length&&(d.attr("src",t.captcha),r.find("input.jr-captcha-code").val(""))}}),s.always(function(){r.find("#jr-valid_fields").remove(),l.find(".jrLoadingSmall").remove(),l.find("button").removeAttr("disabled")})}),m.on("click",function(i){i.preventDefault();var a=t(this),n=a.data("review-id"),o=a.data("token"),r=a.find("span").eq(1),s=new t.Deferred;s.done(function(t){var i={id:n};i[o]=1;var r=e.dispatch({method:"get",type:"json",controller:"owner_replies",action:"_delete",data:i});r.done(function(i){i.success?(t.dialog("close"),a.closest(".jr-owner-reply-outer").replaceWith('<div class="jrSuccess">'+e.__t("OWNER_REPLY_DELETED")+"</div>")):(t.dialog("option","buttons",[]),i.str.length&&t.html(e.__t(i.str)))})});var d={};d[e.__t("DELETE")]=function(){s.resolve(t(this))},d[e.__t("CANCEL")]=function(){t(this).dialog("close")};t.jrDialog(e.__t("OWNER_REPLY_DELETE_CONFIRM"),{buttons:d,title:r.html(),width:"640px"})}),(h.match("#reviewForm$")||h.match("#userReviews$"))&&(o.length&&t(".jr-tabs").tabs("select","#reviewsTab").jrScrollTo({duration:500,offset:-100}),h.match("#reviewForm$")&&f.first().trigger("click"))},edit:function(){t('.jr-review-edit:not(".jr-ready")').on("click",function(){var i=t(this),a=i.find("span").eq(1),n=i.data("review-id"),o=i.data("referrer"),r="jr-form-review-"+n,s=t("#jr-form-review-0"),d=t('<div id="jr-form-review-placeholder" class="jrHidden"></div>');s.before(d);var l=s.detach(),c=e.dispatch({method:"get",type:"html",controller:"reviews",action:"_edit",data:{review_id:n}});c.done(function(s){var c={};c[e.__t("SUBMIT")]=function(){e.review.editSubmit(i,t(this),d,l)},c[e.__t("CANCEL")]=function(){d.after(l),d.remove(),t(this).dialog("close")};var u=t.jrDialog(s,{buttons:c,title:a.html(),width:"800px",height:600});u.find("form").append('<input name="data[referrer]" type="hidden" value='+o+">"),e.review.setup(r,n),e.common.userAutocomplete(u)})}).addClass("jr-ready")},editSubmit:function(a,n,o,r){var s=a.closest(".jr-layout-inner"),d=n.find("form"),l=(d.attr("id"),t(".ui-dialog-buttonpane")),c=d.find(".jr-validation").clone();l.find(".jr-validation").fadeOut().remove(),d.jrSetValidFields().join(",");var u=e.dispatch({form:d});u.done(function(t){if(t.success){o.after(r),o.remove(),n.dialog("close");var a="";s.hide(0).html(function(){return t.moderation===!1&&(a='<div class="jr-message jrSuccess">'+e.__t("user"==t.review_type?"REVIEW_SUBMIT_EDIT":"REVIEW_SUBMIT_EDIT_REFRESH")+"</div>"),a+t.html}).jrScrollTo({duration:500,offset:-50}).delay().slideDown(1500).find("div.jr-message").delay(4e3).slideUp(500)}else{t.str.length&&(c.html(e.__t(t.str)),l.prepend(c),c.fadeIn());var u=d.find("div.jr-captcha img");t.captcha!==i&&u.length&&(u.attr("src",t.captcha),d.find("input.jr-captcha-code").val(""))}e.review.edit(),e.review.vote(),e.popup()}),u.always(function(){d.find("#jr-valid_fields").remove()})},starRating:function(e){e.find(".jr-rating-stars").each(function(){var e=t(this),i=e.data("selector"),a=e.data("inc"),n=t("<span></span>");if("stars"==i){e.parent().next().append(n);var o=1/a;e.stars({split:o,captionEl:n})}})},reply:function(){t('button.jr-owner-reply:not(".jr-ready")').on("click",function(){var i=t(this),a=i.find("span").eq(1),n=i.data("review-id"),o=e.dispatch({method:"get",type:"html",controller:"owner_replies",action:"create",data:{review_id:n}});o.done(function(n){var o={};o[e.__t("SUBMIT")]=function(){e.review.replySubmit(i,t(this))},o[e.__t("CANCEL")]=function(){t(this).dialog("close")},t.jrDialog(n,{buttons:o,title:a.html(),width:"640"})})})},replySubmit:function(t,i){var a=i.find("form"),n=a.find(".jr-validation"),o=e.dispatch({form:a});n.hide(),o.done(function(a){a.success?(i.html(e.__t(a.str)),i.dialog("option","buttons",[]),t.attr("disabled","disabled")):(i.trigger("failedValidation"),n.html(e.__t(a.str)).show())})},vote:function(){t('div.jr-review-vote:not(".jr-ready")').on("click","button",function(i){i.preventDefault();var a=t(this),n=a.data("vote"),o=a.closest(".jr-review-vote"),r=o.data("state"),s=o.data("review-id"),d=(a.find("span").eq(0),a.find("span").eq(1));if(o.unbind("click").find("button").attr("disabled","distabled"),"access"!=r)t.jrAlert(e.__t("register"==r?"REVIEW_VOTE_REGISTER":"ACCESS_DENIED"));else{var l={"data[Vote][review_id]":s,"data[type]":n},c=e.dispatch({method:"get",type:"json",controller:"votes",action:"_save",data:l});c.done(function(i){if(i.success){if(d.html(parseInt(d.html(),10)+1),i.facebook&&"yes"==n){var a={id:s};a[i.token]=1;var o=t.Deferred();o.done(function(){var t=function(t){try{"object"==typeof t&&FB.ui(t)}catch(e){console.log(e)}};e.facebook.addTokenAndPost("_postVote","json",a,t)}),FB.getLoginStatus(function(e){"connected"===e.status?FB.api("/me/permissions",function(e){var i=!1;e&&!e.error&&(t.each(e.data,function(t,e){"publish_actions"==e.permission&&"granted"==e.status&&(i=!0)}),i?o.resolve():FB.login(function(t){t.authResponse&&o.resolve()},{scope:"publish_actions"}))}):FB.login(function(t){t.authResponse&&o.resolve()},{scope:"publish_actions"})})}}else i.str.length&&t.jrAlert(e.__t(i.str))})}}).addClass("jr-ready")}},e.report={init:function(){a.off("click","button.jr-report").on("click","button.jr-report",function(i){i.preventDefault();var a=t(this),n={listing_id:a.data("listing-id"),review_id:a.data("review-id"),post_id:a.data("post-id"),m:a.data("media-id"),extension:a.data("extension")},o=e.dispatch({method:"get",type:"html",controller:"reports",action:"create",data:n});o.done(function(i){var a={};a[e.__t("SUBMIT")]=function(){e.report.submit(t(this))},a[e.__t("CANCEL")]=function(){t(this).dialog("close")},t.jrDialog(i,{buttons:a,title:e.__t("REPORT_INAPPROPRIATE"),width:"640"})})})},submit:function(t){var i=t.find("form"),a=i.find(".jr-validation");a.html("").hide();var n=e.dispatch({form:i});n.done(function(n){n.success?(t.dialog("option","buttons",[]),i.html(e.__t("REPORT_SUBMIT"))):(t.trigger("failedValidation"),a.html(e.__t(n.str)).show())})}},e.facebook={buttons_class:"jr-buttons",enable:!1,permissions:!1,uid:null,load:function(){var i=e.fb.appid||null,n=a.find(".jr-fb-like").length||a.find(".jr-fb-share").length;(e.fb.xfbml||e.fb.post||n)&&(t("#fb-root").length?n&&"object"==typeof FB?FB.XFBML.parse(a.get(0)):n&&"function"!=typeof window.fbAsyncInit&&(window.fbAsyncInit=function(){FB.XFBML.parse(a.get(0))}):(t("body").append('<div class="jrHidden" id="fb-root"></div>'),window.fbAsyncInit=function(){FB.init({appId:i,status:!0,cookie:!0,xfbml:n?!0:!1,version:"v2.1"})}),function(t,i,a){var n,o=t.getElementsByTagName(i)[0];t.getElementById(a)||(n=t.createElement(i),n.id=a,n.async=!0,n.src="//connect.facebook.net/"+e.locale+"/sdk.js",o.parentNode.insertBefore(n,o))}(document,"script","facebook-jssdk"))},init:function(t){e.fb.post&&(e.facebook.form=t,e.facebook.checkPermissions())},login:function(){null===e.facebook.uid&&FB.login(function(i){i.authResponse?e.facebook.uid=i.authResponse.userID:t("#jr-fb-publish").prop("checked",!1)},{scope:"publish_actions"})},checkPermissions:function(i){var a={};a=t.extend(a,i),e.facebook.FBInit=setInterval(function(){"object"==typeof FB&&FB.getLoginStatus(function(i){"connected"===i.status?(e.facebook.uid=i.authResponse.userID,FB.api("/me/permissions",function(i){var a=!1;i&&!i.error&&(t.each(i.data,function(t,e){"publish_actions"==e.permission&&"granted"==e.status&&(a=!0)}),a?e.facebook.addButton(!0):FB.login(function(t){t.authResponse&&e.facebook.addButton(!0)},{scope:"publish_actions"}))})):e.facebook.addButton(!1)})},150)},addButton:function(a){if(clearInterval(e.facebook.FBInit),e.facebook.permissions=a,e.facebook.form===i)return!1;var n=e.facebook.form.find("."+e.facebook.buttons_class);if(a!==!0||e.fb.optout){var o=t('<div class="jrFacebookPublish"><input id="jr-fb-publish" name="data[fb_publish]" value="1" type="checkbox"><div class="jrButton jrBlue"><span class="fb_button_text"><label for="jr-fb-publish">'+e.__t("FACEBOOK_PUBLISH")+"</label></span></div></div>").on("click","input",function(){this.checked&&e.facebook.login()});0===n.find("#jr-fb-publish").length&&n.prepend(o),a&&e.fb.optout&&o.find("input").attr("checked","checked")}else n.prepend('<input id="jr-fb-publish" name="data[fb_publish]" value="1" type="hidden" />')},addTokenAndPost:function(t,i,a,n){FB.getLoginStatus(function(o){if("connected"==o.status){a.accessToken=o.authResponse.accessToken;var r=e.dispatch({method:"get",type:i,controller:"facebook",action:t,data:a});r.done(function(t){"function"==typeof n&&n(t)})}})}},e.common={initForm:function(i,a){var n="string"==typeof i?t("#"+i):n,o=n.find("div.jr-captcha");n.one("mouseover",function(){var a=e.dispatch({method:"get",type:"json",controller:"common",action:"_initForm",data:{"data[form_id]":i,"data[captcha]":o.length}});a.done(function(i){n.find("span.jr_token :input").attr("name",i.token),i.captcha&&n.find(".jr-captcha").html(i.captcha).fadeIn(),n.find("input.jr-user-name").val(i.name),n.find("input.jr-user-username").val(i.username).attr("placeholder",e.__t("USERNAME_CREATE_ACCOUNT")).on("focus mouseover",function(){t(this).closest("div").find(".jr-more-info").trigger("mouseover")}).on("blur mouseout",function(){t(this).closest("div").find(".jr-more-info").trigger("mouseout")}),n.find("input.jr-user-email").val(i.email),n.find("input.jr-user-name, input.jr-user-username, input.jr-user-email").each(function(){var e=t(this).val();""!==e?t(this).prop("disabled",!0):t(this).prop("disabled",!1)})})}),a===!0&&n.trigger("mouseover")},validateUsername:function(i){i.off("focusout","input.jr-user-username:text").on("focusout","input.jr-user-username:text",function(){var i=t(this),a=i.closest("form"),n=t('<input class="jr-valid-username" type="hidden" name="data[valid_username]" value="0" />'),o={username:i.val()},r=t('<span class="jrLoadingSmall"></span>');a.find(".jr-valid-username").remove(),i.next("span").remove(),""!==i.val()&&(i.after(r),e.dispatch({method:"get",type:"json",controller:"users",action:"_validateUsername",data:o}).done(function(t){r.remove(),t.success?(i.after('<span class="jrSuccess" style="padding:3px 8px;">'+t.text+"</span>"),a.append(n.val(1))):(i.after('<span class="jrError" style="padding:3px 8px;">'+t.text+"</span>"),a.append(n.val(0)))}))})},userAutocomplete:function(i){var a=i.find("input.jr-user-autocomplete"),n={target_userid:"jr-user-id-ac",target_name:"jr-user-name-ac",target_username:"jr-user-username-ac",target_email:"jr-user-email-ac"};if(""===a.val()){var o=i.find("."+n.target_userid).val();if(Number(o)>0){var r=e.dispatch({method:"get",type:"text",controller:"users",action:"_getUsername",data:{id:o}});r.done(function(t){a.val(t)})}}a.autocomplete({source:function(t,i){var n=a.data("cache")||{},o=t.term;if(o in n)return void i(n[o]);var r=e.dispatch({method:"get",type:"json",controller:"users",action:"_getList",data:{q:o}});r.done(function(t){n[o]=t,a.data("cache",n),i(t)})},select:function(t,e){i.find("."+n.target_userid).val(e.item.id),i.find("."+n.target_email).val(e.item.email),i.find("."+n.target_name).val(e.item.name),i.find("."+n.target_username).val(e.item.username)},minLength:2}),t(".ui-autocomplete").css("white-space","nowrap")},listingAutocomplete:function(i,a){var n=a.acfield||i.find("input.jr-listing-autocomplete"),o={target_listingid:"jr-listing-id-ac",target_title:"jr-listing-title-ac",target_alias:"jr-listing-alias-ac",target_url:"jr-listing-url-ac"};if(""===n.val()){var r=i.find("."+o.target_listingid).val();if(Number(r)>0){var s=e.dispatch({frontend:!0,method:"get",type:"json",controller:"listings",action:"_getList",data:{id:r}});s.done(function(t){a.onSelect?a.onSelect(n,t[0]):n.val(t[0].value)})}}n.on("blur",function(){""===n.val()&&i.find("."+o.target_listingid+", ."+o.target_title+", ."+o.target_alias+", ."+o.target_url).val("")}).autocomplete({source:function(t,i){var a=n.data("cache")||{},o=t.term;if(o in a)return void i(a[o]);var r=e.dispatch({frontend:!0,method:"get",type:"json",controller:"listings",action:"_getList",data:{search:o}});r.done(function(t){a[o]=t,n.data("cache",a),i(t)})},select:function(t,e){i.find("."+o.target_listingid).val(e.item.id),i.find("."+o.target_title).val(e.item.value),i.find("."+o.target_alias).val(e.item.alias),i.find("."+o.target_url).val(e.item.url),a.onSelect&&a.onSelect(n,e)},minLength:2}),t(".ui-autocomplete").css("white-space","nowrap")}},e.search={submit_delay:150,liveSearch_timer:null,liveSearch_timeout:200,simple:function(){t("form.jr-simple-search").on("click","button.jr-search",function(){t(this).closest("form").attr("action",s2AjaxUri).submit()})},advancedPage:function(){var i=t("#jr-form-adv-search"),a=i.find(".jr-listing-type-outer"),n=t('<div class="jrRoundedPanel" style="text-align:center;"><span class="jrLoadingMedium" style="display:inline;padding:20px;"></span>'+e.__t("LOADING")+"</div>");i.attr("action",s2AjaxUri).on("click","button.jr-search",function(a){a.preventDefault(),t(this).trigger("jrBeforeSearch"),setTimeout(function(){i.submit()},e.search.submit_delay)}),e.search.searchRange(i),i.on("change","select.jr-listing-type,input.jr-listing-type",function(i){i.preventDefault();var o=t(this),r=o.closest("form"),s=o.val(),d=r.find("div.jr-search-fields");return 0===parseInt(s,10)?(d.fadeOut(),!1):(n.insertAfter(a),submittingAction=e.dispatch({method:"get",type:"html",controller:"search",action:"_loadForm",data:{criteria_id:s}}),void submittingAction.done(function(t){d.html(t);var e=d.jreviewsFields({page_setup:!0,referrer:"adv_search"});e?e.done(function(){n.remove(),r.trigger("jrSearchFormLoaded"),d.show()}):n.remove()}))});var o=i.find("input.jr-listing-type").val();o>0&&i.find("input.jr-listing-type").trigger("change")},requestResults:function(a,n){return clearTimeout(e.search.liveSearch_timer),""!==t.jrGetSelected()?!1:void(e.search.liveSearch_timer=setTimeout(function(){n.html('<div class="jrLoadingMedium"></div>').show(),e.search.loadingResults!==i&&e.search.loadingResults.abort();var t=a.find(':not([name="data[controller]"],[name="data[action]"])').serializeArray();e.search.loadingResults=e.dispatch({method:"get",controller:"categories",action:"liveSearch",data:t}),e.search.loadingResults.done(function(t){n.html(t)})},e.search.liveSearch_timeout))},advancedModule:function(){t("form.jr-form-adv-search-module").each(function(){var i=t(this),a=i.data("module-id");e.search.searchRange(i),i.attr("action",s2AjaxUri).on("click","button.jr-search",function(a){a.preventDefault(),t(this).trigger("jrBeforeSearch"),setTimeout(function(){i.submit()},e.search.submit_delay)}).find("input[type=text]").on("keydown",function(a){13==a.keyCode&&(a.preventDefault(),t(this).trigger("jrBeforeSearch"),setTimeout(function(){i.submit()},e.search.submit_delay))}),i.jreviewsFields({page_setup:!0,recallValues:!0,referrer:"adv_search_module"});var n=i.find("input[type=text]"),o=i.find("select,input[type=radio],input[type=checkbox]");i.on("onLiveSearch",function(){function n(){var t=d.offset(),e=d.outerWidth();t.top+=d.outerHeight()+1,l.css(t),l.css("width",e)}var o=i.data("live-search"),r=i.data("live-search-hide");if(!o)return!1;var s=t(this),d=s.parent(),l=t(".jrAdvSearchSuggest.jr-live-search"+a).length?t(".jrAdvSearchSuggest.jr-live-search"+a):t('<div class="jrAdvSearchSuggest jr-live-search'+a+'"></div>').appendTo("body");n(),window.onresize=n,e.search.requestResults(s,l),r&&t(document).on("mousedown",function(t){d.is(t.target)||0!==d.has(t.target).length||l.is(t.target)||0!==l.has(t.target).length||l.hide()}),l.on("click",".jr-close-live-results",function(){l.hide()})}),n.on("keyup",function(){i.trigger("onLiveSearch")}),o.on("change",function(){i.trigger("onLiveSearch")})})},searchRange:function(e){e.on("change","select.jr-search-range",function(){var e=t(this),i=e.parent().find("span").last();"between"==e.val()?i.show():i.hide().find("input").val("")})}},e.popup=function(){t(".jr-more-info").not("jr-ready").jrPopup({className:"jrPopup",delay:150}).addClass("jr-ready")},e.showmore=function(){t(".jr-show-more").not("jr-ready").jrShowMore().addClass("jr-ready")}}(jQuery,jreviews),function(t){t.jrGetSelected=function(){var t="";return window.getSelection?t=window.getSelection().toString():document.getSelection?t=document.getSelection().toString():document.selection&&"Control"!=document.selection.type&&(t=document.selection.createRange().text),t}}(jQuery),function(t){t.jrDialog=function(e,i){t("div.jr-dialog").dialog("destroy").remove();var a={},n=t('<div class="jr-dialog jrDialogContent jrHidden"></div>');a={title:"",width:"640px",height:"auto",dialogClass:"jrDialog",resizable:!1,modal:!0,autoOpen:!0,position:"center"},a=t.extend(a,i),1==jreviews.mobi&&(a.maxWidth=a.width,a.width="95%",a.position="center top"),""===t.trim(e)&&(e=jreviews.__t("PROCESS_REQUEST_ERROR"),a.buttons={}),n.html(e),n.dialog(a);var o=t(".ui-dialog-buttonpane");"function"==typeof jQuery().button&&o.find("button").button("destroy"),1==jreviews.mobi&&o.find(".ui-dialog-buttonset").css("float","left");var r=o.find("button:contains("+jreviews.__t("DELETE")+")"),s=o.find("button:contains("+jreviews.__t("SUBMIT")+")"),d=o.find("button:contains("+jreviews.__t("CANCEL")+")");return r.addClass("jr-submit jrButton").prepend('<span class="jrIconDelete"></span>'),s.addClass("jr-submit jrButton").prepend('<span class="jrIconSave"></span>').on("click",function(){t(this).prop("disabled",!0).find("span").removeClass("jrIconSave").addClass("jrButtonSpinner")}),d.addClass("jr-cancel jrButton").prepend('<span class="jrIconCancel"></span>'),n.on("failedValidation",function(){s.prop("disabled",!1).find("span").removeClass("jrButtonSpinner").addClass("jrIconSave")}),n},t.jrAlert=function(e,i){t("div.jr-alert").dialog("destroy").remove();var a=t('<div class="jr-alert">'+e+"</div>"),n={title:"",width:"400px",height:"auto",dialogClass:"jrDialog",resizable:!1,modal:!0,autoOpen:!0,position:"center",buttons:{}};i=t.extend(n,i),i.buttons[jreviews.__t("CLOSE")]=function(){t(this).dialog("close")},1==jreviews.mobi&&(i.maxWidth=i.width,i.width="95%",i.position="center top"),a.dialog(i)}}(jQuery),function(t){t.getCSS=function(e,i){t(document.createElement("link")).attr({href:e,media:i||"screen",type:"text/css",rel:"stylesheet"}).appendTo("head")}}(jQuery),function(t){t.fn.jrScrollTo=function(e,i){var a=t.extend({},t.fn.jrScrollTo.defaults,e),n=t(this).offset().top+a.offset;return t("html,body").animate({scrollTop:n},a.duration,a.easing,i),t(this)},t.fn.jrScrollTo.defaults={offset:-30,duration:1e3,easing:"swing"}}(jQuery),function(t){t.fn.tinyMCE=function(){var e=this,i=1e3;try{setTimeout(function(){if("object"==typeof tinyMCE){if("object"!=typeof tinyMCEPreInit||t.isEmptyObject(tinyMCEPreInit))return"undefined"==typeof WFEditor&&"undefined"!==tinyMCE.settings&&(tinyMCE.settings.height=null),e.each(function(){tinyMCE.execCommand("mceAddEditor",!1,this.id)});var i="mceInit"in tinyMCEPreInit?tinyMCEPreInit.mceInit["jr-editor"]:!1,a="qtInit"in tinyMCEPreInit?tinyMCEPreInit.qtInit["jr-editor"]:!1;t(".jr-wysiwyg-editor").each(function(){var e=t(this).attr("id");if(a){var n=t.extend({},a,{id:e});tinyMCEPreInit.qtInit[e]=n,quicktags(n),QTags._buttonsInit()}if(i){var o=t.extend({},i,{selector:"#"+e});tinyMCEPreInit.mceInit[e]=o,tinyMCE.init(o)}})}},i)}catch(a){console(a)}},t.fn.RemoveTinyMCE=function(){var t=this;try{if("object"==typeof tinyMCE)return t.each(function(){tinyMCE.execCommand("mceRemoveEditor",!0,this.id)})}catch(e){}},t.fn.SaveTinyMCE=function(){var t=this;try{if("object"==typeof tinyMCE)return t.each(function(){tinyMCE.get(this.id).save()})}catch(e){}}}(jQuery),function(t){var e=function(e,i){this.elem=e,this.$elem=t(e),this.options=t.extend({},t.fn.jrShowMore.options,i),this.init()};e.prototype={init:function(){var e=this,i=e.$elem.data("characters"),a=e.$elem.data("separator");void 0!==i&&parseInt(i,10)>0&&(e.options.characters=i),void 0!==a&&(e.options.separator=a),e.elemTextOrig=e.$elem.html().trim(),e.elemText=e.$elem.text().trim(),e.elemLength=e.elemText.length,e.elemLength>e.options.characters+e.options.separator.length&&(e.elemTextMain=e.elemText.substring(0,e.options.characters),e.elemTextMainHTML='<span class="jrShowMain">'+e.elemTextMain+"</span>",e.elemTextSeparatorHTML='<span class="jrShowMoreSeparator">'+e.options.separator+"</span>",e.elemTextMoreHTML='<span class="jrShowMore" style="display: none;">'+e.elemTextOrig+"</span>",e.elemTextMoreLink='<a class="jrShowLink" href="#">'+e.options.showMoreText+"</a>",e.$elem.html(e.elemTextMainHTML+e.elemTextSeparatorHTML+e.elemTextMoreHTML+" "+e.elemTextMoreLink),e.$elem.on("click","a",function(i){i.preventDefault();var a=t(this);a.hasClass("jrShowLink")?a.html(e.options.hideMoreText).removeClass("jrShowLink").addClass("jrHideLink"):a.html(e.options.showMoreText).removeClass("jrHideLink").addClass("jrShowLink"),e.$elem.find(".jrShowMain, .jrShowMoreSeparator, .jrShowMore").toggle()}))}},t.fn.jrShowMore=function(t){return this.each(function(){new e(this,t)})},t.fn.jrShowMore.options={showMoreText:jreviews.__t("SHOW_MORE"),hideMoreText:jreviews.__t("HIDE_MORE"),separator:"...",characters:250}}(jQuery),function(t){var e=function(e,i){this.elem=e,this.$elem=t(e),this.options=t.extend({},t.fn.jrPopup.options,i),this.init()};e.prototype={init:function(){var e=this;e.popupDiv=e.$elem.next("."+e.options.className),e.popupDiv.length&&(""!==t.trim(e.popupDiv.html())||e.popupDiv.hasClass("jr-ajax"))&&(e.$popupDiv=t(e.popupDiv),e.$elem.hover(function(){e.show()},function(){e.hide()}),e.$elem.click(function(){e.hide()}),e.$popupDiv.hover(function(){e.show()},function(){e.hide()}))},show:function(){var t=this;t.options.onBeforeShow&&t.options.onBeforeShow();var e=t.getPosition();t.$popupDiv.stop(!0,!0),t.clearTimeouts(),t.showTimeout=setTimeout(function(){t.$popupDiv.appendTo("body").css({top:e.top,left:e.left}),t.$popupDiv.fadeIn(100)},300)},hide:function(){var e=this;e.clearTimeouts(),e.showTimeout=setTimeout(function(){t(e.popupDiv).fadeOut(100,function(){e.$elem.after(t(this))})},e.options.delay)},clearTimeouts:function(){this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0),this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=0)},getPosition:function(){{var t=this.$elem.offset().top,e=this.$elem.offset().left,i=this.$elem.outerWidth();this.$elem.outerHeight()}return{left:e+i/2-this.$popupDiv.outerWidth()/2+"px",top:t-this.$popupDiv.outerHeight()-20+"px"}}},t.fn.jrPopup=function(t){return this.each(function(){new e(this,t)})},t.fn.jrPopup.options={className:"jrPopup",delay:300}}(jQuery),function(t){var e=function(t){if("string"!=typeof t)throw"sprintf: The first arguments need to be a valid format string.";for(var e=new RegExp(/%(\+)?([0 ]|'(.))?(-)?([0-9]+)?(\.([0-9]+))?([%bcdfosxX])/g),i=[],a=1;part=e.exec(t);){if(a>=arguments.length)throw"sprintf: At least one argument was missing.";i[i.length]={begin:part.index,end:part.index+part[0].length,sign:"+"==part[1],negative:parseInt(arguments[a])<0?!0:!1,padding:void 0==part[2]?" ":"'"==part[2].substring(0,1)?part[3]:part[2],alignLeft:"-"==part[4],width:void 0!=part[5]?part[5]:!1,precision:void 0!=part[7]?part[7]:!1,type:part[8],data:"%"!=part[8]?String(arguments[a++]):!1}}for(var n="",o=0,r=0;r<i.length;++r){n+=t.substring(o,i[r].begin),o=i[r].end;var s="";switch(i[r].type){case"%":s="%";break;case"b":s=Math.abs(parseInt(i[r].data)).toString(2);break;case"c":s=String.fromCharCode(Math.abs(parseInt(i[r].data)));break;case"d":s=String(Math.abs(parseInt(i[r].data)));break;case"f":s=0==i[r].precision?String(Math.abs(parseFloat(i[r].data))):Math.abs(parseFloat(i[r].data)).toFixed(i[r].precision);break;case"o":s=Math.abs(parseInt(i[r].data)).toString(8);break;case"s":s=i[r].data.substring(0,i[r].precision?i[r].precision:i[r].data.length);break;case"x":s=Math.abs(parseInt(i[r].data)).toString(16).toLowerCase();break;case"X":s=Math.abs(parseInt(i[r].data)).toString(16).toUpperCase();break;default:throw'sprintf: Unknown type "'+i[r].type+'" detected. This should never happen. Maybe the regex is wrong.'}if("%"!=i[r].type){if(0!=i[r].width&&i[r].width>s.length)for(var d=s.length,l=0;l<i[r].width-d;++l)s=1==i[r].alignLeft?s+i[r].padding:i[r].padding+s;("b"==i[r].type||"d"==i[r].type||"o"==i[r].type||"f"==i[r].type||"x"==i[r].type||"X"==i[r].type)&&(1==i[r].negative?s="-"+s:1==i[r].sign&&(s="+"+s)),n+=s}else n+=s}return n+=t.substring(o,t.length)};t.sprintf=e,String.prototype.printf=function(){var t=Array.prototype.slice.call(arguments);return t.unshift(String(this)),e.apply(void 0,t)}}(window),function(t){t.widget("jreviews.buttongroup",{buttons:{},classes:{buttonGroup:"jrButtonGroup",button:"jrButton",selected:"jrBlue"},_create:function(){var e=this,i=e.element,a=e.classes;i.hide();var n=t('<div class="'+a.buttonGroup+'">');i.find("option").each(function(o){var r=t(this),s=t('<div class="'+a.button+'">').html(r.text()).data("index",o),d=r.data("icon");d&&s.prepend('<span class="'+d+'">'),s.on("click",function(){i.find("option:eq("+t(this).data("index")+")").prop("selected",!0),r.trigger("change")}),e.buttons[o]=s,""!==r.val()&&n.append(s)}),i.on("change",function(){n.find("."+a.button).removeClass(a.selected),e.buttons[i.find("option:selected").index()].addClass(a.selected)}),n.insertBefore(i)},_init:function(){var t=this,e=t.element;e.trigger("change")},destroy:function(){t.Widget.prototype.destroy.call(this)}})}(jQuery);
!function(e){jreviewsCompare={numberOfListingsPerPage:3,maxNumberOfListings:15,compareURL:"index.php?option=com_jreviews&url=categories/compare/id:listing_ids/",lang:{compare_heading:jreviews.__t("COMPARE_HEADING"),compare_all:jreviews.__t("COMPARE_COMPARE_ALL"),remove_all:jreviews.__t("COMPARE_REMOVE_ALL"),select_more:jreviews.__t("COMPARE_SELECT_MORE"),select_max:jreviews.__t("COMPARE_SELECT_MAX")},listingTypeID:null,init:function(){jreviewsCompare.set({numberOfListingsPerPage:jreviews.comparison.numberOfListingsPerPage,maxNumberOfListings:jreviews.comparison.maxNumberOfListings,compareURL:jreviews.comparison.compareURL}),jreviewsCompare.initComparePage(),jreviewsCompare.initCompareDashboard(),jreviewsCompare.initListingsSelection()},set:function(i){void 0!==i&&e.extend(jreviewsCompare,i)},initComparePage:function(){var i,r,t=e(".jr-compareview"),a=e(".jr-compare-slider"),s=a.find(".jr-compare-slider-items"),o=e(".jr-compare-slider-secondary"),n=o.find(".jr-compare-slider-items2"),l=s.find(".jr-compare-slider-item"),p=e(".jrScrollbarArea"),m=e(".jr-compare-slider-item").length;t.width(t.parent().width()),i=m>=jreviewsCompare.numberOfListingsPerPage?a.width()/jreviewsCompare.numberOfListingsPerPage:a.width()/m,r=i*m,l.width(i),s.width(r),n.width(r),a.scroll(function(){o.scrollLeft(a.scrollLeft())}),o.scroll(function(){a.scrollLeft(o.scrollLeft())}),m>jreviewsCompare.numberOfListingsPerPage&&(p.removeClass("jrHidden"),a.removeClass("jrSliderDisabled"),o.removeClass("jrSliderDisabled"),t.hasClass("jrCompareViewMenu")||e(".removeComparedListing").removeClass("jrHidden"),a.find(".jr-compare-slider-item").hover(function(){{var r=e(this),t=r.data("listingid");r.width()}r.on("click","img.removeListing",function(){r.fadeOut("slow",function(){r.remove();var l=i*e("div.jr-compare-slider-item").length,m=e(".jr-compare-slider-item").length;s.width(l),n.width(l),m<=jreviewsCompare.numberOfListingsPerPage&&(p.addClass("jrHidden"),a.addClass("jrSliderDisabled"),o.addClass("jrSliderDisabled"),a.find(".removeComparedListing").addClass("jrHidden")),e("span#removelisting"+t).trigger("click")})})})),jreviewsCompare.fixCompareAlignment()},fixCompareAlignment:function(){function i(i){tallest=0,i.each(function(){thisHeight=e(this).height(),thisHeight>tallest&&(tallest=thisHeight)}),i.height(tallest)}function r(r){r.each(function(){var r=e(this).attr("class").split(" ").slice(0,1);i(e("div."+r))})}var t=e("div.jr-compare-slider-item div.jrCompareField");r(t)},initCompareDashboard:function(){e("body").append('<div class="jrCompareDashboard"><div class="jrCompareHeader"><div class="jrCompareArrow"></div></div><div class="jrCompareTabs"></div></div>'),e(".jrCompareTabs").append('<div class="jrCompareTitle">'+jreviewsCompare.lang.compare_heading+'</div><ul class="jrTabsNav"></ul><div class="jrTabsContainer"></div>'),e(".jrCompareHeader, .jrCompareTitle, ul.jrTabsNav").hover(function(){e(this).css("cursor","pointer")}).click(function(){e(".jrCompareTabs .jrTabsContainer").slideToggle("slow",function(){var i=e(".jrCompareArrow");e(this).is(":visible")?i.addClass("down"):i.removeClass("down")})});var i=e(".jrCompareDashboard"),r=jreviewsCompare.getListingsFromStorage();e.isEmptyObject(r)||(i.slideDown("slow"),e.each(r,function(i){var t=!1,a=i.substring(11);e.each(r[i],function(e,i){t||(jreviewsCompare.insertTab(i),t=!0),jreviewsCompare.insertListingIntoComparison(i),jreviewsCompare.updateCompareAllUrl(i)}),e("#tabLT"+a+" li.ltItem").length>4&&e("#tabLT"+a+" a.compareNext").css("visibility","visible")})),i.on("click","span.removeItem",function(){var i=e(this).attr("id"),r={id:i.substring(13),typeId:e(this).text()};e("input.listing"+r.id).prop("checked",!1),jreviewsCompare.removeListingFromComparison(r)}),i.on("click","a.removeListings",function(i){i.preventDefault();var r=e(this).parent().attr("id"),t=r.substring(9),a=e("#tabLT"+t+" li.ltItem:first-child span.removeItem").attr("id").substring(13),s={id:a,typeId:t},o=e('.jrCheckListing[data-listingtypeid="'+t+'"]');o.prop("checked",!1),jreviewsCompare.removeTab(s)}),i.on("click","a.compareListings",function(i){i.preventDefault();var r=e(this).parent().attr("id").substring(9),t=e("div#tabLT"+r+" ul.ltList li").length;if(2>t)""!==e("p.comparisonMessage."+r).val()&&(e("div#tabLT"+r).append('<p class="comparisonMessage '+r+' jrPopup">'+jreviewsCompare.lang.select_more+"</p>"),e("p.comparisonMessage").hide().fadeIn("slow",function(){setTimeout(function(){e("p.comparisonMessage").fadeOut("slow",function(){e(this).remove()})},3e3)}));else{var a=e(this).attr("href");window.location.href=a}}),e("ul.jrTabsNav").on("click","a",function(i){i.stopPropagation();var r=e(".jrTabsContainer");r.is(":hidden")&&r.slideDown("slow")})},insertTab:function(i){var r=i.typeId,t=i.typeTitle,a=e(".jrCompareTabs");a.data("ui-tabs")&&a.tabs("destroy"),e(".jrCompareTabs ul.jrTabsNav").append('<li><a href="#tabLT'+r+'" class="listingTypeCompare jrCompare'+r+'">'+t+' <span class="numSelected">(0)</span></a></li>'),e(".jrCompareTabs .jrTabsContainer").append('<div id="tabLT'+r+'" class="ui-helper-clearfix"><div class="jrCompareScroll"><ul class="ltList"></ul></div></div>'),compareURL=jreviewsCompare.compareURL.replace("listing_ids",i.id);var s='<a rel="nofollow" href="'+compareURL+'" class="compareListings jrButton jrSmall listingType'+r+'"><span class="jrIconCompare"></span>'+jreviewsCompare.lang.compare_all+"</a>",o='<a href="#" class="removeListings jrButton jrSmall listingType'+r+'"><span class="jrIconRemove"></span>'+jreviewsCompare.lang.remove_all+"</a>";e(".jrTabsContainer #tabLT"+r).append('<div id="jrCompare'+r+'" class="jrCompareButtons">'+s+o+"</div>");var n=e(".jrCompareTabs ul.jrTabsNav li").length,l=e("base").attr("href");void 0!==l&&l.length&&a.find('ul.jrTabsNav li a:not(".jrBaseUpdated")').each(function(){e(this).addClass("jrBaseUpdated").attr("href",e(location).attr("href")+e(this).attr("href"))}),a.tabs({selected:n-1})},removeTab:function(i){var r=e(".jrCompareDashboard"),t=e(".jrCompareTabs"),a=t.tabs("option","selected"),s=t.tabs("length");s>1?(e("ul.jrTabsNav li.ui-tabs-active").fadeOut("slow",function(){t.tabs("remove",a)}),t.tabs("destroy"),t.tabs(a>0?{selected:a-1}:{selected:0})):r.slideUp("slow",function(){t.tabs("remove",a),t.tabs("destroy")}),jreviewsCompare.removeListingTypeFromStorage(i)},insertListingIntoComparison:function(i){i.thumb=i.thumbSrc.length?'<div class="compareThumb"><a href="'+i.url+'"><img src="'+i.thumbSrc+'" /></a></div>':"",i.titleUrl='<a href="'+i.url+'">'+i.title+"</a>",e("div#tabLT"+i.typeId+" ul").append('<li id="listing'+i.id+'" class="ltItem"><span id="removelisting'+i.id+'" data-jricon="&#xe018;" class="removeItem">'+i.typeId+"</span>"+i.thumb+'<span class="compareItemTitle">'+i.titleUrl+"</span></li>"),e("input.listing"+i.id).prop("checked",!0);var r=jreviewsCompare.getNumberOfSelectedListings(i.typeId);r++,e(".jrCompareTabs a.jrCompare"+i.typeId+" span.numSelected").html("("+r+")")},removeListingFromComparison:function(i){e(".jrCompareTabs");e("li#listing"+i.id).siblings().length>0?(e("li#listing"+i.id).fadeOut("slow",function(){e(this).remove()}),jreviewsCompare.updateNumberOfSelectedListings(i.typeId,-1),jreviewsCompare.removeListingFromStorage(i),jreviewsCompare.updateCompareAllUrl(i)):jreviewsCompare.removeTab(i)},initListingsSelection:function(){e(".jrPage, .jrModuleContainer").on("click","input.jrCheckListing",function(){var i={id:e(this).attr("value"),title:e(this).data("listingtitle"),url:e(this).data("listingurl"),thumbSrc:e(this).data("thumburl"),typeId:e(this).data("listingtypeid"),typeTitle:e(this).data("listingtypetitle"),location:e(this).data("location")};i.thumbSrc.length?i.thumb='<div class="compareThumb"><a href="'+i.url+'"><img src="'+i.thumbSrc+'" /></a></div>':(thumb=e("img[data-listingid='"+i.id+"']"),thumb.length?(thumbSrc=thumb.attr("src"),i.thumbSrc=thumbSrc,i.thumb='<div class="compareThumb"><a href="'+i.url+'"><img src="'+thumbSrc+'" /></a></div>'):i.thumb=""),i.titleUrl='<a href="'+i.url+'">'+i.title+"</a>",i.data='<li id="listing'+i.id+'" class="ltItem">'+i.thumb+'<span class="compareItemTitle">'+i.titleUrl+'</span><span id="removelisting'+i.id+'" data-jricon="&#xe018;" class="removeItem">'+i.typeId+"</span></li>";var r,t=e(".jrCompareDashboard"),a=e(".jrCompareTabs"),s=e(".jrTabsContainer"),o=e(".jrCompareArrow");if(e(this).is(":checked")){if(r=e("input.listing"+i.id+":not(:checked)"),e.each(r,function(){e(this).prop("checked",!0)}),e("div#tabLT"+i.typeId).length>0){s.is(":hidden")&&(s.slideDown("slow"),o.addClass("down"));var n=jreviewsCompare.getNumberOfSelectedListings(i.typeId);if(n>=jreviewsCompare.maxNumberOfListings)return""!==e("p.comparisonMessageMax."+i.id).val()&&(e(this).parent().append('<p class="comparisonMessageMax '+i.id+' jrPopup">'+jreviewsCompare.lang.select_max+"</p>"),e("p.comparisonMessageMax").hide().fadeIn("slow",function(){setTimeout(function(){e("p.comparisonMessageMax").fadeOut("slow",function(){e(this).remove()})},3e3)})),!1;e(i.data).appendTo("div#tabLT"+i.typeId+" ul.ltList").hide().fadeIn("slow"),a.tabs("select","#tabLT"+i.typeId)}else s.is(":hidden")&&(s.show(),o.addClass("down")),jreviewsCompare.insertTab(i),e(i.data).appendTo("div#tabLT"+i.typeId+" ul.ltList").hide().fadeIn("slow"),t.is(":hidden")&&t.slideDown("slow");jreviewsCompare.updateNumberOfSelectedListings(i.typeId,1),jreviewsCompare.saveListingToStorage(i),jreviewsCompare.updateCompareAllUrl(i)}else r=e("input.listing"+i.id+":checked"),e.each(r,function(){e(this).prop("checked",!1)}),a.tabs("select","#tabLT"+i.typeId),jreviewsCompare.removeListingFromComparison(i)})},getNumberOfSelectedListings:function(i){var r=e(".jrCompareTabs a.jrCompare"+i+" span.numSelected").html().slice(1,-1);return parseInt(r,10)},updateNumberOfSelectedListings:function(i,r){var t=jreviewsCompare.getNumberOfSelectedListings(i);t+=r,e(".jrCompareTabs a.jrCompare"+i+" span.numSelected").html("("+t+")")},updateCompareAllUrl:function(i){var r=e("a.compareListings.listingType"+i.typeId),t=(r.attr("href"),jreviewsCompare.getListingsFromStorage(i.typeId)),a=[];e.each(t,function(e,i){a.push(i.id)}),a=a.toString();var s=jreviewsCompare.compareURL.replace("listing_ids",a);r.attr("href",s)},saveListingToStorage:function(i){var r=i.typeId,t=i.id,a={};a["listingType"+r]={},a["listingType"+r]["listing"+t]=i;var s=jreviewsCompare.getListingsFromStorage();if(e.isEmptyObject(s))localStorage.setItem("jrCompare",JSON.stringify(a));else{var o=e.extend({},s);o["listingType"+r]=e.extend({},o["listingType"+r],a["listingType"+r]),localStorage.setItem("jrCompare",JSON.stringify(o))}},getListingsFromStorage:function(e){var i={},r="";return r=localStorage.getItem("jrCompare"),""!==r&&"{}"!==r&&(i=JSON.parse(r),void 0!==e&&(i=i["listingType"+e])),i},removeListingFromStorage:function(e){var i=jreviewsCompare.getListingsFromStorage();delete i["listingType"+e.typeId]["listing"+e.id],localStorage.setItem("jrCompare",JSON.stringify(i))},removeListingTypeFromStorage:function(e){var i=jreviewsCompare.getListingsFromStorage();delete i["listingType"+e.typeId],localStorage.setItem("jrCompare",JSON.stringify(i))}}}(jQuery);
!function(e){function t(t){var a,i,n,l=!1,o=this,d=t,s=d.find(':input[class^="jr_"]'),r=d.find('fieldset[id^="group_"]'),c=d.find('li[id^="tab_"]'),p={},u=!1;this.getTabs=function(){return c},this.click2add=function(){d.off("click",".jr-click2add-new").on("click",".jr-click2add-new",function(t){t.preventDefault(),e(this).closest("div.jrFieldDiv").find('div.jr-click2add-option:not(".jr-ready")').addClass("jr-ready").toggle(50,function(){e(this).removeClass("jr-ready")})}),d.off("click",".jr-click2add-submit").on("click",".jr-click2add-submit",function(t){t.preventDefault();var a,i,n=e(this),l=n.parent().siblings("select"),o=n.prev(":input"),d=o.val(),s="";!l.data("controlledBy")||l.data("fieldName")in l.data("controlledBy")||e.each(l.data("controlledBy"),function(e,t){a=e,i=t,s="|"+e+"|"+t});var r=encodeURIComponent(d).replace(/'/g,"&#039;")+"|click2add"+s,c=l.children('option[value="'+r+'"]');""!==d&&0===c.length?(l.append(e("<option></option>").attr({value:r,selected:"selected","data-ordering":99999,"data-controlledBy":a,"data-controlValue":i}).text(d)).data("isActive",!0).trigger("change"),o.val("")):1==c.length&&c.prop("selected",!0),n.siblings(".jr_validation").remove()})},this.loadData=function(t){var l={fieldLocation:"Listing",entry_id:null,value:[],page_setup:0,recallValues:!0,autocomplete:!0,lang:{select_field:jreviews.__t("FIELD_SELECT_FIELD"),no_results:jreviews.__t("FIELD_NO_RESULTS"),instructions:jreviews.__t("FIELD_AUTOCOMPLETE_HELP")}},c={},p=[];if(t=e.extend(l,t),n=t.entry_id,t.page_setup=t.page_setup?1:0,a=t,a.res=a.res||{},void 0!==jreviews.paid&&"Listing"==a.fieldLocation)try{void 0!==a.res.planList?(u=!0,jreviews.paid.plan.planList=a.res.planList,jreviews.paid.plan.plan_selected=jreviews.paid.plan.plan_selected||a.res.plan_selected,jreviews.paid.plan.plan_selected&&d.find('#jr-paid-plan-list :radio[value="'+jreviews.paid.plan.plan_selected+'"]').prop("checked",!0)):"object"==typeof jreviews.paid.plan.planList&&null!==jreviews.paid.plan.plan_selected&&(u=!0)}catch(h){}if(i=r.map(function(){return this.id.replace(/group_/g,"")}),s.each(function(){if("button"!=e(this).prop("type")){var t=e(this).data("selected"),a=e(this).attr("class").split(" ")[0].replace(/[^a-zA-Z0-9_\s]+/g,"").match(/^jr_[a-z0-9]+/).toString();t&&(c[a]=String(t).search("_")>-1?t.split("_"):[t],e(this).removeAttr("data-selected"),e(this).removeData("selected")),-1==e.inArray(a,p)&&p.push(a)}}),p=e.unique(p),p.length){e.isEmptyObject(p)||(t.value=c);var v=jreviews.dispatch({method:"POST",type:"json",controller:"fields",action:"_loadFieldData",data:{"data[entry_id]":t.entry_id,"data[fields]":p,"data[value]":c,"data[page_setup]":t.page_setup,"data[fieldLocation]":t.fieldLocation,"data[referrer]":t.referrer,"data[autocomplete]":t.autocomplete}});return v.done(function(e){o.processResponse(t.value,t.page_setup,e),u&&(jreviews.paid.plan.controlFieldClass=o,jreviews.paid.plan.formFilter(d)),o.click2add(),"Listing"==a.fieldLocation&&d.trigger("jrListingFieldsLoaded")}),v}return!1},this.getPaidFields=function(){var e=jreviews.paid.plan.planList,t=(d.find("#jr-paid-plan-list"),jreviews.paid.plan.plan_selected);return"object"==typeof e&&null!==t?void 0!==e["plan"+t]?e["plan"+t].fields:[]:void 0},this.getFieldOptions=function(e,t){var a;switch(t){case"select":case"selectmultiple":a=e.children("option");break;default:a=e}return a},this.getFieldObj=function(e){return e in p?p[e]:!1},this.setValidFields=function(t){var a=[];t=t||d,d.find(":input").filter(function(){e(this).closest("fieldset").data("isActive")!==!1&&e(this).data("isActive")===!0&&a.push(e(this).data("fieldName"))});var i=t.find('[name="data[valid_fields]"]');return i.length?i.val(a.join(",")):t.append(e('<input type="hidden" name="data[valid_fields]" />').val(a.join(","))),e.unique(a)},this.getjQueryObj=function(t,i){if(void 0===t.fields||!(i in t.fields))return!1;var n=!1;if(i in p)return p[i];var l=["selectmultiple","checkboxes","relatedlisting"];if(e.inArray(a.referrer,["adv_search_module"])>-1){var o,s=d.find("."+i);switch(o=s.prop("type")){case"select-one":t.fields[i].type="select";break;case"select-multiple":t.fields[i].type="selectmultiple"}}e.inArray(a.referrer,["adv_search_module","adv_search"])>-1&&e.inArray(t.fields[i].type,["integer","decimal","date"])>-1&&(n=!0);var r=e.inArray(t.fields[i].type,l)>-1||n,c=':input[name="data[Field]['+t.location+"]["+i+"]"+(r?'[]"]':'"]');return p[i]=d.find(c),p[i]},this.storeValues=function(t,a){{var i=t.data("fieldOptions")||{},n=t.data("fieldType");o.getFieldOptions(t,n)}a=e.isArray(a)?a:[a],e(a).each(function(a,n){n in i&&(e(i[n].dependent_groups).each(function(a,i){r.filter("fieldset#group_"+i).find(":input").each(function(){if($dep_field=e(this),$dep_field.data("isControlled")===!1||$dep_field.data("isControlled")===!0&&$dep_field.data("hasControl")===!0){o.debug("6.1 >--- Store current val of "+$dep_field.data("fieldName")+"["+$dep_field.val()+"] for "+t.data("fieldName")+"["+n+"]");var a=$dep_field.data("parentMemory")||[],i=t.data("fieldName")+"."+n;a[i]=$dep_field.val(),$dep_field.data("parentMemory",a)}if($dep_field.data("hasControl")===!0){var l=$dep_field.val();o.debug("6.1 >--- Run recursively for ["+$dep_field.attr("class").split(" ")[0]+"["+l+"]"),null!==l&&o.storeValues($dep_field,l)}})}),e(i[n].dependent_fields).each(function(e,a){var l=o.getjQueryObj(i[n],a);if(0===l.length)return!0;var d,s=i[n].fields[a].type;o.debug("6.2 >--- Store current val of "+s+" "+l.data("fieldName")+"["+l.val()+"] for "+t.data("fieldName")+"["+n+"]");var r=l.data("parentMemory")||[],c=t.data("fieldName")+"."+n;switch(s){case"checkboxes":case"radio":d=l.filter(":checked").map(function(){return this.value}).get();break;default:d=l.val()}r[c]=d,l.data("parentMemory",r),null!==l.val()&&(o.debug("6.2 >--- Run recursively"),o.storeValues(l,l.val()))}))})},this.recallValue=function(t,a,i){var n=t.data("parentMemory")||[],l=a+"."+i;if(void 0!==n[l]){o.debug("** Recall ParentMemory:"+t.data("fieldName")+" = ["+a+":"+i+"] => "+n[l]);var d=t.data("fieldType");e.inArray(d,["checkboxes","radiobuttons"])>-1?t.each(function(){var t=e(this).val();e(this).prop("checked",e.inArray(t,n[l])>-1)}):t.val(n[l]),t.trigger("change")}},this.clearDependents=function(e,t,a){setTimeout(function(){o.clearDependentsDelayed(e,t,a)},100)},this.clearDependentsDelayed=function(t,a,i){var n=t.data("fieldOptions")||{},l=[],d=t.data("fieldType"),s=o.getFieldOptions(t,d);o.debug("5 >--- Clear dependents of "+t.attr("class").split(" ")[0]+"["+a+"]. Event type is "+t.data("eventType")),l=e.isArray(a)?a:[a],e(l).each(function(t,a){a in n&&(e(n[a].dependent_groups).each(function(t,a){o.debug("Hide dependent group: "+a);var i=!0;if(s.each(function(){var t=e(this);n[t.val()]&&(t.is(":checked")||t.is(":selected"))&&e.inArray(a,n[t.val()].dependent_groups)>-1&&(i=!1)}),i){var l=r.filter("fieldset#group_"+a);l.data("isActive",!1).css("display","none").find(":input").val("").data("doNotStore",!0).trigger("change"),c.length&&c.filter("li#tab_"+a).hide()}}),e(n[a].dependent_fields).each(function(t,l){var r=o.getjQueryObj(n[a],l);if(0===r.length)return!0;var c=n[a].fields[l].type;o.debug("5.0 >--- Clear dependent ["+l+"]["+a+"]["+c+"]");r.val();if(e.inArray(c,["select","selectmultiple"])>-1){o.debug("5.1 >---",c),e(n[a].fields[l].options).each(function(){var t=this.value;if(o.debug(l+"["+c+"]["+t+"]"),e.inArray(d,["checkboxes","selectmultiple"]>-1)){var a=!0;s.each(function(){var i=e(this);n[i.val()]&&(i.is(":checked")||i.is(":selected"))&&e(n[i.val()].fields[l]).each(function(){e(this.options).each(function(){this.value==t&&(a=!1)})})}),a&&(o.debug("5.1.1 >----- Removing field option ["+t+"]"),r.children('option[value="'+t+'"]').remove())}else o.debug("5.1.2 >-----"),r.children('option[value="'+t+'"]').remove();null!==t&&o.clearDependents(r,t)}),r.data("old_val","");var p=r.children("option").length;if("select"==c&&1==p||"selectmultiple"==c&&0===p){var u=r.data("click2add")||0;(0===u||1==u&&r.data("isControlled"))&&r.data("isActive",!1).val("").closest("div.jrFieldDiv").css("display","none")}}else{o.debug("5.2 >--- "+c),r.data("old_val","");var h=!0;e.inArray(d,["checkboxes","selectmultiple"]>-1)?(s.each(function(){var t=e(this);n[t.val()]&&(t.is(":checked")||t.is(":selected"))&&e.inArray(l,n[t.val()].dependent_fields)>-1&&(h=!1)}),h&&(e.inArray(c,["checkboxes","radiobuttons"]>-1)?r.prop("checked",!1):r.val(""))):e.inArray(c,["checkboxes","radiobuttons"]>-1)?r.prop("checked",!1):r.val(""),!h||void 0!==i&&void 0!==n[i]&&n[i].dependent_fields.length>0&&e.inArray(l,n[i].dependent_fields)>-1||(o.debug("   ----- Hiding dependent field "+l),r.data("isActive",!1).closest("div.jrFieldDiv").css("display","none"))}r.trigger("change")}))})},this.processResponse=function(t,i,l){if(0!==l.length){if(void 0!==l.responses&&(e.each(l.responses,function(t,a){var i=o.getjQueryObj(l,t);return i?void e.each(a,function(e,a){o.debug("1 >-- Caching response data for "+t+"["+a.control_value+"]");var n=i.data("fieldOptions")||{};n[a.control_value]=a,i.data("fieldOptions",n)}):!0}),i)){o.populateOptions(l);try{var s=d.find(".jrRelatedListing");s.autocompletefield({lookup:"listings",entry_id:n,optionType:s.data("autocompleteType"),optionDivPosition:s.data("autocompletePos")})}catch(r){}}e.each(l.control_field,function(t,i){var n=o.getjQueryObj(l,i);return void 0===l.fields||"text"==l.fields[i].type?!0:n.data("hasControl")!==!1||n.hasClass("jrAutoComplete")?(n.on("change",function(){o.debug("2 >--- Change event triggered for "+i+", id = "+n.attr("class").split(" ")[0]+", "+l.fields[i].type);var t,s="",r=[],c=[],p=n.data("old_val")||(e.inArray(l.fields[i].type,["selectmultiple"])?[]:null);switch(o.debug("   Old val: "+p),l.fields[i].type){case"radiobuttons":s=e(this).val();break;case"selectmultiple":if(n.children("option").not(":selected").each(function(){c.push(e(this).val())}),r=n.val(),null===r&&(r=[]),1==r.length)s=r[0];else if(null!==p)for(var u=0;u<r.length;u++)if(-1==e.inArray(r[u],p)){s=n.children('option[value="'+r[u]+'"]').val();break}break;case"checkboxes":n.each(function(){e(this).is(":checked")&&r.push(e(this).val())}),e(this).is(":checked")&&(s=e(this).val()),t=e(this).val();break;default:s=n.val()}o.debug("   Sel val: "+s);var h;switch(l.fields[i].type){case"checkboxes":""===s&&(h=t);break;case"selectmultiple":c.length>0&&(h=c);break;default:h=p}var v=n.data("doNotStore")||!1;a.recallValues&&null!==p&&p.length>0&&v===!1&&o.storeValues(n,p),n.data("old_val",r.length?r:s);var f=n.data("fieldOptions")||{};if(cachedResp=null===s||f=={}?null:f[s],o.debug("   Cached response"),o.debug(void 0===cachedResp?"       Not cached":cachedResp),void 0===cachedResp&&""!==s&&null!==s){o.debug(" -> Change Event AJAX"),n.prop("disabled",!0);var g={"data[fields]":i,"data[value]":s,"data[page_setup]":!1,"data[fieldLocation]":a.fieldLocation,"data[referrer]":a.referrer,"data[autocomplete]":a.autocomplete},_=jreviews.dispatch({method:"post",type:"json",controller:"fields",action:"_loadFieldData",data:g});_.done(function(e){o.debug("1 >-- Caching data for "+i+"["+s+"]");var t=n.data("fieldOptions")||{};t[s]=e,n.data("fieldOptions",t),n.data("eventType","ajax"),void 0===e.fields&&(e.fields=[]),o.populateOptions(e,l.fields[i],n,h,s),d.trigger("jrAfterFieldChange")})}else e.isEmptyObject(cachedResp)||""===s?(o.debug(" -> Change Event CLEAR"),n.data("eventType","clear"),o.clearDependents(n,h,s),d.trigger("jrAfterFieldChange")):(o.debug(" -> Change Event CACHED"),n.data("eventType","cached"),o.populateOptions(cachedResp,l.fields[i],n,h,s),d.trigger("jrAfterFieldChange"));n.prop("disabled",!1),n.data("doNotStore",!1)}),void(n.hasClass("jrAutoComplete")&&!n.hasClass("jrRelatedListing")&&e.inArray(n.data("fieldType"),["select","selectmultiple"])>-1&&(o.debug(" -> Activate AutoComplete UI for "+i),n.autocompletefield({lookup:"options",optionType:n.data("autocompleteType"),optionDivPosition:n.data("autocompletePos")})))):!0})}},this.populateOptions=function(t,n,l,d,s){if(0!==t.length){n=void 0!==n?n:{type:"",name:""},o.debug("4 >--- Populate options for "+n.name+"["+s+"] and we clear it for ["+d+"]"),t.page_setup&&e.each(i,function(a,i){if(-1==e.inArray(i,t.dependent_groups)){var n=r.filter("fieldset#group_"+i),l=0;n.find(":input").each(function(){"hidden"!=e(this).prop("type")&&l++}),l>0&&(n.show(),c.length&&c.filter("li#tab_"+i).show(10))}}),e.each(t.dependent_groups,function(e,a){var i=r.filter("fieldset#group_"+a);i.data("isControlled",!0),t.page_setup?(i.css("display","none").data("isActive",!1),c.length&&c.filter("li#tab_"+a).hide()):(i.show().data("isActive",!0),c.length&&c.filter("li#tab_"+a).show(10))});var p=[];u&&(p=o.getPaidFields(),o.debug("   --- It is a paid listing!"),o.debug(p)),e.each(t.fields,function(i,n){if(o.debug("   --- Populating field "+n.name+"["+n.title+"]["+s+"]"),e.isArray(n.name))return!0;var l,d=o.getjQueryObj(t,n.name);if(l=d.prop("type"),"relatedlisting"!=n.type)switch(l){case"select-one":n.type="select";break;case"select-multiple":n.type="selectmultiple"}d.data("fieldTitle",n.title),0===t.page_setup&&e.inArray(n.type,["select","selectmultiple"])>-1&&d.val(""),t.page_setup&&(d.data("fieldName",n.name),d.data("fieldType",n.type),d.data("orderBy",n.order_by),d.data("hasControl",n.control),d.data("isControlled",n.controlled),d.data("autocompleteType",n.autocompletetype),d.data("autocompletePos",n.autocompletepos));var c=e.inArray(n.group,t.dependent_groups)>-1,h=r.filter("fieldset#group_"+n.group).data("isActive");if(1==t.control_field.length){var v=d.data("controlledBy")||{};if(v[t.control_field[0]]=t.control_value,c||d.data("controlledBy",v),(0===t.page_setup||void 0===t.page_setup)&&"text"==n.type&&n.controlled===!0&&n.controlgroup===!0)return!0}if(void 0===d.data("isActive")&&t.page_setup&&(e.inArray(n.type,["select","selectmultiple","relatedlisting"])>-1&&(n.control===!0&&n.controlled===!0||n.control===!1&&n.controlled===!0||"0"==n.autocomplete&&void 0===n.options)||e.inArray(n.type,["checkboxes","radiobuttons"])>-1&&(n.control===!0&&n.controlled===!0||n.control===!1&&n.controlled===!0)||!n.control&&n.controlled&&(void 0===n.selected||0===n.selected.length))){if("select"==n.type&&d.html(e("<option></option>").attr("value","").text(a.lang.select_field.replace("%s",d.data("fieldTitle"))).data("ordering",0)).children("option:eq(0)").prop("selected",!0),"function"==typeof d.relatedlisting&&!d.data("isControlled"))return d.data("isActive",!0),!0;o.debug("   ----- Hiding field "+n.name+" on startup");var f=d.data("click2add")||0;return(0===f||1==f&&d.data("isControlled"))&&d.data("isActive",!1).closest("div.jrFieldDiv").css("display","none"),!0}if("select"==n.type&&0===d.children("option").length&&d.html(e("<option></option>").attr("value","").text(a.lang.select_field.replace("%s",d.data("fieldTitle"))).data("ordering",0)),e.inArray(n.type,["select","selectmultiple","relatedlisting"])>-1&&(d.children('option[data-controlledBy="'+t.control_field[0]+'"]').each(function(){var a=e(this);a.data("controlValue")!=t.control_value&&a.remove()}),e(n.options).each(function(){0===d.children('option[value="'+this.value+'"]').length&&d.append(e("<option></option>").attr("value",this.value).text(this.text).attr("data-ordering",this.ordering))})),t.edit&&void 0!==n.selected&&n.selected.length>0&&(-1==e.inArray(n.type,["checkboxes","radiobuttons"])&&d.val(n.selected),d.data("old_val",n.selected),e(n.selected).each(function(e,a){n.name in t.responses&&a in t.responses[n.name]&&(o.debug("  +++++++ Start populateOptions recursion for "+n.name),d.data("eventType","cached"),o.populateOptions(t.responses[n.name][a],n,d,void 0,a))})),"select"==n.type&&0===d.find(":selected").length&&d.children("option:eq(0)").prop("selected",!0),!t.page_setup&&u&&-1==e.inArray(n.name,p))return d.data("isActive",!0),!0;if(o.debug("   ***** Start checks for displaying fields for ["+n.title+"]["+n.type+"]"),c&&h!==!0)d.data("isActive",!1).closest("div.jrFieldDiv").hide();else switch(n.type){case"select":d.children("option").length>1||1==d.data("click2add")&&!c||d.data("hasControl")===!0&&d.data("isControlled")===!1||d.data("hasControl")===!1&&d.data("isControlled")===!1?d.data("isActive",!0).closest("div.jrFieldDiv").show():d.data("isActive",!1).closest("div.jrFieldDiv").hide();break;case"selectmultiple":(d.children("option").length>0||1==d.data("click2add")&&!c||d.data("hasControl")===!0&&d.data("isControlled")===!1||d.data("hasControl")===!1&&d.data("isControlled")===!1)&&d.data("isActive",!0).closest("div.jrFieldDiv").show();break;case"checkboxes":case"radiobuttons":(!c||c&&h&&d.data("hasControl")===!0&&d.data("isControlled")===!1||d.data("hasControl")===!1&&d.data("isControlled")===!1)&&d.data("isActive",!0).closest("div.jrFieldDiv").show();break;default:d.data("isActive",!0).closest("div.jrFieldDiv").show()}d.children("option").length>0&&"ordering"==d.data("orderBy")&&o.sort_by_field(d)}),void 0!==l&&void 0!==d&&o.clearDependents(l,d,s),!t.page_setup&&a.recallValues&&(e(t.dependent_fields).each(function(t,a){o.recallValue(e("."+a),n.name,s)}),e.each(t.dependent_groups,function(t,a){r.filter("fieldset#group_"+a).find(":input").each(function(){var t=e(this).data("hasControl"),a=e(this).data("isControlled");(t||t===!1&&a===!1)&&o.recallValue(e(this),n.name,s)})}))}},this.sort_by_field=function(t){var a,i,n=t.val(),l=t.data("orderBy"),o="ordering"==l?function(e){return parseInt(e,10)}:function(e){return e.toUpperCase()};a=t.prop("type"),"select-one"==a&&(i=t.children('option[value=""]').detach());var d=t.children("option").sort(function(t,a){return t="ordering"==l?e(t).data("ordering"):t.text,a="ordering"==l?e(a).data("ordering"):a.text,"undefined"!=typeof o&&(t=o(t),a=o(a)),a>t?-1:t>a?1:0});void 0!==i?t.html(d).prepend(i).val(n):t.html(d).val(n)},this.debug=function(e){l&&console.log(e)}}e.fn.jreviewsFields=function(e){var a=new t(this);return a.loadData(e)},e.fn.jrSetValidFields=function(){var e=new t(this);return e.setValidFields(this)}}(jQuery),function(e){e.widget("jreviews.autocompletefield",{lookup:"options",options:{entry_id:null,optionType:"link",optionDivPosition:"after",minSearchLength:1,lang:{help:jreviews.__t("FIELD_AUTOCOMPLETE_HELP"),no_results:jreviews.__t("FIELD_NO_RESULTS")},helpClass:"acInstructions",inputClass:"jrAutoSuggest",disabledLinkClass:"ui-disabled",checkboxClass:"ui-option",optionsDivClass:"ui-optionsDiv"},_create:function(t){e.extend(this.options,t);var a=this,i=a.element.hide(),n=a.options,l=a.fname=i.data("fieldName"),o=a.widgetid="text-"+l;a.lookup=n.lookup,i.data("validation",!1);{var d=(this.searchInput=e('<input type="text" />')).attr({id:o,name:o}).val(n.lang.help).addClass(n.helpClass+" "+n.inputClass).insertAfter(i),s=(this.optionsDiv=e("<div></div")).attr("data-fname",l).addClass(n.optionsDivClass+" jrClearfix");(this.noResults=e("<span></span>")).html(n.lang.no_results).css("margin-left","5px").addClass("jrValidation")}switch(n.optionDivPosition){case"before":s.insertBefore(d);break;case"after":s.insertAfter(d)}this._bindEvents()},_init:function(){var t=this,a=t.element,i=t.options,n=t.optionsDiv,l=a.children("option:selected");switch(l.length&&e.each(l,function(){var a=e(this);if(""===a.val())return!0;switch(i.optionType){case"link":var l=t._createLink({value:a.val(),text:a.text(),checked:!0});break;case"checkbox":l=t._createCheckbox({value:a.val(),text:a.text(),checked:!0})}n.append(l)}),i.optionType){case"link":0===n.find("a").length?n.hide():n.show(5);break;case"checkbox":0===n.find("input").length?n.hide():n.show(5)}},_createCheckbox:function(t){var a=this.fname,i=this.options,n="cb-"+a+"_"+t.value.replace(/ /g,"_"),l=e('<input type="checkbox" />').attr({id:n,name:n}).addClass(i.checkboxClass).val(t.value).prop("checked",t.checked),o=e('<label for="'+n+'" />').css("text-align","left").append(l).append("<span>"+t.text+"</span>");return o},_createLink:function(t){var a=this.options;return e('<a href="javascript:void(0)"></a>').addClass(a.checkboxClass).html(t.text).attr("data-value",t.value).data("active",t.checked?!0:!1)},_getListingData:function(e,t,a){var i=this.element;a=a||"";var n={limit:12,id:a,fname:i.attr("class").split(" ")[0],listingtype:i.data("listingtype")||"",value:e},l=jreviews.dispatch({method:"get",type:"json",controller:"fields",action:"relatedListings",data:n});l.done(function(e){t(e)})},_bindEvents:function(){var t=this,a=t.element,i=t.options,n=t.searchInput,l=t.optionsDiv;switch(n.on("click focusin",function(){this.value==i.lang.help&&e(this).val("").removeClass(i.helpClass)}).on("blur focusout",function(){""===this.value&&e(this).val(i.lang.help).addClass(i.helpClass)}),this._bindAutoComplete(),l.delegate(":input:checkbox","change",function(){var t=e(this),i=t.val(),n=t.next("span").html(),l=a.children('option[value="'+i+'"]');return t.is(":checked")?l.length>0?l.prop("selected",!0):l.append(e("<option></option>").attr("value",i).text(n)):l.length>0&&l.prop("selected",!1),a.trigger("change"),!1}).delegate("a","click",function(){var t=e(this),n=t.data("value"),l=t.html(),o=a.children('option[value="'+n+'"]');return t.data("active")===!1?(t.data("active",!0).removeClass(i.disabledLinkClass),o.length>0?o.prop("selected",!0):o.append(e("<option></option>").attr("value",n).text(l))):o.length>0&&(t.data("active",!1).addClass(i.disabledLinkClass),o.prop("selected",!1)),a.trigger("change"),!1}),i.optionType){case"link":this._bindForLinks();break;case"checkbox":this._bindForCheckboxes()}this._bindClick2Add()},_bindForCheckboxes:function(){var t=this,a=t.element,i=(t.options,t.optionsDiv);a.on("change",function(){var n=i.find(":input"),l=a.children("option"),o=l.map(function(){return this.value});l.each(function(){var a=e(this),n=a.val();if(""!==n){var l=i.find(':input[value="'+n+'"]');a.is(":selected")===!1?l.length&&l.prop("checked",!1):l.length?l.prop("checked",!0):i.show(5).append(t._createCheckbox({value:n,text:a.text(),checked:!0}))}}),n.each(function(){var t=e(this);-1==e.inArray(t.val(),o)&&t.closest("label").remove()}),0===i.find(":input").length&&i.hide()})},_bindForLinks:function(){var t=this,a=t.element,i=t.options,n=t.optionsDiv;a.on("change",function(){var l=n.find("a"),o=a.children("option"),d=o.map(function(){return this.value});o.each(function(){var a=e(this),l=a.val();if(""!==l){var o=n.find('a[data-value="'+l+'"]');a.is(":selected")===!1?o.length&&o.data("active",!1).addClass(i.disabledLinkClass):o.length?o.data("active",!0).removeClass(i.disabledLinkClass):n.show(5).append(t._createLink({value:l,text:a.text(),checked:!0}))}}),l.each(function(){var t=e(this);-1==e.inArray(String(t.data("value")),d)&&t.remove()}),0===n.find("a").length&&n.hide()})},_bindAutoComplete:function(){var t=this,a=t.element,i=t.options,n=t.searchInput,l=t.optionsDiv,o=void 0!==a.data("field")?a.data("field").id:"",d=(t.fname,jreviews.isRTL?"right top":"left top"),s=jreviews.isRTL?"right bottom":"left bottom";n.autocomplete({position:{my:d,at:s},minLength:i.minSearchLength,source:function(n,d){var s,r=n.term.toLowerCase(),c=[];switch(i.optionType){case"link":s=l.find("a").map(function(){return e(this).data("value")});break;case"checkbox":s=l.find(":input").map(function(){return this.value})}if(a.data("isControlled")&&"listings"!=t.lookup){var p=new RegExp(e.ui.autocomplete.escapeRegex(n.term),"i");c=a.children("option").map(function(){var t=e(this).text();return""===this.value||n.term&&!p.test(t)||-1!=e.inArray(this.value,s)?void 0:{label:t,value:this.value}}),d(c),t._noMatch(c)}else switch(t.lookup){case"listings":t._getListingData(r,function(a){e(a).each(function(t,a){void 0!==a&&-1==e.inArray(parseInt(a.value,10),s)&&c.push(a)}),d(c),t._noMatch(c)},i.entry_id);break;case"options":var u={limit:12,field_id:o,value:r},h=jreviews.dispatch({method:"get",type:"json",controller:"fields",action:"_loadValues",data:u});h.done(function(a){e(a).each(function(t,a){void 0!==a&&-1==e.inArray(a.value,s)&&c.push(a)}),d(c),t._noMatch(c)})}},search:function(){return"options"==this.lookup&&""===o?!1:void 0},focus:function(e,t){return n.val(t.item.label),!1},select:function(t,i){if(""!==i.item.value){n.val("").focus();var l,o=a.val()||[],d=a.children('option[value="'+i.item.value+'"]');a.val(""),0===d.length&&a.append(e("<option></option>").attr({value:i.item.value}).text(i.item.label)),l=a.prop("type"),"select-multiple"==l?(o.push(i.item.value),a.val(o)):a.val(i.item.value),a.trigger("change")}return n.val(""),!1}}),e(".ui-autocomplete").css("text-align","left")},_bindClick2Add:function(){var t=this.element,a=this.options,i=this.searchInput;1==t.data("click2add")&&e('<button class="jrButton" />').html('<span class="jrIconNew"></span>'+jreviews.__t("FIELD_ADD_OPTION")).on("click",function(n){n.preventDefault();var l,o,d=i.val(),s="";!t.data("controlledBy")||t.data("fieldName")in t.data("controlledBy")||e.each(t.data("controlledBy"),function(e,t){l=e,o=t,s="|"+e+"|"+t});var r=encodeURIComponent(d).replace(/'/g,"&#039;")+"|click2add"+s,c=t.children('option[value="'+r+'"]');""!==d&&d!=a.lang.help&&0===c.length?(t.append(e("<option></option>").attr({value:r,selected:"selected","data-ordering":99999,"data-controlledBy":l,"data-controlValue":o}).text(d)).trigger("change"),i.val("")):1==c.length&&(c.prop("selected",!0),t.trigger("change")),i.focus()}).insertAfter(i)},_noMatch:function(t){var a=this.element,i=this.noResults;0===t.length&&a.data("validation")===!1&&(a.prevAll("label:eq(0)").append(i).data("validation",!0),i.fadeIn(100).delay(3e3).fadeOut(500,function(){e(this).detach(),a.data("validation",!1)}))},_destroy:function(){}})}(jQuery);
var jreviewsMedia=jreviewsMedia||{};jreviewsMedia._options={galleryId:"mediaGallery",uploader:{},mediaDiv:{},polling_period:2e4},function(e){e.fn.serializeObject=function(){var i={},a=this.serializeArray();return e.each(a,function(){void 0!==i[this.name]?(i[this.name].push||(i[this.name]=[i[this.name]]),i[this.name].push(this.value||"")):i[this.name]=this.value||""}),i},jreviewsMedia.upload_valid=!0,jreviewsMedia.addElement=function(e,i){this._el=this._el||[],this._el[e]=i},jreviewsMedia.getElement=function(e){return this._el[e]},jreviewsMedia.initUploader=function(i,a){e("#jr-terms-checkbox-upload, #jr-terms-checkbox-link").prop("checked",!1);var t=e("#jr-embed-submit");t.on("click",function(i){if(t.trigger("beginUpload"),i.stopImmediatePropagation(),jreviewsMedia.upload_valid===!0){var a=e(this),d=e("input#jr-embed-url"),r=e('<span class="jrLoadingSmall"></span>');if(""!==d.val()){a.prop("disabled",!0).after(r);var o=jreviewsMedia.embed();o.done(function(){r.remove(),a.prop("disabled",!1)})}}});var d=e("#jr-upload-url-submit");d.on("click",function(i){if(d.trigger("beginUpload"),i.stopImmediatePropagation(),jreviewsMedia.upload_valid===!0){var a=e(this),t=e("input#jr-upload-url"),r=e('<span class="jrLoadingSmall"></span>');if(""!==t.val()){a.prop("disabled",!0).after(r);var o=jreviewsMedia.uploadFromUrl();o.done(function(){r.remove(),a.prop("disabled",!1)})}}}),e("div.jr-tabs").find("div[id$='-tab']").on("delete",function(){var i=e(".media-file-list"),a=e(".media-file-list-url"),t=e(".media-linked-videos");0===i.children("div").length&&(i.closest("fieldset").hide(),e(".jr-upload-complete-actions").slideUp()),0===a.children("div").length&&(a.closest("fieldset").hide(),e(".jr-upload-url-complete-actions").slideUp()),0===t.children("div").length&&(t.hide(),e(".jr-embed-complete-actions").slideUp())});var r=this,o=e("#jr-form-media-upload");this._options.uploader={element:document.getElementById(uploader_id=i||"jr-media-uploader"),action:s2AjaxUri,params:e("#jr-uploaded-media").serializeObject(),template:e.trim(e("#jr-uploader-template").html()),fileTemplate:e.trim(e("#jr-progress-template").html()),disableCancelForFormUploads:!0,protocol:o.attr("method"),classes:{button:"jr-upload-button",drop:"jr-upload-drop-area",dropActive:"jr-upload-drop-area-active",list:"jr-file-list",file:"jr-upload-file",spinner:"jr-upload-spinner",size:"jr-upload-size",cancel:"jr-upload-cancel",progress:"jr-upload-progress",success:"jr-upload-success",fail:"jr-upload-fail"},messages:{typeError:jreviews.__t("MEDIA_UPLOAD_TYPE_ERROR"),sizeError:jreviews.__t("MEDIA_UPLOAD_SIZE_ERROR"),emptyError:jreviews.__t("MEDIA_UPLOAD_EMPTY_ERROR"),noFilesError:jreviews.__t("MEDIA_UPLOAD_NOFILE_ERROR"),onLeave:jreviews.__t("MEDIA_UPLOAD_ONLEAVE")},showMessage:function(i){e(".jr-media-message").show().prepend("<li>"+i+"</li>")},onSubmit:function(){if(jreviewsMedia.upload_valid=!0,e(".jr-upload-button input").trigger("beginUpload"),!jreviewsMedia.upload_valid)return!1;this.params=o.serializeObject();var i=e("#jr-user-info");if(i.length>0){var a=i.serializeObject();e.extend(this.params,a)}var t=e(".jr-file-list").detach();e(".media-file-list").show().append(t),e(".jr-upload-complete-actions").slideUp()},onComplete:function(i,a,t){return t.id=i,t.success||void 0===t.str?(t.success===!0&&r.addMediaDiv(t,a),"finished"==t.state&&""!==t.thumb_url&&r.updateThumb(t),t.success&&void 0!==t.encoding_job&&r.checkEncodingJobStatus(t),void(0===r.jrUploader._filesInProgress&&e(".jr-upload-complete-actions").slideDown())):(e(".jr-media-message").append(jreviews.__t(t.str,{add_ul:!1})).show(),!1)}},qq.extend(qq.FileUploader.prototype,{_addToList:function(e,i){var a=qq.toElement(this._options.fileTemplate);a.qqFileId=e;var t=this._find(a,"file");qq.setText(t,this._formatFileName(i)),this._find(a,"size").style.display="none",this._listElement.appendChild(a),this._listElement.insertBefore(a,this._listElement.childNodes[0])},_bindCancelEvent:function(){var i=this,a=this._listElement;qq.attach(a,"click",function(a){a=a||window.event;var t=a.target||a.srcElement;if(qq.hasClass(t,i._classes.cancel)){qq.preventDefault(a);var d=t.parentNode.parentNode;i._handler.cancel(d.qqFileId),qq.remove(d),e("div.jr-tabs").find("div[id$='-tab']").trigger("delete")}})},_onProgress:function(i,a,t,d){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var r=this._getItemByFileId(i),o=this._find(r,"size");o.style.display="inline";var s,n=this._find(r,"progress");if(t!=d){var l=Math.round(t/d*100);e(n).progressbar({value:l}),s=l+"% of "+this._formatSize(d)}else e(n).progressbar({value:100}),s=this._formatSize(d);qq.setText(o,s)},_uploadFileList:function(e){for(var i=[],a=0;a<e.length;a++)this._validateFile(e[a])&&i.push(e[a]);for(var t=0;t<i.length;t++)this._uploadFile(i[t])},_validateFile:function(i){var a,t;if(i.value?a=i.value.replace(/.*(\/|\\)/,""):(a=void 0!==i.fileName?i.fileName:i.name,t=void 0!==i.fileSize?i.fileSize:i.size),this._options.allowedExtensions=[],void 0===this._options.fileValidation)return!0;for(var d=-1!==a.indexOf(".")?a.replace(/.*[.]/,"").toLowerCase():"",r=0;r<this._options.fileValidation.length;r++)e.merge(this._options.allowedExtensions,this._options.fileValidation[r].allowedExtensions),e.inArray(d,this._options.fileValidation[r].allowedExtensions)>-1&&(this._options.sizeLimit=this._options.fileValidation[r].sizeLimit);return this._isAllowedExtension(a)?0===t?(this._error("emptyError",a),!1):t&&this._options.sizeLimit&&t>this._options.sizeLimit?(this._error("sizeError",a),!1):t&&t<this._options.minSizeLimit?(this._error("minSizeError",a),!1):!0:(this._error("typeError",a),!1)}}),qq.extend(this._options.uploader,a),this.jrUploader=new qq.FileUploader(this._options.uploader),jreviewsMedia.uploadValidation()},jreviewsMedia.uploadValidation=function(){var i=e("#jr-user-info"),a=e("#jr-terms-checkbox-upload, #jr-terms-checkbox-url, #jr-terms-checkbox-link");a.on("change",function(){var i=e(this);i.is(":checked")?a.prop("checked",!0):a.prop("checked",!1)}),e(".jr-upload-button input, #jr-upload-url-submit, #jr-embed-submit").on("click beginUpload",function(t){var d=i.serializeObject()||{},r=d["data[Media][name]"],o=d["data[Media][email]"],s=e(".jr-media-message"),n=i.find(".jr-user-name").data("required")||!1,l=i.find(".jr-user-email").data("required")||!1;s.html(""),jreviewsMedia.upload_valid=!0,i.length>0&&(void 0!==o&&l&&""===o||void 0!==r&&n&&""===r?(l&&""===o&&s.show().prepend('<li class="jr-user-validation">'+jreviews.__t("VALIDATE_EMAIL")+"</li>"),n&&""===r&&s.show().prepend('<li class="jr-user-validation">'+jreviews.__t("VALIDATE_NAME")+"</li>"),jreviewsMedia.upload_valid=!1,t.preventDefault()):jreviewsMedia.upload_valid=!0),a.length&&!a.is(":checked")?(s.show().prepend('<li class="jr-user-validation">'+jreviews.__t("VALIDATE_TOS")+"</li>"),jreviewsMedia.upload_valid=!1,t.preventDefault()):jreviewsMedia.upload_valid=jreviewsMedia.upload_valid&&!0,0===s.find("li").length&&s.slideUp()})},jreviewsMedia.addMediaDiv=function(i,a){var t,d=(i.embed||!1,e(e.trim(e("#jr-media-template").html())).addClass("jr-"+i.media_type).attr("id","mediaForm"+i.media_id)),r="mediaForm"+i.media_id;t=i.embed===!0||i.upload_url===!0?d.wrap('<div class="jr-upload-success jrMediaDiv" />').parent():d;var o=t.find(".jr-media-spinner");"photo"==i.media_type&&t.find(".jr-media-input-description").closest(".jrFieldDiv").remove(),t.find(".jr-media-update").on("click",function(e){e.preventDefault(),o.show(),jreviews.dispatch({controller:"media",action:"_saveEdit",method:"post",form_id:r}).done(function(){o.hide()})}),t.find(".jr-media-delete-upload").on("click",function(i){var a=t.is("form")?t.attr("id"):t.find("form").attr("id");i.preventDefault(),o.removeClass("jrHidden");var d=jreviews.dispatch({controller:"media",action:"_delete",method:"post",form_id:a});d.done(function(){var i=t.hasClass("jr-upload-success")?t:t.closest(".jr-upload-success");i.slideUp(300,function(){e(this).remove(),e("div.jr-tabs").find("div[id$='-tab']").trigger("delete")})})}),t.find(".jr-media-filename").html(a),1==i.approved?t.find(".jr-media-approved").css("display","inline-block"):t.find(".jr-media-pending").css("display","inline-block"),t.find(".jr-media-input-title").val(i.title?i.title:a),t.find(".jr-media-input-description").html(i.description?i.description:""),t.find(".jr-media-media-id").val(i.media_id),t.find(".jr-media-token").attr("name",i.token),this.addElement(i.media_id,t);var s=this.jrUploader._getItemByFileId(i.id);i.embed?e(".media-linked-videos").show().prepend(t):(("video"==i.media_type||"audio"==i.media_type)&&t.find(".jr-encoding-progress, .jr-encoding-info").show(),s?e(s).html(t):e(".media-file-list-url").append(t).show())},jreviewsMedia.updateThumb=function(i){if(void 0!==i.thumb_url&&""!==i.thumb_url){var a=this.getElement(i.media_id),t=e("<img />").attr("src",i.thumb_url).css({width:"75px",height:"auto"});a.find("div.jr-media-thumb").html(t)}},jreviewsMedia.checkEncodingJobStatus=function(i){if(null!==i.encoding_job){var a=this,t=i.encoding_job.id,d=i.media_id,r=jreviews.dispatch({method:"get",type:"json",controller:"media_upload",action:"checkJobStatus",data:{job_id:t,media_id:d}});r.done(function(t){var r=a.getElement(d);"processing"==t.state?setTimeout(function(){a.checkEncodingJobStatus(i)},jreviewsMedia._options.polling_period):"failed"==t.state?r.find(".jr-media-encoding-failed").css("display","inline-block"):"cancelled"==t.state?r.find(".jr-media-encoding-cancelled").css("display","inline-block"):(e(".jr-encoding-progress, .jr-encoding-info").remove(),a.updateThumb(t))})}},jreviewsMedia.embed=function(){var i=this,a=jreviews.admin?"admin/admin_media_upload":"media_upload",t=jreviews.dispatch({controller:a,action:"_embedVideo",form_id:"jr-form-media-embed",type:"json"});return e(".jr-media-message").html(""),t.done(function(a){return a.success?(e("input#jr-embed-url").val(""),i.addMediaDiv(a,a.service),i.updateThumb(a),e(".jr-embed-complete-actions").slideDown()):e(".jr-media-message").html(jreviews.__t(a.str)).show(),a}),t},jreviewsMedia.uploadFromUrl=function(){var i=this,a=jreviews.admin?"admin/admin_media_upload":"media_upload",t=jreviews.dispatch({controller:a,action:"_uploadUrl",form_id:"jr-form-media-upload-url",type:"json"});return e(".jr-media-message").html(""),t.done(function(a){return e("input#jr-upload-url").val(""),a.success===!0?(i.addMediaDiv(a,a.filename),"finished"==a.state&&""!==a.thumb_url&&i.updateThumb(a),a.success&&void 0!==a.encoding_job&&i.checkEncodingJobStatus(a),e(".jr-upload-url-complete-actions").slideDown()):e(".jr-media-message").html(jreviews.__t(a.str)).show(),a}),t},jreviewsMedia.initActions=function(i){var a=e("."+i),t=a.find(".jr-media-actions"),d=t.data("listing-id"),r=t.data("review-id"),o=t.data("media-id"),s=t.data("media-extension");t.data("media-id",o).data("listing-id",d).data("review-id",r).data("extension",s);var n=t.find(".jr-media-like-dislike button"),l=t.find(".jr-media-like"),c=t.find(".jr-media-dislike");if(a.hasClass("jr-video-gallery"))sliderItem=a.find("#jr-video-slider").find('[data-media-id="'+o+'"]'),sliderItem.length>0&&(void 0===sliderItem.attr("data-voted")?n.prop("disabled",!1):n.prop("disabled",!0));else if(a.hasClass("jr-photo-gallery"))if(void 0===a.data("voted-"+o))n.prop("disabled",!1);else{var p=a.data("media"+o)||{};p.likes&&l.find(".jr-count").html(p.likes),p.dislikes&&c.find(".jr-count").html(p.dislikes),n.prop("disabled",!0)}a.off("click",".jr-media-like-dislike button").on("click",".jr-media-like-dislike button",function(){var i=e(this),t=i.data("like-action"),d=i.find(".jr-count"),r={};r[jreviews.qvars.mc]=o;var s=jreviews.dispatch({controller:"media",action:t,type:"json",data:r});s.done(function(e){if(l.off("click"),c.off("click"),voteCount=parseInt(d.html(),10)+1,e.success&&d.html(voteCount),a.hasClass("jr-video-gallery")&&sliderItem.length>0)sliderItem.attr("data-"+("_like"==t?"likes":"dislikes"),voteCount),sliderItem.attr("data-voted",1);else if(a.hasClass("jr-photo-gallery")){if(e.success){var i=a.data("media"+o)||{};"_like"==t?(i.likes=voteCount,i.dislikes=parseInt(c.find(".jr-count").html(),10)):(i.likes=parseInt(l.find(".jr-count").html(),10),i.dislikes=voteCount),a.data("media"+o,i)}a.data("voted-"+o,1)}n.prop("disabled",!0)})})},jreviewsMedia.videoGallery={init:function(){var i=e("div.jr-video-gallery"),a=i.find("#jr-video-slider");if(i.length&&a.length){var t=i.closest(".jr-tabs");t.length?t.bind("tabsshow",function(e,a){a.panel.id==i.closest(".ui-tabs-panel").attr("id")&&jreviewsMedia.videoGallery.slider(i)}):jreviewsMedia.videoGallery.slider(i)}else if(i.length){jreviewsMedia.initActions("jr-video-gallery");var d=i.find(".video-embed-box");if(d.length)i.fitVids();else{var r=i.find("#jr-video-player");videojs("jr-video-player",{},function(){function e(){var e=document.getElementById(i.b.id).parentElement.offsetWidth;i.width(e).height(e*d)}var i=this,a=r.data("width"),t=r.data("height"),d=t/a;window.onresize=e}),window.onresize()}}},slider:function(i){var a=i.find("#jr-video-slider"),t=a.find(".jr-slider-item"),d=t.length,r=a.data("media-id"),o=i.width(),s=function(){if(o=i.width(),a.addClass("jrSliderSideArrows"),2>d&&a.hide(),maxNumVideos=Math.floor(o/130),d>maxNumVideos){var e=a.not(".jr-ready").addClass("jr-ready").find(".jrVideoList").bxSlider({infiniteLoop:!1,pager:!1,controls:!0,minSlides:2,maxSlides:10,moveSlides:1,slideMargin:0,slideWidth:122}),t=a.closest(".jr-tabs");t.length&&t.bind("tabsshow",function(i,t){t.panel.id==a.closest(".ui-tabs-panel").attr("id")&&e.reloadSlider()})}};s(),e(window).resize(function(){s(),"undefined"!=typeof sliderWrapper&&sliderWrapper.reloadSlider()}),jreviewsMedia.initActions("jr-video-gallery"),a.on("click","a.mediaVideo",function(a){a.preventDefault();var t,d=e(this).closest("div.jr-slider-item").clone(),r=e(this).data("path"),o=e(".jr-video-embed-player"),s=e(".video-js-box"),n=d.find("a"),l=d.find("a"),c=e(".jr-media-actions"),p=l.data("media-id"),m=i.find("div#jr-video-current-info");if(c.data({"listing-id":l.data("listing-id"),"review-id":l.data("review-id"),"media-id":p,"media-extension":l.data("media-extension"),likes:l.data("likes"),dislikes:l.data("dislikes")}),jreviewsMedia.initActions("jr-video-gallery"),void 0===e(this).data("views")&&(jreviews.dispatch({controller:"media",action:"_increaseView",data:{m:p}}),e(this).data("views",!0)),d.find(".jr-media-info").removeClass("jrHidden"),m.html(d.html()).on("click","a",function(e){e.preventDefault()}),i.find(".jr-media-actions .jr-media-like .jr-count").html(l.data("likes")),i.find(".jr-media-actions .jr-media-dislike .jr-count").html(l.data("dislikes")),i.find(".jr-media-info .jr-media-created").html(l.data("created")),i.find(".jr-media-info .jr-media-duration").html(l.data("duration")),i.find(".jr-media-info .jr-media-views-count").html(l.data("views")),""!==n.data("embed"))t=0===o.find("iframe").length?e("<iframe></iframe>"):o.find("iframe"),e.each(n.data("embedAttr"),function(e,i){t.prop(e,i)}),0===o.find("iframe").length&&t.appendTo(o),s.hide(),o.show();else{var h=i.find("#jr-video-player"),u=[{type:"video/mp4",src:r+".mp4"},{type:"video/webm",src:r+".webm"}];if(o.hide().html(""),s.show(),"jr-video-player"in videojs.players){var v=videojs.players["jr-video-player"];v.pause().src(u).load(),i.find(".vjs-poster").css({"background-image":"url("+r+".jpg)",display:"block"}),i.find(".vjs-big-play-button").show()}else videojs("jr-video-player",{poster:r+".jpg"},function(){function e(){var e=document.getElementById(i.b.id).parentElement.offsetWidth;i.width(e).height(e*d)}var i=this,a=h.data("width"),t=h.data("height"),d=t/a;i.src(u),window.onresize=e});window.onresize()}i.fitVids()}),r?a.find('[data-media-id="'+r+'"]').trigger("click"):a.first().trigger("click")}},jreviewsMedia.reorder=function(e,i){var a=i.item.closest(".ui-sortable");listing_id=a.data("listing-id"),extension=a.data("extension"),media_type=a.data("media-type"),tokens=a.data("token-s"),tokeni=a.data("token-i"),ordering=a.sortable("toArray");var t={"data[listing_id]":listing_id,"data[extension]":extension,"data[ordering]":ordering,"data[media_type]":media_type};t[tokens]=1,t[tokeni]=1;var d=jreviews.dispatch({method:"get",controller:"media",action:"reorder",data:t});d.done(function(e){e.success||jreviews.dialog.alert(jreviews.__t("PROCESS_REQUEST_ERROR"))})},jreviewsMedia.photoGallery={init:function(){var i=e("div.jr-photo-gallery");if(0===i.length)return!1;var a=i.closest(".jr-tabs");a.length?a.bind("tabsshow",function(e,a){a.panel.id==i.closest(".ui-tabs-panel").attr("id")&&setTimeout(function(){jreviewsMedia.photoGallery.render(i)},100)}):jreviewsMedia.photoGallery.render(i)},render:function(i){var a,t=i.closest(".jr-listing-detail"),d=i.find("#jr-photo-slideshow"),r=d.data("media-id"),o=d.data("height"),s=!1;void 0!==r&&e.each(data,function(e,i){return i[jreviews.qvars.mc]==r?(a=e,!1):void 0}),d.parent().hasClass("jrPhotoGalleryCompact")&&(s=!0),d.galleria({debug:!0,dataSource:data,responsive:!0,height:o,initialTransition:"fade",lightbox:s,layerFollow:!1,imagePosition:"left bottom",show:a,extend:function(){var i=this;if(1==i.getDataLength()){i.$("image-nav").hide();var a=i.$("thumbnails-container"),r=a.height(),o=i.$("container"),s=o.height()-r;i.$("thumbnails-container").hide(),e("#jr-photo-slideshow").height(s)}window.history.replaceState&&i.bind("loadstart",function(){var a=i.getIndex();e.each(data,function(i,d){if(a==i){if(!t.length){var r={};r[jreviews.qvars.mc]=d[jreviews.qvars.mc];var o=jreviewsMedia.makeNewQueryString(r),s=window.location.pathname.replace(new RegExp("/"+jreviews.qvars.mc+":[a-z0-9]+/","i"),"/");window.history.replaceState(r,"",s+o)}void 0===e(this).data("views")&&(jreviews.dispatch({controller:"media",action:"_increaseView",data:{m:d[jreviews.qvars.mc]}}),e(this).data("views",!0))}})}),d.not("jrPhotoOverlay")&&i.bind("image",function(i){e("#jr-gallery-description").html(i.galleriaData.layer)}),i.bind("image",function(){jreviewsMedia.initActions("jr-photo-gallery")})}}),d.hasClass("jrPhotoOverlay")&&d.hover(function(){d.find(".jr-photo-info, .jr-photo-caption").hide().slideDown(200)},function(){d.find(".jr-photo-info, .jr-photo-caption").show().slideUp(200)})}},jreviewsMedia.audioPlayer=function(){var i=e("div.jr-audio-player");i.each(function(){var i=e(this),a=i.siblings(".jr-audio-tracks"),t=i.data("tracks"),d=i.data("swpath");new jPlayerPlaylist({jPlayer:"#"+i.attr("id"),cssSelectorAncestor:"#"+a.attr("id")},t,{swfPath:d,supplied:"oga, m4a, mp3",playlistOptions:{freeItemClass:"jrButton jrSmall",downloadText:'<span class="jrIconArrowDown"></span>'+jreviews.__t("DOWNLOAD")}})});var a=jQuery(".jp-playlist");a.each(function(){var e=jQuery(this),i=e.closest(".jr-audio-tracks").siblings(".jr-audio-player"),a=i.data("tracks");jQuery(a).each(function(i){var a=e.find("li").eq(i).find("div"),t='<span style="float:right"><a href="" class="jrButton jrSmall"><span class="jrIconArrowDown"></span>Download</a></span>';a.append(t)})})},jreviewsMedia.getUrlParams=function(){var e=window.location.search;e=e.replace("?","");for(var i=e.split("&"),a={},t=0;t<i.length;t++){var d=i[t].split("=");void 0!==d[1]&&(a[d[0]]=d[1])}return a},jreviewsMedia.makeNewQueryString=function(i){var a=jreviewsMedia.getUrlParams(),t=[];return e.each(i,function(e,i){a[e]=i}),jreviews.jparams?(e.each(a,function(e,i){t.push(e+"="+i)}),"?"+t.join("&")):(e.each(a,function(e,i){t.push(e+":"+i)}),t.join("/")+"/")}}(jQuery),function(e){e.fn.fitVids=function(i){var a={customSelector:null},t=document.createElement("div"),d=document.getElementsByTagName("base")[0]||document.getElementsByTagName("script")[0];return t.className="fit-vids-style",t.innerHTML="&shy;<style>         	  .fluid-width-video-wrapper {        		 width: 100%;                     		 position: relative;              		 padding: 0;                      	  }                                   										  	  .fluid-width-video-wrapper iframe,  	  .fluid-width-video-wrapper object,  	  .fluid-width-video-wrapper embed {  		 position: absolute;              		 top: 0;                          		 left: 0;                         		 width: 100%;                     		 height: 100%;                    	  }                                   	</style>",d.parentNode.insertBefore(t,d),i&&e.extend(a,i),this.each(function(){var i=["iframe[src*='player.vimeo.com']","iframe[src*='www.youtube.com']","iframe[src*='www.youtube-nocookie.com']","iframe[src*='www.dailymotion.com']","object","embed"];a.customSelector&&i.push(a.customSelector);var t=e(this).find(i.join(","));t.each(function(){var i=e(this);if(!("embed"===this.tagName.toLowerCase()&&i.parent("object").length||i.parent(".fluid-width-video-wrapper").length)){var a="object"===this.tagName.toLowerCase()||i.attr("height")&&!isNaN(parseInt(i.attr("height"),10))?parseInt(i.attr("height"),10):i.height(),t=isNaN(parseInt(i.attr("width"),10))?i.width():parseInt(i.attr("width"),10),d=a/t;if(!i.attr("id")){var r="fitvid"+Math.floor(999999*Math.random());i.attr("id",r)}i.wrap('<div class="fluid-width-video-wrapper"></div>').parent(".fluid-width-video-wrapper").css("padding-top",100*d+"%"),i.removeAttr("height").removeAttr("width")}})})}}(jQuery);