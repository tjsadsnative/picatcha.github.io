/*
 * OpenTag, a tag deployment platform
 * Copyright 2011-2012, QuBit Group
 * http://opentag.qubitproducts.com
 */

try{(function(){(function(){if(!Function.prototype.bind){Function.prototype.bind=function(oThis){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var aArgs=Array.prototype.slice.call(arguments,1),fToBind=this,FNOP=function(){},fBound=function(){return fToBind.apply(this instanceof FNOP?this:oThis,aArgs.concat(Array.prototype.slice.call(arguments)))};FNOP.prototype=this.prototype;fBound.prototype=new FNOP();return fBound}}}());var PKG_ROOT={__anonymous__:true};var GLOBAL=null;try{GLOBAL=(false||eval)("this")||(function(){return this}())}catch(e){}PKG_ROOT=GLOBAL;var qubit=PKG_ROOT.qubit||{};if(!PKG_ROOT.qubit){PKG_ROOT.qubit=qubit}qubit.VERSION="1.1.13";try{module.exports=PKG_ROOT}catch(e){}var EMPTY_FUN=function(){};var UNDEF;(function(){function Define(){}Define.global=function(){return GLOBAL};Define.globalNamespace=function(path,instance,pckg,noOverride){return _namespace(path,instance,pckg,noOverride,true)};Define.namespace=function(path,instance,pckg,noOverride){return _namespace(path,instance,pckg,noOverride,false)};function _namespace(path,instance,pckg,noOverride,isGlobal){var files=path.split("."),current=Define.NAMESPACE_BASE||PKG_ROOT,last=null,lastName=null,i;if(isGlobal){current=GLOBAL}var root=current;current=pckg||current;for(i=0;i<files.length-1;i+=1){last=current;lastName=files[i];current[lastName]=current[lastName]||{};current=current[lastName]}last=current;lastName=files[files.length-1];if(GLOBAL.TAGSDK_NS_OVERRIDE){noOverride=false}if(instance!==undefined){if(last[lastName]===undefined||!noOverride){last[lastName]=instance}}else{last[lastName]=last[lastName]||{}}return{root:root,object:last}}Define.clazz=function(path,instance,extendingClass,pckg,config){Define.namespace(path,instance,pckg,true);if(typeof(extendingClass)==="function"){instance.superclass=extendingClass;instance.prototype=new instance.superclass(config)}var names=path.split(".");if(instance.prototype){instance.prototype.CLASS_NAME=names[names.length-1];names.splice(names.length-1,1);instance.prototype.PACKAGE_NAME=names.join(".")}else{instance.STATIC_NAME=names[names.length-1];names.splice(names.length-1,1);instance.PACKAGE_NAME=names.join(".")}return instance};Define.clazz("qubit.Define",Define)}());(function(){var cookieAlphabet="abcdefghijklmnopqrstuvwxyz0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ*!-#$&+()@'%./:<>?[\"]^_`{|}~\\;=";var cookieAlphabetMap={};for(var i=0;i<cookieAlphabet.length;i++){cookieAlphabetMap[cookieAlphabet.charAt(i)]=i}function Cookie(config){}qubit.Define.clazz("qubit.Cookie",Cookie);Cookie.cookieAlphabet=cookieAlphabet;Cookie.cookieAlphabetMap=cookieAlphabetMap;Cookie.decode=function(string){return unescape(string)};Cookie.encode=function(string){return escape(string)};Cookie.set=function(name,value,days,domain,notEncoded){var expires;if(days){var date=new Date();date.setTime(date.getTime()+(days*24*60*60*1000));expires="; expires="+date.toGMTString()}else{expires=""}if(!notEncoded){name=Cookie.encode(name);value=Cookie.encode(value)}var cookie=name+"="+value+expires+"; path=/;";if(domain){cookie+=" domain="+domain}document.cookie=cookie};Cookie.get=function(name,notDecoded){var part=name+"=";var chunks=document.cookie.split(";");for(var i=0;i<chunks.length;i++){var chunk=chunks[i];while(chunk.charAt(0)===" "){chunk=chunk.substring(1,chunk.length)}if(chunk.indexOf(part)===0){var tmp=chunk.substring(part.length,chunk.length);if(!notDecoded){tmp=Cookie.decode(tmp)}return tmp}}return null};Cookie.getAllForName=function(name,decoded){if(!name){return[]}var part=name+"=";var chunks=document.cookie.split(";");var cookies=[];for(var i=0;i<chunks.length;i++){var chunk=chunks[i];while(chunk.charAt(0)===" "){chunk=chunk.substring(1,chunk.length)}if(chunk.indexOf(part)===0){var tmp=chunk.substring(part.length,chunk.length);if(decoded){tmp=Cookie.decode(tmp)}cookies.push(tmp)}}return cookies};Cookie.getAll=function(decoded){var chunks=document.cookie.split(";");var cookies=[];for(var i=0;i<chunks.length;i++){var chunk=chunks[i];while(chunk.charAt(0)===" "){chunk=chunk.substring(1,chunk.length)}var name=chunk.substring(0,chunk.indexOf("="));var tmp=chunk.substring(name.length+1,chunk.length);if(decoded){tmp=Cookie.decode(tmp)}cookies.push([name,tmp])}return cookies};Cookie.rm=function(name,domain){Cookie.set(name,"",-1,domain)}})();(function(){var Define=qubit.Define;function Utils(){}var global=Define.global();Define.clazz("qubit.opentag.Utils",Utils);Utils.global=Define.global;Utils.namespace=Define.namespace;Utils.clazz=Define.clazz;Utils.getObjectUsingPath=function(path,base){base=base||global;var parts=path.split(".");for(var i=0;i<parts.length;i++){if(base&&parts[i]){base=base[parts[i]]}}return base};Utils.variableExists=function(value){return(value!==undefined)&&(value!==null)};Utils.ANON_VARS=[];Utils.getAnonymousAcessor=function(obj){var index=Utils.indexInArray(obj,Utils.ANON_VARS);if(index===-1){index=addAnonymousAcessor(obj)}return"qubit.opentag.Utils.ANON_VARS["+index+"]"};function addAnonymousAcessor(obj){return Utils.addToArrayIfNotExist(Utils.ANON_VARS,obj)}function escapeRegExp(string){return string.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")}Utils.replaceAll=function(string,pattern,replace){return string.replace(new RegExp(escapeRegExp(pattern),"g"),replace)};Utils.secureText=function(string){if(typeof(string)!=="string"){string+=""}string=string.replace(/</g,"&lt;");string=string.replace(/>/g,"&gt;");return string};Utils.getUrl=function(){return document.location.href};Utils.getQueryParam=function(param){var i,ii,params,url,query,queries,splitQuery;url=Utils.getUrl();if(url.indexOf("?")>0){queries=url.substring(url.indexOf("?")+1).split("&");for(i=0,ii=queries.length;i<ii;i+=1){query=queries[i];if(query.indexOf("=")>0){splitQuery=query.split("=");if((splitQuery.length===2)&&(splitQuery[0]===param)){return splitQuery[1]}}}}return null};Utils.getElementValue=function(elementId){var el=document.getElementById(elementId);if(el){return el.textContent||el.innerText}return null};var travelArray=[];function existsInPath(object,copy){var len=travelArray.length;for(var i=0;i<len;i++){if(object===travelArray[i][0]){return travelArray[i][1]}}travelArray[travelArray.length]=[object,copy];return false}Utils.objectCopy=function(obj,cfg){cfg=cfg||{};var res=_objectCopy(obj,cfg,cfg.maxDeep);travelArray=[];return res};function _objectCopy(obj,cfg,maxDeep,start,parentObj){var nodes=false,noOwn=false,noFunctions=false,win=false,all=false,copyReference=false,emptyForMaxDeep=false;if(cfg){all=!!cfg.all;nodes=all||cfg.nodes;win=all||cfg.win;noOwn=all;emptyForMaxDeep=!!cfg.emptyForMaxDeep;noFunctions=cfg.noFunctions&&!all;if(cfg.noOwn!==undefined){noOwn=!!cfg.noOwn}if(cfg.noFunctions!==undefined){noFunctions=!!cfg.noFunctions}if(cfg.win!==undefined){win=!!cfg.win}if(cfg.nodes!==undefined){nodes=!!cfg.nodes}copyReference=!!cfg.copyReference}if(maxDeep!==undefined&&!maxDeep){if(emptyForMaxDeep){return}return obj}else{if(maxDeep!==undefined){maxDeep--}}if(!obj||!(obj instanceof Object)){return obj}if(!nodes){try{if(obj instanceof Node){return obj}}catch(ie){if(obj instanceof ActiveXObject&&obj.nodeType!==undefined){return obj}}if(obj===document){return obj}}if(!win){if(obj===global){return obj}}var copy=(obj instanceof Array)?[]:{};if(obj instanceof Date){copy=new Date(obj)}if(!noFunctions&&obj instanceof Function){var funStr=String(obj).replace(/\s+/g,"");if((funStr.indexOf("{[nativecode]}")+14)===funStr.length){copy=function(){return obj.apply(parentObj||this,arguments)}}else{copy=function(){return obj.apply(this,arguments)}}}if(start===undefined){travelArray=[];start=0}var existingCopy=existsInPath(obj,copy);if(existingCopy){return existingCopy}var i;if(copy instanceof Array){for(i=0;i<obj.length;i++){if(obj[i]===obj[i]){copy[copy.length]=_objectCopy(obj[i],cfg,maxDeep,start+1,obj)}else{copy[copy.length]=obj[i]}}}else{i=0;for(var prop in obj){if(noOwn||obj.hasOwnProperty(prop)){if(obj[prop]===obj[prop]){copy[prop]=_objectCopy(obj[prop],cfg,maxDeep,start+1,obj)
}else{copy[prop]=obj[prop]}}i++}}if(cfg.proto){copy.prototype=_objectCopy(obj.prototype,cfg,maxDeep,start+1,obj)}if(copyReference){copy.___copy_ref=obj}return copy}var traverseArray=[];function existsInTraversePath(object,max){for(var i=0;i<max&&i<traverseArray.length;i++){if(object===traverseArray[i]){return true}}return false}Utils.traverse=function(obj,exe,cfg){_traverse(obj,exe,cfg)};function _traverse(obj,exe,cfg,start,parent,prop,trackPath){cfg=cfg||{};if(cfg.hasOwn===undefined){cfg.hasOwn=true}if(cfg.objectsOnly&&!(obj instanceof Object)){return}if(cfg.maxDeep!==undefined&&!cfg.maxDeep){return}else{if(cfg.maxDeep!==undefined){cfg.maxDeep--}}if(!cfg||!cfg.nodes){try{if(obj instanceof Node){return}}catch(ie){if(obj instanceof ActiveXObject&&obj.nodeType!==undefined){return}}}if(obj===global){return}if(start===undefined){traverseArray=[];start=0}if(existsInTraversePath(obj,start)){return}traverseArray[start]=obj;parent=parent||obj;if(parent&&prop&&(parent[prop]!==parent[prop])){return}var stopHere=exe(obj,parent,prop,trackPath);if(stopHere){return}var i=0;var objPath="";for(var pprop in obj){if(!cfg.hasOwn||(obj.hasOwnProperty(pprop))){try{var object=obj[pprop];if(cfg.track){objPath=trackPath?(trackPath+"."+pprop):pprop}_traverse(object,exe,cfg,start+1,parent,pprop,objPath)}catch(e){}}i++}}Utils.prepareQuotedString=function(string){if(typeof(string)==="string"){return'"'+(string.replace(/\"/g,'\\"'))+'"'}else{return string}};Utils.expressionToFunction=function(expr,argzString){argzString=argzString||"";var funTemplate="function ("+argzString+") {"+expr+"}";return Utils.gevalAndReturn(funTemplate).result};Utils.defineClass=function(classPath,extendingClass,config,pckg){var names=classPath.split(".");var className=names[names.length-1];var clazz;var funTemplate=["clazz = ","(function ",className,"() {","  if (",classPath,"._CONSTRUCTOR) {","    return ",classPath,"._CONSTRUCTOR.apply(this, arguments);","  } else {","    if (",classPath,".superclass) {","      return ",classPath,".superclass.apply(this, arguments);","    }","  }","})"].join("");eval(funTemplate);var CONSTRUCTOR=config.CONSTRUCTOR;clazz._CONSTRUCTOR=CONSTRUCTOR;clazz.superclass=extendingClass;Define.clazz(classPath,clazz,extendingClass,pckg);for(var prop in config){if(config.hasOwnProperty(prop)&&prop!=="CONSTRUCTOR"){clazz.prototype[prop]=config[prop]}}return clazz};Utils.keys=function(obj){if(obj instanceof Object){if(Object.keys){return Object.keys(obj)}var keys=[];for(var prop in obj){if(obj.hasOwnProperty(prop)){keys[keys.length]=prop}}return keys}else{throw"keys() called on non-object!"}};Utils.getSrcElement=function(evt){var elem;evt=evt||window.event;if(evt.srcElement){elem=evt.srcElement}else{if(evt.target){elem=evt.target}}return elem};Utils.addToArrayIfNotExist=function(array,obj){var i=0,exists=false;for(;i<array.length;i+=1){if(array[i]===obj){exists=true;break}}if(!exists){array[array.length]=obj;i=-1}return i};Utils.indexInArray=function(array,obj){var i=0,exists=false;for(;i<array.length;i++){if(array[i]===obj){exists=true;break}}return exists?i:-1};Utils.removeFromArray=function(array,obj){var i=0,total=0;for(;i<array.length;i+=1){if(array[i]===obj){array.splice(i,1);total++}}return total};Utils.addClass=function(node,name){var classes;try{node.classList.add(name)}catch(ex){if(node.className===null){node.className=name;return}classes=node.className.split(" ");Utils.addToArrayIfNotExist(classes,name);node.className=classes.join(" ")}};Utils.removeClass=function(node,name){var classes;try{node.classList.remove(name)}catch(ex){if(node.className===null){node.className="";return}classes=node.className.split(" ");Utils.removeFromArray(classes,name);node.className=classes.join(" ")}};var prefix="try{this.qubitopentagutilsgevalandreturn__var_test__=(";var suffix=");}catch(ex){this.qubitopentagutilsgevalandreturn__var_test__error = ex;}";Utils.gevalAndReturn=function(expression){var G=GLOBAL;G.qubitopentagutilsgevalandreturn__var_test__=undefined;G.qubitopentagutilsgevalandreturn__var_test__error=undefined;expression=prefix+expression+suffix;Utils.geval(expression);var res=G.qubitopentagutilsgevalandreturn__var_test__;var err=G.qubitopentagutilsgevalandreturn__var_test__error;try{G.qubitopentagutilsgevalandreturn__var_test__=UNDEF;G.qubitopentagutilsgevalandreturn__var_test__error=UNDEF;delete G.qubitopentagutilsgevalandreturn__var_test__;delete G.qubitopentagutilsgevalandreturn__var_test__error}catch(ex){}return{result:res,error:err}};Utils.trim=function(string){try{return String(string).trim()}catch(noTrim){return String(string).replace(/^\s+|\s+$/g,"")}};Utils.setIfUnset=function(obj,src){if(obj&&src){for(var prop in src){if(src.hasOwnProperty(prop)&&!obj.hasOwnProperty(prop)){obj[prop]=src[prop]}}}};Utils.geval=function(expression){if(window&&window.execScript){return window.execScript(expression)}else{return(function(){return global["eval"].call(global,expression)}())}};var _readyCalls=[];var _loaded=false;var _flushed=false;Utils.bodyReady=function(callback){if(_flushed){if(callback){callback()}return true}_loaded=_loaded||!!(document.body&&document.readyState==="complete");if(_loaded){_flushed=true;for(var i=0;i<_readyCalls.length;i++){try{_readyCalls[i]()}catch(ex){}}if(callback){callback()}}else{if(callback){_readyCalls.push(callback)}}return _loaded};var oldOnload=global.onload;global.onload=function(e){Utils.bodyReady();if(oldOnload){oldOnload(e)}};(function(){var DOMContentLoaded,isReady=false,readyWait=1,readyList,readyComplete,bindReadyComplete,doScrollCheck;readyComplete=function(wait){var f;if(wait===true){readyWait-=1}if(!readyWait||(wait!==true&&!isReady)){if(!document.body){return setTimeout(readyComplete,1)}isReady=true;if(wait!==true){readyWait-=1;if(readyWait>0){return}}while(readyList.length>0){f=readyList.shift();f()}}};doScrollCheck=function(){if(isReady){return}try{document.documentElement.doScroll("left")}catch(e){setTimeout(doScrollCheck,1);return}readyComplete()};bindReadyComplete=function(){if(readyList){return}readyList=[];if(document.readyState==="complete"){return setTimeout(readyComplete,1)}if(document.addEventListener){document.addEventListener("DOMContentLoaded",DOMContentLoaded,false);window.addEventListener("load",readyComplete,false)}else{if(document.attachEvent){document.attachEvent("onreadystatechange",DOMContentLoaded);window.attachEvent("onload",readyComplete);var toplevel=false;try{toplevel=(window.frameElement===null)||(window.frameElement===undefined)}catch(e){}if(document.documentElement.doScroll&&toplevel){doScrollCheck()}}}};var ready=function(fn){bindReadyComplete();if(isReady){setTimeout(fn,1)}else{readyList.push(fn)}};if(document.addEventListener){DOMContentLoaded=function(){document.removeEventListener("DOMContentLoaded",DOMContentLoaded,false);readyComplete()}}else{if(document.attachEvent){DOMContentLoaded=function(){if(document.readyState==="complete"){document.detachEvent("onreadystatechange",DOMContentLoaded);readyComplete()}}}}ready(function(){_loaded=true;Utils.bodyReady()})}())}());(function(){function Timer(config){if(config){this._rate=config.rate||10;this._smallestRate=-1;if(config.start){this.startPooling()}this.config=config}this.inervals=[];this._lck_obj={};this._binded_pool=this._pool.bind(this)}qubit.Define.clazz("qubit.opentag.Timer",Timer);Timer.prototype.timers=[];Timer.prototype.startPooling=function(smallestRate){if(smallestRate&&this.config.dynamic){if(this._smallestRate<0||this._smallestRate>smallestRate){this._smallestRate=Math.min(Math.floor(smallestRate/2),1500)}}if(!this.started){this.started=true;setTimeout(this._binded_pool,0)}};Timer.prototype._pool=function(){this.maxFrequent(function(){var name="";if(this.config&&this.config.name){name="["+this.config.name+"]"}},5000,this._lck_obj);this.callTimers();if(this.timers.length!==0){var rate=(this._smallestRate>this._rate)?this._smallestRate:this._rate;setTimeout(this._binded_pool,rate)}else{this.started=false;this._smallestRate=-1}};Timer.prototype.callTimers=function(){this.lastCalled=new Date().valueOf();
for(var i=0;i<this.timers.length;i++){var timer=this.timers[i];var stamp=new Date().valueOf();if(stamp>=timer.time){try{timer.execute()}catch(e){}this.timers.splice(i,1);--i}}};Timer.prototype.cancellAll=function(){this.timers=[]};Timer.prototype.setRate=function(time){this._rate=time};Timer.prototype.maxFrequent=function(fun,time,lockObj){if(!lockObj){fun.__maxFrequent__timer_opentag_qubit_=fun.__maxFrequent__timer_opentag_qubit_||{};lockObj=fun.__maxFrequent__timer_opentag_qubit_}var last=lockObj.____last__timed__max__frequent____;if(!last||(new Date().valueOf()-last)>time){last=new Date().valueOf();lockObj.____last__timed__max__frequent____=last;fun()}};Timer.prototype.runIfNotScheduled=function(fun,time,lockObj){if(lockObj.__lastRun__&&(new Date().valueOf()<(time+lockObj.__lastRun__))){return this.schedule(fun,time,lockObj)}else{lockObj.__lastRun__=new Date().valueOf();fun();return true}};Timer.prototype.schedule=function(fun,time,lockObj){if(lockObj.___scheduled___){return false}else{lockObj.___scheduled___=new Date().valueOf();this.setTimeout(function(){lockObj.___scheduled___=false;lockObj.__lastRun__=new Date().valueOf();fun()},time);return true}};var ids=1;Timer.prototype.setTimeout=function(call,time){var timer={id:ids++,time:new Date().valueOf()+(+time),execute:call};this.timers.push(timer);this.startPooling(time);return timer};Timer.prototype.setInterval=function(call,time){var interv=setInterval(call,time);this.inervals.push(interv);return interv}})();(function(){qubit.Define.namespace("qubit.opentag.Timed",new qubit.opentag.Timer({rate:37,dynamic:true}));var Timed=qubit.opentag.Timed;Timed.tillTrue=function(test,callback,often){var runner=function(){if(!test()){Timed.setTimeout(runner,often||33)}else{callback()}};runner()}})();var q={};q.html=q.html||{};q.html.fileLoader={};q.html.fileLoader.load=function(url,preLoadAction,postLoadHandler,parentNode,async,attributes){var scriptEl,preLoadResult,loadError,doPostLoad,loaded;loaded=false;doPostLoad=function(loadFailed){return function(){if(!loaded){loaded=true;if(loadFailed&&!loadError){loadError={url:document.location.href}}postLoadHandler(url,loadError,loadFailed)}}};try{if(preLoadAction){preLoadResult=preLoadAction(url)}}catch(e){preLoadResult=false;postLoadHandler(url,"Exception loading pre",true)}finally{if(preLoadResult!==false){scriptEl=q.html.fileLoader.createScriptEl(url,async,false,attributes);if(postLoadHandler){scriptEl.onload=doPostLoad(false);scriptEl.onerror=doPostLoad(true);scriptEl.onreadystatechange=function(){if((this.readyState==="complete")||(this.readyState==="loaded")){setTimeout(function(){doPostLoad(false)()},1)}}}if(!parentNode){parentNode=window.document.getElementsByTagName("head")[0]}parentNode.appendChild(scriptEl)}}};q.html.fileLoader.createScriptEl=function(path,async,forceReload,attr){var a,scriptEl=document.createElement("script");scriptEl.type="text/javascript";scriptEl.src=q.html.fileLoader.tidyUrl(path)+(forceReload?("?"+new Date().getTime()):"");if(async!==false){scriptEl.async="true";scriptEl.defer="true"}else{scriptEl.async="false";if(scriptEl.async!==false){scriptEl.async=false}scriptEl.defer="false"}for(a in attr){if(attr.hasOwnProperty(a)){scriptEl.setAttribute(a,attr[a])}}return scriptEl};q.html.fileLoader.tidyUrl=function(path){if(path.substring(0,5)==="http:"){return path}if(path.substring(0,6)==="https:"){return path}return"//"+path};(function(){var counter=0;function BaseFilter(config){this.config={order:0,include:true,name:"Filter-"+(counter++),script:undefined,session:undefined};this.session=null;if(config){for(var prop in config){if(config.hasOwnProperty(prop)){this.config[prop]=config[prop]}}if(config.session){this.setSession(config.session)}}}qubit.Define.clazz("qubit.opentag.filter.BaseFilter",BaseFilter);BaseFilter.state={DISABLED:-3,SESSION:-2,PASS:-1,FAIL:0};BaseFilter.prototype.reset=function(){this.enable()};BaseFilter.prototype.disable=function(){this.config.disabled=true};BaseFilter.prototype.enable=function(){this.config.disabled=false};BaseFilter.prototype.match=function(){return true};BaseFilter.prototype.setSession=function(session){this.session=session};BaseFilter.prototype.getSession=function(){return this.session};BaseFilter.prototype.getState=function(){var passed=BaseFilter.state.PASS;if(this.config.disabled){return BaseFilter.state.DISABLED}if(this.config.script){passed=this.config.script.call(this,passed)}if(isNaN(+passed)){passed=BaseFilter.state.FAIL}this.lastState=+passed;return passed}}());(function(){var BaseFilter=qubit.opentag.filter.BaseFilter;function SessionVariableFilter(config){var defaultConfig={};if(config){for(var prop in config){if(config.hasOwnProperty(prop)){if(prop==="customStarter"&&config[prop]){this.customStarter=config[prop]}else{if(prop==="customScript"&&config[prop]){this.customScript=config[prop]}}defaultConfig[prop]=config[prop]}}}SessionVariableFilter.superclass.call(this,defaultConfig)}qubit.Define.clazz("qubit.opentag.filter.SessionVariableFilter",SessionVariableFilter,BaseFilter);SessionVariableFilter.prototype.customStarter=function(session,ready,tag){ready(false)};SessionVariableFilter.prototype.customScript=function(session){return true};SessionVariableFilter.prototype.match=function(){try{if(this._matchState===undefined){this._matchState=!!this.customScript(this.getSession())}return this._matchState}catch(ex){return false}};SessionVariableFilter.prototype.runTag=function(tag){if(!this._runTag){if(this.customStarter){this._runTag=true;this.customStarter(this.getSession(),function(rerun){this.lastRun=new Date().valueOf();if(rerun===true){tag.run()}else{tag.runOnce()}}.bind(this),tag)}}};SessionVariableFilter.prototype.getState=function(session){if(session){this.setSession(session)}var pass=SessionVariableFilter.superclass.prototype.getState.call(this);if(pass===BaseFilter.state.DISABLED){return BaseFilter.state.DISABLED}if(pass===BaseFilter.state.PASS){if(this.customStarter){pass=BaseFilter.state.SESSION}}if(this.config.script){pass=this.config.script.call(this,pass,this.getSession())}this.lastState=pass;return pass};SessionVariableFilter.prototype.reset=function(){this._matchState=undefined;SessionVariableFilter.superclass.prototype.reset.call(this);this._runTag=undefined}}());q.html.GlobalEval={};q.html.GlobalEval.globalEval=function(src){if(window.execScript){window.execScript(src)}else{var fn=function(){window["eval"].call(window,src)};fn()}};q.html.HtmlInjector={};q.html.HtmlInjector.inject=function(el,injectStart,str,cb,parentNode){var i,ii,d,scriptsRaw,scripts,script,contents;if(str.toLowerCase().indexOf("<script")>=0){d=document.createElement("div");d.innerHTML="a"+str;scriptsRaw=d.getElementsByTagName("script");scripts=[];for(i=0,ii=scriptsRaw.length;i<ii;i+=1){scripts.push(scriptsRaw[i])}contents=[];for(i=0,ii=scripts.length;i<ii;i+=1){script=scripts[i];var s={attributes:q.html.HtmlInjector.getAttributes(script)};if(script.src){s.src=script.src}else{s.script=script.innerHTML}contents.push(s);script.parentNode.removeChild(script)}if(d.innerHTML){if(d.innerHTML.length>0){d.innerHTML=d.innerHTML.substring(1)}}q.html.HtmlInjector.doInject(el,injectStart,d);q.html.HtmlInjector.loadScripts(contents,0,cb,el)}else{d=document.createElement("div");d.innerHTML=str;q.html.HtmlInjector.doInject(el,injectStart,d);if(cb){cb()}}};q.html.HtmlInjector.doInject=function(el,injectStart,d){if(d.childNodes.length>0){var fragment=document.createDocumentFragment();while(d.childNodes.length>0){fragment.appendChild(d.removeChild(d.childNodes[0]))}if(injectStart){q.html.HtmlInjector.injectAtStart(el,fragment)}else{q.html.HtmlInjector.injectAtEnd(el,fragment)}}};q.html.HtmlInjector.injectAtStart=function(el,fragment){if(el.childNodes.length===0){el.appendChild(fragment)}else{el.insertBefore(fragment,el.childNodes[0])}};q.html.HtmlInjector.injectAtEnd=function(el,fragment,counter){if(!counter){counter=1}if((el===document.body)&&(document.readyState!=="complete")&&(counter<50)){setTimeout(function(){q.html.HtmlInjector.injectAtEnd(el,fragment,counter+1)
},100)}else{el.appendChild(fragment)}};q.html.HtmlInjector.loadScripts=function(contents,i,cb,parentNode){var ii,c,foundSrc=false;for(ii=contents.length;i<ii;i+=1){c=contents[i];if(c.src){foundSrc=true;break}else{q.html.GlobalEval.globalEval(c.script)}}if(foundSrc){q.html.fileLoader.load(c.src,null,function(){q.html.HtmlInjector.loadScripts(contents,i+1,cb,parentNode)},parentNode,false,c.attributes)}if(cb&&(i===ii)){cb()}};q.html.HtmlInjector.getAttributes=function(node){var a,aLength,attributes,val,name,map={};if(node){attributes=node.attributes;aLength=attributes.length;for(a=0;a<aLength;a++){val=attributes[a].value;name=attributes[a].name.toLowerCase();if((val!=="")&&((name==="id")||(name==="class")||(name==="charset")||(name.substr(0,5)==="data-"))){map[name]=val}}return map}};(function(){var BaseFilter=qubit.opentag.filter.BaseFilter;var Utils=qubit.opentag.Utils;var HtmlInjector=q.html.HtmlInjector;var FileLoader=q.html.fileLoader;var SessionVariableFilter=qubit.opentag.filter.SessionVariableFilter;var TagsUtils=function(){};qubit.Define.clazz("qubit.opentag.TagsUtils",TagsUtils);var _bodyLoaded=false;TagsUtils.bodyLoaded=function(){if(_bodyLoaded){return true}_bodyLoaded=!!(document.body&&document.readyState!=="loading");return _bodyLoaded};TagsUtils.bodyAvailable=function(callback){return !!document.body};var loadedURLs={};var STATE={SUCCESS:"success",FAIL:"failure",INIT:"not started"};TagsUtils.loadScript=function(config){var url=config.url;var loadingCheck=function(passedUrlFromLoader,loadError,loadFailed){loadedURLs[url].error=loadError;if(loadFailed){loadedURLs[url].state=STATE.FAIL;config.onerror()}else{loadedURLs[url].state=STATE.SUCCESS;config.onsuccess()}};if(loadedURLs[url]){if(config.noMultipleLoad){return loadingCheck(url,loadedURLs[url].error,loadedURLs[url].state===STATE.FAIL)}loadedURLs[url].count+=1}else{loadedURLs[url]={count:1,state:null}}var useWrite=!config.async;var loaded=TagsUtils.bodyLoaded();if(useWrite&&loaded){}useWrite=useWrite&&!loaded;if(useWrite){TagsUtils.writeScriptURL(url,function(allOk,error){loadingCheck(url,error,!allOk)})}else{FileLoader.load(url,false,loadingCheck,config.node,config.async)}};var redirectedDocWriteMethods=null;function saveDocWriteMethods(){redirectedDocWriteMethods=redirectedDocWriteMethods||{write:document.write,writeln:document.writeln}}function unlockDocWriteMethods(){document.write=redirectedDocWriteMethods.write;document.writeln=redirectedDocWriteMethods.writeln;redirectedDocWriteMethods=null}TagsUtils.redirectDocumentWritesToArray=function(array,log){var text=array;saveDocWriteMethods();document.write=function(t){text.push(t)};document.writeln=function(t){text.push(t)}};TagsUtils.flushDocWritesArray=function(array,location,append,log,cb){var el=location;if(el&&array){var flushed=array.splice(0,array.length);try{TagsUtils.injectHTML(el,append,flushed.join("\n"),cb||EMPTY_FUN);return true}catch(ex){}}else{var message="Flushing location not found!";return false}if(cb){cb()}return true};TagsUtils.unlockDocumentWrites=function(){if(redirectedDocWriteMethods){unlockDocWriteMethods()}};var accessorBasePath=TagsUtils.prototype.PACKAGE_NAME+".TagsUtils._writeScriptURL_callbacks";var accesorBase={};qubit.Define.namespace(accessorBasePath,accesorBase,GLOBAL,true);var wsCounter=0;var startFrom=new Date().valueOf();TagsUtils.writeScriptURL=function(url,callback){var callName="_"+startFrom+"_"+wsCounter++;var accessorName=accessorBasePath+"."+callName;var called=false;accesorBase[callName]=function(error){if(called){return}called=true;if(error){callback(false,"error while loading script "+url)}else{callback(true)}accesorBase[callName]=undefined;delete TagsUtils.writeScriptURL.callbacks[callName]};var jsIE='if(this.readyState === "loaded" || this.readyState === "complete"){ try {'+accessorName+"(true)} catch (ex) {}}";var jsNonIE="try{"+accessorName+"(false)}catch(ex){}";var jsNonIEerr="try{"+accessorName+"(true)}catch(ex){}";var scr="scr",value;url=FileLoader.tidyUrl(url);value="<"+scr+"ipt onload='"+jsNonIE+"'  onerror='"+jsNonIEerr+"' onreadystatechange='"+jsIE+"' type='text/javascript'  src='"+url+"'></"+scr+"ipt>";if(redirectedDocWriteMethods){unlockDocWriteMethods();document.write(value);saveDocWriteMethods()}else{document.write(value)}Utils.bodyReady(function(){if(!called){called=true;callback(true)}})};TagsUtils.writeScriptURL.callbacks={};var SESSION=BaseFilter.state.SESSION;var PASS=BaseFilter.state.PASS;var FAIL=BaseFilter.state.FAIL;TagsUtils.filtersState=function(filters,session,tag,runLastSessionFilterIfPresent){filters=filters.sort(function(a,b){try{return b.config.order-a.config.order}catch(nex){return 0}});var decision=PASS;if(!filters||(filters.length===0)){return decision}var lastFilterResponded=null;var disabledFiltersPresent=false;var sessionFiltersPresent=false;var waitingResponse=0;var response;var lastSessionFilter;var sessionFiltersToRun=[];var filter;var lastUnmatched;for(var i=0;i<filters.length;i++){filter=filters[i];filter.setSession(session);if(filter.match()){response=filter.getState();if(response>0){if(waitingResponse===0||waitingResponse>response){waitingResponse=response}}else{if(response===BaseFilter.state.DISABLED){disabledFiltersPresent=true}else{if(response===SESSION){sessionFiltersPresent=true;lastFilterResponded=filter;lastSessionFilter=filter;sessionFiltersToRun.push(filter)}else{lastFilterResponded=filter}}}}else{lastUnmatched=filter}}var onlyAwaitingFiltersPresent=false;if(lastFilterResponded===null){onlyAwaitingFiltersPresent=true;if(!disabledFiltersPresent){decision=FAIL}else{decision=PASS}}else{if(lastFilterResponded.config.include){decision=response}else{decision=(response===PASS)?FAIL:PASS}}if(waitingResponse>0&&(decision===PASS||onlyAwaitingFiltersPresent)){decision=waitingResponse}if(decision===SESSION||((decision===PASS)&&sessionFiltersPresent)){if(!lastSessionFilter.config.include){return FAIL}decision=SESSION;if(lastSessionFilter instanceof SessionVariableFilter){if(runLastSessionFilterIfPresent){for(var c=0;c<sessionFiltersToRun.length;c++){try{sessionFiltersToRun[c].runTag(tag)}catch(ex){}}}}}if(tag.config.dedupe&&decision===PASS){if(lastUnmatched&&lastUnmatched instanceof SessionVariableFilter){tag.sendDedupePing=true;decision=FAIL}}return decision};TagsUtils.injectHTML=function(location,append,html,callback){return HtmlInjector.inject(location,(!append)?1:0,html,callback||EMPTY_FUN)};TagsUtils.getHTMLLocationForTag=function(tag){var el;var name=tag.prepareLocationObject(tag.config.locationObject);switch(name){case"HEAD":el=document.getElementsByTagName("head")[0];break;case"BODY":el=document.body;break;default:if(name){el=document.getElementById(name)}else{el=document.body}}return el}})();(function(){var Utils=qubit.opentag.Utils;var BV_COUNTER=0;function BaseVariable(config){this.config={};this.parameters=null;if(config){this.uniqueId="BV"+BV_COUNTER++;BaseVariable.ALL_VARIABLES[this.uniqueId]=this;for(var prop in config){this.config[prop]=config[prop]}if(config.value!==undefined){this.value=config.value}if(config.defaultValue!==undefined){this.defaultValue=config.defaultValue}var ret=BaseVariable.register(this);if(ret&&ret!==this){}return ret}}qubit.Define.clazz("qubit.opentag.pagevariable.BaseVariable",BaseVariable);BaseVariable.ALL_VARIABLES={};BaseVariable.pageVariables=[];BaseVariable.register=function(variable){if(variable instanceof BaseVariable){for(var i=0;i<BaseVariable.pageVariables.length;i++){var regVar=BaseVariable.pageVariables[i];if((variable.constructor===regVar.constructor)&&(propertiesMatch(regVar.config,variable.config))){return regVar}}BaseVariable.pageVariables.push(variable);return variable}return null};function propertiesMatch(cfg,ccfg){for(var cprop in ccfg){var value=ccfg[cprop];for(var prop in cfg){if(cfg.hasOwnProperty(prop)){if(cfg[prop]!==value){return false}}}}return true}BaseVariable.prototype.getValue=function(){return this.value};BaseVariable.prototype.setValue=function(string){this.value=string};BaseVariable.prototype.getDefaultValue=function(){return this.defaultValue
};BaseVariable.prototype.setDefaultValue=function(string){this.defaultValue=string};BaseVariable.prototype.exists=function(useDefaults){var exists=Utils.variableExists(this.getValue());if(useDefaults){exists=exists||Utils.variableExists(this.getDefaultValue())}return exists};BaseVariable.prototype.getRelativeValue=function(useDefaults,defaultValue){var pageValue=this.getValue();if(!Utils.variableExists(pageValue)){pageValue=defaultValue}var defLoc;if(useDefaults&&!Utils.variableExists(pageValue)){defLoc=this.getDefaultValue();if(Utils.variableExists(defLoc)){pageValue=defLoc}}return pageValue};BaseVariable.prototype.replaceToken=function(token,string,altValue,useExpressionAccessor){var exists=this.exists();var value=exists?this.getValue():altValue;token="\\$\\{"+token+"\\}";if((useExpressionAccessor||(value instanceof Array))){var acessorString;if(exists){acessorString=this.getValueAccessorString()}else{acessorString=Utils.getAnonymousAcessor(value)}return string.replace(new RegExp(token,"g"),acessorString)}else{return string.replace(new RegExp(token,"g"),value)}};BaseVariable.prototype.getAccessorString=function(){return"qubit.opentag.pagevariable.BaseVariable.ALL_VARIABLES."+this.uniqueId};BaseVariable.prototype.getValueAccessorString=function(){return this.getAccessorString()+".getValue()"}}());(function(){var Utils=qubit.opentag.Utils;var Timed=qubit.opentag.Timed;function Expression(config){this._lockExprObject={};Expression.superclass.apply(this,arguments)}qubit.Define.clazz("qubit.opentag.pagevariable.Expression",Expression,qubit.opentag.pagevariable.BaseVariable);Expression.prototype.getValue=function(){var ret;var error;try{if(this.value.indexOf("[#]")===-1){var tmp=Utils.gevalAndReturn(this.value);ret=tmp.result;this.failMessage=null;error=tmp.error}else{ret=Expression.parseUVArray(this.value)}}catch(e){error=e}if(error){var msg="could not read value of expression: \n"+this.value+"\nexact cause: "+error;if(this.failMessage!==msg){this.failMessage=msg}ret=null}return ret};Expression.parseUVArray=function(uv){var parts=uv.split("[#]");var array=Utils.gevalAndReturn(parts[0]).result;var collection=[];var pathOfElements=parts[1];if(pathOfElements.indexOf(".")===0){pathOfElements=pathOfElements.replace(".","")}for(var i=0;i<array.length;i++){var element=Utils.getObjectUsingPath(pathOfElements,array[i]);collection.push(element)}return collection};Expression.prototype.replaceToken=function(token,string,altValue,exp){if((this.getValue() instanceof Array)){exp=true}return Expression.superclass.prototype.replaceToken.call(this,token,string,altValue,exp)}}());(function(){var Utils=qubit.opentag.Utils;function DOMText(config){DOMText.superclass.apply(this,arguments)}qubit.Define.clazz("qubit.opentag.pagevariable.DOMText",DOMText,qubit.opentag.pagevariable.BaseVariable);DOMText.prototype.getValue=function(){return Utils.getElementValue(this.value)}}());(function(){var Timed=qubit.opentag.Timed;function Cookie(config){Cookie.superclass.apply(this,arguments);this._lockObject={}}qubit.Define.clazz("qubit.opentag.pagevariable.Cookie",Cookie,qubit.opentag.pagevariable.BaseVariable);Cookie.prototype.getValue=function(){var val=qubit.Cookie.get(this.value);Timed.maxFrequent(function(){}.bind(this),2000,this._lockObject);return val}}());(function(){var Utils=qubit.opentag.Utils;function URLQuery(config){URLQuery.superclass.apply(this,arguments)}qubit.Define.clazz("qubit.opentag.pagevariable.URLQuery",URLQuery,qubit.opentag.pagevariable.BaseVariable);URLQuery.prototype.getValue=function(){return Utils.getQueryParam(this.value)}}());(function(){var Utils=qubit.opentag.Utils;var TagsUtils=qubit.opentag.TagsUtils;var Timed=qubit.opentag.Timed;var BaseVariable=qubit.opentag.pagevariable.BaseVariable;var Expression=qubit.opentag.pagevariable.Expression;var DOMText=qubit.opentag.pagevariable.DOMText;var Cookie=qubit.opentag.pagevariable.Cookie;var URLQuery=qubit.opentag.pagevariable.URLQuery;function TagHelper(){}qubit.Define.clazz("qubit.opentag.TagHelper",TagHelper);TagHelper.injectHTMLForLoader=function(tag,callback,tryWrite,altHtml){var config=tag.config;var html=(altHtml!==undefined)?altHtml:config.html;if(html){var append=(config.locationPlaceHolder==="END");var location=TagsUtils.getHTMLLocationForTag(tag);tag.injectHTMLNotFinished=true;try{if(location){TagsUtils.injectHTML(location,append,html,function(){tag.injectHTMLNotFinished=false;if(callback){try{callback()}catch(e){}}}.bind(tag))}else{if(tryWrite&&document.readyState==="loading"){document.write(html);tag.injectHTMLNotFinished=false}else{tag.injectHTMLFailed=new Date().valueOf()}}}catch(ex){tag.injectHTMLNotFinished=false;tag.injectHTMLFailed=new Date().valueOf()}}};function findParamatersForVariable(tag,varRef){var ret=[];try{var params=tag.parameters;if(params){for(var i=0;i<params.length;i++){if(params[i].variable===varRef){ret.push(params[i])}}}}catch(ex){}return ret}TagHelper.getAllVariablesWithParameters=function(tag){var vars=tag.getPageVariables();var results=[];for(var i=0;i<vars.length;i++){var pageVar=vars[i];var parameters=findParamatersForVariable(tag,pageVar);for(var j=0;j<parameters.length;j++){results.push({parameter:parameters[j],variable:pageVar})}}return results};var _lock_obj={};TagHelper.allParameterVariablesReadyForTag=function(tag,tryDefaults){var useDefaults=tryDefaults;var log=tag.log;var allReady=true;var vars=tag.getPageVariables();for(var i=0;i<vars.length;i++){var pageVar=vars[i];try{var parameters=findParamatersForVariable(tag,pageVar);var exist=pageVar.exists();if(!exist&&useDefaults){if(parameters.length>0){exist=!!parameters[0].defaultValue}exist=exist||pageVar.exists(true)}if(!exist){allReady=false;break}}catch(ex){allReady=false;break}}return allReady};var JS_VALUE="2";var QUERY_PARAM="3";var COOKIE_VALUE="4";var ELEMENT_VALUE="5";TagHelper.validateAndGetVariableForParameter=function(param){if(param.hasOwnProperty("variable")&&param.variable){param.variable=TagHelper.initPageVariable(param.variable)}else{if(param.uv){param.variable=new Expression({name:param.uv,value:param.uv})}else{param.variable=TagHelper.initPageVariable({value:undefined,empty:true})}}return param.variable};TagHelper.initPageVariable=function(cfg){if(!cfg||cfg instanceof BaseVariable){return cfg}switch(cfg.type){case JS_VALUE:return new Expression(cfg);case QUERY_PARAM:return new URLQuery(cfg);case COOKIE_VALUE:return new Cookie(cfg);case ELEMENT_VALUE:return new DOMText(cfg);case"EPRESSION":return new Expression(cfg);case"URL_PARAMETER":return new URLQuery(cfg);case"COOKIE_VALUE":return new Cookie(cfg);case"DOM_VALUE":return new DOMText(cfg);default:return new BaseVariable(cfg)}}}());(function(){var Define=qubit.Define;var Utils=qubit.opentag.Utils;function Events(config){this.calls={}}Events.prototype.on=function(name,call){this.calls[name]=this.calls[name]||[];return Utils.addToArrayIfNotExist(this.calls[name],call)};Events.prototype.call=function(name){var calls=this.calls[name];if(calls){for(var i=0;i<calls.length;i++){try{calls[i]()}catch(ex){}}}};Events.prototype.remove=function(name,call){return Utils.removeFromArray(this.calls[name],call)};Events.prototype.removeAll=function(call){var total=0;for(var prop in this.calls){if(this.calls.hasOwnProperty(prop)){total+=Utils.removeFromArray(this.calls[prop],call)}}return total};Define.clazz("qubit.Events",Events)})();(function(){var Utils=qubit.opentag.Utils;var TagsUtils=qubit.opentag.TagsUtils;var Timed=qubit.opentag.Timed;var TagHelper=qubit.opentag.TagHelper;var nameCounter=0;function GenericLoader(config){this.urlsLoaded=0;this.urlsFailed=0;this.events=new qubit.Events({});this._depLoadedHandler=function(){if(this.dependenciesLoaded()&&this.awaitingDependencies){this._triggerLoadingAndExecution()}}.bind(this);this.config={name:"Tag-"+nameCounter++,async:true,usesDocumentWrite:false,timeout:this.LOADING_TIMEOUT,dependencies:[],url:null,urlLocation:null,locationPlaceHolder:"END",locationObject:null,dontWaitForInjectionLocation:false,noMultipleLoad:false,loadDependenciesOnLoad:false};
this.delayDocWrite=false;this.dependencies=[];this._lockObject={count:0};this._lockObjectDepsLoaded={};this.genericDependencies=this.genericDependencies||[];if(config){if(!config.name){var n="Tag-"+nameCounter++;this.config.name=n}this.addState("INITIAL");for(var prop in config){this.config[prop]=config[prop]}if(config.genericDependencies){this.genericDependencies=this.genericDependencies.concat(config.genericDependencies)}if(config.dependencies){var deps=config.dependencies.concat(this.getDependencies());this.setDependencies(deps)}if(config.PACKAGE){this._package=config.PACKAGE}this.onInit()}}qubit.Define.clazz("qubit.opentag.GenericLoader",GenericLoader);GenericLoader.prototype.onInit=EMPTY_FUN;GenericLoader.prototype.LOADING_TIMEOUT=5*1000;GenericLoader.prototype._executeScript=function(){var success=false;try{this.script();success=true}catch(ex){this.addState("EXECUTED_WITH_ERRORS");this.executedWithErrors=new Date().valueOf();this._onError(ex)}finally{this._onExecute(success)}};GenericLoader.prototype.getTimeout=function(){return this._getTimeout()};GenericLoader.prototype._getTimeout=function(chain){var tout=+this.config.timeout;var deps=this.getDependencies();if(tout!==-1&&deps.length>0){var max=0;chain=chain||[];var present=(Utils.indexInArray(chain,this)!==-1);if(!present){chain[chain.length]=this;for(var i=0;i<deps.length;i++){var val=deps[i]._getTimeout(chain);if(val>max){max=val}}if(max>0){tout+=max}}else{return 0}}return tout};GenericLoader.prototype._onExecute=function(noErrors){this.onExecute(noErrors)};GenericLoader.prototype.onExecute=EMPTY_FUN;GenericLoader.prototype._flushDocWrites=function(cb){var ret=true;this._docWriteNotFlushed=false;try{var loc=TagsUtils.getHTMLLocationForTag(this);if(loc&&this._securedWrites&&this._securedWrites.length>0){var append=(this.config.locationPlaceHolder==="END");ret=TagsUtils.flushDocWritesArray(this._securedWrites,loc,append,this.log,cb);if(ret){this._docWriteFlushed=new Date().valueOf()}else{this._docWriteNotFlushed=new Date().valueOf()}}}catch(ex){this._onError(ex)}if(cb){cb()}if(this._securedWrites&&this._securedWrites.length>0){ret=false;this._docWriteNotFlushed=new Date().valueOf()}return ret};GenericLoader.prototype.log=EMPTY_FUN;GenericLoader.prototype.finished=function(){return !!this.runIsFinished};GenericLoader.prototype.script=function(){};GenericLoader.prototype.before=function(){this.beforeRun=new Date().valueOf();try{this.onBefore()}catch(ex){this._onError(ex)}};GenericLoader.prototype.onBefore=EMPTY_FUN;GenericLoader.prototype.after=function(success){this.afterRun=new Date().valueOf();try{this.onAfter(success)}catch(ex){this._onError(ex)}};GenericLoader.prototype.onAfter=function(success){};GenericLoader.prototype.runOnce=function(){if(!this._runOnceTriggered&&!this.scriptExecuted){this._runOnceTriggered=new Date().valueOf();this.run()}else{}};GenericLoader.CANCEL_ALL=false;GenericLoader.prototype.runCounter=0;GenericLoader.prototype.run=function(){if(this.cancelled||GenericLoader.CANCEL_ALL){this._handleCancel();return false}if(this.isRunning){return false}if(this.lastRun){this.reset()}this.lastRun=this.isRunning=new Date().valueOf();this.runCounter++;this._ignoreDeps=!!this.ignoreDependencies;if(!this._ignoreDeps&&!this.dependenciesLoaded()){this._attachDepsEventsToContinue();return false}return this._triggerLoadingAndExecution()};GenericLoader.prototype._triggerLoadingAndExecution=function(){this.awaitingDependencies=-new Date().valueOf();this.load();if(this._ignoreDeps){this.execute()}else{this.waitForDependenciesAndExecute()}return true};GenericLoader.prototype._attachDepsEventsToContinue=function(){this.awaitingDependencies=new Date().valueOf();var deps=this.getDependencies();for(var i=0;i<deps.length;i++){try{deps[i].events.on("success",this._depLoadedHandler)}catch(ex){}}};GenericLoader.prototype.dependenciesLoaded=function(){var deps=this.getDependencies();for(var i=0;i<deps.length;i++){if(deps[i]!==this){var executed=(+deps[i].scriptExecuted)>0;if(!executed){return false}}}return true};GenericLoader.prototype._setTimeout=function(fun,time){this._wasTimed=new Date().valueOf();return Timed.setTimeout(fun,time)};GenericLoader.prototype._handleCancel=function(){this.addState("CANCELLED");try{this.onCancel()}catch(ex){this._onError(ex)}};GenericLoader.prototype.waitForDependenciesAndExecute=function(){if(this.cancelled){this._handleCancel();return}if(this.loadedDependencies){this.execute()}else{if(this.loadingDependenciesFailed){this._markFailure();this._markFinished()}else{this._setTimeout(this.waitForDependenciesAndExecute.bind(this),30)}}};GenericLoader.prototype.execute=function(){this._triggerExecution()};GenericLoader.prototype._triggerExecution=function(){if(this.cancelled){this._handleCancel();return}if(this.scriptExecuted){return}var finished=true;if(this.shouldWaitForDocWriteProtection()){finished=false}else{if(!this._beforeEntered){this._beforeEntered=new Date().valueOf();var cancel=false;try{cancel=this.before()}catch(ex){this._onError(ex)}if(cancel){this._markFailure();this._markFinished();return}}finished=this.loadExecutionURLsAndHTML(this._triggerExecution.bind(this))}if(this.scriptExecuted){return}if(this.unexpectedFail){finished=true}if(!finished){this._setTimeout(this._triggerExecution.bind(this),30)}else{this._flushDocWrites();if(this.scriptLoadingFailed||this.injectHTMLFailed||this.unexpectedFail){this._markFailure()}else{this.scriptExecuted=new Date().valueOf();this.addState("EXECUTED");this._executeScript()}if(this.cancelled){this._handleCancel();return false}else{var successful=this.scriptExecuted>0;try{if(!this.afterRun){this.afterRun=new Date().valueOf();this.after(successful)}}catch(ex){this.executedWithErrors=new Date().valueOf()}if(!this.executedWithErrors){if(successful){this.events.call("success")}}}this._flushDocWrites();this._markFinished()}};GenericLoader.prototype._markFailure=function(){this.scriptExecuted=-(new Date().valueOf());this.addState("FAILED_TO_EXECUTE")};GenericLoader.prototype._markFinished=function(){this.runIsFinished=new Date().valueOf();this.isRunning=false;if(GenericLoader.LOCK_DOC_WRITE===this){this._flushDocWrites();TagsUtils.unlockDocumentWrites();GenericLoader.LOCK_DOC_WRITE=false}this.onFinished(true)};GenericLoader.prototype.onFinished=EMPTY_FUN;GenericLoader.prototype.onCancel=EMPTY_FUN;GenericLoader.prototype.onFinished=EMPTY_FUN;GenericLoader.prototype.shouldWaitForDocWriteProtection=function(){if(this.willSecureDocumentWrite()){if(!GenericLoader.LOCK_DOC_WRITE){GenericLoader.LOCK_DOC_WRITE=this;this._secureWriteAndCollectForExecution()}else{if(GenericLoader.LOCK_DOC_WRITE!==this){if(!this._lockedDocWriteInformed){this._lockedDocWriteInformed=new Date().valueOf()}return true}}}return false};GenericLoader.prototype.runWithoutDependencies=function(){this.ignoreDependencies=true;this.run()};GenericLoader.prototype.loadExecutionURLsAndHTML=function(callback){if(this.cancelled){this._handleCancel();return true}if(!this._loadExecutionURLsAndHTMLInformed){this._loadExecutionURLsAndHTMLInformed=true}this._triggerURLsLoading(callback);if(!this.loadURLsNotFinished){this._flushDocWrites();this._triggerHTMLInjection();this._flushDocWrites();if(!this.injectHTMLNotFinished){this._flushDocWrites();if(!this._docWriteNotFlushed){if(this._docWriteFlushed){}return true}}}return false};GenericLoader.prototype._triggerURLsLoading=function(callback){if(!this._urlLoadTriggered&&this.config.url){this._urlLoadTriggered=true;this.loadURLs(false,callback)}};GenericLoader.prototype._triggerHTMLInjection=function(){if(!this._injectHTMLTriggered&&this.config.html){this._injectHTMLTriggered=true;this.injectHTML()}};GenericLoader.prototype.STATE={INITIAL:0,STARTED:1,LOADING_DEPENDENCIES:2,LOADED_DEPENDENCIES:4,LOADING_URL:8,LOADED_URL:16,EXECUTED:32,EXECUTED_WITH_ERRORS:64,FAILED_TO_LOAD_DEPENDENCIES:128,FAILED_TO_LOAD_URL:256,FAILED_TO_EXECUTE:512,TIMED_OUT:1024,UNEXPECTED_FAIL:2048,CANCELLED:2048*2};GenericLoader.prototype.addState=function(stateName){if(this.STATE.hasOwnProperty(stateName)){this.state=(this.state|this.STATE[stateName]);
try{this.onStateChange(stateName)}catch(ex){this._onError(ex)}}};GenericLoader.prototype.onStateChange=EMPTY_FUN;GenericLoader.prototype.cancel=function(){this.cancelled=new Date().valueOf()};GenericLoader.prototype.state=GenericLoader.prototype.STATE.INITIAL;GenericLoader.prototype._markLoadedSuccesfuly=function(){this.loadedDependencies=new Date().valueOf();this.onAllDependenciesLoaded()};GenericLoader.prototype._secureWriteAndCollectForExecution=function(){if(!this._securedWrites){this._securedWrites=[];TagsUtils.redirectDocumentWritesToArray(this._securedWrites,this.log)}};function _waitForDependencies(){if(this.cancelled){this._handleCancel();return}this.waitForDependenciesFinished=new Date().valueOf();var fullBodyNeededAndUnLoaded=this._fullBodyNeededAndUnLoaded();var interactiveBodyNeededButNotReady=this._bodyNeededButNotAvailable();if(fullBodyNeededAndUnLoaded||interactiveBodyNeededButNotReady){this.waitForDependenciesFinished=false}else{if(!this.timeoutCountdownStart){this.timeoutCountdownStart=new Date().valueOf()}if(this.allDependenciesLoaded()){this._markLoadedSuccesfuly()}else{if(this._loadingOutOfTimeFrames()){this.loadingTimedOut=new Date().valueOf();if(this.allDependenciesLoaded(true)){this._markLoadedSuccesfuly()}else{this.addState("TIMED_OUT");this.loadingDependenciesFailed=new Date().valueOf();this._triggerOnLoadTimeout()}}else{this.waitForDependenciesFinished=false}}}if(!this.waitForDependenciesFinished){this._setTimeout(_waitForDependencies.bind(this),65)}else{this.addState("LOADED_DEPENDENCIES")}}GenericLoader.prototype.allDependenciesLoaded=function(tryDefaults,arrayToAdd){return this.getDependenciesToBeLoaded(tryDefaults,arrayToAdd).length===0};GenericLoader.prototype.getDependenciesToBeLoaded=function(tryDefaults,arrayToAdd){var failures=arrayToAdd||[];if(!this.injectionLocationReady()){failures.push("injection location")}var i;var deps=this.getDependencies();for(i=0;i<deps.length;i++){if(deps[i]!==this){var executed=(+deps[i].scriptExecuted)>0;if(!executed){var name=deps[i].config?deps[i].config.name:"anonymous";failures.push("dependant Tag with name -> "+name)}}}for(i=0;i<this.genericDependencies.length;i++){var ready=this.genericDependencies[i](this);if(!ready){failures.push("this.genericDependencies["+i+"] (index: "+i+")")}}if(failures!==""){}return failures};GenericLoader.prototype.docWriteAsksToWaitForBody=function(){return !!(this.delayDocWrite&&this.config.usesDocumentWrite)};GenericLoader.prototype._bodyNeededButNotAvailable=function(){if(this._dontWaitForInjections()){return false}return this._isBodyLocationNeeded()&&!TagsUtils.bodyAvailable()};GenericLoader.prototype._isBodyLocationNeeded=function(){if(!this.isLoadingAsynchronously()){return false}if(this._isBodyLocationSet()){return true}else{var atHead=(this.config.locationObject==="HEAD");return atHead&&(this.config.locationPlaceHolder==="END")}};GenericLoader.prototype._isBodyLocationSet=function(){var locObj=this.config.locationObject;return !locObj||(locObj==="BODY")};GenericLoader.prototype._fullBodyNeededAndUnLoaded=function(){if(this._dontWaitForInjections()){return false}var needed=false;if(this._isBodyLocationNeeded()){needed=(this.config.locationPlaceHolder==="END")}needed=needed||(this.fullbodyNeeded||this.docWriteAsksToWaitForBody());return needed&&!Utils.bodyReady()};GenericLoader.prototype._dontWaitForInjections=function(){return this.config.dontWaitForInjectionLocation||this.dontWaitForInjectionLocation||GenericLoader.dontWaitForInjectionLocation};GenericLoader.prototype.injectionLocationReady=function(){if(this._dontWaitForInjections()){return true}if(this._fullBodyNeededAndUnLoaded()){return false}if(!this.isLoadingAsynchronously()){return true}return !!TagsUtils.getHTMLLocationForTag(this)};GenericLoader.prototype._loadingOutOfTimeFrames=function(){if(this.getTimeout()<0){return false}return(new Date().valueOf()-this.timeoutCountdownStart)>this.getTimeout()};GenericLoader.prototype.loadDependencies=function(){this._loadDependencies()};GenericLoader.prototype.getDependencies=function(){return this.dependencies};GenericLoader.prototype.setDependencies=function(deps){this.dependencies=deps};GenericLoader.prototype._loadDependencies=function(chain){chain=chain||[];var deps=this.getDependencies();var present=Utils.indexInArray(chain,this)!==-1;if(!present){chain[chain.length]=this;for(var i=0;i<deps.length;i++){deps[i].load(chain)}}};GenericLoader.prototype.onError=EMPTY_FUN;GenericLoader.prototype._onError=function(msg){try{this.onError(msg)}catch(ex){}};GenericLoader.prototype._triggerOnLoadTimeout=function(){this.onLoadTimeout()};GenericLoader.prototype.onLoadTimeout=EMPTY_FUN;GenericLoader.prototype.onScriptsLoadSuccess=EMPTY_FUN;GenericLoader.prototype.onScriptLoadError=EMPTY_FUN;GenericLoader.prototype.onAllDependenciesLoaded=EMPTY_FUN;GenericLoader.prototype.onBeforeLoad=EMPTY_FUN;GenericLoader.prototype.load=function(){if(this.loadStarted){return}else{this.loadStarted=new Date().valueOf();try{this.onBeforeLoad()}catch(ex){this._onError(ex)}}this.addState("LOADING_DEPENDENCIES");try{if(!this._ignoreDeps&&this.config.loadDependenciesOnLoad){this.loadDependencies()}}catch(ex){throw ex}_waitForDependencies.call(this)};GenericLoader.prototype._singleUrlLoadHandler=function(success,urls,callback){++this.urlsLoaded;if(!success){++this.urlsFailed}if(this.urlsLoaded===urls.length){this.loadURLsNotFinished=false;if(success&&this.urlsFailed===0){this.addState("LOADED_URL");this.urlsLoaded=new Date().valueOf();try{if(callback){callback(true)}}catch(ex){this._onError(ex)}finally{this.onScriptsLoadSuccess()}}else{var message="error loading urls. Failed "+this.urlsFailed;this._onError(message);this.addState("FAILED_TO_LOAD_URL");this.urlsLoaded=-new Date().valueOf();try{this.scriptLoadingFailed=true;if(callback){callback(false)}}catch(ex){this._onError(ex)}finally{this.onScriptLoadError(message)}}}};GenericLoader.prototype.loadURLs=function(urlz,callback){var urls=urlz||this.config.url;this.addState("LOADING_URL");try{if(urls&&!(urls instanceof Array)){urls=[urls]}for(var i=0;i<urls.length;i++){this.loadURLsNotFinished=true;var url=urls[i];url=this.prepareURL(url);this.loadURL(url,function(success){this._singleUrlLoadHandler(success,urls,callback)}.bind(this))}}catch(ex){this.loadURLsNotFinished=false;this.addState("UNEXPECTED_FAIL");this.unexpectedFail=new Date().valueOf();this._onError(ex)}};GenericLoader.prototype.prepareLocationObject=function(loc){return loc};GenericLoader.prototype.prepareURL=function(url){return url};GenericLoader.prototype.prepareHTML=function(html){return html};GenericLoader.prototype.loadURL=function(url,callback,location){var passedUrl=url;this.addState("LOADING_URL");TagsUtils.loadScript({onsuccess:function(){try{if(callback){callback(true)}}catch(ex){}}.bind(this),onerror:function(){try{if(callback){callback(false)}}catch(ex){}}.bind(this),url:passedUrl,node:location||this.config.urlLocation,async:this.isLoadingAsynchronously(),noMultipleLoad:this.config.noMultipleLoad})};GenericLoader.prototype.reset=function(){var u;this._injectHTMLTriggered=u;this._loadExecutionURLsAndHTMLInformed=u;this._lockedDocWriteInformed=u;this._runOnceTriggered=u;this._urlLoadTriggered=u;this.afterRun=u;this.beforeRun=u;this.filtersRunTriggered=u;this.injectHTMLFailed=u;this.loadStarted=u;this.loadURLsNotFinished=u;this.loadedDependencies=u;this.loadingDependenciesFailed=u;this.loadingTimedOut=u;this.runIsFinished=u;this.scriptExecuted=u;this.scriptLoadingFailed=u;this.delayDocWrite=u;this._securedWrites=u;this.state=0;this.unexpectedFail=u;this.urlsFailed=0;this.urlsLoaded=0;this.waitForDependenciesFinished=u;this.isRunning=u;this._lastRun=u;this.cancelled=u;this._beforeEntered=u;this.awaitingDependencies=u;this.timeoutCountdownStart=u;this.addState("INITIAL")};GenericLoader.prototype.isLoadingAsynchronously=function(){if(this._wasTimed){return true}return !!(this.config.async||this.forceAsynchronous)};GenericLoader.prototype.willSecureDocumentWrite=function(){return(this.config.usesDocumentWrite&&this.isLoadingAsynchronously())
};GenericLoader.prototype.injectHTML=function(callback){var tryWriteIfNoLocation=!this.docWriteAsksToWaitForBody();var html=this.prepareHTML(this.config.html);if(html){TagHelper.injectHTMLForLoader(this,callback,tryWriteIfNoLocation,html)}};GenericLoader.prototype.clone=function(){var clone=new GenericLoader(this.config);return clone}}());(function(){var Utils=qubit.opentag.Utils;var TagsUtils=qubit.opentag.TagsUtils;var Timed=qubit.opentag.Timed;var BaseFilter=qubit.opentag.filter.BaseFilter;var GenericLoader=qubit.opentag.GenericLoader;var TagHelper=qubit.opentag.TagHelper;function BaseTag(config){var defaults={filterTimeout:(config&&config.filterTimeout)||this.FILTER_WAIT_TIMEOUT,PACKAGE:(config&&config.PACKAGE),dedupe:false,needsConsent:false,inactive:false,variables:null,runner:null,disabled:false,locked:false};Utils.setIfUnset(config,defaults);BaseTag.superclass.apply(this,arguments);this.namedVariables={};this.parameters=[];this.filters=[];this.session=null;if(config){this.addState("INITIAL");try{BaseTag.register(this)}catch(ex){}if(config.filters){for(var i=0;i<config.filters.length;i++){this.addFilter(config.filters[i])}}if(config.parameters){this.parameters=this.parameters.concat(config.parameters)}if(config.variables){for(var prop in config.variables){if(config.variables.hasOwnProperty(prop)){var param=this.getParameterByTokenName(prop);if(param){var variable=config.variables[prop];param.variable=variable;if(variable.defaultValue!==undefined){param.defaultValue=variable.defaultValue}if(variable.uv!==undefined){param.uv=variable.uv}}}}}if(config.locked){this.lock()}this.initPageVariablesForParameters();this.uniqueRefString=null;this.onTagInit()}}qubit.Define.clazz("qubit.opentag.BaseTag",BaseTag,GenericLoader);BaseTag.prototype.valueForToken=function(token,defaults){var param=this.getParameterByTokenName(token);if(param){if(defaults===undefined){if(this.loadingTimedOut){defaults=true}}return this.getParameterValue(param,defaults)}if(this.namedVariables&&this.namedVariables[token]){var variable=_getSetNamedVariable(this,token);if(variable){return variable.getRelativeValue(defaults)}}return undefined};BaseTag.prototype.LOADING_TIMEOUT=5*1000;BaseTag.prototype.FILTER_WAIT_TIMEOUT=-1;BaseTag.prototype.run=function(){if(this.config.runner){var ret=false;try{this.addState("AWAITING_CALLBACK");ret=this._runner=new Date().valueOf();this.config.runner.call(this)}catch(e){}return ret}else{this._runner=false;return this.start()}};BaseTag.prototype.lock=function(){this.locked=true;this._unlock=null};BaseTag.prototype.unlock=function(){this.locked=false;if(this._unlock){this._unlock();this._unlock=false}};BaseTag.prototype.start=function(){if(!this.locked){return BaseTag.superclass.prototype.run.call(this)}else{this._unlock=function(){return BaseTag.superclass.prototype.run.call(this)}.bind(this);return false}};BaseTag.prototype.startOnce=function(){if(!this.locked){return BaseTag.superclass.prototype.runOnce.call(this)}else{this._unlock=function(){return BaseTag.superclass.prototype.runOnce.call(this)}.bind(this);return false}};BaseTag.prototype.getFilters=function(){return this.filters};BaseTag.prototype.runOnceIfFiltersPass=function(){if(!this._runOnceIfFiltersPassTriggered&&!this.scriptExecuted){this._runOnceIfFiltersPassTriggered=new Date().valueOf();this.runIfFiltersPass()}};BaseTag.prototype.runIfFiltersPass=function(){var state=this.filtersState(true);this.addState("FILTER_ACTIVE");if(!this.filtersRunTriggered){this.filtersRunTriggered=new Date().valueOf()}if(state===BaseFilter.state.SESSION){this.addState("AWAITING_CALLBACK");this.awaitingCallback=new Date().valueOf()}else{if(state===BaseFilter.state.PASS){this.filtersPassed=new Date().valueOf();try{this.onFiltersPassed()}catch(ex){}this.run()}else{if(state===BaseFilter.state.FAIL){this._markFiltersFailed();this._markFinished()}else{if(state>0){var tout=this.config.filterTimeout;if(tout<0||((new Date().valueOf()-this.filtersRunTriggered)>tout)){if(!this._awaitingForFilterInformed){this._awaitingForFilterInformed=new Date().valueOf();try{this.onFiltersDelayed()}catch(ex){}}this._setTimeout(this.runIfFiltersPass.bind(this),state)}else{this._markFiltersFailed();this._markFinished();this.filtersRunTimedOut=new Date().valueOf()}}}}}try{this.onFiltersCheck(state)}catch(e){}return state};BaseTag.prototype._markFiltersFailed=function(){this.addState("FILTERS_FAILED");this.filtersPassed=-(new Date().valueOf())};BaseTag.prototype.STATE={INITIAL:0,FILTER_ACTIVE:1,AWAITING_CALLBACK:2,FILTERS_FAILED:4,STARTED:8,LOADING_DEPENDENCIES:16,LOADED_DEPENDENCIES:32,LOADING_URL:64,LOADED_URL:128,EXECUTED:256,EXECUTED_WITH_ERRORS:512,FAILED_TO_LOAD_DEPENDENCIES:1024,FAILED_TO_LOAD_URL:2048,FAILED_TO_EXECUTE:4096,TIMED_OUT:4096*2,UNEXPECTED_FAIL:4096*2*2,CANCELLED:4096*2*2*2};BaseTag.prototype.addState=function(stateName){BaseTag.superclass.prototype.addState.call(this,stateName);try{BaseTag.onStateChange(this)}catch(ex){}this.stateStack=[];var s=this.STATE;var current=this.state;var stack=this.stateStack;if(current&s.INITIAL){stack.push("Initial state.")}if(current&s.FILTER_ACTIVE){stack.push("Tag running with filters pass triggered.")}if(current&s.FILTERS_FAILED){stack.push("Filters failed to pass.")}if(current&s.AWAITING_CALLBACK){stack.push("Awaiting callback to run this tag. Not pooling.")}if(current&s.STARTED){stack.push("Tag is initialized and loading has been started.")}if(current&s.LOADING_DEPENDENCIES){stack.push("Dependencies are being loaded.")}if(current&s.LOADED_DEPENDENCIES){stack.push("Dependencies loading process has been finished.")}if(current&s.LOADING_URL){stack.push("External URL is being loaded.")}if(current&s.LOADED_URL){stack.push("External URL has been loaded.")}if(current&s.EXECUTED){stack.push("Main script has been executed.")}if(current&s.EXECUTED_WITH_ERRORS){stack.push("Main script has been executed but errors occured.")}if(current&s.FAILED_TO_LOAD_DEPENDENCIES){stack.push("Dependencies has failed to load.")}if(current&s.FAILED_TO_LOAD_URL){stack.push("URL location failed to load.")}if(current&s.FAILED_TO_EXECUTE){stack.push("Script failed to execute.")}if(current&s.TIMED_OUT){stack.push("Script timed out awaiting for dependencies.")}if(current&s.UNEXPECTED_FAIL){stack.push("Script occured UNEXPECTED exception and is failed.")}if(current&s.CANCELLED){stack.push("Tag has been cancelled.")}};BaseTag.prototype.onTagInit=EMPTY_FUN;BaseTag.onStateChange=EMPTY_FUN;BaseTag.prototype.onFiltersDelayed=EMPTY_FUN;BaseTag.prototype.onFiltersPassed=EMPTY_FUN;BaseTag.prototype.onFiltersCheck=EMPTY_FUN;BaseTag.prototype.state=BaseTag.prototype.STATE.INITIAL;BaseTag.prototype.arePageVariablesLoaded=function(tryDefaults){return TagHelper.allParameterVariablesReadyForTag(this,tryDefaults)};BaseTag.prototype.getDependenciesToBeLoaded=function(tryDefaults,arrayToAdd){var failures=arrayToAdd||[];if(!this.arePageVariablesLoaded(tryDefaults)){failures.push("page variables")}return BaseTag.superclass.prototype.getDependenciesToBeLoaded.call(this,tryDefaults,failures)};BaseTag.prototype.prepareURL=function(url){return this.replaceTokensWithValues(url)};BaseTag.prototype.prepareLocationObject=function(loc){return this.replaceTokensWithValues(loc)};BaseTag.prototype.prepareHTML=function(html){if(html){html=this.replaceTokensWithValues(html)}return html};BaseTag.prototype._executeScript=function(){if(this.config&&this.config.script){if(typeof(this.config.script)==="function"){this.script=this.config.script}else{var expr=this.replaceTokensWithValues(String(this.config.script));this.script=Utils.expressionToFunction(expr).bind(this)}}BaseTag.superclass.prototype._executeScript.call(this)};BaseTag.prototype.replaceTokensWithValues=function(string){if(!string||string.indexOf("${")===-1){return string}var params=this.parameters;if(params){for(var i=0;i<params.length;i++){var parameter=params[i];var variable=this.getVariableForParameter(parameter);if(variable){var token=params[i].token;var value=this.valueForToken(token);
string=variable.replaceToken(token,string,value)}}}return string};BaseTag.prototype.getParameter=function(name){var params=this.parameters;var ret=null;if(params){for(var i=0;i<params.length;i++){if(params[i].name===name){ret=params[i]}}}return ret};BaseTag.prototype.setParameterValueByTokenName=function(tokenName,variable){var param=this.getParameterByTokenName(tokenName);if(param!==null){param.variable={value:variable};return true}return false};BaseTag.prototype.getParameterValue=function(parameterOrName,defaults){var param=(typeof(parameterOrName)==="string")?this.getParameter(parameterOrName):parameterOrName;if(param){var variable=this.getVariableForParameter(param);if(variable){try{var value;if(defaults){value=Utils.gevalAndReturn(param.defaultValue).result}value=variable.getRelativeValue(defaults,value);return value}catch(ex){return undefined}}}return undefined};BaseTag.prototype.filtersState=function(runLastSessionFIlterIfPresent){var run=runLastSessionFIlterIfPresent;return TagsUtils.filtersState(this.filters,this.session,this,run)};BaseTag.prototype.addFilter=function(filter){if(this.session){filter.setSession(this.session)}this.filters.push(filter)};BaseTag.prototype.reset=function(){BaseTag.superclass.prototype.reset.call(this);this.resetFilters();var u;this.filtersPassed=u;this.dedupePingSent=u;this.pingSent=u;this._runOnceIfFiltersPassTriggered=u;this.filtersRunTriggered=u;this._runner=u};BaseTag.prototype.resetFilters=function(){for(var i=0;i<this.filters.length;i++){this.filters[i].reset()}};BaseTag.prototype.getParameterByTokenName=function(name){var ret=null;if(this.parameters){var params=this.parameters;for(var i=0;i<params.length;i++){if(params[i].token===name){ret=params[i]}}}return ret};BaseTag.prototype.removeFilter=function(filter){Utils.removeFromArray(this.filters,filter)};var _counter_tag_map=0;var tags=[];var tagAccessorsMap={};var UNIQUE_REF={};BaseTag.register=function(tag){var index=Utils.addToArrayIfNotExist(tags,tag);if(index!==-1){}if(index===-1){tag._tagIndex=tags.length-1}else{tag._tagIndex=index}if(tag.config.id){var str="Q"+tag.config.id;UNIQUE_REF[str]=tag;tag.uniqueId=str}};BaseTag.getById=function(id){return UNIQUE_REF[String(id)]};BaseTag.prototype.getById=BaseTag.getById;BaseTag.prototype.unregister=function(ref){BaseTag.unregister(ref||this)};BaseTag.unregister=function(tag){var index=Utils.removeFromArray(tags,tag);if(!index||index.length===0){}tag._tagIndex=-1};BaseTag.getTags=function(){return tags};BaseTag.getAccessorsMap=function(){return tagAccessorsMap};BaseTag.prototype.getTags=function(){return tags};BaseTag.prototype.initPageVariablesForParameters=function(){var params=this.parameters;if(params){for(var i=0;i<params.length;i++){params[i].variable=TagHelper.validateAndGetVariableForParameter(params[i])}}if(this.namedVariables){for(var prop in this.namedVariables){if(this.namedVariables.hasOwnProperty(prop)){this.namedVariables[prop]=TagHelper.initPageVariable(this.namedVariables[prop])}}}};BaseTag.prototype.getPageVariables=function(){var params=this.parameters;var vars=[];if(params){for(var i=0;i<params.length;i++){var v=this.getVariableForParameter(params[i]);if(v!==null){Utils.addToArrayIfNotExist(vars,v)}}}if(this.namedVariables){for(var key in this.namedVariables){Utils.addToArrayIfNotExist(vars,_getSetNamedVariable(this,key))}}return vars};BaseTag.prototype.getAccessorString=function(){if(!this._accessorsMapKey){this._accessorsMapKey="_"+_counter_tag_map++;tagAccessorsMap[this._accessorsMapKey]=this}return"qubit.opentag.BaseTag.getAccessorsMap()."+this._accessorsMapKey};BaseTag.prototype.getVariableForParameter=function(param){var variable=TagHelper.validateAndGetVariableForParameter(param);var existAndIsNotEmpty=variable&&!variable.config.empty;if(!existAndIsNotEmpty&&(this.namedVariables&&this.namedVariables[param.token])){variable=_getSetNamedVariable(this,param.token)}return variable};BaseTag.prototype.checkVariablesState=function(){var res=[];var pairs=TagHelper.getAllVariablesWithParameters(this);for(var i=0;i<pairs.length;i++){var param=pairs[i].parameter;var variable=pairs[i].variable;var val;if(param&&param.token){val=this.valueForToken(param.token)}else{val=variable.getRelativeValue(true)}var tmp={name:variable.config.name,exists:variable.exists(),token:param?param.token:null,value:val,variable:variable};res.push(tmp)}return res};BaseTag.prototype._triggerOnLoadTimeout=function(){this.onLoadTimeout()};function _getSetNamedVariable(tag,token){var variable=TagHelper.initPageVariable(tag.namedVariables[token]);tag.namedVariables[token]=variable;return variable}BaseTag.prototype._getUniqueId=function(){var id=this.config.name;if(this.config.id){id=this.config.id}return id};var cookiePrefix="qubit.tag.forceRunning_";var cookieRunAll="qubit.tag.forceAllToRun";BaseTag.prototype.cookieSaysToRunEvenIfDisabled=function(){var id=this._getUniqueId();var ret=!!qubit.Cookie.get(cookieRunAll);if(!ret){ret=!!qubit.Cookie.get(cookiePrefix+id)}return ret};BaseTag.prototype.setCookieForcingTagToRun=function(){var id=this._getUniqueId();qubit.Cookie.set(cookiePrefix+id,"true")};BaseTag.setCookieForcingTagsToRun=function(){qubit.Cookie.set(cookieRunAll,"true")};BaseTag.rmCookieForcingTagsToRun=function(){qubit.Cookie.rm(cookieRunAll)};BaseTag.prototype.rmCookieForcingTagToRun=function(){var id=this._getUniqueId();qubit.Cookie.rm(cookiePrefix+id)};BaseTag.rmAllCookiesForcingTagToRun=function(){var cookies=qubit.Cookie.getAll();for(var i=0;i<cookies.length;i++){var name=cookies[i][0];if(name.indexOf(cookiePrefix)===0){qubit.Cookie.rm(name)}}BaseTag.rmCookieForcingTagsToRun()}}());(function(){var Tags=function(){};qubit.Define.clazz("qubit.opentag.Tags",Tags);Tags.getById=function(id){return qubit.opentag.BaseTag.getById(String(id))};Tags.getAllTagsByState=function(){return qubit.opentag.Container.getAllTagsByState(Tags.getTags())};Tags.findTagByName=function(match){var tags=this.getTags();var results=[];for(var i=0;i<tags.length;i++){if(tags[i].config.name===match){results.push(tags[i])}}return results};Tags.findTagByMatch=function(match){var tags=this.getTags();var results=[];for(var i=0;i<tags.length;i++){if(tags[i].config.name.match(match)){results.push(tags[i])}}return results};Tags.getTags=function(){return qubit.opentag.BaseTag.getTags()};Tags.resetAllTags=function(){var tags=Tags.getTags();for(var i=0;i<tags.length;i++){tags[i].reset()}};Tags.getContainersPageVariables=function(){var containers=Tags.getContainers();var vars=[];for(var i=0;i<containers.length;i++){vars=vars.concat(containers.getPageVariables())}return vars};Tags.getAllPageVariables=function(){var tags=Tags.getTags();var vars=[];for(var i=0;i<tags.length;i++){vars=vars.concat(tags[i].getPageVariables())}return vars};Tags.cancelAll=function(){var tags=Tags.getTags();for(var i=0;i<tags.length;i++){tags[i].cancel()}};Tags.resetAll=function(){var tags=Tags.getTags();for(var i=0;i<tags.length;i++){tags[i].reset()}};Tags.getPageVariableByName=function(name){var vars=Tags.getAllPageVariables();var rets=[];for(var i=0;i<vars.length;i++){if(vars[i].config.name===name){rets.push(vars[i])}}return rets};Tags.getLoadTime=function(tag){var start=tag.beforeRun;var end=tag.runIsFinished;if(isNaN(end)){return{tag:tag,loadTime:null}}else{return{tag:tag,loadTime:(end-start)}}};Tags.getLoadTimes=function(tags){var ret=[];if(tags instanceof qubit.opentag.BaseTag){ret.push([Tags.getLoadTime(tags[prop])]);return ret}tags=tags||Tags.getTags();var array=tags instanceof Array;if(array){for(var i=0;i<tags.length;i++){if(tags[i] instanceof qubit.opentag.BaseTag){ret.push(Tags.getLoadTime(tags[i]))}}}else{for(var prop in tags){if(tags[prop] instanceof qubit.opentag.BaseTag){ret.push(Tags.getLoadTime(tags[prop]))}}}return ret};Tags.forceAllContainersAndTagsToRunIfDisabled=function(){qubit.opentag.Container.setCookieForDisabledContainersToRun();qubit.opentag.BaseTag.setCookieForcingTagsToRun()};Tags.rmAllContainersAndTagsForcingFlags=function(){qubit.opentag.Container.rmCookieForDisabledContainersToRun();
qubit.opentag.BaseTag.rmAllCookiesForcingTagToRun()};Tags.getContainers=function(){return qubit.opentag.Container.getContainers()}})();q.cookie={};q.cookie.PageView={};q.cookie.PageView.update=function(){var a,r;r=function _(){return(Math.floor(1+Math.random()*65536)).toString(36).substring(1)};if(!window.__pageViewId__){a=new Date().getTime().toString(36);window.__pageViewId__=a+r()+r()+r()}return window.__pageViewId__};q.html.PostData=function(url,data,type){var _post,agent,isIe,isIe9,isOldIe,fullUrl,loaded,retry,retryDelay,retryCount;retryCount=2;retryDelay=5000;loaded=false;retry=function(){if(retryCount>0){setTimeout(function(){if(!loaded){retryCount-=1;_post()}},retryDelay)}};agent=navigator.userAgent.toLowerCase();isIe=agent.indexOf("msie")!==-1;isIe9=agent.indexOf("msie 9")!==-1;isOldIe=((agent.indexOf("msie 7")!==-1)||(agent.indexOf("msie 6")!==-1));fullUrl=("https:"===document.location.protocol?"https:":"http:")+url;type=type||"POST";_post=function(){var xhr;try{xhr=null;try{xhr=new XMLHttpRequest()}catch(e1){}if(xhr&&!isIe){xhr.open(type,fullUrl,true)}else{if(typeof XDomainRequest!=="undefined"){xhr=new XDomainRequest();xhr.open(type,fullUrl)}else{xhr=null}}try{xhr.withCredentials=false}catch(e2){}if(xhr.setRequestHeader){xhr.setRequestHeader("Content-Type","text/plain;charset=UTF-8")}xhr.onload=function(){loaded=true};xhr.onreadystatechange=function(){};xhr.ontimeout=function(){};xhr.onerror=function(){};xhr.onprogress=function(){};xhr.send(data)}catch(err){try{try{q.html.fileLoader.load(fullUrl)}catch(err2){if(window.console&&window.console.log){window.console.log(err)}}}catch(e){}}retry()};if(isOldIe){q.html.fileLoader.load(fullUrl);return}else{_post()}};(function(){function Ping(){}qubit.Define.clazz("qubit.opentag.Ping",Ping);Ping.prototype.send=function(config,loadTimes){var pingString="c="+config.clientId+"&p="+config.containerId+"&l="+config.tellLoadTimesProbability+"&pv="+q.cookie.PageView.update()+"&d=";var pingStrings=[];for(var i=0;i<loadTimes.length;i++){var tag=loadTimes[i].tag;var loadTime=loadTimes[i].loadTime;if(loadTime===null||isNaN(loadTime)){continue}var loaderId=tag.config.id;if(!tag.pingSent&&loaderId&&loadTime!==null){if(loaderId!==undefined){pingStrings.push('"'+loaderId+'":'+loadTime);tag.pingSent=true}else{}}else{if(tag.pingSent){}else{if(loadTime===null){}}}}if(config.pingServerUrl&&pingStrings.length>0){pingString+=encodeURIComponent("{"+pingStrings.join(",")+"}");var url="//"+config.pingServerUrl+"/tag2?"+pingString;q.html.PostData(url,null,"GET")}else{if(!pingStrings.length){}if(!config.pingServerUrl){}}};Ping.prototype.sendErrors=function(config,errors){}}());(function(){var Utils=qubit.opentag.Utils;var BaseFilter=qubit.opentag.filter.BaseFilter;var BaseTag=qubit.opentag.BaseTag;var Timed=qubit.opentag.Timed;var Tags=qubit.opentag.Tags;var Cookie=qubit.Cookie;var _counter=1;try{window.opentag_consentGiven=function(){Container.consentIsGiven=true;var all=Container.getContainers();for(var i=0;i<all.length;i++){try{all[i].run()}catch(ex){}}}.bind(this)}catch(ex){}function Container(config){this.runQueue=[];this.tags={};this.config={cookieDomain:"",maxCookieLength:1000,gzip:true,delayDocWrite:false,clientId:"",name:"",tellLoadTimesProbability:0,pingServerUrl:null,trackSession:false,disabled:false,containerId:""};this.ignoreTagsState=false;if(config){this.setConfig(config);this.isTellingLoadTimes=this.config.tellLoadTimesProbability>Math.random();if(!config.name){this.config.name="Cont-"+_counter++}Container.register(this);this.ping=new qubit.opentag.Ping(this.config);var callback=this.sendPings.bind(this);this._pingAsyncCallback=function(){Timed.setTimeout(callback,5)}}return this}qubit.Define.clazz("qubit.opentag.Container",Container);var containers=[];Container.register=function(ref){Utils.addToArrayIfNotExist(containers,ref)};Container.findContainersByName=function(name){var items=this.getContainers();var results=[];for(var i=0;i<items.length;i++){if(items[i].config.name===name){results.push(items[i])}}return results};Container.getById=function(id){var items=this.getContainers();for(var i=0;i<items.length;i++){if(items[i].config.containerId===id){return items[i]}}return null};Container.prototype.unregister=function(){Container.unregister(this)};Container.unregister=function(ref){Utils.addToArrayIfNotExist(containers,ref);var index=Utils.removeFromArray(containers,ref);if(!index||index.length===0){}};Container.prototype.hasConsent=function(){return Cookie.get("qubitconsent")==="Accepted"};Container.prototype.register=function(ref){Container.register(ref||this)};Container.getContainers=function(){return containers};Container.prototype.getContainers=function(){return Container.getContainers()};Container.prototype.onTagRegistered=function(tag){};Container.prototype.registerTag=function(tag){var name=tag.config.name;if(this.tags[name]){}else{this.tags[name]=tag;try{this.onTagRegistered(tag)}catch(ex){}}};Container.prototype.registerTags=function(tags){for(var i=0;i<tags.length;i++){this.registerTag(tags[i])}};Container.prototype.setConfig=function(config){for(var prop in config){this.config[prop]=config[prop]}};Container.prototype.run=function(){this.runTags({command:"runOnceIfFiltersPass"})};Container.prototype.runWithoutFilters=function(){this.runTags({command:"run"})};Container.prototype.getTagByname=function(name){return this.tags[name]};Container.prototype.containerScriptLoadedSynchronously=function(){var i,ii,script,scripts,src;scripts=document.getElementsByTagName("script");for(i=0,ii=scripts.length;i<ii;i+=1){script=scripts[i];src=script.getAttribute("src");if(!!src&&(src.indexOf(""+this.config.clientId+"-"+this.config.containerId+".js")>0)){return(script.getAttribute("async")===null&&(script.getAttribute("defer")===false||script.getAttribute("defer")===""||script.getAttribute("defer")===null))}}return true};Container.prototype.runTags=function(config,force){if(!force){if(Container.LOCKED||Utils.global().QUBIT_CONTAINERS_LOCKED){return}}var forceAsync=!this.containerScriptLoadedSynchronously();var command="runIfFiltersPass";if(config&&config.command){command=config.command}this.runningStarted=new Date().valueOf();var firedTagsMap={};for(var name in this.tags){try{var tag=this.tags[name];if(this.includedToRun(tag)){var deps=tag.getDependencies();if(deps.length>0){for(var i=0;i<deps.length;i++){var dependency=deps[i];var depName=dependency.config.name;if(!firedTagsMap[depName]&&this.tags[depName]){firedTagsMap[depName]=dependency;this._tagRunner(dependency,command,forceAsync)}}}if(!firedTagsMap[name]){firedTagsMap[name]=tag;this._tagRunner(tag,command,forceAsync)}}}catch(ex){}}Timed.setTimeout(function(){this.sendPingsNotTooOften()}.bind(this),1100);this.waitForAllTagsToFinish()};Container.prototype._tagRunner=function(tag,command,forceAsync){try{if(this.includedToRun(tag)){if(forceAsync){tag.forceAsynchronous=true}if(this.config.delayDocWrite){tag.delayDocWrite=true}tag[command]()}}catch(ex){}};Container.prototype.includedToRun=function(tag){if(!tag){return false}var cfg=tag.config;if(cfg.inactive){return false}if(cfg.disabled){if(!tag.cookieSaysToRunEvenIfDisabled()){return false}}var consentOk=Container.consentIsGiven||(!cfg.needsConsent)||this.hasConsent();var atInitialState=(tag.state===BaseTag.prototype.STATE.INITIAL);return this.ignoreTagsState||(consentOk&&atInitialState)};Container.prototype.waitForAllTagsToFinish=function(){if(this._waitForAllTagsToFinishWaiting){return}if(!this._lastWaited){this._lastWaited=new Date().valueOf()}var timedOut=(new Date().valueOf()-this._lastWaited)>15*1000;var finished=this.allTagsFinished()||timedOut;if(!this._showFinishedOnce&&finished){this._lastWaited=null;if(timedOut){}this._showFinishedOnce=true;this.runningFinished=new Date().valueOf();this.sendPingsNotTooOften();if(this.onTagsInitiallyRun){this.onTagsInitiallyRun()}}else{if(!finished){this._waitForAllTagsToFinishWaiting=true;this._showFinishedOnce=false;Timed.setTimeout(function(){this._waitForAllTagsToFinishWaiting=false;
this.waitForAllTagsToFinish()}.bind(this),100)}else{l.INFO("********************************************************");l.WARN("All tags seem to finished current jobs.");l.INFO("********************************************************")}}};Container.prototype.onTagsInitiallyRun=EMPTY_FUN;Container.prototype.resetAllTags=function(){for(var prop in this.tags){if(this.tags.hasOwnProperty(prop)){this.tags[prop].reset()}}};Container.prototype.reset=function(){this.runningFinished=undefined;this._waitForAllTagsToFinishWaiting=undefined;this.runningStarted=undefined;this._showFinishedOnce=undefined;this.resetAllTags()};Container.prototype.sendPingsNotTooOften=function(){this._sndLck=this._sndLck||{};Timed.runIfNotScheduled(this._pingAsyncCallback,2000,this._sndLck)};Container.prototype.sendPings=function(){var i;if(this.isTellingLoadTimes){var results=this.getAllTagsByState();var _this=this;var loadTimes;if(results.run){loadTimes=Tags.getLoadTimes(results.run);this.lastPingsSentTime=new Date().valueOf();this.ping.send(this.config,loadTimes)}}};Container.prototype.getAllTagsByState=function(){return Container.getAllTagsByState(this.tags)};Container.getAllTagsByState=function(tags){var runScripts=null,other=null,filterReady=null,failed=null,consent=null,locked=null;var LOWEST_FAIL_STATE=BaseTag.prototype.STATE.EXECUTED_WITH_ERRORS;for(var prop in tags){var tag=tags[prop];if(tag instanceof BaseTag){var name=tag.config.name;if(tag.scriptExecuted>0){runScripts=runScripts||{};attachRenamedIfExist(runScripts,tag,name)}else{if(tag.locked){locked=locked||{};attachRenamedIfExist(locked,tag,name)}else{if(tag.scriptExecuted<0||(tag.state>=LOWEST_FAIL_STATE)){failed=failed||{};attachRenamedIfExist(failed,tag,name)}else{if(tag.filtersState()===BaseFilter.state.SESSION||tag.filtersState()>0){filterReady=filterReady||{};attachRenamedIfExist(filterReady,tag,name)}else{if(tag.config.needsConsent){consent=consent||{};attachRenamedIfExist(consent,tag,name)}else{other=other||{};attachRenamedIfExist(other,tag,name)}}}}}}}return{run:runScripts,failed:failed,awaiting:filterReady,consent:consent,locked:locked,other:other}};var steps={};function attachRenamedIfExist(obj,src,name){if(obj[name]){steps[name]=steps[name]||1;name+="("+steps[name]+")";steps[name]++}obj[name]=src}Container.prototype.allTagsFinished=function(){for(var prop in this.tags){if(this.tags.hasOwnProperty(prop)){var tag=this.tags[prop];if(tag instanceof qubit.opentag.BaseTag){var state=tag.filtersState();if(!tag.config.disabled){var notFailedAndUnlocked=tag.filtersState()<0&&!tag.locked;var tagNotFinishedOrNotRunner=!(tag.finished()||(tag.config.runner&&!tag.isRunning));if(notFailedAndUnlocked&&tagNotFinishedOrNotRunner){var isNotSession=(state!==BaseFilter.state.SESSION);var doesWaitForDeps=+tag.awaitingDependencies>0;if(isNotSession&&!doesWaitForDeps){return false}}}}}}return true};Container.prototype.getPageVariables=function(){var vars=[];for(var prop in this.tags){if(this.tags.hasOwnProperty(prop)){var tVars=this.tags[prop].getPageVariables();for(var i=0;i<tVars.length;i++){Utils.addToArrayIfNotExist(vars,tVars[i])}}}return vars};Container.getPageVariableByName=function(name){var vars=this.getAllPageVariables();var rets=[];for(var i=0;i<vars.length;i++){if(vars[i].config.name===name){rets.push(vars[i])}}return rets};Container.setCookieForDisabledContainersToRun=function(){qubit.Cookie.set("qubit.opentag.forceContainerRunning","true")};Container.rmCookieForDisabledContainersToRun=function(){qubit.Cookie.rm("qubit.opentag.forceContainerRunning")}})();(function(){var Utils=qubit.opentag.Utils;function LibraryTag(config){Utils.setIfUnset(config,LibraryTag.defaultConfig);if(this.singleton){var path=this.PACKAGE_NAME+"."+this.CLASS_NAME;var zuper=qubit.opentag.Utils.getObjectUsingPath(path,PKG_ROOT);if(zuper.__instance){return zuper.__instance}zuper.__instance=this}LibraryTag.superclass.call(this,config)}qubit.Define.clazz("qubit.opentag.LibraryTag",LibraryTag,qubit.opentag.BaseTag);LibraryTag.defaultConfig={vendor:null,imageUrl:null,description:"Provide description.",async:false,isPrivate:false,upgradeable:true,html:"",parameters:[]};LibraryTag.prototype.pre=function(){};LibraryTag.prototype.post=function(){};LibraryTag.prototype.before=function(){LibraryTag.superclass.prototype.before.call(this);if(this.config.html||this.config.script){return false}try{var cfg=this.config;if(cfg&&cfg.pre){if(typeof(cfg.pre)==="function"){this.pre=cfg.pre;this.pre()}else{var expr=this.replaceTokensWithValues(String(cfg.pre));if(this.config.prePostWindowScope){Utils.geval(expr)}else{this.pre=Utils.expressionToFunction(expr).bind(this);this.pre()}}}else{this.pre()}}catch(ex){return true}return false};LibraryTag.prototype.after=function(success){LibraryTag.superclass.prototype.after.call(this,success);if(this.config.html||this.config.script){return}try{var cfg=this.config;if(cfg&&cfg.post){if(typeof(cfg.post)==="function"){this.post=cfg.post;this.post(success)}else{var expr=this.replaceTokensWithValues(String(cfg.post));if(this.config.prePostWindowScope){Utils.geval(expr)}else{this.post=Utils.expressionToFunction(expr).bind(this);this.post(success)}}}else{this.post(success)}}catch(ex){}};LibraryTag.define=function(namespace,libConfig){namespace=namespace.replace(/^[\.]+/g,"").replace(/[\.]+$/g,"").replace(/\.+/g,".");var libraryDefaultConfig=libConfig.config;var constr=libConfig.CONSTRUCTOR;var prototypeTemplate={};for(var prop in libConfig){if(prop!=="config"){prototypeTemplate[prop]=libConfig[prop]}}prototypeTemplate.CONSTRUCTOR=function(cfg){cfg=cfg||{};var defaultsCopy=Utils.objectCopy(libraryDefaultConfig,{maxDeep:8});for(var prop in defaultsCopy){if(!cfg.hasOwnProperty(prop)){cfg[prop]=defaultsCopy[prop]}}var ret=qubit.opentag.LibraryTag.call(this,cfg);if(constr){constr.call(this,cfg)}if(ret){return ret}};var ret=qubit.opentag.Utils.defineClass(namespace,LibraryTag,prototypeTemplate,GLOBAL);Utils.namespace("qubit.opentag.libraries."+namespace,ret);return ret}}());(function(){var Utils=qubit.opentag.Utils;function CustomTag(config){var defaults={url:null,html:"",locationPlaceHolder:"NOT_END",locationObject:"BODY",prePostWindowScope:true,async:true};Utils.setIfUnset(config,defaults);CustomTag.superclass.call(this,config)}qubit.Define.clazz("qubit.opentag.CustomTag",CustomTag,qubit.opentag.LibraryTag)}());(function(){var Define=qubit.Define;var PatternType={CONTAINS:"Contains",MATCHES_EXACTLY:"Matches Exactly",STARTS_WITH:"Starts with",ENDS_WITH:"Ends with",REGULAR_EXPRESSION:"Regular Expression",ALL_URLS:"All URLs"};Define.namespace("qubit.opentag.filter.pattern.PatternType",PatternType)}());(function(){var Utils=qubit.opentag.Utils;var BaseFilter=qubit.opentag.filter.BaseFilter;var Timed=qubit.opentag.Timed;var PatternType=qubit.opentag.filter.pattern.PatternType;function URLFilter(config){this._lockObject={};var defaultConfig={patternType:PatternType.CONTAINS,pattern:""};if(config){for(var prop in config){if(config.hasOwnProperty(prop)){defaultConfig[prop]=config[prop]}}}URLFilter.superclass.call(this,defaultConfig)}qubit.Define.clazz("qubit.opentag.filter.URLFilter",URLFilter,BaseFilter);URLFilter.prototype.getURL=function(url){return url||Utils.getUrl()};URLFilter.prototype.match=function(url){url=this.getURL(url);var match=true;var pattern=this.config.pattern;switch(this.config.patternType){case PatternType.CONTAINS:match=(url.toLowerCase().indexOf(pattern.toLowerCase())>=0);break;case PatternType.MATCHES_EXACTLY:match=(url.toLowerCase()===this.config.pattern.toLowerCase());break;case PatternType.STARTS_WITH:match=(url.toLowerCase().indexOf(pattern.toLowerCase())===0);break;case PatternType.ENDS_WITH:match=((url.lastIndexOf(pattern.toLowerCase())+pattern.length)===url.length);break;case PatternType.REGULAR_EXPRESSION:match=new RegExp(pattern).test(url);break;case PatternType.ALL_URLS:match=true;break}return match}}());(function(){var Utils=qubit.opentag.Utils;var PatternType=qubit.opentag.filter.pattern.PatternType;var URLFilter=qubit.opentag.filter.URLFilter;
var SessionVariableFilter=qubit.opentag.filter.SessionVariableFilter;var LibraryTag=qubit.opentag.LibraryTag;var CustomTag=qubit.opentag.CustomTag;var DOMText=qubit.opentag.pagevariable.DOMText;var BaseVariable=qubit.opentag.pagevariable.BaseVariable;var URLQuery=qubit.opentag.pagevariable.URLQuery;var Cookie=qubit.opentag.pagevariable.Cookie;var Expression=qubit.opentag.pagevariable.Expression;function OldTagRunner(config){this.config={filters:[],profileName:"",qTagClientId:"",pageVars:{},scriptLoaders:{},tellLoadTimesProbability:0,containerDisabled:false,pingServerUrl:"",qtag_domain:"",delayDocWrite:false,maxCookieLength:1000,containerName:""};for(var prop in config){if(config.hasOwnProperty(prop)){this.config[prop]=config[prop]}}}qubit.Define.clazz("qubit.opentag.OldTagRunner",OldTagRunner);OldTagRunner.prototype.run=function(){if(!this._run){this._run=new Date().valueOf();this.container=new qubit.opentag.Container({cookieDomain:this.config.qtag_domain,maxCookieLength:this.config.maxCookieLength,delayDocWrite:this.config.delayDocWrite,gzip:true,clientId:this.config.qTagClientId,containerId:this.config.profileName,name:this.config.containerName,tellLoadTimesProbability:this.config.tellLoadTimesProbability,disabled:this.config.containerDisabled,pingServerUrl:this.config.pingServerUrl,trackSession:this.config.qtag_track_session});var tags=this.getTags();this.container.registerTags(tags);if(!this.container.config.disabled){this.container.run()}else{var enabledByCookie=qubit.Cookie.get("qubit.opentag.forceContainerRunning");if(enabledByCookie!==null){this.container.run()}else{}}}};OldTagRunner.prototype.getTags=function(){var filters=this.config.filters;var tagDefinitions=this.config.scriptLoaders;var pageVars=this.config.pageVars;var tags=[];var prop,loader,tag;for(prop in tagDefinitions){if(tagDefinitions.hasOwnProperty(prop)){loader=tagDefinitions[prop];var filterDefinitions=findFilters(filters,prop);var parameterDefinitions=findParameters(loader,pageVars);var location="";if(loader.locationId===1){location="HEAD"}else{if(loader.locationId===2){location="BODY"}else{if(loader.locationId===3){location=loader.locationDetail}}}var dedupe=loader.dedupe;var cfg={name:loader.name,filters:filterDefinitions,parameters:parameterDefinitions,id:loader.id,locked:!!loader.locked,url:loader.url,html:loader.html,template:!!loader.template,locationPlaceHolder:((+loader.positionId)===1)?"NOT_END":"END",locationObject:location,disabled:loader.disabled,async:loader.async,needsConsent:loader.needsConsent,usesDocumentWrite:loader.usesDocWrite,genericDependencies:loader.genericDependencies};if(loader.prePostWindowScope!==undefined){cfg.prePostWindowScope=loader.prePostWindowScope}if(loader.scriptTimeout){cfg.timeout=+loader.scriptTimeout}if(dedupe){cfg.dedupe=true}if(loader.runner){cfg.runner=loader.runner}if(loader.pre){cfg.pre=loader.pre}if(loader.post){cfg.post=loader.post}if(loader.script){cfg.script=loader.script}tag=null;if(cfg.template){tag=new LibraryTag(cfg)}else{tag=new CustomTag(cfg)}tagDefinitions[prop].instance=tag;tags.push(tag)}}for(prop in tagDefinitions){if(tagDefinitions.hasOwnProperty(prop)){var dependencies=[];loader=tagDefinitions[prop];if(loader.dependencies){for(var j=0;j<loader.dependencies.length;j++){var tagId=loader.dependencies[j];var dependency=tagDefinitions[tagId].instance;dependencies.push(dependency)}tag=loader.instance;tag.setDependencies(dependencies.concat(tag.getDependencies()))}}}return tags};var V_JS_VALUE="2";var V_QUERY_PARAM="3";var V_COOKIE_VALUE="4";var V_ELEMENT_VALUE="5";function findParameters(loader,variables){var parameters=loader.pageVars;var ret=[];for(var prop in parameters){if(parameters.hasOwnProperty(prop)){var param=parameters[prop];var variableDefinition=variables[prop];if(variableDefinition){var variable;var varCfg={name:variableDefinition.name,value:variableDefinition.value};switch(variableDefinition.type){case V_JS_VALUE:variable=new Expression(varCfg);break;case V_QUERY_PARAM:variable=new URLQuery(varCfg);break;case V_COOKIE_VALUE:variable=new Cookie(varCfg);break;case V_ELEMENT_VALUE:variable=new DOMText(varCfg);break;default:variable=new BaseVariable(varCfg)}var parameter={token:param.token};if(param.defaultValue){parameter.defaultValue=param.defaultValue}if(variable){parameter.variable=variable}ret.push(parameter)}}}return ret}var NORMAL_FILTER="1";var DEDUPE_URL_FILTER="2";var DEDUPE_SESSION_FILTER="3";var getFilterType=function(filter){var x=parseInt(filter.patternType,10);if((x<10)||(x===100)){return NORMAL_FILTER}if((x>=10)&&(x<20)){return DEDUPE_URL_FILTER}if(x===110){return DEDUPE_SESSION_FILTER}};function findFilters(filters,id){var filtersToReturn=[];for(var i=0;i<filters.length;i++){var filter=filters[i];var idx=Utils.indexInArray(filter.scriptLoaderKeys,id);if(idx!==-1){var session=false;switch(getFilterType(filter)){case NORMAL_FILTER:case DEDUPE_URL_FILTER:break;case DEDUPE_SESSION_FILTER:session=true;break}if(session||filter.starter||typeof(filter.pattern)==="function"){filter.instance=new SessionVariableFilter({include:(+filter.filterType===1),name:filter.name,customStarter:filter.starter,customScript:filter.pattern})}else{filter.instance=new URLFilter({include:(+filter.filterType===1),name:filter.name,patternType:resolvePatternType(filter),pattern:filter.pattern})}if(filter.priority!==undefined){filter.instance.config.order=+filter.priority}filtersToReturn.push(filter.instance)}}var sortFun=function(a,b){return +a.priority>+b.priority};return filtersToReturn.sort(sortFun)}var ALL="1";var SUBSTRING="2";var REGEX="3";var EXACT_MATCH="4";var FN="100";var DEDUPE_FN="110";function resolvePatternType(filter){switch(filter.patternType){case FN:case DEDUPE_FN:return null;case EXACT_MATCH:case"1"+EXACT_MATCH:return PatternType.MATCHES_EXACTLY;case SUBSTRING:case"1"+SUBSTRING:return PatternType.CONTAINS;case REGEX:case"1"+REGEX:return PatternType.REGULAR_EXPRESSION;case ALL:case"1"+ALL:return PatternType.ALL_URLS;default:return null}}})();var JSON={};(function(){function f(n){return n<10?"0"+n:n}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function stringifyDate(key){return isFinite(key.valueOf())?key.getUTCFullYear()+"-"+f(key.getUTCMonth()+1)+"-"+f(key.getUTCDate())+"T"+f(key.getUTCHours())+":"+f(key.getUTCMinutes())+":"+f(key.getUTCSeconds())+"Z":null}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value instanceof Date){value=stringifyDate(value)}else{if((value instanceof String)||(value instanceof Number)||(value instanceof Boolean)){value=value.valueOf()}}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){try{partial[i]=str(i,value)||"null"}catch(stackExceeded){partial[i]='{"stack_exceeded": null}'}}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];try{v=str(k,value)}catch(stackExceeded){v='{"stack_exceeded": null}'}if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){try{v=str(k,value)
}catch(stackExceeded){v='{"stack_exceeded": null}'}if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());(function(){function trim(text){return text.replace(/^\s+/,"").replace(/\s+$/,"")}var UVListener={callbacks:{},unfired_events:[],early_callbacks:null,currentUV:null},uv,uvLocation="universal_variable",starterId=0,POLL_DELAY_MS=500,timer;UVListener._isArray=function(input){return(Object.prototype.toString.call(input)==="[object Array]")};UVListener._targetChanged=function(keyString,old,newObject){var oldAsObject,oldTarget,newTarget;if(newObject===null){if(old==="null"){return false}else{return true}}else{if(newObject===undefined){if(old===newObject){return false}else{return true}}else{oldAsObject=JSON.parse(old);oldTarget=UVListener._getNested(oldAsObject,keyString);newTarget=UVListener._getNested(newObject,keyString);return !UVListener._jsonIsEqual(oldTarget,newTarget)}}};UVListener._processCallbacks=function(){var i;if(UVListener.early_callbacks&&UVListener.early_callbacks.length>0){for(i=0;i<UVListener.early_callbacks.length;i+=1){UVListener.push(UVListener.early_callbacks[i])}UVListener.early_callbacks=null}};UVListener._keyStringToArr=function(keyString){keyString=trim(keyString);if(keyString===""){return[]}else{keyString=keyString.replace(/\[(\w+)\]/g,".$1");keyString=keyString.replace(/^\./,"");return keyString.split(".")}};UVListener._getNested=function(object,keyString){var arr=UVListener._keyStringToArr(keyString),n;while(arr.length>0){n=arr.shift();if(object.hasOwnProperty(n)){object=object[n]}else{return}}return object};UVListener._jsonIsEqual=function(obj1,obj2){if(typeof obj1!=="string"){obj1=JSON.stringify(obj1,UVListener._stripEvents)}if(typeof obj2!=="string"){obj2=JSON.stringify(obj2,UVListener._stripEvents)}return obj1===obj2};UVListener._stripEvents=function(key,value){if(key!=="events"){return value}else{return undefined}};UVListener._on=function(type,func){var typeArray,key;typeArray=type.split(":");type=typeArray[0];key=typeArray[1];UVListener.callbacks[type]=UVListener.callbacks[type]||[];if(key){UVListener.callbacks[type].push({keyString:key,func:func})}else{UVListener.callbacks[type].push({func:func})}};UVListener._trigger=function(type,data){var i,keyString;if(UVListener.callbacks[type]){for(i=0;i<UVListener.callbacks[type].length;i+=1){if(typeof UVListener.callbacks[type][i].func==="function"){keyString=UVListener.callbacks[type][i].keyString;if(keyString){if(type==="change"&&UVListener._targetChanged(keyString,UVListener.currentUV,uv)){UVListener.callbacks[type][i].func(data)}}else{UVListener.callbacks[type][i].func(data)}}}}};UVListener._eventsPush=function(evt){var i,ii;uv.events[uv.events.length]=evt;evt.time=evt.time||(new Date()).getTime();if(UVListener.callbacks.event){i=0;ii=UVListener.callbacks.event.length;for(i;i<ii;i+=1){UVListener.callbacks.event[i].func(evt)}}evt.has_fired=true};UVListener._getUnfiredEvents=function(){var i=0;for(i=0;i<uv.events.length;i+=1){if(!uv.events[i].has_fired){UVListener.unfired_events.push(uv.events.splice(i,1)[0]);i-=1}}};UVListener._fireEvents=function(){while(UVListener.unfired_events.length>0){uv.events.push(UVListener.unfired_events.shift())}};UVListener._resetEventsPush=function(){uv.events=uv.events||[];if(uv.events.push.toString().indexOf("[native code]")!==-1){uv.events.push=UVListener._eventsPush;UVListener._getUnfiredEvents();UVListener._fireEvents()}};UVListener._checkForChanges=function(){if(UVListener.callbacks.change&&UVListener.callbacks.change.length>0){if(!UVListener._jsonIsEqual(UVListener.currentUV,uv)){UVListener._trigger("change",uv);UVListener.currentUV=JSON.stringify(uv,UVListener._stripEvents)}}};UVListener._setUVLocation=function(newLoc){uvLocation=newLoc;UVListener._initUV()};UVListener._initUV=function(){window[uvLocation]=window[uvLocation]||{events:[]};uv=window[uvLocation];if(!uv.events){uv.events=[]}};UVListener.push=function(data){if(!UVListener._isArray(data)){return}if(data[0]==="on"){UVListener._on(data[1],data[2])}else{if(data[0]==="trigger"&&data[1]){UVListener._trigger(data[1])}}};UVListener.init=function(testing,uvLoc){if(uvLoc){uvLocation=uvLoc}UVListener._initUV();if(!window.uv_listener||UVListener._isArray(window.uv_listener)){UVListener.early_callbacks=window.uv_listener||null;window.uv_listener=UVListener;if(!testing){UVListener.start()}}else{if(uvLoc){window.uv_listener._setUVLocation(uvLocation)}}};UVListener.start=function(){UVListener.currentUV=JSON.stringify(uv,UVListener._stripEvents);timer=setInterval(function(){UVListener._initUV();UVListener._resetEventsPush();UVListener._checkForChanges()},POLL_DELAY_MS);UVListener._processCallbacks()};q.html.UVListener=UVListener}());(function(){var filters=[],pageVars={},scriptLoaders={},delayDocWrite=false,qTagClientId="",containerName="Opentag",profileName="",tellLoadTimesProbability=0,containerDisabled=false,maxCookieLength=1000,pingServerUrl=null,qtag_track_session=false,qtag_domain="",scriptURL=null;var qTagClientId="53775";var profileName="238498";var filters=[{filterType:"1",name:"Include: All",patternType:"1",pattern:"/2136721/",priority:1,id:68148348,scriptLoaderKeys:["2159302"]},{filterType:"2",name:"Include: All",patternType:"1",pattern:"",priority:2,id:68148360,scriptLoaderKeys:["2159304"]},{filterType:"2",name:"exclude test & stage",patternType:"2",pattern:"incbase.net",priority:1,id:68148368,scriptLoaderKeys:["2159304"]},{filterType:"1",name:"https://payments.incisivemedia.com/interfaces/trial/step_two",patternType:"2",pattern:"https://payments.incisivemedia.com/interfaces/trial/step_two",priority:1,id:68148453,scriptLoaderKeys:["6516380"]},{filterType:"2",name:"PwC Hub Exclusion",patternType:"3",pattern:"2415256",priority:1,id:68148493,scriptLoaderKeys:["11139173"]},{filterType:"1",name:"Match All",patternType:"1",pattern:"",priority:2,id:68148508,scriptLoaderKeys:["11139173"]},{filterType:"2",name:"All pages",patternType:"1",pattern:"incbase.net",priority:1,id:68148518,scriptLoaderKeys:["14949223"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:68148535,scriptLoaderKeys:["20183513"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:68148547,scriptLoaderKeys:["20183525"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:68148556,scriptLoaderKeys:["20183532"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:68148560,scriptLoaderKeys:["20183538"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:68148570,scriptLoaderKeys:["20183553"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:68148579,scriptLoaderKeys:["20183856"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:68148591,scriptLoaderKeys:["20183864"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:68148594,scriptLoaderKeys:["23917958"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:68148609,scriptLoaderKeys:["34075545"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:68148618,scriptLoaderKeys:["34075553"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:68148633,scriptLoaderKeys:["34075563"]},{filterType:"1",name:"PwC Hub Page URL",patternType:"2",pattern:"businessgreen.com/bg/special/2415256/road-to-paris-hub",priority:1,id:68148646,scriptLoaderKeys:["43411039"]},{filterType:"1",name:"Match All",patternType:"1",pattern:"Adam",priority:1,id:68148650,scriptLoaderKeys:["44071964"]},{filterType:"1",name:"Default filter: Match all",patternType:"1",pattern:"",priority:1,id:68148653,scriptLoaderKeys:["52019191"]},{filterType:"1",name:"Default filter: Match all",patternType:"2",pattern:"m.businessgreen.com",priority:1,id:68148656,scriptLoaderKeys:["55540270"]},{filterType:"1",name:"Only Mobile",patternType:"2",pattern:"m.businessgreen.com",priority:1,id:68148657,scriptLoaderKeys:["55540856"]}];
var containerDisabled=false;var pageVars={};var scriptLoaders={2159302:{id:"2159302",name:"OTC Load: 0:V9:ALL (V9 Sites - All Domains)",scriptTimeout:5000,disabled:false,dedupe:false,pre:"var _gaq = _gaq || [];",url:"d3c3cq33003psk.cloudfront.net/opentag-53775-279656.js",post:"",html:"",locationId:1,positionId:2,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[2159304]},2159304:{id:"2159304",name:"Site Specific Variables (businessgreen.com)",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<!-- Site Specific Variables (businessgreen.com) -->\x0A<script type=\x22text/javascript\x22>\x0Avar siteUA = \x22UA-2448662-7\x22;\x0Avar onSwipeID = \x22businessgreen\x22;\x0Avar enableScout = true;\x0Avar enableDynamicGPT = true;\x0Avar loginEnabledSite = true;\x0Avar syncToGlobal = true;\x0Avar syncFromGlobal = false;\x0A  ad_slots_array = [\x0A    {\x0A        \x22dimensions\x22: [\x0A            [600,500]\x0A        ],\x0A        \x22div\x22: \x22otdm-gptad-overlay\x22,\x0A        \x22pos\x22: \x22overlay\x22\x0A    },\x0A    {\x0A        \x22dimensions\x22: [\x0A            [1280,900],\x0A          	[1264,900]\x0A        ],\x0A        \x22div\x22: \x22otdm-gptad-wallpaper\x22,\x0A        \x22pos\x22: \x22wallpaper\x22\x0A    },\x0A    {\x0A        \x22dimensions\x22: [\x0A            [980,60],\x0A          	[2,1]\x0A        ],\x0A        \x22div\x22: \x22otdm-gptad-static_bar\x22,\x0A        \x22pos\x22: \x22static-bar\x22\x0A    }, \x0A    {\x0A        \x22dimensions\x22: [\x0A            [970,250],\x0A            [970,90],\x0A            [728,90]\x0A        ],\x0A        \x22div\x22: \x22otdm-gptad-leaderboard_top\x22,\x0A        \x22pos\x22: \x22ldb1\x22\x0A    },\x0A    {\x0A        \x22dimensions\x22: [\x0A            [300,1050],  \x0A            [300,600],\x0A            [300,250]\x0A        ],\x0A        \x22div\x22: \x22otdm-gptad-mpu_one\x22,\x0A        \x22pos\x22: \x22mpu1\x22\x0A    },\x0A    {\x0A        \x22dimensions\x22: [\x0A            [300,1050],\x0A            [300,250],\x0A            [300,600]\x0A        ],\x0A        \x22div\x22: \x22otdm-gptad-mpu_two\x22,\x0A        \x22pos\x22: \x22mpu2\x22\x0A    },\x0A      {\x0A        \x22dimensions\x22: [\x0A            [300,1050],\x0A            [300,250],\x0A            [300,600]\x0A        ],\x0A        \x22div\x22: \x22otdm-gptad-mpu_three\x22,\x0A        \x22pos\x22: \x22mpu3\x22\x0A    },\x0A    {\x0A        \x22dimensions\x22: [\x0A            [3,1]\x0A        ],\x0A        \x22div\x22: \x22otdm-gptad-insights\x22,\x0A        \x22pos\x22: \x22insights\x22\x0A    }\x0A];\x0A<\/script>",locationId:1,positionId:2,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},6516380:{id:"6516380",name:"Business Green NEW/gateway-confirmation",disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<!-- OpenTag - Business Green NEW/gateway-confirmation -->\x0A<script type=\x22text/javascript\x22>\x0A  var ord = window.ord || Math.floor(Math.random() * 1e16);\x0A  document.write(\x27<script type=\x22text/javascript\x22 src=\x22http://ad.doubleclick.net/N4818/adj/bg3.uk/gateway-confirmation;sz=2x1;ord=\x27 + ord + \x27?\x22><\x5C/script>\x27);\x0A<\/script>\x0A\x0A<noscript>\x0A<a href=\x22http://ad.doubleclick.net/N4818/jump/bg3.uk/gateway-confirmation;sz=2x1;ord=[timestamp]?\x22>\x0A<img src=\x22http://ad.doubleclick.net/N4818/ad/bg3.uk/gateway-confirmation;sz=2x1;ord=[timestamp]?\x22 width=\x222\x22 height=\x221\x22 />\x0A</a>\x0A</noscript>\x0A",locationId:3,positionId:2,locationDetail:"conf_page_container",async:true,needsConsent:false,usesDocWrite:true,pageVars:{},dependencies:[]},11139173:{id:"11139173",name:"Onscroll Bottom MPU",scriptTimeout:5000,disabled:true,dedupe:false,pre:"",url:"",post:"",html:"<!-- OnScroll - BG Bottom MPU - BG Bottom MPU -->\x0A<script>\x0Avar onScrOll=new Object();\x0AonScrOll.code=\x22PCEtLSBNZXRyaWMgU2NpZW5jZSAtIEJHIEJvdHRvbSBNUFUgLSBCRyBCb3R0b20gTVBVIC0tPgo8ZGl2Pgo8IS0tIHN0YXJ0IG9mIGNyZWF0aXZlIGNvbnRlbnQgLS0+CjwhLS0gQmVnaW5uaW5nIFBhc3NCYWNrIGZvciBBZCB1bml0IGJnMy51ay9vbnNjcm9sbCAjIyMgc2l6ZTogW1szMDAsMjUwXV0gLS0+DQoJPHNjcmlwdCB0eXBlPSd0ZXh0L2phdmFzY3JpcHQnIHNyYz0naHR0cDovL3d3dy5nb29nbGV0YWdzZXJ2aWNlcy5jb20vdGFnL2pzL2dwdC5qcyc+DQoJCWdvb2dsZXRhZy5wdWJhZHMoKS5kZWZpbmVQYXNzYmFjaygnNDgxOC9iZzMudWsvb25zY3JvbGwnLCBbWzMwMCwyNTBdXSkuZGlzcGxheSgpOw0KCTwvc2NyaXB0Pg0KPCEtLSBFbmQgUGFzc2JhY2sgLS0+CjwhLS0gZW5kIG9mIGNyZWF0aXZlIGNvbnRlbnQgLS0+CjxzY3JpcHQgdHlwZT0idGV4dC9qYXZhc2NyaXB0Ij4KKHdpbmRvdy5fdHJhY2tlciA9ICh3aW5kb3cuX3RyYWNrZXIgfHwgW10pKS5wdXNoKHsKICBjYW1wYWlnbklkOiAnNTIyMGFlMTc0ODhlNTZjZTEwMDAwMDA4JywKICBjcmVhdGl2ZUlkOiAnNTIyMGFlMmE0ODhlNTZjZTEwMDAwMDA5JywKICBhY2NvdW50SWQ6ICc1MjBiNjZjYTc4ZWNjOGU4NzYwMDAwNDAnCn0pOwo8L3NjcmlwdD4KPHNjcmlwdCBzcmM9Imh0dHA6Ly9jZG4ub25zY3JvbGwuY29tL21zLm9zLmpzIj48L3NjcmlwdD4KPC9kaXY+CjwhLS0gRW5kIG9mIHRhZyAtIC0tPg==\x22;\x0AonScrOll.margin=550;\x0AonScrOll.mode=\x22sticky\x22;\x0AonScrOll.height=250;\x0AonScrOll.width=300;\x0AonScrOll.reload=false;\x0A<\/script>\x0A<script src=\x22http://cdn.onscroll.com/onscroll.ms.js\x22><\/script>\x0A<!-- End of tag - -->",locationId:3,positionId:2,locationDetail:"container_right",async:true,needsConsent:false,usesDocWrite:true,pageVars:{},dependencies:[]},14949223:{id:"14949223",name:"Initialise User Data",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<script type=\x22text/javascript\x22>\x0A  function initialiseUniversalVariableLayerWaiter() {\x0A    if (typeof initialiseUniversalVariableLayer === \x22function\x22) {\x0A      initialiseUniversalVariableLayer(location.protocol+\x27//\x27+location.hostname+\x22/get_user_info_with_query\x22, getDataLayer);\x0A    }\x0A    else if (typeof sendRequest === \x22function\x22) {\x0A      sendRequest(location.protocol+\x27//\x27+location.hostname+\x22/get_user_info_with_query\x22, getDataLayer);\x0A    }\x0A    else {\x0A      setTimeout(initialiseUniversalVariableLayerWaiter, 1000);\x0A    }\x0A  }\x0A\x0AinitialiseUniversalVariableLayerWaiter();\x0A<\/script>",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[2159302]},20183513:{id:"20183513",name:"otdm-homepage-slot-1",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<div id=\x22mobile_mpu_one\x22>\x0A	<script type=\x27text/javascript\x27>\x0A		googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_one\x27); });\x0A	<\/script>\x0A</div>",locationId:3,positionId:1,locationDetail:"otdm-homepage-slot-1",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},20183525:{id:"20183525",name:"otdm-listings-slot-5",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<div id=\x22mobile_mpu_one\x22>\x0A	<script type=\x27text/javascript\x27>\x0A		googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_one\x27); });\x0A	<\/script>\x0A</div>",locationId:3,positionId:1,locationDetail:"otdm-listings-slot-5",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},20183532:{id:"20183532",name:"otdm-listings-slot-after-pagination",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<div id=\x22mobile_mpu_two\x22>\x0A	<script type=\x27text/javascript\x27>\x0A		googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_two\x27); });\x0A	<\/script>\x0A</div>",locationId:3,positionId:1,locationDetail:"otdm-listings-slot-after-pagination",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},20183538:{id:"20183538",name:"otdm-article-above-comments",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<div id=\x22mobile_mpu_one\x22>\x0A	<script type=\x27text/javascript\x27>\x0A		googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_one\x27); });\x0A	<\/script>\x0A</div>",locationId:3,positionId:1,locationDetail:"otdm-article-above-comments",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},20183553:{id:"20183553",name:"otdm-article-body-multipage-2",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<div id=\x22mobile_mpu_two\x22>\x0A	<script type=\x27text/javascript\x27>\x0A		googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_two\x27); });\x0A	<\/script>\x0A</div>",locationId:3,positionId:1,locationDetail:"otdm-article-body-multipage-2",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},20183856:{id:"20183856",name:"otdm-article-body-multipage-3",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<div id=\x22mobile_mpu_three\x22>\x0A	<script type=\x27text/javascript\x27>\x0A		googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_three\x27); });\x0A	<\/script>\x0A</div>",locationId:3,positionId:1,locationDetail:"otdm-article-body-multipage-3",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},20183864:{id:"20183864",name:"otdm-top",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<div id=\x22mobile_banner_ad\x22>\x0A	<script type=\x27text/javascript\x27>\x0A		googletag.cmd.push(function() { googletag.display(\x27mobile_banner_ad\x27); });\x0A	<\/script>\x0A</div>",locationId:3,positionId:1,locationDetail:"otdm-top",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},23917958:{id:"23917958",name:"Quantcast",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<!-- Quantcast Tag -->\x0A<script type=\x22text/javascript\x22>\x0Avar _qevents = _qevents || [];\x0A\x0A(function() {\x0Avar elem = document.createElement(\x27script\x27);\x0Aelem.src = (document.location.protocol == \x22https:\x22 ? \x22https://secure\x22 : \x22http://edge\x22) + \x22.quantserve.com/quant.js\x22;\x0Aelem.async = true;\x0Aelem.type = \x22text/javascript\x22;\x0Avar scpt = document.getElementsByTagName(\x27script\x27)[0];\x0Ascpt.parentNode.insertBefore(elem, scpt);\x0A})();\x0A\x0A_qevents.push({\x0Aqacct:\x22p-b1ou2z6Xnkchs\x22\x0A});\x0A<\/script>\x0A\x0A<noscript>\x0A<div style=\x22display:none;\x22>\x0A<img src=\x22//pixel.quantserve.com/pixel/p-b1ou2z6Xnkchs.gif\x22 border=\x220\x22 height=\x221\x22 width=\x221\x22 alt=\x22Quantcast\x22/>\x0A</div>\x0A</noscript>\x0A<!-- End Quantcast tag -->",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:true,pageVars:{},dependencies:[]},34075545:{id:"34075545",name:"otdm-bottom",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<div id=\x22mobile_mpu_three\x22>\x0A	<script type=\x27text/javascript\x27>\x0A		googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_three\x27); });\x0A	<\/script>\x0A</div>",locationId:3,positionId:1,locationDetail:"otdm-bottom",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},34075553:{id:"34075553",name:"otdm-homepage-slot-3",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<div id=\x22mobile_mpu_two\x22>\x0A	<script type=\x27text/javascript\x27>\x0A		googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_two\x27); });\x0A	<\/script>\x0A</div>",locationId:3,positionId:1,locationDetail:"otdm-homepage-slot-3",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},34075563:{id:"34075563",name:"otdm-article-below-more-on",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<div id=\x22mobile_mpu_two\x22>\x0A	<script type=\x27text/javascript\x27>\x0A		googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_two\x27); });\x0A	<\/script>\x0A</div>",locationId:3,positionId:1,locationDetail:"otdm-article-below-more-on",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},43411039:{id:"43411039",name:"PwC Hub - Header Change",scriptTimeout:5000,disabled:true,dedupe:false,pre:"",url:"",post:"",html:"<script>\x0Aif (window.location.href.indexOf(\x222415256\x22)>=0) {\x0A	document.getElementById(\x22wrapper_header\x22).style.backgroundImage = \x27url(http://specs.incisivemedia.com/Marketing_Ads/Business/Business_Green/PwC_Hub/BGTPCS15-MH-1000x304-new-background.jpg)\x27;\x0A	var cake = document.getElementsByClassName(\x22header_left\x22)[0];\x0A	cake.getElementsByTagName(\x22img\x22)[1].src = \x22http://specs.incisivemedia.com/Marketing_Ads/Business/Business_Green/PwC_Hub/COP21-copy.png\x22;\x0A}\x0A<\/script>",locationId:1,positionId:2,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},44071964:{id:"44071964",name:"PWC Header Change (Article)",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<script>\x0A// start counter at 0\x0Avar counter = 0;\x0A// start function to determine if page is contains a \x22paris-summit\x22 tag, if so change header\x0Afunction headerChange() {\x0A	// if function hasn\x27t run 5 times already\x0A	if (counter<5) {\x0A		// if leaderboard div is populated (indicates if GPT Tags have run, which indicates if UV is available)\x0A		if (typeof document.getElementById(\x22otdm-gptad-leaderboard_top\x22) !== \x22undefined\x22 && document.getElementById(\x22otdm-gptad-leaderboard_top\x22).innerHTML !== \x22\x22) {\x0A			// if tag \x22paris-sumit\x22 exists\x0A			if (typeof universal_variable.content !== \x22undefined\x22 && typeof universal_variable.content.tag !== \x22undefined\x22 && universal_variable.content.tag.indexOf(\x22paris-summit\x22)>=0) {\x0A				// change background image which contains French Flag\x0A				document.getElementById(\x22wrapper_header\x22).style.backgroundImage = \x27url(http://specs.incisivemedia.com/Marketing_Ads/Business/Business_Green/PwC_Hub/BGTPCS15-MH-1000x304-new-background.jpg)\x27;\x0A				var cake = document.getElementsByClassName(\x22header_left\x22)[0];\x0A				// change caption underneath Business Green Logo to \x22COP21 The Road to Paris 2015\x22\x0A				cake.getElementsByTagName(\x22img\x22)[1].src = \x22http://specs.incisivemedia.com/Marketing_Ads/Business/Business_Green/PwC_Hub/COP21-copy.png\x22;\x0A				console.log(\x22headerChange: Successful\x22);\x0A			}\x0A		}\x0A		else {\x0A			// if leaderboard div isn\x27t populated, assume UV isn\x27t available and re-run function\x0A			counter++;\x0A			setTimeout(function(){headerChange()}, 1000);\x0A		}\x0A	}\x0A	else {\x0A		// function unsuccessful after 5 runs\x0A		console.log(\x22headerChange: Timeout\x22);\x0A	}\x0A}\x0A// timeout to allow for load of GPT tags\x0AsetTimeout(function(){headerChange()}, 2000);\x0A<\/script>",locationId:2,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[14949223]},52019191:{id:"52019191",name:"CSS Overlay",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<style>\x0A  #advertWrapper {\x0A    width: 100%;\x0A    height: 100%;\x0A    left: 0px;\x0A    top: 0px;\x0A    position: absolute;\x0A    z-index: 20000;\x0A    text-align: center;\x0A    /* background-color: rgba(0,0,0,0.6); */\x0A    display: none;\x0A  }\x0A  #advertOverlay {\x0A    position:relative; \x0A    top:0px; \x0A    width:600px; \x0A    height:600px; \x0A    margin:10% auto; \x0A    font-family:Arial, Helvetica, sans-serif;\x0A    color:#ffffff; \x0A    cursor:pointer;\x0A  }\x0A  .closeButton {\x0A    position:absolute;\x0A    right:3px;\x0A    top:5px;\x0A    display: none;\x0A  }\x0A</style>",locationId:1,positionId:1,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},55540270:{id:"55540270",name:"Mobile Ads Slots",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<script type=\x22text/javascript\x22>\x0Agoogletag.cmd.push(function() {\x0A//Adslot 1 declaration (Banner ad)\x0Agptadslots[1]= googletag.defineSlot(\x27/4818/m.businessgreen.com/home\x27, [[300,50],[320,50],[468,60],[728,90]],\x27mobile_banner_ad\x27).setTargeting(\x27pos\x27,[\x27bottom\x27]).addService(googletag.pubads()).setCollapseEmptyDiv(true);\x0A//Adslot 2 declaration (MPU ad one)\x0Agptadslots[2]= googletag.defineSlot(\x27/4818/m.businessgreen.com/home\x27, [[300,250],[300,600]],\x27mobile_mpu_one\x27).setTargeting(\x27pos\x27,[\x27mpu-one\x27]).addService(googletag.pubads()).setCollapseEmptyDiv(true);\x0A//Adslot 3 declaration (MPU ad two)\x0Agptadslots[3]= googletag.defineSlot(\x27/4818/m.businessgreen.com/home\x27, [[300,250],[300,600]],\x27mobile_mpu_two\x27).setTargeting(\x27pos\x27,[\x27mpu-two\x27]).addService(googletag.pubads()).setCollapseEmptyDiv(true);\x0A//Adslot 4 declaration (MPU ad three)\x0Agptadslots[4]= googletag.defineSlot(\x27/4818/m.businessgreen.com/home\x27, [[300,250],[300,600],[2,1]],\x27mobile_mpu_three\x27).setTargeting(\x27pos\x27,[\x27mpu_three\x27]).addService(googletag.pubads()).setCollapseEmptyDiv(true);\x0Agoogletag.pubads().enableAsyncRendering();\x0Agoogletag.enableServices();\x0A});\x0A<\/script>",locationId:1,positionId:2,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]},55540856:{id:"55540856",name:"Show Mobile ads",scriptTimeout:5000,disabled:false,dedupe:false,pre:"",url:"",post:"",html:"<script type=\x22text/javascript\x22>\x0A    function injectAdsMobile() {\x0A    if (window.googletag && googletag.apiReady) {\x0A        googletag.cmd.push(function() { googletag.display(\x27mobile_banner_ad\x27); });\x0A      	googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_two\x27); });\x0A      //article above comment\x0A      googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_one\x27); });\x0A      //article below more on\x0A      googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_two\x27); });      \x0A      //otdm bottom\x0A      googletag.cmd.push(function() { googletag.display(\x27mobile_mpu_three\x27); });\x0A      \x0A        consoleLog(\x27Google Tag Publisher Ready!\x27);\x0A    } else {\x0A        consoleLog(\x27Google Tag Publisher not Ready!\x27);\x0A        setTimeout(function() {\x0A            injectAdsMobile();\x0A        }, 100);\x0A    }\x0A      \x0A};\x0AinjectAdsMobile();\x0A<\/script>",locationId:2,positionId:2,locationDetail:"",async:true,needsConsent:false,usesDocWrite:false,pageVars:{},dependencies:[]}};
var tellLoadTimesProbability=1;var pingServerUrl="pong.qubitproducts.com";var qtag_domain=".businessgreen.com";var delayDocWrite=true;var maxCookieLength=3000;var mainConfig={};try{mainConfig.filters=filters}catch(e){}try{mainConfig.pageVars=pageVars}catch(e){}try{mainConfig.scriptLoaders=scriptLoaders}catch(e){}try{mainConfig.delayDocWrite=delayDocWrite}catch(e){}try{mainConfig.qTagClientId=qTagClientId}catch(e){}try{mainConfig.containerName=containerName}catch(e){}try{mainConfig.profileName=profileName}catch(e){}try{mainConfig.tellLoadTimesProbability=tellLoadTimesProbability}catch(e){}try{mainConfig.containerDisabled=containerDisabled}catch(e){}try{mainConfig.maxCookieLength=maxCookieLength}catch(e){}try{mainConfig.pingServerUrl=pingServerUrl}catch(e){}try{mainConfig.qtag_track_session=qtag_track_session}catch(e){}try{mainConfig.qtag_domain=qtag_domain}catch(e){}try{mainConfig.scriptURL=scriptURL}catch(e){}var Cookie=qubit.Cookie;function requestedDebugMode(){var isDebug=false;if(Cookie.get("opentag_debug")||document.location.href.indexOf("opentag_debug")>=0){isDebug=true}return isDebug}function requestedDebugTool(){var isDebug=false;if(Cookie.get("opentag_debug_tool")||document.location.href.indexOf("opentag_debug_tool")>=0){isDebug=true}return isDebug}function disabled(){if(document.location.href.indexOf("opentag_disabled=true")>=0){return true}return false}var started=false;function old(mainConfig){if(disabled()){return}if(started){return}started=true;var selfDebug=false;var otRef=qubit.opentag;var debugToolRequested=requestedDebugTool();var debugRequested=debugToolRequested||requestedDebugMode();if(!selfDebug&&debugRequested){var debugScript=document.createElement("script");var url;if(mainConfig.scriptURL){url=mainConfig.scriptURL;var dLen="-debug.js".length;if(url.lastIndexOf("-debug.js")!==url.length-dLen){url=url.substring(0,url.length-".js".length);url+="-debug.js"}}var urlCDN="//d3c3cq33003psk.cloudfront.net/opentag-"+mainConfig.qTagClientId+"-"+mainConfig.profileName+"-debug.js";if(url&&urlCDN!==url){debugScript.src=url}else{debugScript.src="//s3-eu-west-1.amazonaws.com/opentag/opentag-"+mainConfig.qTagClientId+"-"+mainConfig.profileName+"-debug.js"}if(!otRef.Log){GLOBAL.TAGSDK_NS_OVERRIDE=true}else{GLOBAL.TAGSDK_NS_OVERRIDE=false}document.getElementsByTagName("head")[0].appendChild(debugScript);return}if(otRef.Log){GLOBAL.TAGSDK_NS_OVERRIDE=false}new qubit.opentag.OldTagRunner(mainConfig).run()}try{q.html.UVListener.init()}catch(uvInitFalure){}old(mainConfig)})()}())}catch(e){try{console.log(e)}catch(ex){}};