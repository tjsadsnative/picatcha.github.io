if(/firefox/i.test(navigator.userAgent)){var nativeGetComputedStyle=window.getComputedStyle,defaults={width:0,height:0};window.getComputedStyle=function(b,c){var a=nativeGetComputedStyle(b,c);return null===a?{getPropertyValue:function(a){return defaults[a]}}:a}};
;
(function(){if(!window.google||!google.gears){var d=null;if("undefined"!=typeof GearsFactory)d=new GearsFactory;else try{d=new ActiveXObject("Gears.Factory"),-1!=d.getBuildInfo().indexOf("ie_mobile")&&d.privateSetGlobalObject(this)}catch(e){"undefined"!=typeof navigator.mimeTypes&&navigator.mimeTypes["application/x-googlegears"]&&(d=document.createElement("object"),d.style.display="none",d.width=0,d.height=0,d.type="application/x-googlegears",document.documentElement.appendChild(d))}d&&(window.google||
(google={}),google.gears||(google.gears={factory:d}))}})();
Persist=function(){var d,e,c,l,q,n;n=function(){var a=["expires","path","domain"],b=escape,f=unescape,d=document,c,e=function(s,f){var d,p,c=[],e=2<arguments.length?arguments[2]:{};c.push(b(s)+"="+b(f));for(var g=0;g<a.length;g++)d=a[g],(p=e[d])&&c.push(d+"="+p);e.secure&&c.push("secure");return c.join("; ")};c={set:function(a,b){var f=2<arguments.length?arguments[2]:{},c=new Date;c.setTime(c.getTime());var k={};if(f.expires)if(-1==f.expires)k.expires=-1;else{var m=864E5*f.expires;k.expires=new Date(c.getTime()+
m);k.expires=k.expires.toGMTString()}c=["path","domain","secure"];for(m=0;m<c.length;m++)f[c[m]]&&(k[c[m]]=f[c[m]]);f=e(a,b,k);d.cookie=f;return b},has:function(a){a=b(a);var f=d.cookie,c=f.indexOf(a+"="),f=f.substring(0,a.length);return!c&&a!=f||0>c?!1:!0},get:function(a){a=b(a);var c=d.cookie,e=c.indexOf(a+"="),p=e+a.length+1,k=c.substring(0,a.length);if(!e&&a!=k||0>e)return null;a=c.indexOf(";",p);0>a&&(a=c.length);return f(c.substring(p,a))},remove:function(a){var b=c.get(a);d.cookie=e(a,"",{expires:"Thu, 01-Jan-1970 00:00:01 GMT"});
return b},keys:function(){for(var a=d.cookie.split("; "),b,c=[],e=0;e<a.length;e++)b=a[e].split("="),c.push(f(b[0]));return c},all:function(){for(var a=d.cookie.split("; "),b,c=[],e=0;e<a.length;e++)b=a[e].split("="),c.push([f(b[0]),f(b[1])]);return c},version:"0.2.1",enabled:!1};c.enabled=function(){var a=new Date,a=a.toGMTString();this.set("__EC_TEST__",a);return this.enabled=this.remove("__EC_TEST__")==a}.call(c);return c}();var t=function(){return Array.prototype.indexOf?function(a,b){return Array.prototype.indexOf.call(a,
b)}:function(a,b){for(var c=0,d=a.length;c<d;c++)if(a[c]==b)return c;return-1}}();q=function(){};c=function(a){return"PS"+a.replace(/_/g,"__").replace(/ /g,"_s")};var h="localstorage globalstorage gears cookie ie flash".split(" "),u=/^[a-z][a-z0-9_ \-]+$/i,r="init get set remove load save iterate".split(" "),v={autostart:!0};e={gears:{size:-1,test:function(){return window.google&&window.google.gears?!0:!1},methods:{init:function(){var a;a=this.db=google.gears.factory.create("beta.database");a.open(c(this.name));
a.execute("CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)").close()},get:function(a){var b=this.db,c;b.execute("BEGIN").close();a=b.execute("SELECT v FROM persist_data WHERE k = ?",[a]);c=a.isValidRow()?a.field(0):null;a.close();b.execute("COMMIT").close();return c},set:function(a,b){var c=this.db;c.execute("BEGIN").close();c.execute("DELETE FROM persist_data WHERE k = ?",[a]).close();c.execute("INSERT INTO persist_data(k, v) VALUES (?, ?)",[a,b]).close();
c.execute("COMMIT").close();return b},remove:function(a){var b=this.db;b.execute("BEGIN").close();b.execute("DELETE FROM persist_data WHERE k = ?",[a]).close();b.execute("COMMIT").close();return!0},iterate:function(a,b){var c;for(c=this.db.execute("SELECT * FROM persist_data");c.isValidRow();)a.call(b||this,c.field(0),c.field(1)),c.next();c.close()}}},globalstorage:{size:5242880,test:function(){return window.globalStorage?!0:!1},methods:{key:function(a){return c(this.name)+c(a)},init:function(){this.store=
globalStorage[this.o.domain]},get:function(a){a=this.key(a);return this.store.getItem(a)},set:function(a,b){a=this.key(a);this.store.setItem(a,b);return b},remove:function(a){var b;a=this.key(a);b=this.store.getItem[a];this.store.removeItem(a);return b}}},localstorage:{size:-1,test:function(){try{if(window.localStorage&&void 0==window.localStorage.setItem("test",null))if(/Firefox[\/\s](\d+\.\d+)/.test(navigator.userAgent)){if(9<=RegExp.$1)return!0;if("file:"==window.location.protocol)return!1}else return!0;
else return!1;return window.localStorage?!0:!1}catch(a){return!1}},methods:{key:function(a){return this.name+">"+a},init:function(){this.store=localStorage},get:function(a){a=this.key(a);return this.store.getItem(a)},set:function(a,b){a=this.key(a);this.store.setItem(a,b);return b},remove:function(a){var b;a=this.key(a);b=this.store.getItem(a);this.store.removeItem(a);return b},iterate:function(a,b){for(var c=this.store,d,e,h=0;h<c.length;h++)d=c.key(h),e=d.split(">"),2==e.length&&e[0]==this.name&&
a.call(b||this,e[1],c.getItem(d))}}},ie:{prefix:"_persist_data-",size:65536,test:function(){return window.ActiveXObject?!0:!1},make_userdata:function(a){var b=document.createElement("div");b.id=a;b.style.display="none";b.addBehavior("#default#userdata");document.body.appendChild(b);return b},methods:{init:function(){var a=e.ie.prefix+c(this.name);this.el=e.ie.make_userdata(a);this.o.defer&&this.load()},get:function(a){a=c(a);this.o.defer||this.load();return this.el.getAttribute(a)},set:function(a,
b){a=c(a);this.el.setAttribute(a,b);this.o.defer||this.save();return b},remove:function(a){var b;a=c(a);this.o.defer||this.load();b=this.el.getAttribute(a);this.el.removeAttribute(a);this.o.defer||this.save();return b},load:function(){this.el.load(c(this.name))},save:function(){this.el.save(c(this.name))}}},cookie:{delim:":",size:4E3,test:function(){return d.Cookie.enabled?!0:!1},methods:{key:function(a){return this.name+e.cookie.delim+a},get:function(a,b){a=this.key(a);return n.get(a)},set:function(a,
b,c){a=this.key(a);n.set(a,b,this.o);return b},remove:function(a,b){a=this.key(a);return b=n.remove(a)}}},flash:{test:function(){try{if(!window.swfobject)return!1}catch(a){return!1}return 8<=swfobject.getFlashPlayerVersion().major?!0:!1},methods:{init:function(){if(!e.flash.el){var a,b;a=document.createElement("div");a.id="_persist_flash_wrap";b=document.createElement("div");b.id="_persist_flash";a.appendChild(b);document.body.appendChild(a);e.flash.el=swfobject.createSWF({id:"_persist_flash",data:this.o.swf_path||
"persist.swf",width:1,height:1},v,"_persist_flash")}this.el=e.flash.el},get:function(a){a=c(a);return this.el.get(this.name,a)},set:function(a,b){a=c(a);return this.el.set(this.name,a,b)},remove:function(a){a=c(a);return this.el.remove(this.name,a)}}}};l=function(){var a,b,c=h;a=0;for(var g=r.length;a<g;a++)d.Store.prototype[r[a]]=q;d.type=null;d.size=-1;for(var g=0,l=c.length;!d.type&&g<l;g++)if(a=e[c[g]],a.test())for(b in d.type=c[g],d.size=a.size,a.methods)d.Store.prototype[b]=a.methods[b];d._init=
!0};d={VERSION:"0.3.1",type:null,size:0,add:function(a){e[a.id]=a;h=[a.id].concat(h);l()},remove:function(a){var b=t(h,a);0>b||(h.splice(b,1),delete e[a],l())},Cookie:n,Store:function(a,b){if(!u.exec(a))throw Error("Invalid name");if(!d.type)throw Error("No suitable storage found");b=b||{};this.name=a;b.domain=b.domain||location.hostname||"localhost";b.domain=b.domain.replace(/:\d+$/,"");b.domain="localhost"==b.domain?"":b.domain;this.o=b;b.expires=b.expires||730;b.path=b.path||"/";this.o.search_order&&
(h=this.o.search_order,l());this.init()}};l();return d}();
;
(function(){function k(a,b,f,g){var e=this,d=randHash(16),c={action:"get",hash:d,name:a};a=document.createElement("a");a.href=b.src;var l=a.protocol+"//"+a.hostname;$w.on("message."+d,function(a){a=a.originalEvent;var h;try{h=JSON.parse(a.data)}catch(k){return}if(h.hash===d){$w.off("message."+d);c.action="set";var m=[];e.iterate(function(a,b){m.push({k:a,v:b})});c.data=_.isFunction(f)?f(h.data||[],m):[];b.contentWindow.postMessage(JSON.stringify(c),l);_.forEach(c.data,function(a,b){e.set(b,a)});_.isFunction(g)&&
g()}});b.contentWindow.postMessage(JSON.stringify(c),l)}var b={};window.Persist.Store.prototype.sync=function(a,n,f){var g=this,e;b[a]||(e="www"===a?"//"+(FTB.IS_LOCAL?"www.dw.com":"www.graphiq.com")+"/lstore_sync?app_id="+FTB.app_id:"//"+a+"."+FTB.DOMAIN+"/lstore_sync?app_id="+FTB.app_id,b[a]={queue:[],$iframe:$('<iframe src="'+e+'" style="display: none"></iframe>').on("load",function(){var d=function(c){k.apply(g,[c.name,b[a].$iframe.get(0),c.callback,c.done])};_.forEach(b[a].queue,d);b[a].queue.push=
d}).appendTo("body")});b[a].queue.push({name:this.name,callback:n,done:f})}})();
;
(function(l){if(!FTB.ABTest){var d=persist("ABTest",{expires:-1}),g={},n={},p=!1;"localstorage"!==window.Persist.type&&(d=persist.mocked,p=!0);var f=function(b){var a={},f=function(a){for(var e=0,d=0,b;b=a[d];++d){if(b.weight===l)throw"Weight must be defined for each AB Test";e+=b.weight}return $.map(a,function(a){return{percent:a.weight/e,label:a.label}})},m,k=function(c){var e;m===l&&(m=!1,e=GET().testbucket)&&(e=e.split(":"),e[0]===a.p.id&&(m=e[1]));e=m;c=e||c;if(!0===c){a:{c=f(a.p.tests);e=Math.random();
for(var b=0,h=0,k=c.length;h<k;h++){if(e>b&&e<c[h].percent+b){c=c[h].label;break a}b+=c[h].percent}c=void 0}return c?(a.tag=c,d.set(a.p.id,a.tag),g[a.p.id]=a.tag):l}if(c===l)return d.get(a.p.id)||a.tag;a.tag=c;d.set(a.p.id,a.tag);g[a.p.id]=a.tag;return c};(function(){if(!b.id)throw"test id must be defined for AB Test";a.p=$.extend({},b);var c=k();c||(c=k(!0));a.tag=c;g[a.p.id]=a.tag;n[a.p.id]=a})();return{tag:k,log:function(c,b){var d={action:c,time_on_page:time_on_site(),desc:a.p.id+":"+a.tag};if(a.p.pass&&
-1===$.inArray(c,a.p.pass))return!1;$.extend(!0,d,b);if(("true"===GET().debug||a.p.debug)&&FTB.IS_EMPLOYEE)console.log("The following data will be sent to Kibana:",d);else{if(p)return!1;FTB.Analytics.send_data("ab_test",d)}return!0},reset:function(){d.remove(a.p.id);delete g[a.p.id];delete a.tag}}};f.active_tags=function(){return g};f.all_tags=function(){var b={};if(!_.isFunction(d.iterate))return b;d.iterate(function(a){"__time"!==a&&(b[a]=d.get(a))});return b};f.all_tests=function(){return _.map(n,
function(b,a){return{id:a,tags:_.pluck(b.p.tests,"label"),active:g[a]}})};f.clear_all=function(){var b=[];d.iterate(function(a){b.push(a)});_.forEach(b,function(a){d.remove(a)})};(d.get("__time")||!1)<_.now()/1E3-1800&&f.clear_all();d.set("__time",_.now()/1E3>>0);FTB.module("FTB.ABTest",f)}})();
;
(function(g,k,q){function n(){function a(a,c,d){EVT([b,a,c||"",0,d||!1]);(g.widget_log||$.noop)(b,a,c,d)}var b,d,c;FTB.widget_error&&FTB.widget_id&&FTB.utils.postMessage({method:"remove",wid:k.location.href},"*");if(b=p[FTB.widget_type]){c=!FTB.dynamic_widget&&-1<["SRP","Versus"].indexOf(b);var e,m=$(".ww-embed-this"),l=!1;FTB.widget_id||m.length&&m.hide();$(k).one("mouseover",function(){a("Impression + Hover");d=_.now()}).on("click",".ww-footer-link-a",function(){a("Click to "+f(this),"Click Footer (See More)")}).on("click",
".powered-link",function(){a("Click FTB Logo")}).on("click",".ww-title-link",function(){a("Click to "+f(this),"Click Widget Title")}).on("click",".ss-more-details",function(){a("Click to "+f(this),"Click More Details")}).on("click",".ss-img-link, .det-img-a, .vs-img-a",function(){a("Click to "+f(this),"Click Image")}).on("click",".ss-mini-nav",function(){a("Scroll "+($(this).hasClass("ss-go-left")?"Left":"Right"))}).on("click",".ss-box",function(){a("Click Thumbnail")}).on("click",".vs-view-full",
function(){a("Click to "+f(this),"Click View Full Comparison")}).on("click","a.vs-title, .srp-widget .widget_row_link",function(){a("Click to "+f(this),"Click Listing Title")}).on("click",".wctr-field-clickable .ss-fields, .wctr-field-clickable .ww-datapoints-td, .wctr-field-clickable .vs-val",function(b){var c=$(".vs-view-full").attr("href")||$(".ww-title-link").attr("href");!$(b.target).closest("a,.link").length&&c&&(a("Click to "+f(this),"Click Fields"),g.open(c))}).on("mouseover",".wctr-field-clickable .vs-val",
function(){$(".vs-val").removeClass("vs-highlight");$(".vs-row").find(".vs-val:eq("+$(this).parent().children(".vs-val").index(this)+")").addClass("vs-highlight")}).on("click",".dsrc-sources",function(){a("Click on data sources")}).on("click",".ww-embed-this",function(){if($(".mask-menu").length)!l&&$(".mask-menu-x").siblings().remove();else e=g.MaskMenu($(".widget"));l||(g.WidgetShare(e.get(),{has_widget_img:c,widget_id:FTB.widget_id,custom_attrs:FTB.widget.custom_attrs}),l=!0);a("Inception Embed");
e.open()}).on("click",".tab-nav",function(){a("Click on Tab")});$.subscribe("affiliate/render",function(){a("Click See Prices")});$.subscribe("srpwidget/sort",function(){a("Sort")});$.subscribe("srpwidget/clickrow",function(){a("Click to DD","Click Listing Row")});var h=[5,10,30,60,300];$d.on("mousemove.widg click.widg",_.throttle(function(){h.length&&_.now()-d>1E3*h[0]&&(a(h.shift()+"s interaction"),h.length||$d.off("mousemove.widg click.widg"))},200));gatekeeper("WLP enable all widgets")&&FTB.backlink_for_test&&
"wlp-page"===FTB.ABTest({id:"wlp-backlink-test",tests:[{label:"nochange",weight:50},{label:"wlp-page",weight:50}]}).tag()&&($(".ww-title-link").attr("href",FTB.backlink_for_test),$(".ww-footer-link-a").attr("href",FTB.backlink_for_test));a("PageView","",!0)}}function f(a){var b=k.createElement("a"),d="SRP";if(!a)return d;_.isString(a)||(a=$(a),a=a.attr("href")||a.data("href"));b.href=a;b.href=b.href;/\/l\//.test(b.pathname)?d="DD":/\/compare\//.test(b.pathname)?d="SxS":/\/wlp\//.test(b.pathname)&&
(d="WLP");return d}var p={srp:"SRP",detail:"DD",ss:"SS",vs:"Versus",viz:"Viz",group:"Group",card:"Card"};g.MaskMenu=function(a,b){b=$.extend({},{html:"",initOpen:0},b);var d=a.jquery?a:$(a),c=$('<div class="mask-menu"/>').html(b.html),e={$:c,open:function(){c.show()},close:function(){c.hide()},get:function(){return c}};c.prepend('<div class="mask-menu-x">&times;</div>').appendTo(d).showIf(b.initOpen).on("click",".mask-menu-x",e.close);return e};$d.on("click",".shr-button",function(){var a=$(this).data("share-type");
a&&(EVT(["Share Overlay","Click "+a,"",0,!1]),(g.widget_log||$.noop)("Share Overlay","Click "+a))});$(function(){n();var a=$(".widget").outerWidth(),b=$(".ww-powered-by").outerWidth(),d=$(".ww-footer-link-a"),c=d.outerWidth(),e=parseInt($(".ww-footer-link").css("padding-left"),10);c+b>a&&(c=d.find(".ww-footer-link-reg").text(),c=c.substring(0,c.length-1),d.css("max-width",a-b-e).attr("title",c))})})(window,document);
;
(function(){function g(d,a,b,f,k){var g=d.split("#")[1];k=k||randHash(6);var e=d;g||("twitter"===a&&"/"!==e.slice(-1)&&(e+="/"),e+="facebook"===a||"twitter"===a?"#":encodeURIComponent("#"));e+="facebook"===a||"twitter"===a?"&":encodeURIComponent("&");e+="st="+k;p("hash_generated",d,a,b,f,k);return e}function p(d,a,b,f,k,g){FTB.Analytics.send_data("social",{action:d,hash:g,channel:b,shared_url:a,source:f.source||FTB.page_type,title:f.title||document.title,body:k||"",img_link:f.img_link||""})}window.miniShare=
function(d,a){d=d.jquery?d:$(d);a=a||{};if(d[0]){var b=window.location.pathname,f=a.url||"http://"+window.location.host.replace(".dw.com",".graphiq.com")+("/"!==b?b:""),k=a.title||document.title,q=a.img_link||"",e=encodeURIComponent(k),b=tt("[network_name] - a Graphiq site",[FTB.net_name]),b=-1!==FTB.net_name.search("FindTheBest")?"Graphiq":b,c="";switch(FTB.page_type){case "detail":c=tt("I'm researching [detail_title] on [site_name]. Thoughts?",[window.detail.title,b]);break;case "comp":var r=_.pluck(window.compare.items,
"title").join(" vs. "),c=tt("I'm comparing [comparison] on [site_name]. Thoughts?",[r,b]);break;case "editorial":c=tt("Reading an article about [topic_plural] on [site_name]. Check it out: ",[FTB.app_plural,b]);break;case "wlp":c=tt("I'm looking at [widget_title] on [site_name]. Check it out: ",[window.wlp.title,b]);break;case "widget":c="I thought you might be interested in this info from "+FTB.net_name+": "+f;break;default:c=tt("I'm researching [topic_plural] on [site_name]. Thoughts?",[FTB.app_plural,
b])}a.body&&(c=a.body);d.off("click",".shr-button");d.on("click",".shr-button",function(){var b,d=$(this),m=d.attr("class").split(" "),h=1<m.length?m[1].substr(4):"",l=a.incl_hash?f+window.location.hash:f,m=!0;switch(h){case "facebook":var n=randHash(6);a.facebook&&(c=a.body=a.facebook);if(!_.isFunction(window.load_fb_js)){b="https://www.facebook.com/sharer/sharer.php?s=100&p[url]="+g(l,h,a,a.body||"",n)+"&p[images][0]="+q+"&p[title]="+k+"&p[summary]="+c;break}load_fb_js(function(){FB.ui({method:"feed",
name:k,link:g(l,h,a,a.body||"",n),picture:q,caption:"",description:a.body||""},function(b){if(b&&b.post_id){b=b.post_id.split("_");var c="";b[0]&&b[1]&&(c='<a target="_blank" href="http://www.facebook.com/permalink.php?id='+b[0]+"&v=wall&story_fbid="+b[1]+'">View</a>');MSG("Posted to Facebook successfully. "+c,"green");p("facebook_shared",l,h,a,a.body||"",n)}else p("facebook_canceled",l,h,a,a.body||"",n)})});break;case "twitter":/[^\/]#/.test(l)&&(l=l.replace("#","/#"));a.twitter&&(c=a.twitter);b=
"https://twitter.com/share?&text="+(FTB.IS_WIDGET?e:encodeURIComponent(c))+"&via=GraphiqHQ&url="+encodeURIComponent(g(l,h,a,c));break;case "googleplus":b="https://plus.google.com/share?url="+encodeURIComponent(g(l,h,a,c))+"&t="+encodeURIComponent(e);break;case "email":gatekeeper("ShareViaEmail")?481>window.innerWidth?b="mailto:?subject="+e+"&body="+encodeURIComponent(c+" ")+g(f,h,a,c):(FTB.spin(),FTB.lazy("ShareViaEmail").done(function(){FTB.EmailBox.create({body:c,preview:{url:g(f,h,a,c)},clicked_index:$(".shr-email").index(d)})})):
(m=!1,b="mailto:?subject="+e+"&body="+encodeURIComponent(c+" ")+g(f,h,a,c))}EVT(["Social Buttons",h,a.source||FTB.page_type,0,!1]);b&&(m?window.open(b,"shareWindow","status = 1, height = 500, width = 360, resizable = 0"):window.location=b)});FTB.EmailBox={share:function(a){$(".shr-email").get(a.clicked_index).click()}}}}})();
;
(function(b){var e=gatekeeper("disable widget kibana events"),c;b.widget_log=function(a,b,f,d){e||(a={eventCategory:a,eventAction:b,eventLabel:f||"",nonInteraction:d||!1},FTB.widget_rendered_component&&(a.widget_rendered_component=FTB.widget_rendered_component),FTB.IS_DEVELOPER&&GET().debug?console.log("Widget Kibana Events:",a):FTB.Analytics.send_data("widgets",a),c||d||(c=!0,$.publish("widget/first_interaction")))}})(window);
;
(function(){function k(a){FTB.geo=_.merge({},a,FTB.geo)}var m=Class.extend({init:function(a){this.fromJSON(a);this.vizWidth=this.options.viz_width||60;this.noLinks=this.options.no_links;this.configKey=this.options.config_key;this.isIframe=this.options.is_iframe;this.target=(this.isEmbedded=this.options.is_embedded)?"_blank":"_parent";this.srp_data&&(_.bindAll(this,"renderResults"),this.app=this.getApp(),this.app.on("update",this.renderResults));_.bindAll(this,"applyHeight");return this},render:function(a){this.el=
a;this.$el=$(a);this.$=_.bind(this.$el.find,this.$el);this.$main=this.$("."+this.mainClass);this.applyHeight();this.$el.data("__widgetInstance",this);this.bindEvents()},renderViz:function(){viz.render(this.vizWidth,this.$el)},isLoaded:function(){return!this.options.lazyload||this.lazyDef&&"resolved"===this.lazyDef.state()},lazyLoad:function(){var a=this.options.lazyload;if(!a)return!0;if(!this.lazyDef){var a=a.join+"-"+a.item,b;if(!(b=f[a])){b=f;var c=$.Deferred();e.push({deferred:c,key:a});g();b=
b[a]=c}this.lazyDef=b.done(this.app.update)}return this.lazyDef},bindEvents:function(){var a=this;a.$el.on("click","a.reset",function(b){a.resetFilters();cancelEvent(b)})},fromJSON:function(a){$.extend(this,_.pick(a,"options","srp_data","widgetId"));this.srp_data&&$.extend(this,_.pick(this.srp_data,"app_id","base_url"))},getApp:function(){return this.app||new window.App(this.srp_data)},getHeight:function(){if(this._height)return this._height;var a=this.options.h,b=this.options.minHeight||this.minHeight||
0,a="auto"===a?this.defaultHeight||b:Math.max(b,+a||0);this.isIframe&&(a-=this.headerHeight=this.$(".ww-header").outerHeight()||0,a-=this.footerHeight=this.$(".ww-footer").outerHeight()||0,a-=parseInt(this.$el.css("paddingTop"),0)||0,a-=parseInt(this.$el.css("paddingBottom"),0)||0,(this.isFilteringEnabled||$.noop).call(this)&&(b=this.$(".ww-filters-wrap"),b.length&&a&&(a-=b.outerHeight())));a-=parseInt(this.$main.css("paddingTop"),0)||0;return this._height=a-=parseInt(this.$main.css("paddingBottom"),
0)||0},applyHeight:function(){this.shouldPublishHeight()?l(this.$el):"auto"!==this.options.h&&this.$main.height(this.getHeight())},shouldPublishHeight:function(){return!1},resize:function(){this._height=null},trackSponsors:function(){window.track_sponsor_links(this.$el.find(".sponsor_button"))},fitImage:function(a,b,c){b=Math.max(a.w/b,a.h/c);return{w:Math.round(a.w/b),h:Math.round(a.h/b)}},remove:function(a){a=a||this.$el;a=a.closest(".component");var b=(window.detail||{}).remove_component;a.length&&
b&&b(a);this.destroy();return this},destroy:function(){this.off();$.contains(document.documentElement,this.$el[0])&&this.$el.remove()},renderNoResults:function(a){(a||this.$main).html('<div class="no-results-placeholder"/><div class="no-results"><h1 class="no-results-header">No Results</h1><p class="no-results-body">Try <a class="link reset">resetting filters</a>'+(this.noLinks?"":' or <a href="'+this.base_url+'" target="_blank" class="link base-url">refining your search</a>.</p>')+"</div>");this.trigger("renderResults")},
set:function(a,b){var c=this,d;"object"===typeof a?d=a:(d={})[a]=b;_.each(d,function(a,b){c[b]!==a&&(c[b]=a,c.trigger("change:"+b))})}}).mixin(_.Events).statics({renderIn:function(a,b){var c=a.getWidgetInstance();if(c)return c;if(window.widgets){var c=a.data("id"),d=$.extend({},window.widgets[c],{widgetId:c});if(!c)throw"Widget information not found";c=new this(d);c.render(a,b||$.noop);return c}}}),e=[],g,f={};g=_.debounce(function(){var a=e.slice(0),b={batches:_.pluck(a,"key").join(","),shapeKeys:Object.keys(FTB.geo||
{})};$.getJSON("/ajax_lazy",b).always(function(b){k(b._geo||[]);_.each(a,function(a){var h=b[a.key];a.deferred[h?"resolve":"reject"](h)})});e=[]},20);var l=_.throttle(function(a){a=a[0].scrollHeight||a.height();FTB.utils.postMessage({method:"resize",height:Math.max(a,200),_wid:FTB.widget_id,wid:document.location.href},"*")},50);FTB.module("FTB.widget.Base",m);FTB.widget.getById=function(a){return $('.ftb-widget[data-id="'+a+'"]').getWidgetInstance()};FTB.widget.renderMeAWidgetIn=function(a,b,c){c=
c||{};var d=$.Deferred();FTB.fetch({url:"/ajax/widget/render_me_a_widget",data:$.extend({},{w:a.width()},b)}).done(function(b){try{if(b.data.html){a.html(b.data.html);var e=a.children(".ftb-widget").addClass("lazy-loaded");e.length?d.resolve(e.trigger("render").getWidgetInstance()):d.reject(b.data)}else c.empty_fallback?c.empty_fallback():(a.html($('<div class="lazy-widget-placehoder align-center">No content</div>').css("height",a.height())),d.reject(b.data))}catch(f){d.reject(b.data)}}).fail(d.reject);
return d};$.fn.getWidgetInstance=function(){var a=this.eq(0);return a?a.data("__widgetInstance"):void 0}})();
;
FTB.module("FTB.widget.filterable",{initFilters:function(){var a=this.isFilteringEnabled();a&&(this.$(".wwf-spin").spin({size:5}),this.renderFilters(this.$(".ww-filters-wrap")));this.$(".widget-filter").showIf(a);this.open_dropdowns=0;return a},isFilteringEnabled:function(){return!(!_.size(this.options.filter_specs)||!FTB.filters)},renderFilters:function(a){this.$filterWrap=a;var b,c=this.options.filter_specs||{},d=c.specs||[],f=c.statics||[],g=a.find(".wwf-groups");for(a=0;a<d.length;a++)b="w_"+
_.uniqueId()+"_fltr_"+a,g.append('<div class="single-filter-wrap ww-filt-'+a+'" style="z-index:'+(1E3-a)+';"><div id="'+b+'" class="filter_group"></div></div>'),d[a].parent_group="#"+b,d[a].no_report=!0;this.filters=FTB.filters.create_collection({id:c.id,app_id:this.app.app_id,callback:_.bind(this.filterResults,this),sort_callback:_.bind(this.setSort||$.noop,this),load_callback:_.bind(this.onFilterLoad,this),filter_props:{dom:this.isEmbedded?this.$main.closest(".ww-root-inner"):$("body")},statics:f,
compact:!0,style_type:"Top"},d);this.bindFilterEvents()},getFilterState:function(){return this.filters?this.filters.get():this.srp_data.filters||[]},bindFilterEvents:function(){var a=this,b=-1;a.$el.on("click",".wwf-toggle",function(){a.$filterWrap.toggleClass("wwf-open").find(".filter-wrap-inner").toggleClass("stnd-box white-bg")});a.$el.on("toggle-drp",".drp",function(b,d){a.open_dropdowns+=d?1:-1;a.$filterWrap.toggleClass("ww-filters-wrap-open",0<a.open_dropdowns)});a.$el.on("click",".widget-filter-reset",
function(){a.resetFilters()}).on("click",".widget-filter",function(){b=a.$filterWrap.toggleClass("open").hasClass("open")?0:-1});a.$filterWrap.hover(function(){clearTimeout(b);b=0},function(c){0===b&&"SELECT"!==c.target.nodeName&&"INPUT"!==c.target.nodeName&&(b=setTimeout(function(){b=-1;a.$filterWrap.removeClass("open")},300))});a.$filterWrap.find(".filter-wrap-icon, .filter-wrap-close").on("vclick",function(c){cancelEvent(c);0<b&&window.clearTimeout&&clearTimeout(b);b=0;a.$filterWrap.removeClass("open")})},
resetFilters:function(){this.setSort(null);this.filters.reset();this.filterResults();this.$(".widget-filter-reset").removeClass("shown")},filterResults:function(a){var b=this,c=this.filters.has_criteria();a=$.extend({get_headers:!0,filters:c?this.filters.get():[],show_distance:!!this.options.show_distance,pre_update:a?function(a){if(!a.data.length&&!b.isEmbedded)return FTB.lazy("WidgetWelcomeMat").done(_.bind(b.renderWelcome,b)),!1}:$.noop},this.sort||{});this.configKey&&(a.config_key=this.configKey,
a.type="join");this.app.ajax(a);this.$(".widget-filter-reset").toggleClass("shown",c);this.filterResults._location=!1},renderWelcome:function(){var a=this,b;_.each(this.options.filter_specs.specs||[],function(c){if("_location"===c.db_name){var d=a.filters.get_filters("_location")[0],e=d.get_criteria();b={field:c.db_name,title:e[7]?tt("No results were found within [distance] [units]s of [location]",[e[4],d.options.units,e[7]]):tt("No Results Found")+" "+d.get_value_nice()}}});if(b&&FTB.widget.WM){try{b.img=
window.detail?window.detail.img_info.filename:window.compare?window.compare.items[this.$el.parent(".cell").data("cell-i")].img_info.file_name:this.app.images[Object.keys(this.app.images)[0]][0]}catch(c){b.img=!1}var d={single:{field:b.field},type:"single",title:tt("Enter a different location"),subtitle:b.title,other:tt("Reset all filters"),img:[b.img],style:"1"};this.$main.html(FTB.WelcomeMat.TPL);this.psf=new FTB.widget.WM({d:[d]},{f_collect:this.filters,f_specs:this.options.filter_specs.specs,$el:this.$main,
onAction:_.bind(this.welcomeCB,this)})}else a.filters.reset(),a.renderResults()},welcomeCB:function(a,b){switch(a){case "filter":this.filters.set([b.filter]);this.filterResults();break;case "other":this.resetFilters()}},setSort:function(a){var b=(this.sort||{}).sort_field;this.sort=a&&"distance"===a.current&&"distance"!==b&&-1===this.app.dist_index?{sort_index:0,sort_dir:"ASC",sort_field:"distance"}:{sort_field:null,sort_dir:null}},filtersLoaded:function(){this.$(".wwf-spin").spin(!1);this.$(".ww-filters").removeClass("ww-filters-stage")},
onFilterLoad:function(){if(this.filters.waiting())this.once("renderResults",this.filtersLoaded,this);else this.filtersLoaded()}});
;
FTB.module("FTB.widget.comparable",{initComparable:function(){this.getRCQ().onadd(this.onCompareAdd).onremove(this.onCompareRemove).each(this.onCompareAdd)},getRCQ:function(){if(FTB.rcq)this.rcq=FTB.rcq;else if(window.RCQ){var a=this.isIframe?this.$(".ww-root-inner"):$("body"),a=$('<div class="rcq-wrap" style="bottom:'+(this.footerHeight||0)+'px">').appendTo(a);this.rcq=new window.RCQ({app_id:this.app_id,base_url:this.base_url,element:a})}return this.rcq||!1}});
;
FTB.module("FTB.widget.selectable",{onSelect:function(a){var c=this;this.on("selected",function(b){a.call(this,b,c.selected)})},select:function(a,c){this.selected=a;this.trigger("selected",this.app.get_index(a),c)},deselect:function(){this.selected=null;this.trigger("deselected")},renderSelected:function(){this.$(".selected."+this.selectableClass).removeClass("selected");this.selected&&this.$("."+this.selectableClass+"[data-id="+this.selected+"]").addClass("selected")},onHover:function(a,c){var b=
this,d=b.app;b.selectableClass&&$.each({mouseenter:a,mouseleave:c},function(a,c){if(c)b.$el.on(a,"."+b.selectableClass,function(a){a=[a];var b=$(this).data("id");b&&a.push(b,d.data[d.get_index(b)]);c.apply(this,a)})})}});
;
FTB.module("FTB.widget.scrollable",{scroll:!1,initScroll:function(){this.scroll=this.isScrollable();this.minScrollHeight=this.minScrollHeight||this.getHeight();this.$scrollView=this.$("."+this.scrollViewClass)},isScrollable:function(){return this.isEmbedded||768<$w.width()},onScroll:function(){this.trigger("scrolled")},renderExpandMore:function(){var a=this,c=this.$scrollView,d=parseInt(c.height(),10),e=c[0].scrollHeight||d;this._originHeight=d;e>d?this.expand||(this.expand=$('<div class="scroll-expand clearfix"><div style="height:0"><div class="sx-shadow-bottom on"></div></div><div class="scroll-expand-btn scroll-show-more"><i class="i icon-angle-down"></i></div><div class="scroll-expand-btn scroll-show-less"><i class="i icon-angle-up"></i></div></div>'),
c.after(this.expand),this.expand.on("vclick",".scroll-expand-btn",function(b){cancelEvent(b);b=$(this).hasClass("scroll-show-more");!b&&a.$scrollView.offset().top<$(window).scrollTop()&&FTB.go_to(a.$scrollView,-100);b&&a.$scrollView.css("max-height","");a.$scrollView.css("height",b?"auto":a._originHeight);a.expand.toggleClass("expanded",b);EVT([window.get_gaq_page_type(),"Soft Joins",b?"click more":"click less",0,!1])})):(this.expand&&this.expand.hide().removeClass("expanded"),e<this.minScrollHeight&&
this.$scrollView.css("height",this.minScrollHeight))},scrollTop:function(a){a=a||0;this.$scrollView.animate({scrollTop:this.$scrollView.scrollTop()+a},300)},scrollResize:function(){var a=this.scroll=this.isScrollable();this.$scrollView.addClass("scrollbar-style scroll-light").toggleClass("no-scroll-y",!a);this.expand&&this.expand.showIf(!a);a||this.renderExpandMore();if(a)this.$scrollView.on("scroll.sw",_.throttle(_.bind(this.onScroll,this),200));else this.$scrollView.off("scroll.sw")}});
;
(function(c,g,d){d=FTB.widget.Base.extend({mainClass:"card-content",init:function(a){this.abTest();this._super(a);return this},render:function(a){this._super(a);this.initContextFilter();this.$main.find(".js-render:visible").trigger("render");this.$main.addClass(this.tab_style);this.isIframe&&this.autoPlay(this.$main.find(".tab-nav").filter(":not(.hide)").filter(":not(.tab-nav-more)"),0);viz.render();this.dimensions=this.getDimensions()},bindEvents:function(){this._super();var a=this.boundCheckHeightChange=
_.debounce(_.bind(this.checkHeightChange,this),50);this.$el.on("heightChanged",a);this.$el.on("click",".card-ctx-reset",_.bind(this.resetContext,this));$w.on("resize",a);this.shouldPublishHeight()&&this.options.contains_custom_code&&(this.checkHeightInterval=setInterval(a,250))},getDimensions:function(){return{w:this.$el.outerWidth(),h:this.getContentHeight()}},checkHeightChange:function(){var a=this.getDimensions();if(a.h!==this.dimensions.h||a.w!==this.dimensions.w)this.dimensions=a,this._height=
null,this.applyHeight()},getContentHeight:function(){return this.$el[0].scrollHeight||this.$el.outerHeight()},shouldPublishHeight:function(){return this.options.is_script||this.options.publish_height},applyHeight:function(){var a=this._super,b=this;setTimeout(function(){a.call(b)},100)},destroy:function(){this._super();$w.off("resize",this.boundCheckHeightChange);clearInterval(this.checkHeightInterval)},abTest:function(){var a=this;if(gatekeeper("Widget Engagement: Tab style change")){var b=FTB.ABTest({id:"tab_style_test",
tests:[{label:"ww-tab-style-old",weight:50},{label:"ww-tab-style-arrow",weight:50},{label:"ww-tab-style-bar",weight:50},{label:"ww-tab-style-tab",weight:50}]});a.tab_style=b.tag()}gatekeeper("Widget Engagement: Autoplay Tabs")&&(b=FTB.ABTest({id:"tab_autoplay",tests:[{label:"tab_autoplay_true",weight:50},{label:"tab_autoplay_false",weight:50}]}),a.isAutoPlay="tab_autoplay_true"===b.tag()?!0:!1,c.subscribe("widget/first_interaction",function(){a.isAutoPlay=!1}))},autoPlay:function(a,b){var c=this;
!0===c.isAutoPlay&&(b===a.length&&(b=0),a.eq(b).trigger("click"),setTimeout(function(){c.autoPlay(a,b+1)},5E3))},initContextFilter:function(){if(this.options.show_context_filter){if(gatekeeper("Card Context Filter Display Test")){if("hidden"===FTB.ABTest({id:"ctx_display_test",tests:FTB.IS_EMPLOYEE?[{label:"show",weight:50}]:[{label:"show",weight:50},{label:"hidden",weight:50}]}).tag()){this.$(".ww-context-filter").remove();return}FTB.IS_EMPLOYEE&&c('<i class="i icon-info"><span class="tip">Employee Note: We are currently running AB test on this card filter.</span></div>').css({position:"absolute",
left:0,top:"15px",color:"#bbb"}).insertAfter(this.$(".ww-context-filter"))}var a=!1;gatekeeper("Card Context Filter Position Test")&&"at-bottom"===FTB.ABTest({id:"ctx_position_test",tests:[{label:"at-top",weight:50},{label:"at-bottom",weight:50}]}).tag()&&(a=!0);var b=this,d=this.options.context_type,h=this.options.context_items||[],f=this.$(".ww-context-filter"),e=this.$context_wrap=c('<div class="card-ctx-wrap stnd-srch-form w-icon"><span><i class="i icon-search"></i></span><div class="card-ctx-list"></div><input class="card-ctx-input stnd-in" placeholder="Search" /></div>');
this.context_filter_items=[];this.$context_input=e.find("input");this.$context_list=e.find(".card-ctx-list");this.$context_content_wrap=this.$main.find(".card:first");a&&f.addClass("at-bottom").insertAfter(this.$context_content_wrap);"SINGLE"===d?(f.html(e.addClass("single-context")),this.$context_list.on("click",function(){b.$context_list.hide();b.$context_input.show().val("").focus()})):"MULTI"===d&&(f.html(e.addClass("multi-context")),this.context_tag_list=new g.TagList({container:this.$context_list.append('<span class="prefix"></span>')}),
this.$context_input.appendTo(this.$context_list));this.$context_input.ASG({minChars:0,leadingWildcard:!0,numToSuggest:8,offsetTop:18,putAbove:a,source:function(a,d,e){a={limit:20,app_id:b.options.app_id,includes:["img","short_title"],skip_ids:_.uniq(_.pluck(b.context_filter_items,"key")),value:d};c.get("/ajax/suggest/item",a,e,"json")},callback:_.bind(b.contextFilterCallback,b)}).on("focus",function(){b.ctxEVT("Focus Search");b.$context_input.data("asg").suggest()});_.forEach(h||[],this.addContext,
this)}},contextFilterCallback:function(){var a=this.$context_input.data("asg").get();a&&(this.ctxEVT("Select Listing"),this.addContext(a),this.refreshContext())},refreshContext:function(){var a=this;FTB.widget.renderMeAWidgetIn(this.$context_content_wrap,{type:"card",app_id:this.options.app_id,context:this.options.context_type,card_id:this.options.card_id,is_embedded:this.isIframe,w:"auto",h:"auto",ids:_.uniq(_.pluck(this.context_filter_items,"key"))},{empty_fallback:_.bind(this.renderNoResults,this)}).done(function(b){b.$(".js-render:visible").trigger("render");
a.checkHeightChange()}).fail(function(b){a.renderNoResults()})},renderNoResults:function(){this.ctxEVT("Render Empty",!0);this.$context_content_wrap.html(c('<div class="card-ctx-empty"><div class="card-ctx-empty-text">No results for this search. Try another one or <a class="card-ctx-reset">reset this search.</a></div></div>').css("height",Math.min(400,this.$main.height()||400)));this.checkHeightChange()},resetContext:function(){this.ctxEVT("Reset Filter");this.context_filter_items=[];this.context_tag_list&&
this.context_tag_list.clear();_.forEach(this.options.context_items||[],this.addContext,this);this.refreshContext()},addContext:function(a){a&&a.key&&("SINGLE"===this.options.context_type?(this.context_filter_items=[a],this.$context_list.show().html('<div class="card-ctx-item">'+(a.short_title||a.value)+'<span class="stnd-srch-clear">\u00d7</span></div>'),this.$context_input.hide()):"MULTI"===this.options.context_type&&(this.context_filter_items.push(a),this.context_tag_list.add(c.extend({},a,{value:a.short_title||
a.value,onClose:_.bind(this.onTagClose,this)})),this.$context_list.find(".prefix").insertBefore(this.$context_input),this.$context_input.val("")))},onTagClose:function(a){this.ctxEVT("Close Tag");this.removeContext(a);this.refreshContext()},removeContext:function(a){_.remove(this.context_filter_items,{key:a.key})},ctxEVT:function(a,b){EVT(["Card","Context Filter-"+a,this.options.context_type,0,b||!1])}});lazy_render(".ww-root.card-widget, .lazy-loaded.card-widget",d.renderIn);FTB.module("FTB.widget.Card",
d)})(jQuery,window);
;
(function(l,n,m){m=FTB.widget.Base.extend({IMAGE_MAX_WIDTH:70,IMAGE_MAX_HEIGHT:65,mainClass:"srp-table-div",scrollViewClass:"srp-table-div",init:function(a){_.bindAll(this,"onCompareAdd","onCompareRemove","resize");this._super(a);this.selectableClass="item_row";this.resizeDebounce=_.debounce(this.resize,50);return this},render:function(a){var d=this;this._super(a);this.initScroll();if((a=this.initFilters())&&this.filters.waiting()){if(!this.scroll)this.once("renderResults",this.autoResize,this)}else if(a&&
this.filters.did_persist())this.filterResults(!0);else if(this.options.sponsorships_enabled&&this.app.num_sponsorships&&2<this.app.data.length)this.getSponsoredResults();else{if(1===this.app.data.length)this.on("renderResults",function(){n.track_sponsor_links(d.$(".sponsor_button").first())});this.renderResults()}this.options.compare_enabled&&this.initComparable()},bindEvents:function(){var a=this;if(a.options.select_mode||FTB.explore){var d=_.uniqueId("srp-widget-uniquehash-");a.$main.addClass(d);
$d.on("click.srpw_"+a.widgetId,"."+d+" .item_row",function(c){var d=l(this).data("id"),e=l(c.target);e.is("a")||e.hasClass("link")||e.closest(".sx-cb").length||(a.selected!==d?(a.rowSelect=1,a.select(d)):a.deselect(),cancelEvent(c))});a.on("selected",function(){a.renderSelected();if(a.rowSelect){var c=0;if(a.floatingHeader||a.flex_table)a.$table.scroll(),c-=a.$(".floating-header").height();a.scrollTop(c+a.$(".item_row.selected").position().top)}delete a.rowSelect}).on("deselected",function(){a.renderSelected()})}a.on("renderResults",
a.scrollResize,a);a.$el.on("click",".sorted,.unsorted",function(){a.app.sort(l(this).attr("data-index"),{filters:a.getFilterState()});l.publish("srpwidget/sort")}).on("click",".sx-cb-wrap",function(c){cancelEvent(c);l.publish("widget/srp/compare");c=l(this).find(".sx-cb");c.hasClass("on")?a.rcq.remove(c.data("listing-id")):a.app.rcq_add(a.rcq,c.closest(".item_row").attr("data-index"),"t")}).on("click",".srp-widget-table .item_row",function(c){a.onRowClicked.apply(this,[c,a])}).on("_resize",this.resizeDebounce);
resize_width_debounce(a.resize);a._super()},setHeight:function(a){this._height=null;this.$(".srp-table-div").height(a)},resize:function(){var a=this;this.scrollResize();this.flex_table&&this.flex_table.resize();setTimeout(function(){a.floatingHeader&&a.floatingHeader.new_content()},1)},onCompareAdd:function(a){!1!==a&&this.$(".item-row"+a).find(".sx-cb").addClass("on thm-on").data("listing-id",a)},onCompareRemove:function(a){this.$(".item-row"+a).find(".sx-cb").removeClass("on thm-on")},getTableHeader:function(a,
d){var c="srp-widget-th",f=this.app,e=a===f.sort_index,h=f.defs[a].name||"";a===f.img_index&&(h="");this.options.nosort||(f.defs[a].sortable&&(c+=e?" sorted sorted_"+f.sort_dir:" unsorted"),e&&(h='<div class="srp-th-sort-wrap relative">'+h+'<div class="sort-arrow sort-'+("DESC"===f.sort_dir?"down":"up")+'"></div></div>'));return'<th data-index="'+a+'" class="'+c+'"'+(d?' colspan="2"':"")+">"+h+"</th>"},renderResults:function(){var a="",d,c,f,e,h,p=this.options,b=this.app,m=b.data.length,k,q,g;if(0===
m)return this.renderNoResults();a+='<table class="srp-widget-table'+(p.compare_enabled&&this.isIframe?" rcq-margin":"")+'">';if(!p.hide_table_header){a+="<thead><tr>";g=0;p.compare_enabled&&(a+='<th class="srp-widget-th compare-header"><i class="i icon-compare"></i></th>');-1!==b.dist_index&&(a+=this.getTableHeader(b.dist_index));-1!==b.img_index&&-1!==b.title_index&&(a+=this.getTableHeader(b.title_index,!0),g+=2);for(;g<b.id_index;g++)(g!==b.img_index||g===b.img_index&&-1===b.title_index)&&g!==b.urr_index&&
(a+=this.getTableHeader(g));a+="</tr></thead>"}a+="<tbody>";for(g=0;g<m;g++){d=b.data[g];c=d[b.id_index];f=b.get_title(g);e=' data-index="'+g+'" data-id="'+c+'"';d=h="";k="item_row item-row"+c;q=b.sponsored_ids.indexOf(c);c=-1!==q&&q===b.sponsored_ids.length-1;FTB.explore||(this.noLinks?k+=" no_links":(h=b.get_data_url(g),e+=' data-href="'+h+'" data-target="'+this.target+'"'));-1!==q&&(k+=" sponsor");a+="<tr"+e+' class="'+k+'">';p.compare_enabled&&(a+='<td class="srp-cell sx-cb-wrap">'+sxCheckbox()+
"</td>");-1!==b.dist_index&&(a+='<td class="srp-cell">'+b.get_cell(g,b.dist_index,this.vizWidth)+"</td>");-1!==b.img_index&&(e=b.get_img_info(g,"t"),d+='<td class="srp-cell image">',e.src&&(k="",e.w&&e.h&&(k=this.fitImage(e,this.IMAGE_MAX_WIDTH,this.IMAGE_MAX_HEIGHT),k=' width="'+k.w+'" height="'+k.h+'"'),d+='<img src="'+e.src+'" alt="'+e.alt+'" title="'+e.title+'"'+k+"/>"),d+="</td>");-1!==b.title_index&&(a+=d,a+='<td class="srp-cell name">',a=this.noLinks||0===b.head[b.title_index].indexOf("_GC_")||
"entity"===b.defs[b.title_index].data_type?a+b.get_cell(g,b.title_index,this.vizWidth):a+('<a class="widget_row_link" href="'+h+'" target="'+this.target+'">'+f+"</a>"),a+=b.get_urr_html(g,!0,!1),1===this.getNumColumns()&&c&&(a+=this.sponsorTag()),a+="</td>");for(f=0;f<b.id_index;f++)f!==b.title_index&&f!==b.urr_index&&(f===b.img_index?-1===b.title_index&&(a+=d):(a=-1===_.indexOf(b.entity_indices,f)||_.isEmpty((b.associated_imgs[b.head[f]]||{})[g])?a+'<td class="srp-cell">':a+'<td class="srp-cell centered">',
a+=b.get_cell(g,f,this.vizWidth),f===b.id_index-1&&c&&(a+=this.sponsorTag()),a+="</td>"));a+="</tr>"}a+="</tbody></table>";this.$main.html(a);this.flex_table&&this.flex_table.teardown();this.$table=this.$(".srp-widget-table");this.renderViz();this.rcq&&this.rcq.each(this.onCompareAdd);this.flex_table=this.$table.FlexTable({scrollX:!0,swipeScroll:!0,fixedHeader:this.overflown()}).data("flex-table");this.trigger("renderResults");l.publish("content/update");this.$("img").not("[width][height]").load(this.resizeDebounce);
b.sponsored_comp&&n.update_sponsor_buttons(this.$el.find(".item_row"))},renderNoResults:function(){this.$(".floating-header").remove();this.flex_table&&this.flex_table.teardown();this._super(this.$main)},autoResize:function(){var a=parseInt(this.$(".srp-widget-table").height(),10)||0,d=parseInt(this.$main.height(),10),a=Math.max(a,d,68);this.$main.height(a)},getNumColumns:function(){return this.app.id_index-Math.max(this.app.urr_index,0)},getSponsoredResults:function(){var a=this;FTB.fetch({url:"/ajax_get_sponsor_listings",
cache:!1,data:{app_id:a.app_id,fields:a.app.head.slice(0,a.app.id_index),_fil:a.options.no_filter_sponsorships?[]:a.getFilterState(),_zq:a.app.zq,sj:1}}).done(function(d){a.app.insert_sponsorships(d.data.data,3,a.options.limit);a.app.sponsored_ids[0]&&n.track_sponsor(a.app.sponsored_ids,0,"i","",a.isIframe?"w":"sjd",{app:a.app_id})}).fail(function(a){console.error(a.message||"Sponsorships failed")}).always(function(){a.renderResults()})},sponsorTag:function(){return'<span class="sponsored-tag">Partner</span>'},
onRowClicked:function(a,d){var c=l(this),f=l(a.target),e=c.data("href"),h=c.data("target"),m=d.configKey;c.data("index");EVT(["Softjoin",m,"Click Row","",!1],void 0,void 0,!0);!f.is("a:not(.widget_row_link),.link,.in-link")&&e&&(f.is(".widget_row_link")||l.publish("srpwidget/clickrow"),"_blank"===h||a.ctrlKey||a.metaKey?n.open(e):setTimeout(function(){("_parent"===h?n.parent:n).location.href=e},100),a.preventDefault())},overflown:function(){var a=this.$scrollView[0];return a&&this.isScrollable()&&
a.scrollHeight>a.clientHeight},renderExpandMore:function(){this.$el.css("height","auto");this._super()},destroy:function(){this._super();$d.off(".srpw_"+this.widgetId)}}).mixin(FTB.widget.filterable).mixin(FTB.widget.comparable).mixin(FTB.widget.selectable).mixin(FTB.widget.scrollable);lazy_render(".srp-widget",m.renderIn);FTB.module("FTB.widget.SRP",m)})(jQuery,window);
;
window.FloatingHeader=function(a,c,m){function f(){b&&(a.is(":visible")?(b.css("left",(g?a.offset().left:0)-k),_.defer(function(){h.width(a.width())})):n=!0)}function p(){b&&(h.width(a.width()).html(a.find(">thead").clone(!0)),a.find("th").quickEach(function(a){b.find("th:eq("+a+")").outerWidth(this.outerWidth())}),q=a.height(),f())}a=$(a);c=$(c);var g=c[0]===window,b,h,q=a.height(),d=!1,n=!1,k=c.scrollLeft(),r=!0,l=_.throttle(function(){if(r){var e=(g?c.scrollTop():c.offset().top)-a.offset().top;
0<e&&e<q||!b?b?(d||(b.css("display","block"),n&&f(),d=!0),e=c.scrollLeft(),e!==k&&(k=e,f())):(h=$('<table class="table-header-clone">').css({pointerEvents:"auto"}),b=$('<div class="floating-header">').css({position:g?"fixed":"absolute",display:"none",pointerEvents:"none"}).html(h),_.defer(p),(g?$("body"):c).append(b),d=!1,l()):d&&(m||b.css("display","none"),d=!1)}else d&&(m||b.css("display","none"),d=!1)},200);c.scroll(l);this.onscroll=l;this.recenter=f;this.new_content=p;this.active_state=function(a){r=
!!a};this.rebind=function(b){a=$(b)};this.get_header=function(){return b}};
;
(function(u,I){function n(b,e){function l(){if(e.fixedColumn)if(f.length&&!g){g=z(b,e.fixedColumnIndex,k.height());k.after(g);if(d){var a=g.find("table"),c=$('<table class="flt-column-table">').addClass(a.attr("class")),h=$('<div class="flt-fixed flt-fixed-header">').html(c),v=a.find("tr:first");c.append(v.clone(!0).outerHeight(v.outerHeight()));h.width(a.outerWidth());p=h}k.after(p)}else!f.length&&g?w():g&&(a=b.find("th:first").outerWidth(),g.width(a),x(g),d&&(p.width(a),x(p)))}function A(){if(f.length){if(u.is_mobile&&
e.swipeScroll){var a=k.scrollLeft();q.Touchy();q.data("touchy").on("move",function(c){k.scrollLeft(a-c.x);d&&d.get_header().scrollLeft(a-c.x)}).on("end",function(){a=k.scrollLeft()})}else k.addClass("scrollbar-style scroll-light scrollbar-x");k.on("scroll.flt",function(){d&&d.get_header().scrollLeft(this.scrollLeft)});if(g&&(k.on("scroll.flt",function(){g.scrollTop(this.scrollTop);d&&d.get_header().scrollLeft(this.scrollLeft)}),u.is_webkit))g.on("wheel.flt",function(){})}else q.data("touchy")&&q.data("touchy").kill(),
k.off("scroll.flt")}function x(a){a.find(".flt-column-table").find("> thead > tr, > tbody > tr, > tr").quickEach(function(c){this.outerHeight(y.eq(c).outerHeight())})}function B(){e.fixedHeader&&(d?setTimeout(function(){d.new_content()},1):(d=new FloatingHeader(b,q,!0),d.onscroll()))}function n(){if(b.is(":visible")){b.width("auto");var a=k.width(),c=C(),h;if(a){if(a>=c)for(;f.length;)if(h=m[f[f.length-1]],c+h<a)r(f.pop(),!0),c+=h;else break;else for(s||(s=!0,D()),h=m.length-1;0<=h&&!(-1===$.inArray(h,
f)&&(c-=m[h],r(h,!1),f.push(h),c<=a));h--);e.scrollX&&f.length&&(b.width("auto"),b.css("table-layout","fixed"),c=b.find("th.overflow, td.overflow"),c.hide(),b.find("tr:first").children("th, td").each(function(c){var a=$(this);a.hasClass("overflow")?a.outerWidth(m[c]):a.outerWidth(a.outerWidth())}),c.show(),b.width(a+_.reduce(f,function(a,c){return a+m[c]},0)));f.length||(b.css("width","100%"),b.css("table-layout",E));B();l();A()}}}function D(){var a=0;m=[];b.find("tr:first").children("td, th").each(function(c){var b=
$(this),d=+b.attr("colspan"),e="> td:nth-child("+(a+c+1)+")";1<d&&(a+=d-1,e=c?"> td:gt("+(a+c-1)+"):lt("+d+")":"> td:lt("+d+")");b.attr("flt-index",c);y.filter(":gt(0)").find(e).attr("flt-index",c);m.push(b.outerWidth())})}function F(){w();d&&d.get_header().remove()}function w(){g&&(d&&p.remove(),g.remove(),g=null)}function G(){m=[];f=[];s=!1}function r(a,c){var d=b.find("tr th[flt-index="+a+"], tr td[flt-index="+a+"]");e.scrollX?d.toggleClass("overflow",!c):d.showIf(c)}function H(){return d}function C(){var a;
f.length&&(a=_.reduce(_.filter(m,function(a,b){return-1===$.inArray(b,f)}),function(a,b){return a+b}));return a||b.outerWidth()}if(b){var t={};e=$.extend({scrollX:!0,swipeScroll:!1,fixedHeader:!1,fixedColumn:!1,fixedColumnIndex:0},e);var s=!1,m=[],f=[],k=e.container||b.parent(),q=k.parent().addClass("flt-scroll-wrap"),d,g,p,y=b.find("> thead > tr, > tbody > tr, > tr"),E=b.css("table-layout");n();t={resize:n,reset:G,getFixedHeader:H,teardown:F,toggleColumn:r};b.data("flex-table",t);return t}}function z(b,
e,l){var n=$('<table class="flt-column-table">').addClass(b.attr("class"));l=$('<div class="flt-fixed flt-fixed-column">').height(l).html(n);b.find("> thead > tr, > tbody > tr, > tr").each(function(){var b=$(this),l=b.clone(!0).empty().outerHeight(b.outerHeight());b.find("[flt-index="+e+"]").each(function(){l.append($(this).clone(!0).width("auto").css("padding",$(this).css("padding")))});n.append(l)});l.width(b.find("th:first").outerWidth());return l}$.fn.FlexTable=function(b){this.each(function(){var e=
$(this);e.data("flex-table")?e.data("flex-table").resize():n(e,b)});return this};FTB.module("FTB.utils.FlexTable",n)})(window,document);
;
(function(e,g){function m(n,c){var b={},e,g,f={},h;c=$.extend({disableScroll:!1,thresholdMinX:30,thresholdMaxY:30},c);var d=n[0],k={handleEvent:function(a){switch(a.type){case "touchstart":this.start(a);break;case "touchmove":this.move(a);break;case "touchend":var b=this.end(a);setTimeout(b||p,0)}c.stopPropagation&&a.stopPropagation()},start:function(a){a=a.touches[0];e=a.pageX;g=a.pageY;h=void 0;f={};d.addEventListener("touchmove",this,!1);d.addEventListener("touchend",this,!1);b.trigger("start")},
move:function(a){if(!(1<a.touches.length||a.scale&&1!==a.scale)){c.disableScroll&&a.preventDefault();var d=a.touches[0];f={x:d.pageX-e,y:d.pageY-g};"undefined"==typeof h&&(h=!!(h||Math.abs(f.x)<Math.abs(f.y)));h||(a.preventDefault(),b.trigger("move",f))}},end:function(a){a=0>f.x;Math.abs(f.x)>=c.thresholdMinX&&Math.abs(f.y)<c.thresholdMaxY&&b.trigger(a?"right":"left");b.trigger("end");d.removeEventListener("touchmove",k,!1);d.removeEventListener("touchend",k,!1)}};l.addEventListener&&l.touch&&d.addEventListener("touchstart",
k,!1);b.kill=function(){l.addEventListener&&d.removeEventListener("touchstart",k,!1)};$.extend(b,_.Events);n.data("touchy",b);return b}var p=function(){},l={addEventListener:!!e.addEventListener,touch:"ontouchstart"in e||e.DocumentTouch&&g instanceof DocumentTouch,transitions:function(e){var c=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"],b;for(b in c)if(void 0!==e.style[c[b]])return!0;return!1}(g.createElement("swipe"))};$.fn.Touchy=function(){this.each(function(){m($(this))});
return this};FTB.module("FTB.utils.Touchy",m)})(window,document);
;
(function(c){function l(a,b,d){if(e.user.uid&&!d)b&&b(!0);else{var f=!1;c.ajax({url:a+"/ftb-auto-login-token",dataType:"jsonp",jsonp:!1,jsonpCallback:"get_session",success:function(a){a&&(h=a.token);f=!!h;b&&b(f)}})}}function n(a,b){l(location.protocol+"//"+location.host,function(d){d?p(a,h,b):m+location.host!==k&&l(k,function(d){d&&p(a,h,b)},!0)},!0)}function p(a,b,d){var f="/ftb-auto-login";a&&(f=m+"www."+a+f);c.ajax({url:f+"?token="+b,dataType:"jsonp",jsonp:!1,jsonpCallback:"get_user",success:function(b){console.log("logged in to "+
a);console.log(b);b.uid&&(e.user.uid=b.uid)},complete:function(){d&&d()}})}function q(a){if(a=r?r[a]:!1){var b=a.next;set_cookie("ftbrrl",b);n(a.domain,function(){b&&q(b)})}else set_cookie("ftbrrl","false")}var e=window.FTB=window.FTB||{},m=e.IS_LOCAL?"http://":"https://",k=m+(e.IS_LOCAL?"www.dw.com":"www.findthebest.com"),r=e.login_domains,h=!1,g;window.ftbRecaptchaCallback=function(){g.resolve()};e.Auth={RECAPTCHA_SITE_KEY:"6LfxXwATAAAAAGgo1U30WTs3h82Gm7NAQzhEb-qk",AUTH_METHOD_FB:"facebook",AUTH_METHOD_FTB:"ftb",
AUTH_METHOD_GOOGLE:"google",is_logged_in:l,auto_login:n,login_using_ftb:function(a){var b=c.Deferred();c.post(location.protocol+"//"+location.host+"/ftb-secure-login",a,null,"json").done(function(a){a.error?b.reject(a.error):location.href=k+"/ftb-secure-login?token="+a.token+"&redirect_uri="+encodeURIComponent(window.get_cookie("login_source")||"")}).fail(function(a){b.reject();console.error(a.error||"Login Error")});return b},register_using_ftb:function(a){var b=c.Deferred();c.post((a.state||"")+
"/ftb-secure-register",a,null,"json").done(function(a){a.user_error?b.reject(a.user_error):location.href=k+"/ftb-secure-register?token="+a.token+"&redirect_uri="+encodeURIComponent(window.get_cookie("login_source")||"")}).fail(function(a){b.reject();console.error(a.error||"Registration Error")});return b},set_login_source:function(a){set_cookie("login_source",a||location.href)},round_robin_login:q,load_recaptcha:function(){if(g)return g;g=c.Deferred();c.getScript("https://www.google.com/recaptcha/api.js?onload=ftbRecaptchaCallback&render=explicit");
return g}}})(jQuery);
;
(function(c){function w(){m();location.href=c(this).data("auth-url")}function x(){m();location.href=c(this).data("auth-url")}function y(a){a.preventDefault();l(!0);var b=c("#user-login-small-form");a=s(b);var g="";m();a?h.login_using_ftb(a).fail(function(a){p(b,[{id:g,value:a||"Login failed, please try again later."}]);l(!1)}):(b.find(".required").each(function(){this.value||(g+=this.id+", #")}),g=g.substring(0,g.length-3),p(b,[{id:g,value:"Must provide email and password."}]),l(!1))}function z(a){a.preventDefault();
a=e.find("#edit-pass");var b=e.find("#edit-mail");e.find(".mail-error").toggleClass("active",""===b.val());e.find(".password-error").toggleClass("active",6>a.val().length);c(".username-error.active").length||c(".password-error.active").length||c(".mail-error.active").length?c(".username-error, .password-error, .mail-error").css("color","red"):(e.removeClass("tc-error"),window.cleanup_placeholders(),l(!0),m(),a=s(e),a.captcha_response=window.grecaptcha.getResponse(A),a.reg_url=location.href,h.register_using_ftb(a).fail(function(a){p(e,
[{id:"",value:a||"Registration failed, please try again later."}]);l(!1)}))}function m(){h.set_login_source(d.redirect)}function p(a,b){a.find(".messages").remove();a.find(".error").removeClass("error");if(b){for(var d=c("<div>").addClass("messages").addClass("error"),e=0;e<b.length;e++){var f=b[e];f.id&&a.find("#"+f.id).addClass("error");d.append(f.value+"<br/>")}a.prepend(d)}}function l(a){var b=c(".login-loading").toggleClass("active",a);!1===a?setTimeout(function(){b.hide().spin()},200):b.show().spin()}
function s(a){var b={drupal_ajax:1};a.find("input").each(function(){-1<this.className.indexOf("required")&&!this.value&&(b=!1);b&&(b[this.name]=this.value)});return b}function n(a){BOX.hide();t(a)&&f&&(f.find("#edit-dest").val(d.destination?d.destination:""),d.message&&f.find("#login-title").text(d.message),f.show(),window.loginBox=BOX.show({html:f,onclose:function(){f.parent().append(f.hide());if(d.onClose)d.onClose()}}))}function u(a){t(a)&&(q?v():c.getJSON("/user_register_form?purpose"+d.purpose,
function(a){a&&a.html&&(q=a.html,v())}))}function v(){BOX.hide();BOX.show({html:q,fixed:!0,onClose:d.onClose});e=c("#user-register-small-form");e.css({maxHeight:c(window).height()-150,overflowY:"auto",overflowX:"hidden"});c.getScript("https://www.google.com/recaptcha/api.js");window.setup_placeholders()}function B(){var a=e.find(".username-error");c.get("/ajax_valid_username",{username:c(this).val(),r:Math.random()}).done(function(b){a.toggleClass("active",!b.is_valid)})}function C(){var a=e.find(".mail-error");
c.get("/ajax_valid_email",{email:c(this).val(),r:Math.random()}).done(function(b){b=JSON.parse(b);a.toggleClass("active",!b.is_valid)})}function t(a){window.loginBox&&(f.hide(),window.loginBox.hide());if(!1===a)return!1;d=c.extend({},D,a);set_cookie("login_purpose",d.purpose);set_cookie("ftbrrl","0");d.callback&&(set_cookie("login_callback","true"),r.set("callback_info",JSON.stringify({data:d.callback_data,callback:d.callback})));return!0}var k=window.FTB=window.FTB||{},h=k.Auth,f=c(".popup_login_box"),
D={callback:null,callback_data:null,method:h.AUTH_METHOD_FTB,message:null,purpose:"manual",redirect:null,onClose:null},d={},q=!1,e,A,r=window.persist("login_data");k.user=k.user||{};k.user.uid||(k.user.renderLoginForm=n,k.user.renderRegistrationForm=u,c("body").on("click","#create-account-btn",u).on("click","#existing-account-btn",n).on("click",".google-login-btn",w).on("click",".fb-login-btn",x).on("click","form#user-login-small-form input[type=submit]",y).on("click","form#user-register-small-form input[type=submit]",
z).on("change","form#user-register-small-form input#edit-name",B).on("change","form#user-register-small-form input#edit-email",C).on("keyup","form#user-register-small-form input#edit-pass",function(){e.find(".password-error").toggleClass("active",6>c(this).val().length)}).on("click",".popup_login_dlg",function(a){a.preventDefault();a=c(this);n({redirect:a.attr("href")||null,purpose:a.data("login-purpose")||a.attr("id")||"force_login"});return!1}));c(function(){gatekeeper("Login: enable auto login")&&
h.auto_login(null,function(){location.reload()});if("true"===GET().prompt_login||0<=window.location.hash.indexOf("prompt_login=true"))n({message:"Get more out of your experience by logging in now.",purpose:"page_load_prompt"});else if("true"===window.get_cookie("login_callback")||"true"===GET().login_callback||0<=window.location.hash.indexOf("login_callback=true")){var a=JSON.parse(r.get("callback_info"));if(a){var b=window,c=a.callback.split(".");r.remove("callback_info");for(var d=0;d<c.length;d++)b=
b[c[d]];b(a.data)}window.set_cookie("login_callback",!1)}a=get_cookie("ftbrrl");(0===a||a&&"false"!==a)&&h.round_robin_login(a)})})(jQuery);
;
(function(d){var a=d.FTB||{},c=0;a.track_gmaps=function(b){c++;b={page_type:a.page_type||"other",order_on_page:c,is_bot:d.is_bot,title:b};a.Analytics&&a.Analytics.send_data("gmaps",b)};a.gmaps_error=function(b,c){var e={page_type:a.page_type||"other",title:b+" error",is_bot:d.is_bot,error:c};a.Analytics&&a.Analytics.send_data("gmaps",e)}})(window);
;
$(function(){var a=[7434,7522];$d.on("contextmenu","img, img.block-right-click",function(){if($(this).hasClass("block-right-click"))return!1;var b=this.src;return 0===_.filter(a,function(a){return-1<b.indexOf("sites/default/files/"+a+"/media/images")}).length})});
;
(function(){FTB.module("FTB.utils.ComponentTracker",function(b){function k(){var a=+new Date,f=window.$wScroll.scrollTop();l=Math.max(l,f);g||(g=a);e||($w.width(),e=$w.height());var n=f+e,d=_.filter(h,function(a){if(a.visible)if(a.height>e){if(a.offsetTop+a.height<f+e*b.percent||a.offsetTop>n-e*b.percent)return!1}else{if(a.offsetTop+a.height*b.percent<f||a.offsetTop+a.height*(1-b.percent)>n)return!1}else return!1;return!0});_.forEach(d,function(f){c[f.id]||(c[f.id]={inView:0,hoverTime:0,clicks:0});
c[f.id].inView+=a-g});g=a}var d={},h={},c={},g,e,m=!1;b=$.extend({},{percent:0.5,showInSeconds:!0,timeMinimum:1},b);d.resize=function(a){m&&(p=l,a=a||b.$el||$d,a.filter(b.selector).add(a.find(b.selector)).each(function(){var a=$(this),b=a.attr("data-cptid");b||(b=_.uniqueId(),a.attr("data-cptid",b));var c=a.offset();h[b]={id:b,offsetTop:c.top,offsetLeft:c.left,height:a.height(),$node:a,visible:a.is(":visible")}}))};d.start=function(){m=!0;d.resize();k()};d.stop=function(){k();m=!1;g=void 0};d.getData=
function(){k();return _.map(c,function(a,c){var d={$node:h[c].$node,height:h[c].height},e=b.showInSeconds?1E3*b.timeMinimum:b.timeMinimum;a.inView&&a.inView>e&&(d.inView=b.showInSeconds?a.inView/1E3:a.inView);a.hoverTime&&a.hoverTime>e&&(d.hoverTime=b.showInSeconds?a.hoverTime/1E3:a.hoverTime);a.clicks&&(d.clicks=a.clicks);return d})};var l=0;d.paint=function(){var a=_.max(c,function(a){return a.inView}).inView;_.forEach(c,function(b,c){h[c].$node.css("opacity",b.inView/a)})};var q,p=0;scroll_throttle(function(){k();
clearTimeout(q);l>p+e&&(q=setTimeout(function(){d.resize()},2E3))});resize_debounce(function(){d.resize()});resize_throttle(function(){$w.width();e=$w.height()});$d.on("mouseenter",b.selector,function(){var a=this.getAttribute("data-cptid");c[a]&&(c[a].startHover=+new Date)}).on("mouseleave",b.selector,function(){var a=this.getAttribute("data-cptid");c[a]&&c[a].startHover&&(c[a].hoverTime+=+new Date-c[a].startHover,delete c[a].startHover)}).on("click",b.selector,function(){var a=this.getAttribute("data-cptid");
c[a]&&c[a].clicks++});return d})})();
;
(function(){function m(){void 0!==a.hidden&&(document[a.hidden]?(d=!1,c+=+new Date-e,h(),EVT(["Engagement","Viewability","Browser out of view",time_on_site(),!0]),$d.trigger("onBrowserViewChange",!1)):(d=!0,e=+new Date,EVT(["Engagement","Viewability","Browser back of view",time_on_site(),!0]),$d.trigger("onBrowserViewChange",!0)))}function n(){k++}function h(){clearTimeout(f);g=!0}var a=function(){var a,b;void 0!==document.hidden?(a="hidden",b="visibilitychange"):void 0!==document.mozHidden?(a="mozHidden",
b="mozvisibilitychange"):void 0!==document.msHidden?(a="msHidden",b="msvisibilitychange"):void 0!==document.webkitHidden&&(a="webkitHidden",b="webkitvisibilitychange");return{hidden:a,visibilityChange:b}}(),k=0,c=0,e=+new Date,d=!0,g=!0,l,f;if(a.visibilityChange)$d.on(a.visibilityChange,m);$d.on("keydown click mousemove scroll",_.throttle(function(){g&&(clearTimeout(f),f=setInterval(n,1E3),g=!1);clearTimeout(l);l=setTimeout(h,5100)},1E3,{trailing:!1}));FTB.module("FTB.utils",{engaged_time:function(){return void 0===
a.hidden?!1:k},viewable_time:function(){return void 0===a.hidden?!1:d?(c+(+new Date-e))/1E3>>0:c}})})();
;
(function(){function p(){return FTB.ABTest?_.map(FTB.ABTest.all_tags(),function(a,b){return b+":"+a}).join(","):""}function q(){return JSON.stringify(_.map(EVT.getAll(),function(a){return{category:a.eventCategory,action:a.eventAction,label:a.eventLabel,interaction:!a.nonInteraction,time:a.time}}))}function e(a){if(time_on_site()>k||l&&"widget"!==FTB.page_type||FTB.Analytics&&!FTB.Analytics.isEnabled())return $.Deferred().resolve();var b=$.extend({version:FTB.AnalyticsFunnel.version,evt_data:q(),page_type:FTB.real_page_type||
FTB.page_type,page_hash:r,ab_tests:p(),scroll_depth:d||0,page_height:f||$d.height(),screen_height:c||$w.height(),load_timestamp:s,current_timestamp:+new Date((new Date).toUTCString()),time_on_page:time_on_site(),time_viewable:FTB.utils.viewable_time()||0,time_engaged:FTB.utils.engaged_time()||0},FTB.Analytics.default_data(),t());a&&console.log&&console.log(b);return $.ajax({url:gatekeeper("Analytics Funnel: funn.graphiq.com")&&!FTB.IS_LOCAL?"https://funn.graphiq.com/ajax/analytics/funnel":"/ajax/analytics/funnel",
type:"POST",data:b}).fail(function(){clearTimeout(m)})}function t(){var a={};_.forEach(g,function(b,c){a[c]=b()});return a}function u(a,b){if(g[a])throw"Analytics Funnel already has this field ("+a+") defined";g[a]=b}function h(){document.hidden||document.webkitHidden||document.msHidden||document.mozHidden||e();time_on_site()>k||(m=setTimeout(h,v))}if(!(FTB.disable_all_tracking||FTB.IS_DEVELOPER&&!gatekeeper("Developers using analytics funnel"))){var v=1E4,k=300,d=0,c,f=0,n=_.debounce(function(){c||
(c=$w.height());var a=$d.height(),b=$w.scrollTop();f=Math.max(f,a);d=Math.min(Math.max(b/(a-c),d),1);1===d&&$w.off("scroll",n)},200);$w.on("scroll",n);resize_debounce(function(){c=$w.height()});var l=!1;set_cookie("__afct","on");"on"!==get_cookie("__afct")&&(EVT(["Engagement","Cookies","Disabled",0,!0]),l=!0);var s=+new Date((new Date).toUTCString()),r=randHash(60),g={},m;if(FTB.Analytics.tracked_session)h();else FTB.Analytics.on("tracked-session",h);$w.on("unload",function(){e()});FTB.module("FTB.AnalyticsFunnel",
{ping:e,register:u})}})();
;
