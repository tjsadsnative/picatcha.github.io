Reuters.utils.loadEchoTrendingStream=function(){var a="",d="";arguments.length>0&&(a=arguments[0],arguments.length>1&&(d="markers:"+arguments[1]+" "));var b=document.getElementById("echo-trending"),f="www",e="12 hours ago";typeof Reuters.info.edition!="undefined"&&Reuters.info.edition.toLowerCase()!="betaus"&&Reuters.info.edition.toLowerCase()!="us"&&(f=Reuters.info.edition.toLowerCase(),e="72 hours ago");Echo.Broadcast.subscribe("Stream.Item.onRender",function(){setDynamicModuleTrackingOnClick("echo-trending")});
new Echo.Stream({target:b,appkey:"dev.reuters.com",query:"scope:http://"+f+".reuters.com"+a+"/* "+d+"-markers:arktan-category-EntertainmentNews,arktan-category-oddlyEnoughNews,arktan-category-sportsNews,arktan-category-olympicsNews,arktan-category-televisionNews,arktan-category-peopleNews,arktan-category-artsNews sanitizeHTML:false type:article after:'"+e+"' -state:ModeratorDeleted,ModeratorFlagged sortOrder:repliesDescending itemsPerPage:4 children:0",viaLabel:{icon:false,text:true},reTag:false,
streamStateLabel:{icon:true,text:true},aggressiveSanitization:true,openLinksInNewWindow:true,contentTransformations:{text:["smileys","hashtags","urls"],html:["smileys","hashtags","urls"],xhtml:["smileys","hashtags","urls"]},plugins:[{name:"ItemAccumulatorDisplay"},{name:"ItemAccumulatorDisplayTweaks"},{name:"LastTweetDate"}]})};Reuters.namespace("stocktwits");Reuters.stocktwits.ricList=[];Reuters.stocktwits.hourlyRicData={};Reuters.stocktwits.dailyRicData={};Reuters.stocktwits.ricCount=4;
dateFormat.masks.chatterTime="mmm d 'at' h:MM tt";dateFormat.masks.trendingTime="d mmm yyyy',' HH:MM Z";formatDate=function(a){prepDate=a.replace(/([T|Z|:])/g,"-").split("-",6);return origDate=Date.UTC(prepDate[0],prepDate[1]-1,prepDate[2],prepDate[3],prepDate[4],prepDate[5])};
Reuters.stocktwits.trendingRicsHourly=function(a){Reuters.stocktwits.hourlyRicData=a;if(a.response.status==200){if(document.getElementById("trendingTickers")&&a.trends.length>0)for(i=0;i<a.trends.length;i++){var d=a.trends[i];d.ric&&Reuters.stocktwits.ricList.push(d.ric)}Reuters.utils.loadScript("hourlyRicQuotes","/ajax/do/marketDataAjax?type=quote&symbol="+Reuters.stocktwits.ricList.join(",")+"&callback=Reuters.stocktwits.writeRicDataHourly")}else trace("stocktwits error: "+a.errors[0])};
Reuters.stocktwits.writeRicDataHourly=function(){Reuters.stocktwits.writeRicData("hourly")};
Reuters.stocktwits.writeRicData=function(a){var a=a=="hourly"?Reuters.stocktwits.hourlyRicData:Reuters.stocktwits.dailyRicData,d=0;for(i=0;i<a.trends.length;i++){var b=a.trends[i];if(b.ric&&quote[b.ric]){currentData=quote[b.ric];var f=currentData.positiveChange=="true"?"Up":"Down",e=quote[b.ric],e=e?e.company:"",c="";c+='<div class="trending-item">';c+='<div class="echo-item-accumulatorContainerWrap"><div class="echo-item-accumulatorContainer">'+b.hourly_points[23]+'</div><div class="echo-item-accumulatorContainerLabel">Tweets</div></div>';
c+=Reuters.info.edition.toLowerCase()=="uk"?'<h4><a href="/business/quotes/social-pulse?symbol='+b.ric+'">'+e+"&nbsp;("+b.ric+")</a></h4>":'<h4><a href="/finance/stocks/social-pulse?symbol='+b.ric+'">'+e+"&nbsp;("+b.ric+")</a></h4>";currentData.quote!="--"?(c+='<div class="ricData"><span class="price">'+currentData.quote+"</span>",c+='<span class="change'+f+'">$'+currentData.netChange+" | "+currentData.percentChange+"</span></div>"):c+='<div class="quotePending"><span class="price">Quote data pending (<span class="hrefClone" title="Quotes may be delayed 15-20 minutes." onclick="javascript:Reuters.utils.popup(\'http://www.reuters.com/info/disclaimer\',540,525,3,\'bottomNav\')">why?</span>)</span></div>';
c+='<div class="timestamp">'+dateFormat(formatDate(b.updated_at),"trendingTime")+"</div>";c+="</div>";document.getElementById("trendingTickersCol1").innerHTML+=c;d++;if(d==Reuters.stocktwits.ricCount)break}}setDynamicModuleTrackingOnClick("trendingTickers")};Reuters.stocktwits.init=function(){Reuters.utils.loadScript("trendingRicsHourly","http://api.stocktwits.com/api/symbols/trending/hourly.json?asset=equities&limit=4&callback=Reuters.stocktwits.trendingRicsHourly")};
