var kmn_data=kmn_data||{},kmn_iframe=kmn_iframe||0,kmn_force_iframe=kmn_force_iframe||null,kmn_ts=new Date().getTime(),kmn_next=kmn_next||{},kmn_house=kmn_house||{},kmn_cb=generateCb(),kmn_cstat=kmn_cstat||new function(){var a=this;a.async_js=function(g,d,f){f=typeof(f==="undefined")?(null):(f);try{var h,b=kmn_sa,c=document.createElement("script");b.setAttributes(c,b.extend(d||{},{src:g,async:true,type:"text/javascript"}));h=document.getElementsByTagName("head")[0];if(h){h.appendChild(c)}return c}catch(i){if(f){a.spark(f,{err:"asyncjs@cstat",msg:i.message})}}return""};a.stat_src=function(b,e){var c,d="?",e=e||{};for(c in e){d+=encodeURIComponent(c)+"="+encodeURIComponent(e[c])+"&"}return(b+d.slice(0,-1))};a.save=function(d,h,c){c=typeof(c==="undefined")?(null):(c);try{var g=a.stat_src(d,h),b=a.async_js(g,{},c);b.onload=b.onreadystatechange=function(){var e=b.readyState;if(!e||e==="loaded"||e==="complete"){b.onload=b.onreadystatechange=null;if(b.parentNode){b.parentNode.removeChild(b)}}};return b}catch(f){if(c){a.spark(c,{err:"save@cstat",msg:f.message})}}}}(),kmn_sa=kmn_sa||new function(){var i=this;i.is_iframe=function(){var k=false;try{k=(d.location!==d.parent.location)}catch(l){}return k};i.getDoc=function(){var k=null;try{k=(i.is_iframe()?d.frameElement.contentDocument||d.frameElement.contentWindow.document:document)}catch(l){}return k||document};i.getIfrmDoc=function(k){var l=(k.contentDocument?k.contentDocument:(k.contentWindow?k.contentWindow.document:(k.document?k.document:null)));return l};i.getParent=function(){var k={};try{if(d.parent.document){k=d.parent}}catch(l){}return k};i.extend=function(){var m=0,l,k={};for(;m<arguments.length;m++){for(l in arguments[m]){k[l]=k[l]||arguments[m][l]}}return k};var h=".komoona.com/",b="kmn_tag_",c="kmni_",a="kmn-div",e="kmn-debug=true",g=kmn_cstat,d=window,f=i.getDoc(),j=i.extend(d.kmn_options||{},{base_url:"//a"+h,ext_src:"//cdn"+h+"scripts/kmn",video_src:"//cdn"+h+"video/",debug:0,stat_url:"//stat"+h+"s",np:"//s"+h+"passback/np/",sa:"sa",v:"3.34",cs:{}});i.options=j;i.tags={};i.stMx=120;i.stMxVd=160;i.ifrmMx=12;i.hdbdTagTimeout=300;i.maxHdbdTagRetries=50;i.hdbdRetryWait=50;i.HDBD_STATE_RECEIVED="received";i.HDBD_STATE_TIMEOUT="timedOut";i.HDBD_STATE_FULL="full";i.videoloaded=null;i.videoChains=["d","C","f"];i.isVideoChain=function(k){for(var l in i.videoChains){if(i.videoChains[l]===k.charAt(0)){return true}}return false};i.handleChainedVideoTag=function(o,m,p,l){if(!i.flashEnabled(o)){i.set_ts(o,"nf");i.get_np(o)}else{if(i.videoloaded){kmn_vid.handleVideo(o,m,p,l)}else{try{i.set_ts(o,"ks");i.spark(o,{vidEvtType:"kvid.fls"});i.stMx=i.stMxVd;var k=f.getElementById(m);i.setDataVar(o,"videoDivName",m);if(l){i.setDataVar(o,"videoContent",l)}i.setDataVar(o,"videoChain",p);i.element_add_js(k,j.video_src+"video_files.min.js",i.load_kmn_vid_js.bind(undefined,o));i.write_css_link(k,j.video_src+"kvid_css.css");i.callS2sCallbackFunction(o,kmn_data[o],"GetContent","kmn_sa.onS2SContentResponse");i.videoloaded=true}catch(n){i.spark(o,{err:"hvtag@sa",msg:n.message});i.get_np(o)}}}};i.load_kmn_vid_js=function(m){try{var l=f.getElementById(i.getDataVar(m,"videoDivName"));i.element_add_js(l,j.ext_src+"_vid.js",i.call_kmn_vid_callback.bind(undefined,m));i.set_ts(m,"ks1");i.spark(m,{vidEvtType:"kvid.kmnvidlss"})}catch(k){i.spark(m,{err:"kvidclbk@sa",msg:k.message});i.get_np(m)}};i.call_kmn_vid_callback=function(l){try{i.set_ts(l,"ks2");i.spark(l,{vidEvtType:"kvid.kmnvidldd"});kmn_vid.handleVideo(l,i.getDataVar(l,"videoDivName"),i.getDataVar(l,"videoChain"))}catch(k){i.spark(l,{err:"vidclbk@sa",msg:k.message})}};i.onS2SContentResponse=function(k){if(k&&k.error===null){var l=k.results.placement_id;i.setDataVar(l,"videoContent",k.results.videocontent)}};i.flashEnabled=function(l){if(i.getDataVar(l,"testmode","")===true){return true}var m="application/x-shockwave-flash";if(typeof navigator.plugins!=="undefined"&&(typeof navigator.plugins["Shockwave Flash"]==="object"&&(typeof navigator.mimeTypes!=="undefined"&&(navigator.mimeTypes[m]&&navigator.mimeTypes[m].enabledPlugin)))){return true}else{if(typeof window.ActiveXObject!=="undefined"){try{if(new window.ActiveXObject("ShockwaveFlash.ShockwaveFlash")){return true}}catch(k){}}}return false};i.element_add_js=function(k,m,n){var l=i.setAttributes(f.createElement("script"),{src:m,async:true,type:"text/javascript"});if(n){l.onload=n;l.onreadystatechange=function(){if(this.readyState==="complete"){i.call_kmn_vid_callback}}}if(k){k.appendChild(l)}};i.build_js=function(l,k,m){return("<script "+(m?'id="'+m+'" ':"")+'type="text/javascript"'+(k?">"+l:' src="'+l+'">')+"<\/script>")};i.write_js=function(k,l){f.write(i.build_js(k,0,l))};i.write_css_link=function(k,l){var m=i.setAttributes(f.createElement("link"),{type:"text/css",rel:"stylesheet",href:l,media:"all"});if(k){k.appendChild(m)}};i.setAttributes=function(m,l){try{if(m){for(var k in l){m.setAttribute(k,l[k])}}return m}catch(n){}return null};i.cssClass=function(m){try{var o=f.createElement("style"),l="",k=f.getElementsByTagName("head")[0];for(var n in m){l+="."+n+"{"+m[n]+"}"}o.appendChild(f.createTextNode(l));o.setAttribute("type","text/css");if(k){k.appendChild(o)}}catch(p){}};i.create_iframe=function(n,l,k){var m=f.createElement("iframe");i.setAttributes(m,i.extend(k||{},{src:n,marginHeight:0,marginWidth:0,frameBorder:0,scrolling:"no"}));if(l){l.appendChild(m)}return m};i.get_np=function(k){if(d.kmn_passbacks&&kmn_passbacks[k]){kmn_np.next(k)}else{if(kmn_next[k]){delete kmn_next[k]}i.write_js(j.np+k+".js")}};i.callS2s=function(m,o){if(o.s2sBaseUrl){var l,n,p=i.getDoc(),k=i.tags[m]||{},q={layoutid:m,chain:o.codes,cb:kmn_cb,index:o.full_index-1,uts:new Date().getTime(),inFrame:i.is_iframe()?1:0,url:i.site_url(),tz:new Date().getTimezoneOffset(),v:j.v};if(k.statname){q.statname=k.statname}if(p){n=(p.characterSet?p.characterSet:p.charset);if(n){q.ch=n}}l=g.stat_src(o.s2sBaseUrl+"GetAd",q);i.log("s2s["+l+"]");return i.build_js(l,0)}return""};i.callS2sCallbackFunction=function(m,o,p,r){if(o.s2sBaseUrl){var l,k,q=i.getDoc(),s=i.tags[m]||{},n={layoutid:m,chain:o.codes,cb:kmn_cb,index:o.full_index-1,uts:new Date().getTime(),inFrame:i.is_iframe()?1:0,url:i.site_url(),tz:new Date().getTimezoneOffset(),v:j.v};if(s.statname){n.statname=s.statname}if(r){n.callback=r}if(q){k=(q.characterSet?q.characterSet:q.charset);if(k){n.ch=k}}l=g.stat_src(o.s2sBaseUrl+p,n);i.log("s2s["+l+"]");return i.write_js(l,0)}return""};i.s2sServerIncrement=function(m,k){if(k>1&&kmn_data[m]){var r=kmn_data[m],p=r.full_index,o=p,n=(p+k-1),l=r.order,q=r.codes;for(;o<n&&o<q.length;o++){l=q[o].split("").reverse().join("")+"|"+l}if(n>=q.length){i.spark(m,{err:"warn:idx@s2s",idx:n,curCh:q.length,ord:l})}r.order=l;r.full_index=n}if(kmn_next[m]){delete kmn_next[m]}};i.useS2sOn=function(l,m){try{var n=kmn_data[l]||{};if(n.s2sCodes){var k=n.s2sCodes.indexOf(m.charAt(0))>-1;if(k&&n.s2sExcludedTags){k=!(n.s2sExcludedTags.indexOf(m)>-1)}return k}}catch(o){i.spark(l,{err:"us2son@sa",msg:o.message})}return 0};i.site_url=function(){var l="",k="";l=k=(i.is_iframe()&&f.referrer!=="")?f.referrer:d.location.href;if(l.indexOf("javascript:window")!==-1||l.indexOf("about:blank")!==-1){try{l=d.parent.location.href}catch(m){l=k}}if(l.length>1024){l=l.replace(/([^:]+:\/\/[^\/]+).*/,"$1")}return l};i.is_debug=function(){try{var m=0,n=0,l=d.location.href,k=l.slice(l.indexOf("?")+1).split("&");for(;m<k.length;m++){if(k[m]===e){n=1}}if(typeof(kmn_force_debug)!=="undefined"){n=kmn_force_debug}j.debug=n;if(n&&!d.console){d.console={log:function(){}}}}catch(o){}};i.live_tags=function(m){var k,l=[];for(k in i.tags){if(k!==m&&!i.tags[k].parent){l.push(k)}}return l};i.spark=function(l,o){try{var r=i.extend({tagid:l,v:j.v,cb:kmn_cb,ds:f.readyState},o||{}),x=i.live_tags(l);if(o.codes){i.set_ts(l,"s");i.tags[l].div=f.getElementById(b+l);i.parentDiv(l)}if(d.kmn_siteurl){r.um=kmn_siteurl}if(i.tags[l]){var p=i.tags[l].ts||[];r.ts=p.join("|")}if(x.length){r.p=x.join(";")}if(!r.l){r.d=i.site_url()}var t=i.getBidDataForACall(l);if(t&&t.length>2){r.hb=t}var k=i.getDataVar(l,"hdbdResponseInUse");if(k&&k.hb_tp){r.hb_tp=k.hb_tp}var w=i.getDataVar(l,"hdbdServed");if(w){r.hbs=w}var q=i.getDataVar(l,"winning_bid");if(q){r.wb=q;if(w){r.cpm=q}}var s=i.getDataVar(l,"hdbdResponseTime");if(s){r.hdbdrt=s}if(d.kmn_np){r.npv=d.kmn_np.v||"1.00"}var v=i.getDataVar(l,"qs");if(v){r.qs=v}var m=i.getDataVar(l,"qg");if(m){r.qg=m}var n=i.getDataVar(l,"qf");if(n){r.qf=n}i.log("sprk"+i.stringify(r),1);g.save(j.stat_url,r,l);return r}catch(u){i.log("sprk["+u.message+"]",1)}};i.parentDiv=function(k){try{var l=i.getParent();if(l.kmn_sa&&l.kmn_sa.tags[k]){l.kmn_sa.tags[k].div=i.tags[k].div;var n=l.parent||{};if(n.kmn_sa&&n.kmn_sa.tags[k]){n.kmn_sa.tags[k].div=i.tags[k].div}}}catch(m){}};i.set_ts=function(m,o){try{var k=i.tags[m]||{},n=(new Date().getTime())-kmn_ts,l=k.ts||[];l.push(o+":"+n)}catch(p){i.spark(m,{err:"setts@sa",msg:p.message})}return n||-1};i.log=function(o,k){if(j.debug){var n=new Date(),m=n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()+":"+n.getMilliseconds();var l="";if(typeof(k)!=="undefined"){switch(k){case 1:l="color: blue;";break;case 2:l="color: green;";break;case 3:l="color: gray;";break}}d.console.log("%c[%s]%s",l,m,o)}};i.console=function(k){i.log(k)};i.fetch_np=function(l){try{if(l.indexOf("_")===-1&&!kmn_next[l]){kmn_next[l]={render:false};var k=g.async_js(j.np+l+".js",{id:"np-"+l},l);k.onload=k.onreadystatechange=function(){var n=k.readyState;if(!n||n==="loaded"||n==="complete"){k.onload=k.onreadystatechange=null;kmn_next[l]={render:true};k.removeAttribute("id");i.set_ts(l,"np");i.log("np@d["+l+"]")}}}}catch(m){i.spark(l,{err:"fetchnp@sa",msg:m.message})}};i.initTagParams=function(l){try{i.xd=i.xd||komoona_xd.receive(function(s){i.handle(s.data)});if(!Function.prototype.bind){Function.prototype.bind=function(s){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind")}var w=Array.prototype.slice.call(arguments,1),v=this,t=function(){},u=function(){return v.apply(this instanceof t?this:s,w.concat(Array.prototype.slice.call(arguments)))};if(this.prototype){t.prototype=this.prototype}u.prototype=new t();return u}}if((!Array.prototype.indexOf)&&!d.kmn_bc){i.write_js(j.ext_src+"-bc.js")}}catch(o){i.spark(l,{err:"itp@sa",msg:o.message})}i.tags[l]={srv:0,timer:null,ifrm:0,st:0,ts:[],start:kmn_ts,async:kmn_iframe,wait:0,cnt:1};var k=d.location.href,q=k.slice(k.indexOf("?")+1).split("&");for(var m in q){var n=q[m];if(n&&n.split){var p=n.split("=");if(p.length===2){if(p[0]==="force_iframe"){kmn_force_iframe=p[1];i.log("forcing iframe set to "+kmn_force_iframe)}}}}i.set_ts(l,"t");var r=f.getElementById(c+l);if(r){i.tags[l].async=1}if(!i.tags[l].async){i.fetch_np(l)}kmn_iframe=0;i.statTimer(l)};i.replaceTagParams=function(l,k){if(i.tags[l]){d.clearInterval(i.tags[l].timer);i.tags[k]=i.extend(i.tags[l]);i.tags[l].parent=k;i.statTimer(k)}};i.elemHeight=function(o){var m=-1;try{if(o){if(o.getBoundingClientRect){var n=o.getBoundingClientRect();if(n.top&&n.bottom){m=n.bottom-n.top}}if(m===-1){var l=o.clientHeight||0,p=o.offsetHeight||0,k=o.scrollHeight||0;m=Math.max(p,l,k)}}}catch(q){}return m};i.statsParams=function(k){var m={h:i.elemHeight(f.getElementById(b+k))},l=kmn_data[k];if(l){m.o=l.order;m.ch=(l.codes)?(l.codes.join("|")):("");m.ch_orig=(l.codes_orig)?(l.codes_orig.join("|")):("")}return m};i.label=function(n,m){try{var l,k=i.tags[n],o=kmn_data[n],q=f.getElementById(b+n);if(k.lbl&&o&&q&&m!==1){l=i.setAttributes(f.createElement("a"),{id:"lbl_"+n,"class":"kmn-lbl",target:"_blank",href:k.lbl.lnk});l.appendChild(f.createTextNode(k.lbl.txt));q.style.width=o.w+"px";q.style.height=o.h+"px";q.appendChild(l)}return l}catch(p){i.spark(n,{err:"label@sa",msg:p.message})}};i.house=function(l){try{var o=i.statsParams(l),k=o.o,n=(o.h!==-1);if(!i.tags[l].srv){i.tags[l].srv=1;if(k.indexOf("h")===-1){o.o="h"+(k.length?"|"+k:"")}o.had=1;o.l=i.site_url();i.set_ts(l,"h");i.set_ts(l,"p")}else{o.house=1;n=(i.tags[l].cnt===1)&&n}i.log("house|"+l+"|"+i.stringify(o));if(n){i.spark(l,o)}}catch(m){i.spark(l,{err:"house@sa",msg:m.message})}};i.stats=function(k,l){if(!i.tags[k].srv){i.tags[k].srv=1;i.log("stats["+k+"]o["+l.o+"]h["+l.h+"]");l.l=i.site_url();i.spark(k,l)}};i.statTimer=function(k){i.tags[k].timer=d.setInterval(function(){i.statHandler(k)},250)};i.statHandler=function(n){var w=i.tags[n]||{};if(w.srv){d.clearInterval(w.timer)}else{w.st+=1;var q=i.statsParams(n),l=i.getDoc().getElementById(b+n),o=q.o||"",r=0;if(l){if(w.st===i.stMx){i.set_ts(n,"tsa");i.spark(n,{o:o,h:q.h,err:"timeout@sa"})}else{if(o.indexOf("h")===-1){if(i.detectAdServed(n,q)){var v=l.getElementsByTagName("iframe");if(!v.length){if(w.wait++){r=2}}else{var t,u=0;for(t=0;t<v.length;t++){u=(v[t].offsetHeight!==0&&v[t].style.display!=="none")||u}if(u){var k=o.split("|"),p=k[0];if(p.indexOf("x")!==-1||p.indexOf("w")!==-1){if(w.ifrm++>=i.ifrmMx){r=3}}else{r=4}}else{if(w.wait++>3){r=5}}}}if(r){i.label(n,r);var m,s=kmn_data[n];if(s){m=s.codes[s.full_index-1];if(m){i.set_ts(n,m)}}i.set_ts(n,"p");q.status=r;i.stats(n,q)}}}}else{if(w.st===50){i.set_ts(n,"wsa");i.spark(n,{err:"wrapper@sa",o:o})}}}};i.detectAdServed=function(m,q){var p=i.getDataVar(m,"videoAdServed");if(p){return true}var o=i.getDataVar(m,"hdbdServed");if(o){return true}var k=i.getDataVar(m,"h",50);var l=q&&q.h&&(q.h>=k);var n=i.getDataVar(m,"videoTagBeingServed");return(l&&!n)};i.cookieSync=function(k,l){if(!j.cs.js){j.cs.js=g.async_js(j.ext_src+"-cs.js",{})}if(!d.kmn_cs&&!j.cs[k]){j.cs[k]=d.setInterval(function(){i.cookieSync(k,l)},100)}else{if(d.kmn_cs){d.clearInterval(j.cs[k]);kmn_cs.cookieSync(k,l)}}};i.heartbeat=function(k){if(!d.kmn_hb&&!j.hb){g.async_js(j.ext_src+"-hb.js",{},k);j.hb=d.setInterval(function(){i.heartbeat(k)},50)}else{if(d.kmn_hb){d.clearInterval(j.hb);kmn_hb.start(k)}}};i.heartbeat_stop=function(k){if(d.kmn_hb){kmn_hb.stop(k)}};i.getDataVar=function(l,k,m){if(kmn_data[l]&&kmn_data[l][k]){return kmn_data[l][k]}return m||null};i.setDataVar=function(l,k,n){var m=(kmn_data[l]&&kmn_data[l][k])?(kmn_data[l][k]):(null);if(!kmn_data[l]){kmn_data[l]={}}kmn_data[l][k]=n;return m};i.tag=function(n){try{var m=i.tags;i.is_debug();if(d.kmn_size){n=n+"_"+d.kmn_size.replace("x","_");delete d.kmn_size}if(d.kmn_passback){kmn_house[n]=d.kmn_passback;delete d.kmn_passback}if(!m[n]){i.initTagParams(n)}else{if(m[n].parent){n=m[n].parent}delete m[n].ar;m[n].cnt+=1}if(i.UseHdbd()){var l,p={tagid:n},q=f.getElementById(c+n);if(!q){i.addKmniDiv(n)}i.log("hdbd request["+n+"]");var k=i.handleHdbdResponse.bind(undefined,p);if(i.canAccessBidstore()){i.log("tag "+n+" has direct access to bidStore, sending req in sync mode")}else{i.log("tag "+n+" has no direct access to bidStore, sending req in async mode and setting listener");komoona_xd.receive(k)}i.set_ts(n,"hbq");i.requestHdbdData(n,k);d.setTimeout(function(){var r=i.getDataVar(n,"hdbdResponseStatus");if(r!==i.HDBD_STATE_RECEIVED&&r!==i.HDBD_STATE_FULL){i.setDataVar(n,"hdbdResponseStatus",i.HDBD_STATE_TIMEOUT);i.log("hdbd no respose ["+n+"]state["+r+"]new state:["+i.getDataVar(n,"hdbdResponseStatus")+"]");i.dtag(n)}else{i.log("dbg:hdbd request timed out, response already received")}},i.hdbdTagTimeout)}else{i.dtag(n)}}catch(o){i.spark(n,{err:"tag@sa",msg:o.message})}};i.UseHdbd=function(){var l=false;try{if(window.top.kmn_hbid){l=true}}catch(k){i.log("hdbd: couldn't access window.top")}return window.kmn_hdbd||l};i.canAccessBidstore=function(){try{if(window.top.kmn_bids_store){return true}}catch(k){}return false};i.getBidstoreData=function(k){try{return window.top.kmn_bids_store._HBData(k)}catch(l){}return null};i.requestHdbdData=function(l,m){if(i.canAccessBidstore()){var k=i.getBidstoreData(l);m({data:k})}else{komoona_xd.post({msg_type:"hdbdRequest",params:{placement_id:l}},"*",d.top)}};i.handleHdbdResponse=function(p,o){i.setDataVar(p.tagid,"hdbdRetries",i.getDataVar(p.tagid,"hdbdRetries",0));var l=o.data;if(l&&l.msg_type==="hdbdData"&&l.hdbd_data&&l.hdbd_data.placement_id===p.tagid){var m=l.hdbd_data;var q=i.setDataVar(p.tagid,"hdbdResponse",m);if(!q){var n=i.set_ts(p.tagid,"hbr");i.setDataVar(p.tagid,"hdbdResponseTime",n);i.log("got first hdbd response for tag "+p.tagid+" at "+n)}if(i.getDataVar(p.tagid,"hdbdResponseStatus")!==i.HDBD_STATE_TIMEOUT){if(i.isFullHdbdResponse(m)){if(i.getDataVar(p.tagid,"hdbdResponseStatus")!==i.HDBD_STATE_FULL){i.setDataVar(p.tagid,"hdbdResponseStatus",i.HDBD_STATE_FULL);i.log("tag "+p.tagid+": full hdbd response received, proceeding to tag.");i.set_ts(p.tagid,"fhb");i.callTagInHdbdFlow(p.tagid)}}else{i.setDataVar(p.tagid,"hdbdResponseStatus",i.HDBD_STATE_RECEIVED);var k=i.getDataVar(p.tagid,"hdbdRetries")+1;i.setDataVar(p.tagid,"hdbdRetries",k);if(k<i.maxHdbdTagRetries){setTimeout(function(){i.requestHdbdData(p.tagid,i.handleHdbdResponse.bind(undefined,p))},i.hdbdRetryWait)}else{i.log("debug: waited for full hdbd response for too long in tag "+p.tagid+", stopping retries. Proceeding to tag. latest reponse: "+i.stringify(m)+"(retries="+k+")");i.callTagInHdbdFlow(p.tagid)}}}else{i.log("got hdbd response for tag "+p.tagid+" after timeout was deemed, ignoring (ts="+i.getDataVar(p.tagid,"hdbdResponseTime")+")")}}};i.callTagInHdbdFlow=function(k){if(!i.getDataVar(k,"hdbdFlowTag",false)){i.setDataVar(k,"hdbdFlowTag",true);i.dtag(k)}else{i.log("refraining from calling dtag twice in hdbd flow")}};i.getBidDataForACall=function(k){var o=i.getDataVar(k,"hdbdResponse"),n=[];if(o&&o.hbbids){i.setDataVar(k,"hdbdResponseInUse",o);for(var l in o.hbbids){var m=o.hbbids[l],p={code:m.code,ret:m.returned,cpm:(m.cpm)?(m.cpm):(null)};if(m.error){p.err=m.error}if(m.creative_data&&typeof(m.creative_data.cpm_second)!=="undefined"){p.secprice=m.creative_data.cpm_second}else{if(m.returned&&m.network==="index"){i.log("warning: index tag missing second price! bidData="+i.stringify(m),2)}}n.push(p)}}return i.stringify(n)};i.isFullHdbdResponse=function(l){var m=false;if(l.hbbids){for(var k in l.hbbids){if(l.hbbids[k].returned===false){return false}else{m=true}}if(m){return true}}return false};i.serveHdbdAol=function(l,n){kmn_sa.log("serveHdbdAol: serving");if(n&&n.creative_data&&n.creative_data.creative){var k=n.creative_data.creative.replace(/[\n\r\f]/g," ");var m='<div id="kmnp-'+l+'">'+k+"</div>";var o=i.getDoc();if(o){o.write(m)}else{i.log("doc not accessible in hdbd o");i.spark(l,{err:"doc@ohdbd"})}}else{i.spark(l,{err:"creative@ohdbd"});kmn_sa.log("warning: no creativeData/creative in o hdbd, responseData="+n)}};i.serveHdbdCpx=function(k,n){kmn_sa.log("serveHdbdCpx: serving");if(n&&n.creative_data&&n.creative_data.creative){var o=i.getDoc();var m=(o)?(o.getElementById(b+k)):(null);if(m){var l=i.create_iframe(n.creative_data.creative,m,{width:i.getDataVar(k,"w",0),height:i.getDataVar(k,"h",0),border:"0px",frameBorder:"0",scrolling:"no",id:"kmnp-"+k})}else{i.log("can't find div in hdbd l");i.spark(k,{err:"div@lhdbd"})}}else{i.spark(k,{err:"creative@ihdbd"});kmn_sa.log("warning: no creativeData/creative in l hdbd, responseData="+n)}};i.serveHdbdIndex=function(m,o){if(o&&o.creative_data&&o.creative_data.creative){var l=i.getDataVar(m,"winning_bid");if(l){var n=o.creative_data.creative;n.replace("${AUCTION_PRICE}",l);var k=n.replace(/\'/g,"\\'");k=k.replace(/[\n\r\f]/g," ");k='<div id="kmnp-'+m+'">'+k+"</div>";i.getDoc().write(k)}else{i.spark(m,{err:"wp@ihdbd"});i.log("warning: no winning price in j hdbd")}}else{i.spark(m,{err:"creative@ihdbd"});i.log("warning: no creativeData/creative in j hdbd, responseData="+o)}};i.serveHdbdPubmatic=function(l,o){if(o.creative_data){var k=o.creative_data.bidsObject,m=o.creative_data.pbkey,p="//ads.pubmatic.com/AdServer/js/gshowad.js";if(k&&m){if(!d.PubMaticGrouped){g.async_js(p,{},l)}var n=function(){var t="window.bidDetailsMap = {};";t+="var bidString = '"+i.stringify(k)+"';";t+="window.bidDetailsMap['"+m+"'] = JSON.parse(bidString);";var r="";r+="<html><head><script>"+t+"<\/script>";r+="<script src='"+p+"'><\/script>";r+="<script>PubMaticGrouped.displayCreative('"+m+"')<\/script></head><body></body></html>";var u=i.getDoc();var s=(u)?(u.getElementById(b+l)):(null);if(s){i.createIframeWithHtml(r,s,{width:i.getDataVar(l,"w",0),height:i.getDataVar(l,"h",0),border:"0px",frameBorder:"0",scrolling:"no",id:"kmnp-"+l})}else{i.log("can't find div in hdbd p");i.spark(l,{err:"div@phdbd"})}};var q=false;if(!d.PubMaticGrouped&&!q){q=d.setInterval(function(){i.log("dbg: in pubMg interval");d.clearInterval(q);n()},100)}else{if(d.PubMaticGrouped){d.clearInterval(q);n()}}}else{i.log("warning: no bidObject/pbKey in p hdbd");i.spark(l,{err:"bo@phdbd"})}}else{i.log("warning: no creativeData in p hdbd");i.spark(l,{err:"cd@phdbd"})}};i.createIframeWithHtml=function(n,m,l){m=typeof m!=="undefined"?m:document.head;l=typeof l!=="undefined"?l:{};var o=document.createElement("iframe");for(var k in l){o[k]=l[k]}m.appendChild(o);o.contentWindow.document.open();o.contentWindow.document.write(n);o.contentWindow.document.close()};i.getHdbdDataForTag=function(k,m){var l=i.getDataVar(k,"hdbdResponseInUse");if(l&&l.hbbids&&l.hbbids[m]){return l.hbbids[m]}return null};i.isHdbdTag=function(l,m){var k=i.getHdbdDataForTag(l,m);if(k){return true}return false};i.callHdbd=function(m,n){var l=i.getHdbdDataForTag(m,n);var k=false;if(l){try{switch(l.network){case"pubmatic":i.serveHdbdPubmatic(m,l);k=true;break;case"aol":i.serveHdbdAol(m,l);k=true;break;case"cpx":i.serveHdbdCpx(m,l);k=true;break;case"s2s":case"index":i.serveHdbdIndex(m,l);k=true;break;default:i.log("hdbd doesn't know how to serve code "+n)}}catch(o){i.spark(m,{err:"serving@hdbd",dft:i.stringify(l),msg:o.message})}}else{i.spark(m,{err:"tagData@hdbd",msg:"nd"})}i.setDataVar(m,"hdbdServed",k);i.set_ts(m,"hbsv");i.spark(m,{o:i.getDataVar(m,"order"),hbsv:1});return k};i.hdbdTagCallback=function(l){i.log("dbg: Tag callback called for "+l+", starting chain");if(d.kmn_passbacks&&kmn_passbacks[l]){kmn_np.next(l)}else{i.log("np not loaded yet, waiting");var n=0;var k=50;var o=60;var m=setInterval(function(){n++;if(d.kmn_passbacks&&kmn_passbacks[l]){i.log("np loaded, nexting (count="+n+")");clearInterval(m);kmn_np.next(l)}else{if(n>o){i.log("np taking too long, fetching again");clearInterval(m);i.fetch_np(l)}}},k)}};i.readyStateDontWrite=function(k){return(k==="loaded"||k==="complete"||k==="interactive")};i.dtag=function(A){var w={},z=i.live_tags(A),s={l:i.site_url(),v:j.v,cb:kmn_cb},p="tag/";if(z.length){var u,m=[];for(u in z){m.push(i.getDataVar(z[u],"codes",""))}s.s=z.join(";");s.codes=m.join(";")}if(d.kmn_siteurl){s.um=kmn_siteurl}var y,l=i.tags[A].cnt,o=i.getKmniDiv(A),r=(o||i.tags[A].async||i.readyStateDontWrite(f.readyState));if(kmn_force_iframe==="yes"){r=true}else{if(kmn_force_iframe==="no"){r=false}}if(l>1){s.n=l;var v=0,t=f.getElementsByTagName("div"),n=f.getElementById(b+A),q=!(i.tags[A].div||n);if(!q){for(;v<t.length;v++){if(t[v]===i.tags[A].div||t[v]===n){q=t[v]}}}if(!q){if(!i.tags[A].srv){i.house(A)}i.tags[A].ar=s.ar=1;komoona_xd.receive(function(B){i.handle(B.data)})}s.chain=i.getDataVar(A,"codes","");if(n){y=i.findTag(n,A)}s.loop=y?true:false;p="passback/hp/";if(o&&!i.tags[A].ar){o.setAttribute("id",c+A+"_"+l)}}else{if(r){delete s.l;w.asmk=1}i.spark(A,w)}var x=i.getDataVar(A,"hdbdResponseStatus");if(x===i.HDBD_STATE_RECEIVED||x===i.HDBD_STATE_FULL){i.log("tag["+A+"]: using hdbd data");s.hbBids=i.getBidDataForACall(A);r=true}var k=g.stat_src(j.base_url+p+A+".js",s);if(j.debug){k+="&"+e}i.log("tag["+k+"]async["+r+"]");if(!r){i.write_js(k)}else{i.atag(A,k+"&asmk=1",o)}};i.atag=function(k,o,q){i.tags[k].srv=1;try{if(!q){q=i.addKmniDiv(k)}if(q){var m=d.atob,p=(m?"about:blank":o.replace(k+".js?",k+".html?")),l=i.create_iframe(p,q,{});if(l){o='document.write(\'<script type="text/javascript" src="'+o+"&l='+encodeURIComponent(kmn_sa.site_url())+'\"></'+'script>');";i.log("atag["+o+"]");i.iframe_content(l,i.build_js(o,1),k,0)}}}catch(n){i.spark(k,{err:"atag@sa",msg:n.message})}};i.getKmniDiv=function(l){var q,o=c+l,k=0,m=f.getElementsByTagName("div");try{for(;k<m.length;k++){if(m[k].id===o&&m[k].className.indexOf(a)===-1){q=m[k];var n=q.className||"";if(q.classList){q.classList.add(a)}else{q.className=(n!=="")?(n+" "+a):a}break}}}catch(p){}return q};i.getKmniId=function(l){var k=i.tags[l].ar||i.tags[l].cnt,m=c+l+(k>1?"_"+k:"");return m};i.addKmniDiv=function(m){var l,k=i.getKmniId(m),p=f.getElementById(k);i.log("kmnid["+k+"]["+p+"]");if(!p){try{l=i.findTag(i.getDoc().getElementsByTagName("body")[0],m)}catch(o){}if(l){var n=i.setAttributes(f.createElement("div"),{id:k,"class":a});l.parentNode.insertBefore(n,l)}else{if(!i.readyStateDontWrite(f.readyState)){f.write('<div id="'+k+' class="'+a+'"></div>')}}p=f.getElementById(k)}return p};i.findTag=function(p,m){var n,o,l,k;if(p){try{k=p.getElementsByTagName("script")||[];for(o in k){l=k[o].text||"";if(l.indexOf("kmn_placement")!==-1&&l.indexOf(m)!==-1){n=k[o];break}}}catch(q){}}return n};i.hideElement=function(k){if(k){k.style.display="none";k.style.height="0px"}};i.xtag=function(n){try{var m=n.tid,q=kmn_data[m],t="kmnx_"+m;if(!f.getElementById(t)){i.tags[m].srv=1;i.log(t);var l=f.getElementById(b+m);if(n.idToHide){i.log("hdng obj id "+n.idToHide);var p=f.getElementById(n.idToHide);if(p){i.hideElement(p)}else{i.log("WARNING: couldn't find hdn obj "+n.idToHide)}try{kmn_vid.setVideoTagBeingServed(m,false)}catch(u){i.spark(m,{err:"xtagvid@sa",msg:u.message})}}else{var r=0,k=(l?l.getElementsByTagName(n.e||"ins"):[]);for(;r<k.length;r++){i.hideElement(k[r])}}var o=i.create_iframe("about:blank",l,{id:t,width:n.w,height:n.h});if(o){var s=i.build_js("kmn_data['"+m+"']="+i.stringify(q)+";kmn_sa.get_np('"+m+"')",1);i.iframe_content(o,s,m,1)}}}catch(u){i.spark(m,{err:"xtag@sa",msg:u.message})}};i.iframe_content=function(s,u,z,o){var p="var kmn_cb="+kmn_cb+",kmm_ts="+kmn_ts+",kmn_options="+i.stringify(d.kmn_options||{})+",kmn_data=kmn_data||{};";if(kmn_data[z]){var r=encodeURIComponent(i.stringify(kmn_data[z])).replace(/'/g,"%27");p+='kmn_data["'+z+"\"]=JSON.parse(decodeURIComponent('"+r+"'.replace(/%27/g, \"'\")));"}var C=i.build_js(p,1);var y=(j.debug?"kmn_sa.options.debug=1;":""),w=i.tags[z],k=(w.cnt>1?"":"kmn_sa.initTagParams('"+z+"');kmn_sa.tags['"+z+"'].ts="+i.stringify(w.ts)+";kmn_sa.tags['"+z+"'].async="+w.async+";"),v=i.build_js(y+k,1);if(o){u='<div id="'+b+z+'" class="'+a+'">'+u+"</div>"}var n="<!DOCTYPE HTML><html><head>",B="</body></html>",x="</head>",l=i.build_js(i.options.ext_src+"_"+i.options.sa+".js",0),A=n+C+l+v+x+'<body class="'+a+'">'+u+B;if(!o){var m=encodeURIComponent(A).replace(/'/g,"%27"),q=i.getKmniId(z);A=n+l+"<script>function kload(){komoona_xd.receive(function(response){kmn_sa.handle(response.data);komoona_xd.post(response.data,'*',parent);});;kmn_sa.tags['"+z+'\']={};var ifrm=kmn_sa.create_iframe("about:blank",document.getElementById("'+q+"\"),{}),ifrmDoc=kmn_sa.getIfrmDoc(ifrm);ifrmDoc.open();ifrmDoc.write(decodeURIComponent('"+m+"'));ifrmDoc.close();}<\/script>"+x+'<body onload="kload();"><div id="'+q+'">'+B}var t=i.getIfrmDoc(s);if(t){t.open();t.write(A);t.close()}return A};i.handle=function(n){try{var k=i.parseJson(n);if(k.w&&k.h){if(k.tid){i.xtag(k)}else{if(k.tagid){var m,p=f.getElementById(c+k.tagid);if(p){m=p.getElementsByTagName("iframe")[0];if(m){m.style.display="block";if(!isNaN(k.w)){k.w+="px"}if(!isNaN(k.h)){k.h+="px"}i.setAttributes(m,{width:k.w,height:k.h})}}}}}}catch(o){var l=(k)?(k.tid||k.tagid):(null);if(l){i.spark(l,{err:"handle@sa",msg:o.message})}}};i.parseJson=function(l){var k;try{k=d.JSON&&d.JSON.parse?d.JSON.parse(l):(new Function("return "+l))()}catch(m){}return k||{}};i.stringify=function(p){if(d.JSON&&d.JSON.stringify){return d.JSON.stringify(p)}else{var o=typeof(p);if(o!=="object"||p===null){if(o==="string"){p='"'+p+'"'}return String(p)}else{var q,l,m=[],k=(p&&p.constructor===Array);for(q in p){if(p.hasOwnProperty(q)){l=p[q];o=typeof(l);if(o==="string"){l='"'+l+'"'}else{if(o==="object"&&l!==null){l=i.stringify(l)}}m.push((k?"":'"'+q+'":')+String(l))}}return(k?"[":"{")+String(m)+(k?"]":"}")}}}}(),komoona_xd=komoona_xd||(function(){var a=window;return{post:function(b,d,c){if(a.postMessage){c.postMessage(b,d.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}},receive:function(c){if(a.postMessage){var b=function(d){return c(d)};if(a.addEventListener){a.addEventListener("message",b,false)}else{a.attachEvent("onmessage",b)}return b}}}}());function generateCb(){var a;try{a=window.top.kmn_cb}catch(b){}return a||kmn_cb||Math.floor((kmn_ts%65536)+(Math.floor(Math.random()*65536)*65536))}if(window.kmn_placement){var tag=window.kmn_placement;delete window.kmn_placement;kmn_sa.tag(tag)}else{var kmnWT=function(c){var b,a;for(b in c){a=c[b];delete c[b];if(typeof(a)==="string"){kmn_sa.tag(a)}}};if(window.kmn_tags){kmnWT(window.kmn_tags)}else{window.setTimeout(function(){if(window.kmn_tags){kmnWT(window.kmn_tags)}},50)}};