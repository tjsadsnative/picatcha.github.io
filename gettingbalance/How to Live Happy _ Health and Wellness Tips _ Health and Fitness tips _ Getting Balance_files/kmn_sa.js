var kmn_data=kmn_data||{},kmn_iframe=kmn_iframe||0,kmn_ts=new Date().getTime(),kmn_next=kmn_next||{},kmn_house=kmn_house||{},kmn_cb=kmn_cb||Math.floor((kmn_ts%65536)+(Math.floor(Math.random()*65536)*65536)),kmn_cstat=kmn_cstat||new function(){var a=this;a.async_js=function(f,d){try{var g,b=kmn_sa,c=document.createElement("script");b.setAttributes(c,b.extend(d||{},{src:f,async:true,type:"text/javascript"}));g=document.getElementsByTagName("head")[0];if(g){g.appendChild(c);c.apnd=1}return c}catch(h){}};a.stat_src=function(b,e){var c,d="?",e=e||{};for(c in e){d+=encodeURIComponent(c)+"="+encodeURIComponent(e[c])+"&"}return(b+d.slice(0,-1))};a.save=function(c,g){try{var f=a.stat_src(c,g),b=a.async_js(f,{});b.onload=b.onreadystatechange=function(){if(!b.readyState||b.readyState==="loaded"||b.readyState==="complete"){b.onload=b.onreadystatechange=null;if(b.parentNode){b.parentNode.removeChild(b)}}};return b}catch(d){}}}(),kmn_sa=kmn_sa||new function(){var j=".komoona.com/",d="border:none;padding:0;margin:0;background:transparent;",b="kmn_tag_",e="kmn-debug=true",k=this,g=kmn_cstat,f=document,c=window,m={base_url:"//a"+j,ext_src:"//cdn"+j+"scripts/kmn",debug:0,stat_url:"//stat"+j+"s",np:"//s"+j+"passback/np/",v:"2.63",cs:{}};k.options=m;k.tags={};k.stMx=120;k.ifrmMx=12;k.is_iframe=function(){var n=0;try{n=(c.location!==c.parent.location)}catch(o){}return n};k.build_js=function(o,n,p){return("<script "+(p?'id="'+p+'" ':"")+'type="text/javascript"'+(n?">"+o:' src="'+o+'">')+"<\/script>")};k.write_js=function(n,o){f.write(k.build_js(n,0,o))};k.extend=function(){var p=0,o,n={};for(;p<arguments.length;p++){for(o in arguments[p]){n[o]=n[o]||arguments[p][o]}}return n};k.setAttributes=function(p,o){try{for(var n in o){p.setAttribute(n,o[n])}return p}catch(q){}};k.cssClass=function(p){try{var r=f.createElement("style"),o="",n=f.getElementsByTagName("head")[0];for(var q in p){o+="."+q+"{"+p[q]+"}"}r.appendChild(f.createTextNode(o));r.setAttribute("type","text/css");if(n){n.appendChild(r)}}catch(s){}};k.create_iframe=function(q,o,n){var p=f.createElement("iframe");k.setAttributes(p,k.extend(n||{},{src:q,marginHeight:0,marginWidth:0,frameBorder:0,scrolling:"no"}));if(o){o.appendChild(p)}return p};k.get_np=function(n){if(c.kmn_passbacks&&kmn_passbacks[n]){kmn_np.next(n)}else{if(kmn_next[n]){delete kmn_next[n]}k.write_js(m.np+n+".js")}};k.getDoc=function(){try{return(k.is_iframe()?c.frameElement.contentDocument||c.frameElement.contentWindow.document:f)}catch(n){}return null};k.callS2s=function(o,q){if(q.s2sBaseUrl){var n,p,r=k.getDoc(),s={layoutid:o,chain:q.codes,cb:kmn_cb,index:q.full_index-1,uts:new Date().getTime(),inFrame:k.is_iframe()?1:0,url:k.site_url(),tz:new Date().getTimezoneOffset()};if(r){p=(r.characterSet?r.characterSet:r.charset);if(p){s.ch=p}}n=g.stat_src(q.s2sBaseUrl+"GetAd",s);k.log("s2s["+n+"]");return k.build_js(n,0)}return""};k.handleVideoTag=function(o,n){kmn_sa.console("vid tag on div "+n);kmn_data[o]["videoDivName"]=n;k.setVideoTagBeingServed(o,true);(function(r,p){if(r.vdb_Player){p(o,r.vdb_Player)}else{var q=arguments.callee;setTimeout(function(){q(r,p)},0)}})(document.getElementById(n),k.onVideoPlayerReady)};k.onVideoPlayerReady=function(r,p){vid=p;var n=[vidible.PLAYLIST_END,vidible.VIDEO_META,vidible.VIDEO_START,vidible.VIDEO_END,vidible.VIDEO_PLAY,vidible.VIDEO_PAUSE,vidible.AD_META,vidible.AD_START,vidible.AD_END,vidible.PLAYER_READY,vidible.VIDEO_DATA_LOADED];var o=20000;var q=setTimeout(function(){kmn_sa.console("videoTimeout: serving passback");k.set_ts(r,"passback_on_vid_timeout");k.serveVideoPassback(r,vid)},o);kmn_data[r]["videoTimeout"]=q;for(i=0;i<n.length;i++){p.addEventListener(n[i],a.bind(undefined,r))}p.addEventListener(vidible.AD_START,function(s){k.clearVideoTimeout(r);k.setVideoAdServed(r,true)});p.addEventListener(vidible.VIDEO_START,function(t){k.clearVideoTimeout(r);var s=false;if(s){kmn_sa.console("DEBUG: never serving passback")}if(s||k.getVideoAdServed(r)){}else{kmn_sa.console("vid started w/out ad, serving passback");k.serveVideoPassback(r,vid)}})};k.clearVideoTimeout=function(n){if(kmn_data[n]["videoTimeout"]){clearTimeout(kmn_data[n]["videoTimeout"])}};k.serveVideoPassback=function(q,o){var p=b+q;var n=kmn_sa.getDataVar(q,"videoDivName");if(n){o.mute();o.pause();k.xtag({idToHide:n,w:k.getDataVar(q,"w"),h:k.getDataVar(q,"h"),tid:q})}else{kmn_sa.console("WARNING: couldn't find video div")}};k.setVideoAdServed=function(o,n){kmn_data[o]["videoAdServed"]=n};k.getVideoAdServed=function(n){return kmn_sa.getDataVar(n,"videoAdServed",false)};k.setVideoTagBeingServed=function(o,n){kmn_data[o]["videoTagBeingServed"]=n};function a(n,o){try{var q="(no JSON.stringify)";if(JSON.stringify){q=JSON.stringify(o,h)}kmn_sa.log("video event caught, tagid="+n+": "+q);if(o.type==vidible.VIDEO_START||o.type==vidible.AD_START||o.type==vidible.PLAYER_READY){k.set_ts(n,o.type)}k.spark(n,{playerid:o.data.videoId,vidEvtType:o.type,vidIsAd:o.data.isAd,vidDuration:o.data.duration,vidPlayerType:o.data.playerType})}catch(p){}}var l=[];function h(n,o){if(typeof o==="object"&&o!==null){if(l.indexOf(o)!==-1){return}l.push(o)}return o}k.s2sServerIncrement=function(p,n){if(n>1&&kmn_data[p]){var u=kmn_data[p],s=u.full_index,r=s,q=(s+n-1),o=u.order,t=u.codes;for(;r<q;r++){o=t[r].split("").reverse().join("")+"|"+o}u.order=o;u.full_index=q}};k.useS2sOn=function(o,p){try{var q=kmn_data[o]||{};if(q.s2sCodes){var n=q.s2sCodes.indexOf(p.charAt(0))>-1;if(n&&q.s2sExcludedTags){n=!(q.s2sExcludedTags.indexOf(p)>-1)}return n}}catch(r){}return 0};k.site_url=function(){var o="",n="";o=n=(k.is_iframe()&&f.referrer!=="")?f.referrer:c.location.href;if(o.indexOf("javascript:window")!==-1||o.indexOf("about:blank")!==-1){try{o=c.parent.location.href}catch(p){o=n}}if(o.length>1024){o=o.replace(/([^:]+:\/\/[^\/]+).*/,"$1")}return o};k.is_debug=function(){try{var p=0,q=0,o=c.location.href,n=o.slice(o.indexOf("?")+1).split("&");for(;p<n.length;p++){if(n[p]===e){q=1}}m.debug=q;if(q&&!c.console){c.console={log:function(){}}}}catch(r){}};k.live_tags=function(p){var n,o=[];for(n in k.tags){if(n!==p&&!k.tags[n].replace){o.push(n)}}return o};k.spark=function(p,s){try{var q=k.extend({tagid:p,v:m.v,cb:kmn_cb,ds:f.readyState},s||{}),o=k.live_tags(p);if(s.codes){k.set_ts(p,"s")}if(c.kmn_siteurl){q.um=kmn_siteurl}if(k.tags[p]){var n=k.tags[p].ts||[];q.ts=n.join("|")}if(o.length){q.p=o.join(";")}if(!q.l){q.d=k.site_url()}k.log("sprk"+k.stringify(q));g.save(m.stat_url,q);return q}catch(r){}};k.set_ts=function(p,r){try{var n=k.tags[p]||{},q=(new Date().getTime())-n.start,o=n.ts||[];o.push(r+":"+q)}catch(s){}return q||-1};k.log=function(p){if(m.debug){var o=new Date(),n=o.getHours()+":"+o.getMinutes()+":"+o.getSeconds()+":"+o.getMilliseconds();c.console.log("["+n+"] "+p)}};k.console=function(n){k.log(n)};k.fetch_np=function(o){try{if(o.indexOf("_")===-1&&!kmn_next[o]&&!kmn_iframe){kmn_next[o]={render:0};var n=g.async_js(m.np+o+".js",{id:"np-"+o});if(n.apnd){n.onload=n.onreadystatechange=function(){if(!n.readyState||n.readyState==="loaded"||n.readyState==="complete"){n.onload=n.onreadystatechange=null;kmn_next[o]={render:1};n.removeAttribute("id");k.set_ts(o,"np");k.log("np@d["+o+"]")}}}else{delete kmn_next[o]}}}catch(p){}};k.initTagParams=function(n){try{k.xd=k.xd||komoona_xd.receive(function(p){k.handle(p.data)});if((!Array.prototype.indexOf||!Function.prototype.bind)&&!c.kmn_bc){k.write_js(m.ext_src+"-bc.js")}}catch(o){}k.tags[n]={srv:0,timer:null,ifrm:0,st:0,ts:[],start:kmn_ts,wait:0,cnt:1};k.set_ts(n,"t");k.fetch_np(n);k.statTimer(n)};k.replaceTagParams=function(o,n){if(k.tags[o]){c.clearInterval(k.tags[o].timer);k.tags[n]=k.extend(k.tags[o]);k.tags[o].replace=0;k.statTimer(n)}};k.elemHeight=function(r){var p=-1;try{if(r){if(r.getBoundingClientRect){var q=r.getBoundingClientRect();if(q.top&&q.bottom){p=q.bottom-q.top}}if(p===-1){var o=r.clientHeight||0,s=r.offsetHeight||0,n=r.scrollHeight||0;p=Math.max(s,o,n)}}}catch(t){}return p};k.statsParams=function(n){var p={h:k.elemHeight(f.getElementById(b+n))},o=kmn_data[n];if(o){p.o=o.order;p.ch=o.codes.join("|")}return p};k.label=function(q,p){try{var o,n=k.tags[q],r=kmn_data[q],t=f.getElementById(b+q);if(n.lbl&&r&&t&&p!==1){o=k.setAttributes(f.createElement("a"),{id:"lbl_"+q,"class":"kmn-lbl",target:"_blank",href:n.lbl.lnk});o.appendChild(f.createTextNode(n.lbl.txt));t.style.width=r.w+"px";t.style.height=r.h+"px";t.appendChild(o)}return o}catch(s){}};k.house=function(o){try{var r=k.statsParams(o),n=r.o,q=(r.h!==-1);if(!k.tags[o].srv){k.tags[o].srv=1;if(n.indexOf("h")===-1){r.o="h"+(n.length?"|"+n:"")}r.had=1;r.l=k.site_url();k.set_ts(o,"h");k.set_ts(o,"p")}else{r.house=1;q=(k.tags[o].cnt===1)&&q}k.log("house|"+o+"|"+q+"|"+k.stringify(r));if(q){k.spark(o,r)}}catch(p){}};k.stats=function(n,o){if(!k.tags[n].srv){k.tags[n].srv=1;k.log("stats["+n+"]o["+o.o+"]h["+o.h+"]");o.l=k.site_url();k.spark(n,o)}};k.statTimer=function(n){k.tags[n].timer=c.setInterval(function(){k.statHandler(n)},250)};k.statHandler=function(q){var z=k.tags[q]||{};if(z.srv){c.clearInterval(z.timer)}else{z.st+=1;var t=k.statsParams(q),o=f.getElementById(b+q),r=t.o||"",A=k.getDataVar(q,"h",50),u=0;if(o){if(z.st===k.stMx){k.set_ts(q,"tsa");k.spark(q,{o:r,h:t.h,err:"timeout@sa"})}else{if(r.indexOf("h")===-1){if(t.h>=A&&(!k.getDataVar(q,"videoTagBeingServed")||k.getDataVar(q,"videoAdServed"))){var y=o.getElementsByTagName("iframe");if(!y.length){if(z.wait++){u=2}}else{var w,x=0;for(w=0;w<y.length;w++){x=(y[w].offsetHeight!==0&&y[w].style.display!=="none")||x}if(x){var n=r.split("|"),s=n[0];if(s.indexOf("x")!==-1||s.indexOf("w")!==-1){if(z.ifrm++>=k.ifrmMx){u=3}}else{u=4}}else{if(z.wait++>3){u=5}}}}if(u){k.label(q,u);var p,v=kmn_data[q];if(v){p=v.codes[v.full_index-1];if(p){k.set_ts(q,p)}}k.set_ts(q,"p");t.status=u;k.stats(q,t)}}}}else{if(z.st===50){k.set_ts(q,"wsa");k.spark(q,{err:"wrapper@sa",o:r})}}}};k.cookieSync=function(n,o){if(!m.cs.js){m.cs.js=g.async_js(m.ext_src+"-cs.js",{})}if(!c.kmn_cs&&!m.cs[n]){m.cs[n]=c.setInterval(function(){k.cookieSync(n,o)},100)}else{if(c.kmn_cs){c.clearInterval(m.cs[n]);kmn_cs.cookieSync(n,o)}}};k.heartbeat=function(n){if(!c.kmn_hb&&!m.hb){g.async_js(m.ext_src+"-hb.js",{});m.hb=c.setInterval(function(){k.heartbeat(n)},50)}else{if(c.kmn_hb){c.clearInterval(m.hb);kmn_hb.start(n)}}};k.getDataVar=function(o,n,p){if(kmn_data[o]&&kmn_data[o][n]){return kmn_data[o][n]}return p||null};k.tag=function(o){try{var n=k.tags;k.is_debug();if(c.kmn_size){o=o+"_"+kmn_size.replace("x","_");delete kmn_size}if(c.kmn_passback){kmn_house[o]=kmn_passback;delete kmn_passback}if(!n[o]){k.initTagParams(o)}else{n[o].cnt+=1}k.dtag(o)}catch(p){k.spark(o,{err:"tag@sa",msg:p.message})}};k.dtag=function(A){var x={},z=k.live_tags(A),v={l:k.site_url(),v:m.v,cb:kmn_cb},t="tag/";if(z.length){var w,p=[];for(w in z){p.push(k.getDataVar(z[w],"codes",""))}v.s=z.join(";");v.codes=p.join(";")}if(c.kmn_siteurl){v.um=kmn_siteurl}var y,s="kmn-sa-"+A,o=k.tags[A].cnt,r=f.getElementById("kmni_"+A),u=(r||kmn_iframe);if(o>1){v.n=o;v.chain=k.getDataVar(A,"codes","");var q=f.getElementById(b+A);if(q){y=k.findTag(q,A)}v.loop=y?true:false;s+="-"+o;t="passback/hp/"}else{if(u){x.asmk=1}k.spark(A,x)}var n=g.stat_src(m.base_url+t+A+".js",v);if(m.debug){n+="&"+e}k.log("tag["+n+"]async["+u+"]");if(!u){k.write_js(n,s);y=f.getElementById(s);if(y){y.removeAttribute("id")}else{u=1}}if(u){k.atag(A,n,o,r)}};k.atag=function(n,s,o,u){kmn_iframe=0;k.tags[n].srv=1;try{if(!u){var p,t="kmni_"+n+(o>1?"_"+o:"");try{p=k.findTag(f.getElementsByTagName("body")[0],n)}catch(r){}if(p){u=k.setAttributes(f.createElement("div"),{id:t,style:d});p.parentNode.appendChild(u)}else{f.write('<div id="'+t+'" class="kmn-div"></div>');u=f.getElementById(t)}}var q=k.create_iframe("about:blank",u,{});if(q){k.iframe_content(q,k.build_js(s+"&asmk=1",0),n)}}catch(r){}};k.findTag=function(s,p){var q,r,o,n;if(s){try{n=s.getElementsByTagName("script")||[];for(r in n){o=n[r].text||"";if(o.indexOf("kmn_placement")!==-1&&o.indexOf(p)!==-1){q=n[r];break}}}catch(t){}}return q};k.hideElement=function(n){if(n){n.style.display="none";n.style.height="0px"}};k.xtag=function(q){try{var p=q.tid,t=kmn_data[p],w="kmnx_"+p;if(!f.getElementById(w)){k.tags[p].srv=1;k.log(w);var o=f.getElementById(b+p);if(q.idToHide){kmn_sa.console("hdng obj id "+q.idToHide);var s=f.getElementById(q.idToHide);if(s){k.hideElement(s)}else{kmn_sa.console("WARNING: couldn't find hdn obj "+q.idToHide)}k.setVideoTagBeingServed(p,false)}else{var u=0,n=(o?o.getElementsByTagName(q.e||"ins"):[]);for(;u<n.length;u++){k.hideElement(n[u])}}var r=k.create_iframe("about:blank",o,{id:w,width:q.w,height:q.h});if(r){var v=k.build_js("kmn_data['"+p+"']="+k.stringify(t)+";kmn_sa.get_np('"+p+"')",1);k.iframe_content(r,v,p)}}}catch(x){}};k.iframe_content=function(p,n,o){var s=k.build_js("var kmn_cb="+kmn_cb+",kmm_ts="+kmn_ts+(m.debug?";kmn_sa.options.debug=1":"")+";kmn_sa.initTagParams('"+o+"');kmn_sa.tags[\""+o+'"].ts='+k.stringify(k.tags[o].ts)+";",1),q='<!DOCTYPE HTML><html><head><meta name="robots" content="noindex,nofollow">'+k.build_js(m.ext_src+"_sa.js",0)+s+'</head><body style="'+d+'"><div id="'+b+o+'">'+n+"</div></body></html>";var r=(p.contentDocument?p.contentDocument:(p.contentWindow?p.contentWindow.document:(p.document?p.document:0)));if(r){r.open();r.write(q);r.close()}};k.handle=function(p){k.log("hndl["+p+"]");try{var n=k.parseJson(p);if(n.w&&n.h){if(n.tid){k.xtag(n)}else{if(n.tagid){var o,r=f.getElementById("kmni_"+n.tagid);if(r){o=r.getElementsByTagName("iframe")[0];o.style.display="block";if(!isNaN(n.w)){n.w+="px"}if(!isNaN(n.h)){n.h+="px"}k.setAttributes(o,{width:n.w,height:n.h})}}}}}catch(q){}};k.parseJson=function(o){var n;try{n=c.JSON&&c.JSON.parse?c.JSON.parse(o):(new Function("return "+o))()}catch(p){}return n||{}};k.stringify=function(s){if(c.JSON&&c.JSON.stringify){return c.JSON.stringify(s)}else{var r=typeof(s);if(r!=="object"||s===null){if(r==="string"){s='"'+s+'"'}return String(s)}else{var u,p,q=[],o=(s&&s.constructor===Array);for(u in s){if(s.hasOwnProperty(u)){p=s[u];r=typeof(p);if(r==="string"){p='"'+p+'"'}else{if(r==="object"&&p!==null){p=k.stringify(p)}}q.push((o?"":'"'+u+'":')+String(p))}}return(o?"[":"{")+String(q)+(o?"]":"}")}}}}(),komoona_xd=komoona_xd||(function(){var a=window;return{post:function(b,d,c){if(a.postMessage){c.postMessage(b,d.replace(/([^:]+:\/\/[^\/]+).*/,"$1"))}},receive:function(c){if(a.postMessage){var b=function(d){return c(d)};if(a.addEventListener){a.addEventListener("message",b,false)}else{a.attachEvent("onmessage",b)}return b}}}}());if(window.kmn_placement){var tag=kmn_placement;delete kmn_placement;kmn_sa.tag(tag)}else{if(window.kmn_tags){for(var index in kmn_tags){var tag=kmn_tags[index];if(!kmn_sa.tags[tag]){kmn_sa.tag(tag)}}}};