var version="2.26.1";try{var isMsie=(/msie/i).test(window.navigator.userAgent.toLowerCase());if((typeof mraid==="undefined")&&isMsie){console={};console.log=function(b){};console.debug=console.info=console.warn=console.error=console.log}(function(){var b=false,c=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.JRClass=function(){};JRClass.extend=function(h){var g=this.prototype;b=true;var f=new this();b=false;for(var e in h){f[e]=typeof h[e]=="function"&&typeof g[e]=="function"&&c.test(h[e])?(function(j,k){return function(){var m=this._super;this._super=g[j];var l=k.apply(this,arguments);this._super=m;return l}})(e,h[e]):h[e]}function d(){if(!b&&this.init){this.init.apply(this,arguments)}}d.prototype=f;d.constructor=d;d.extend=arguments.callee;return d}})();var tm=JRClass.extend({init:function(c){var b=/^\<(.*)\>$/,d=b.exec(c);this.el=d&&d.length>0?document.createElement(d[1]):typeof c=="object"?c:document.querySelector(c);return this},addClass:function(b){if(!this.hasClass(b)){this.el.className+=" "+b;this.el.className=this.ltrim(this.el.className)}return this},removeClass:function(b){if(this.hasClass(b)){this.el.className=this.rtrim(this.el.className.replace(new RegExp("(\\s|^)"+b+"(\\s|$)")," "))}return this},hasClass:function(b){return this.el.className.match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},ltrim:function(b){return b.replace(/^\s+/,"")},rtrim:function(b){return b.replace(/\s+$/,"")},html:function(b){if(b){this.el.innerHTML=b;return this}return this.el.innerHTML},attr:function(){if(arguments.length>1){this.el.setAttribute(arguments[0],arguments[1]);return this}else{if(typeof arguments[0]=="object"){for(var b in arguments[0]){if(typeof arguments[0][b]!="function"){this.el.setAttribute(b,arguments[0][b])}}return this}else{return this.el.getAttribute(arguments[0])}}},css:function(){if(arguments.length>1){if(this.el.style.setProperty){this.el.style.setProperty(arguments[0],arguments[1],"")}else{this.el.style[arguments[0]]=arguments[1]}return this}else{if(typeof arguments[0]=="object"){for(var b in arguments[0]){if(this.el.style.setProperty){this.el.style.setProperty(b,arguments[0][b],"")}else{this.el.style[b]=arguments[0][b]}}return this}else{if(window.getComputedStyle){return window.getComputedStyle(this.el).getPropertyValue(arguments[0])}else{if(document.currentStyle){return document.currentStyle[arguments[0]]}else{return this.el.style.getPropertyValue(arguments[0])}}}}},appendTo:function(b){b.appendChild(this.el)},append:function(b){this.el.appendChild(b.el)},prepend:function(b){this.el.insertBefore(b.el,this.el.firstChild)},bind:function(c,g){c=c.split(" ");var b=this;$(c).each(function(d,e){if(b.el.addEventListener){b.el.addEventListener(e,function(f){g.call(this,f)},false)}else{b.el.attachEvent(e,function(f){g.call(this,f)})}})},unbind:function(c,g){c=c.split(" ");var b=this;$(c).each(function(d,e){if(b.el.removeEventListener){b.el.removeEventListener(e,function(f){g.call(this,f)},false)}else{b.el.detachEvent(e,function(f){g.call(this,f)})}})},each:function(b,g){for(var c in this.el){if(typeof this.el[c]!="function"){b.call(g,c,this.el[c],this.el)}}},size:function(){var b=this.el.length?this.el.length:0;for(var e in this.el){if(typeof this.el[e]!="function"){b++}}return b},width:function(){return this.el.offsetWidth},height:function(){return this.el.offsetHeight},parent:function(){this.el=this.el.parentNode;return this}});function $(c){return new tm(c)}var extend=function(e,c){if(arguments.length>2){for(var b=1;b<arguments.length;b++){extend(e,arguments[b])}}else{for(var d in c){e[d]=c[d]}}return e};var collect=function(b,e){var g=[];for(var d=0;d<b.length;d++){var c=e(b[d]);if(c!=null){g.push(c)}}return g};var thisTM=(function(){var c,k,b,e;var m;var d="fileName";var l="stack";var j="stacktrace";var g=function(n,o){return m=o};if(!!document.currentScript){m=document.currentScript.src}else{try{nope()}catch(h){if(d in h){m=h[d]}else{if(j in h){h[j].replace(/called from line \d+, column \d+ in (.*):/gm,g)}else{if(l in h){h[l].replace(/at.*?\(?(\S+):\d+:\d+\)?$/g,g)}}}}}c=m.split("?")[1].split("&");for(b=0;b<c.length;b++){e=c[b].split("=");if(e[0]=="sessId"){k=e[1];break}}if(typeof TM_array!="undefined"&&!!TM_array[k]){var f=TM_array[k]}if(typeof f=="undefined"){f={}}return f})();(function(TM){var videoNode={src:{mp4:{url:"",type:""},ogg:{url:"",type:""},webm:{url:"",type:""}},width:300,height:250,poster:"",fullscreen:true,timeout:10000,autoplay:false,onFullscreen:function(){},onStart:function(){},onEnd:function(){},onClick:function(){},callback:function(){}};var docObj,feed,adTracker,vidPaused=false,notUsed=null,videoStarted=false,winplayInfo=[],videoObjectForWinplay,mraidStateTrail=[],isMraid;var videoInit=function(methodObject,containingElement){console.log("videoInit() ");try{notUsed=containingElement||$(document.body);if(methodObject){extend(videoNode,methodObject)}}catch(e){console.log("videoInit Error "+e.toString())}initDocObj()};var browserDetect={isIE:function(){return !+"\v1"},isIPad:function(){return !!navigator.userAgent.match(/iPad/i)},isIPhone:function(){return !!navigator.userAgent.match(/iPhone/i)},isIOS:function(){return browserDetect.isIPhone()||browserDetect.isIPad()},iOSVersion:function(){var a=navigator.userAgent.match(/OS (\d+)_/i);if(a&&a[1]){return a[1]}else{return false}},isAndroid:function(){return !!navigator.userAgent.match(/Android/i)},androidVersion:function(){var a=navigator.userAgent.match(/Android (\d+)\./i);if(a&&a[1]){return a[1]}else{return false}}};var tmVideoPlayer={videoReachedEnd:false,buffer:{start:null,end:null},readyState:{HAVE_NOTHING:0,HAVE_METADATA:1,HAVE_CURRENT_DATA:2,HAVE_FUTURE_DATA:3,HAVE_ENOUGH_DATA:4},buffered:function(){if(!!tmVideoPlayer.buffer.start){tmVideoPlayer.buffer.start=0;tmVideoPlayer.buffer.end=0}if(docObj.video.el.buffered&&docObj.video.el.buffered.length>0){var a=docObj.video.el.buffered.end(0);if(a>tmVideoPlayer.buffer.end){tmVideoPlayer.buffer.end=a}}else{tmVideoPlayer.buffer.end=1}return[tmVideoPlayer.buffer.start,tmVideoPlayer.buffer.end]},loader:{show:function(){},hide:function(){docObj.loader.removeClass("v")}},supportsFullScreen:function(){return docObj.video.el.webkitSupportsFullscreen},toggleFullScreenMode:function(){if(!docObj.body.hasClass("tm-video-fullscreen-mode")){this.enterFullScreen()}else{this.videoReachedEnd=false;this.exitFullScreen()}},enterFullScreen:function(){videoNode.onFullscreen();if(!isMraid&&docObj.video.el.webkitSupportsFullscreen){docObj.video.el.addEventListener("webkitendfullscreen",function(){tmVideoPlayer.videoReachedEnd=false;tmVideoPlayer.exitFullScreen()},false);docObj.video.el.webkitEnterFullscreen()}else{docObj.body.addClass("tm-video-fullscreen-mode");window.addEventListener("resize",adObj.resizeAll,false);adObj.resizeAll()}},exitFullScreen:function(){console.log("exitFullScreen()");videoNode.onFullscreen();if(
/*isMraid &&*/
adParts[0].type!="player"){docObj.video.el.currentTime=0;this.pause();videoStarted=false;if(!this.videoReachedEnd){console.log("Going BACK one adPartâ€¦");activeAdPartSequence--;startAdPart()}}if(this.supportsFullScreen()){docObj.video.el.webkitExitFullscreen()}docObj.body.removeClass("tm-video-fullscreen-mode");window.removeEventListener("resize",adObj.resizeAll,false);adObj.resizeAll()},play:function(){docObj.video.el.play();iFrameApiHelpers.sendResume()},pause:function(){docObj.video.el.pause();iFrameApiHelpers.sendPause()},hasStarted:function(){return videoStarted}};var initializeWinplay=function(){console.log("initializeWinplay() "+thisTM.PlaytimeAnalytics);if(!!thisTM.PlaytimeAnalytics){winplayInfo.vinst=(adModel.theFeed.vtrusted&&String(adModel.theFeed.vtrusted).toLowerCase()=="t")?"t":"f";winplayInfo.paId=adModel.theFeed.paId;winplayInfo.psId=adModel.theFeed.psId;winplayInfo.bi=adModel.theFeed.bi;winplayInfo.pt=adModel.theFeed.pt||"view";winplayInfo.price=adModel.theFeed.price;winplayInfo.adEngagementViewQP=adModel.theFeed.adEngViewQP;winplayInfo.adEngagementClickThruQP=adModel.theFeed.adEngClickThruQP;winplayInfo.statsBaseURL=adModel.theFeed.statsBaseURL;winplayInfo.autoplay=(!!promotedVideoJson&&promotedVideoJson.autoPlay);if(!!adModel.theFeed.tagParams){winplayInfo.clickThroughUrlPrefix=adModel.theFeed.tagParams.clickthroughurlprefix}winplayInfo.burl=getBurl();winplayInfo.sessId=winplayInfo.playerInstanceId?winplayInfo.playerInstanceId:"preview";winplayInfo.did=adModel.theFeed.did;winplayInfo.didtype=adModel.theFeed.didtype;winplayInfo.nc=adModel.theFeed.nc;winplayInfo.pixels=adModel.theFeed.pixels;console.log("+++++++++++++++++++++ INITIALIZING ADtRACKER ++++++++++++++++");adTracker=thisTM.PlaytimeAnalytics.newAdTracker(winplayInfo)}};var initializeVideoTracker=function(){console.log("initializeVideoTracker()");if(!!adTracker&&!!videoObjectForWinplay){adObj.videoTracker=adTracker.newVideoTracker({pvId:winplayInfo.pvId,duration:videoObjectForWinplay.duration,autoplay:winplayInfo.autoplay,volume:videoObjectForWinplay.muted?0:videoObjectForWinplay.volume,playheadTime:videoObjectForWinplay.currentTime})}};var bindHandlers=function(){console.log("BIND HANDLERS ");docObj.play_pause.bind("click",function(){console.log("play_pause clicked");if(docObj.video_container.hasClass("tm-video-paused")){videoObj.play()}else{videoObj.pause()}},false);docObj.video.bind("click",videoHandlers.handleClick);docObj.video.bind("ended",videoHandlers.handleEnded);docObj.video.bind("seeking",videoHandlers.handleSeeking);docObj.video.bind("seeked",videoHandlers.handleSeeked);docObj.video.bind("progress",videoHandlers.handleProgress);docObj.video.bind("timeupdate",videoHandlers.handleTimeupdate);docObj.video.bind("durationchange",videoHandlers.handleDurationchange);docObj.video.bind("loadeddata",videoHandlers.handleLoadeddata);docObj.video.bind("play",videoHandlers.handlePlay);docObj.video.bind("pause",videoHandlers.handlePause);docObj.video.bind("canplaythrough",videoHandlers.handleCanplaythrough)};var videoHandlers={handleClick:function(){console.log("videoHandlers.handleClick()");if(docObj.video_container.hasClass("tm-video-paused")){videoStarted=true;videoObj.play()}else{videoNode.onClick();videoObj.pause()}},handleEnded:function(){console.log("videoHandlers.handleEnded; duration is "+this.duration);if(this.duration<6000&&this.duration>1){videoObj.pause();videoObj.onEnd();tmVideoPlayer.videoReachedEnd=true;tmVideoPlayer.exitFullScreen()}},handleTimeupdate:function(){var currentTimeObj=dateUtil.toObject(this.currentTime);try{tmVideoPlayer.timer.update(currentTimeObj)}catch(e){console.log("Unable to update video obj timer.")}},handleSeeking:function(){},handleSeeked:function(){},handleDurationchange:function(){console.log("handleDurationchange");if((adObj.videoTracker==null||adObj.videoTracker==undefined)&&this.duration<6000&&this.duration>1){videoObjectForWinplay=this;initializeVideoTracker()}},handleProgress:function(){console.log("PROGRESS!!!! duration: "+this.duration)},handleLoadeddata:function(){console.log("####### LOADEDDATA #######");if(isMraid&&mraid.isViewable()!=false&&mraid.isViewable()!="false"){console.log("loadeddata: activeAdPartSequence: "+activeAdPartSequence)}else{if(!isMraid&&adModel.adType==MRAID_TTP){tmVideoPlayer.enterFullScreen()}}if(isMraid&&adModel.adType==MRAID_INTERSTITIAL){console.log("loadeddata: interstitial case")}},handlePlay:function(){if(docObj.big_play){docObj.big_play.removeClass("v")}z.bigPlayButtonClicked=true;docObj.video_container.removeClass("tm-video-paused").addClass("tm-video-playing");setTimeout(function(){if(docObj.video.el.readyState==tmVideoPlayer.readyState.HAVE_NOTHING){docObj.loader.html("<span>Unable to load video</span>")}},videoNode.timeout);if(!isMraid&&adModel.adType==MRAID_TTP){console.log("mobile_app_ctp");tmVideoPlayer.enterFullScreen()}},handlePause:function(){docObj.video_container.removeClass("tm-video-playing").addClass("tm-video-paused")},handleCanplaythrough:function(){console.log("####### CAN PLAY THROUGH #######");console.log("videoStarted: "+videoStarted);if(videoStarted){videoObj.play()}}};var getBurl=function(){var burl="Unknown";try{burl=window.location.href.toString();if(burl.indexOf("facebook.com/")>-1){var burlHalves=burl.split("?");burl=burlHalves[0]+"---REDACTED_FOR_PRIVACY---"}}catch(error){}return burl};var z={handleLocked:false,onController:false,bigPlayButtonClicked:false};var x={mousemove:null};var dateUtil={toText:function(a){return(a.h>0?a.h+":":"")+a.m+":"+a.s},toObject:function(b){var c=Math.floor(b/(60*60));var d=b%(60*60);var e=Math.floor(d/60);var a=d%60;var f=Math.floor(a);return{h:c<10?"0"+c:c,m:e<10?"0"+e:e,s:f<10?"0"+f:f}}};var initDocObj=function(){console.log("initDocObj()");var vidDims=getVideoPosition();if(!docObj){docObj={body:$(document.body),video_container:$("#tm-video-container").addClass("tm-video-container tm-video-paused").css({position:"absolute","z-index":"1000",background:"transparent"}),video:$("#tm-video-space").addClass("tm-video").attr({preload:"auto","webkit-playsinline":""}).css({width:"100%",height:"100%"}),p_unsupported:$("<p>").addClass("tm-video-src-error-txt").html("Video not supported on your browser"),loader:$("<div>").addClass("tm-video-loader"),controls_container:$("<div>"),play_pause:$("<div>").addClass("tm-video-play-pause-control").html("<span></span>")};bindHandlers();$(videoNode.src).each(function(unused,d){var vidSourceNode=$("<source>");if(d.url!=""){vidSourceNode.attr("src",d.url)}if(!browserDetect.isAndroid()&&d.type){vidSourceNode.attr("type",d.type)}docObj.video.append(vidSourceNode)});docObj.video.append(docObj.p_unsupported);if(videoNode.poster){docObj.video.attr("poster",videoNode.poster)}docObj.video_container.append(docObj.loader);if(!tmVideoPlayer.supportsFullScreen()){docObj.fullscreen_overlay=$("<div>");docObj.fullscreen_overlay.addClass("tm-video-fullscreen_overlay");docObj.body.append(docObj.fullscreen_overlay)}if(!browserDetect.isIPhone()){}docObj.controls_container.append(docObj.play_pause)}};var buttonFunctionHolder={bigPlayButton:function(){docObj.big_play=$("<div>").addClass("tm-video-big-play-button v").html("<span></span>");docObj.video_container.append(docObj.big_play);docObj.big_play.bind("click",function(a){videoObj.play();tmVideoPlayer.loader.show()})}};var Video=JRClass.extend({init:videoInit,play:tmVideoPlayer.play,pause:tmVideoPlayer.pause,hasStarted:tmVideoPlayer.hasStarted,player:tmVideoPlayer,device:browserDetect});var logLevels={NONE:-1,CONSOLE:0,ALERT:1};var util={DEBUG_LEVEL:0,log:function(msg){if(this.DEBUG_LEVEL==logLevels.CONSOLE){console.log(msg)}else{if(this.DEBUG_LEVEL==logLevels.ALERT){alert(msg)}}},loadJS:function(path,callBack){var scriptElement=document.createElement("script");scriptElement.type="text/javascript";scriptElement.src=path;if(!!callBack){scriptElement.onload=callBack}document.getElementsByTagName("head")[0].appendChild(scriptElement)},loadCSS:function(path,callBack){var linkElement=document.createElement("link");linkElement.rel="stylesheet";linkElement.type="text/css";linkElement.href=path;var img=document.createElement("img");img.onerror=function(){if(!!callBack){callBack()}};img.src=path;document.getElementsByTagName("head")[0].appendChild(linkElement)},isNull:function(val){return !val||val==""||val=="undefined"||val=="null"||typeof(val)=="undefined"},dynamicSort:function(sortOn){return function(I,H){return(I[sortOn]<H[sortOn])?-1:(I[sortOn]>H[sortOn])?1:0}},numericSort:function(sortOn){return function(I,H){return(Number(I[sortOn])<Number(H[sortOn]))?-1:(Number(I[sortOn])>Number(H[sortOn]))?1:0}},clearCanvas:function(_canvas2d,_canvasObj,_hideIfTrue){var hideIfTrue=_hideIfTrue||false;_canvas2d.clearRect(0,0,_canvasObj.width(),_canvasObj.height());if(_hideIfTrue){console.log("Hiding Canvas object "+_canvasObj);_canvasObj.css({display:"none"})}},elementClicked:function(H,G){if(H){if(G[0]>H.x&&G[0]<(H.x+H.width)&&G[1]>H.y&&G[1]<(H.y+H.height)){return true}}return false}};var WEB_TTP="webTtp",MRAID_INTERSTITIAL="mraidInterstitial",MRAID_TTP="mraidTtp";var inplayObj,adModel={theFeed:null,width:null,height:null,adType:null},AdClass=JRClass.extend({inplayInfo:null,videoTracker:null,init:function(winplayInfo){this.inplayInfo=winplayInfo;var thisAdClassInstance=this;window.inplayParams={playerID:"P-5GL-OUB",version:"1.1.0",loadMode:"async",loadCallback:function(){thisAdClassInstance.start.call(thisAdClassInstance)}}},start:function(){console.log("* * * * Start() * * * * * * * * ");initializeWinplay();activeAdPartSequence=0;if(adParts[activeAdPartSequence].type=="player"&&!isMraid||(adModel.adType!=MRAID_TTP&&isMraid&&mraid.getState()=="default"&&mraid.isViewable()!=false&&mraid.isViewable()!="false")){if(!!videoObj&&promotedVideoJson.delay!="infinite"){videoObj.play()}}},clickThrough:function(clickUrl,winplayCall){if(util.isNull(clickUrl)){return}var callHash={emailShares:"eml",facebookShares:"fbs",twitterShares:"tws",bannerClicks:"ct",facebookFanPageClicks:"fbf"};console.log("UserAction: "+winplayCall+" / "+callHash[winplayCall]);console.log("winplayInfo: "+winplayInfo);adObj.videoTracker.userAction(callHash[winplayCall],winplayInfo);if(isMraid){mraid.open(clickUrl)}else{videoObj.pause();window.open(clickUrl,"_newtab","scrollbars=yes,menubar=yes,resizable=yes,toolbar=yes,location=yes,status=yes")}},resizeAll:function(){var vidDims;if(isMraid&&mraid.getState()=="expanded"){var expandedProperties=mraid.getExpandProperties();setAdDims();canvasObj.el.width=adModel.width;canvasObj.el.height=adModel.height;videoObj.width(getAbsFromPercent(promotedVideoJson.width,"width"));videoObj.height(getAbsFromPercent(promotedVideoJson.width,"height"));console.log("New canvas size: "+canvasObj.width()+", "+canvasObj.height())}else{if(isMraid&&mraid.getState()=="default"&&adModel.adType==MRAID_INTERSTITIAL){console.log("MRAID interstitial detected. ");console.log("in the MRAID interstitial case of resizeAll()");var rawWidth=window.innerWidth;var rawHeight=window.innerHeight;if(Math.abs(lastOrientation)===90){console.log("LANDSCAPE.");console.log("raw dims: "+rawWidth+" x "+rawHeight);videoObj.width(Math.max(rawWidth,rawHeight));videoObj.height(Math.min(rawWidth,rawHeight));videoObj.y(0);videoObj.x(0);util.clearCanvas(canvas2d,canvasObj,true)}else{console.log("PORTRAIT");setAdDims();if(!!videoObj){vidDims=getVideoPosition();videoObj.x(vidDims.x);videoObj.y(vidDims.y);videoObj.width(vidDims.w);videoObj.height(vidDims.h);console.log("Video dims in PORTRAIT: "+getVideoPosition().x,getVideoPosition().y,getVideoPosition().w,getVideoPosition().h)}positionAssets(canvas2d,adParts[activeAdPartSequence].assets,true)}}}}});var preppedFeed={},lastOrientation,canvasObj,videoContainer,placementDiv,adParts,pixels,activeAdPartSequence,playerAdPartSequence,promotedVideoJson,vastUrl,videoObj,adObj,ctUrls,streamUpdateInterval,mraidAdStarted=false,myOrigin=document.location,vastTracker,iFrameListenerSet=false,flashDivs=[],iFrameAssets=[];var prepFeed=function(feedObj){var t,m,l,nestedAssets=[],vertical,padding=4,nextCoord=padding;for(t=0;t<feedObj.adParts.length;t++){for(m=0;m<feedObj.adParts[t].assets.length;m++){if(feedObj.adParts[t].assets[m].type=="slate"){vertical=!!((feedObj.adParts[t].assets[m].detail.substr(feedObj.adParts[t].assets[m].detail.indexOf("vertical=")+9,1)=="t"));for(l=0;l<feedObj.adParts[t].assets[m].assets.length;l++){nestedAssets.push(feedObj.adParts[t].assets[m].assets[l])}nestedAssets.sort(util.dynamicSort("layer"));for(l=0;l<nestedAssets.length;l++){nestedAssets[l].x=parseInt(nestedAssets[l].x);nestedAssets[l].y=parseInt(nestedAssets[l].y);if(vertical){nestedAssets[l].x+=parseInt(feedObj.adParts[t].assets[m].x)+padding;nestedAssets[l].y+=parseInt(feedObj.adParts[t].assets[m].y)+nextCoord;nextCoord+=parseInt(nestedAssets[l].height)+padding}else{nestedAssets[l].y+=parseInt(feedObj.adParts[t].assets[m].y)+padding;nestedAssets[l].x+=parseInt(feedObj.adParts[t].assets[m].x)+nextCoord;nextCoord+=parseInt(nestedAssets[l].width)+padding}nestedAssets[l].type="overlay";feedObj.adParts[t].assets[feedObj.adParts[t].assets.length]=nestedAssets[l]}}}}return feedObj};var handleMraidOrientationChange=function(){var expandedProperties=mraid.getExpandProperties();var currentOrientation=(expandedProperties.width>expandedProperties.height)?90:0;if(lastOrientation!=currentOrientation){lastOrientation=currentOrientation;adObj.resizeAll()}};var readDeviceOrientationFromBrowser=function(){if(lastOrientation!=window.orientation){lastOrientation=window.orientation;adObj.resizeAll()}};var addOrientationListeners=function(){readDeviceOrientationFromBrowser();window.onorientationchange=readDeviceOrientationFromBrowser};var setupAd=function(){console.log("****************************");console.log("**		setupAd			**");console.log("****************************");util.DEBUG_LEVEL=0;videoStarted=false;preppedFeed=prepFeed(adModel.theFeed);pixels=preppedFeed.pixels;setAdDims();console.log("setupAd() dims: "+adModel.width+"x"+adModel.height);canvasObj=$("<canvas>").attr({id:"tm_ad_canvas",width:adModel.width,height:adModel.height});var canvasDiv=$("<div>").attr("id","tm-canvas-holder").css("position","absolute");placementDiv=$("div[id^='TM_PlacementDiv']");placementDiv.css("background","#E4E4E4");placementDiv.css("width",adModel.width+"px");placementDiv.css("height",adModel.height+"px");placementDiv.prepend(canvasDiv);canvasDiv.append(canvasObj);canvas2d=canvasObj.el.getContext("2d");adParts=preppedFeed.adParts;adParts.sort(util.dynamicSort("sequence"));for(var H=0;H<adParts.length;H++){if(adParts[H].type=="player"){playerAdPartSequence=H;for(var i=0;i<adParts[H].assets.length;i++){if(adParts[H].assets[i]["type"]=="promoted_video"){promotedVideoJson=adParts[H].assets[i];break}else{if(adParts[H].assets[i]["type"]=="vast"){vastUrl=adParts[H].assets[i].detail;break}}}}adParts[H].sequence=H;adParts[H].assets=adParts[H].assets.sort(util.dynamicSort("layer"))}if(!!promotedVideoJson){prepPromotedVideo();if(adModel.theFeed.adClass=="BAP"){addUnmuteBar();docObj.video.el.volume=0}}else{if(!!vastUrl){DMVAST.client.get(vastUrl,function(response){if(response){var candidateVideoNodes=[],bestWidthVideoNodes=[],chosenVideoNode,adIdx,ad,pixId,creaIdx,creative,mfIdx,ctIdx,mediaFile,targetBitrate,creativeBitrate,delta,smallestDelta;for(adIdx=0,adLen=response.ads.length;adIdx<adLen;adIdx++){ad=response.ads[adIdx];for(creaIdx=0,creaLen=ad.creatives.length;creaIdx<creaLen;creaIdx++){creative=ad.creatives[creaIdx];if(creative.type=="linear"){for(mfIdx=0,mfLen=creative.mediaFiles.length;mfIdx<mfLen;mfIdx++){mediaFile=creative.mediaFiles[mfIdx];if(mediaFile.mimeType!="video/mp4"){continue}candidateVideoNodes.push({ad:ad,creative:creative,mediaFile:mediaFile,clickthrough:creative.videoClickThroughURLTemplate});for(pixId=0;pixId<ad.impressionURLTemplates.length;pixId++){pushPixel("creativeView",ad.impressionURLTemplates[pixId])}for(ctIdx=0;ctIdx<creative.videoClickTrackingURLTemplates.length;ctIdx++){pushPixel("clickTracking",creative.videoClickTrackingURLTemplates[ctIdx])}}}}}targetBitrate=adModel.theFeed.width*3.5;smallestDelta=Number.POSITIVE_INFINITY;for(mfIdx=0;mfIdx<candidateVideoNodes.length;mfIdx++){delta=Math.abs(candidateVideoNodes[mfIdx]["mediaFile"].width-adModel.theFeed.width);if(delta<smallestDelta){smallestDelta=delta;bestWidthVideoNodes=[candidateVideoNodes[mfIdx]]}else{if(delta==smallestDelta){bestWidthVideoNodes.push(candidateVideoNodes[mfIdx])}}}smallestDelta=Number.POSITIVE_INFINITY;for(mfIdx=0;mfIdx<bestWidthVideoNodes.length;mfIdx++){if(bestWidthVideoNodes[mfIdx]["mediaFile"].bitrate!=0){creativeBitrate=bestWidthVideoNodes[mfIdx]["mediaFile"].bitrate}else{if(bestWidthVideoNodes[mfIdx]["mediaFile"].maxBitrate!=0){creativeBitrate=bestWidthVideoNodes[mfIdx]["mediaFile"].maxBitrate}else{if(bestWidthVideoNodes[mfIdx]["mediaFile"].minBitrate!=0){creativeBitrate=bestWidthVideoNodes[mfIdx]["mediaFile"].minBitrate}else{creativeBitrate=0}}}delta=Math.abs(creativeBitrate-targetBitrate);if(delta<smallestDelta){smallestDelta=delta;chosenVideoNode=bestWidthVideoNodes[mfIdx]}}promotedVideoJson={type:"promoted_video",detail:chosenVideoNode.mediaFile.fileURL,x:"0",y:"0",height:adModel.theFeed.height,width:adModel.theFeed.width,clickURL:chosenVideoNode.clickthrough,delay:"0"};adParts[playerAdPartSequence].assets.push(promotedVideoJson);var pixelTypes=["creativeView","firstQuartile","midpoint","thirdQuartile","complete"],currentPixel;for(var p=0;p<pixelTypes.length;p++){if(!!chosenVideoNode.creative["trackingEvents"][pixelTypes[p]]){for(var t=0;t<chosenVideoNode.creative["trackingEvents"][pixelTypes[p]].length;t++){currentPixel=chosenVideoNode.creative["trackingEvents"][pixelTypes[p]][t];pushPixel(pixelTypes[p],currentPixel)}}}prepPromotedVideo();startAdObj();addUnmuteBar();docObj.video.el.volume=0}})}else{$("#tm-video-container").css("display","none");setCanvasPosition(0,0);initDocObj()}}if(!vastUrl){startAdObj()}};var unmuteVideo=function(){docObj.video.el.volume=1;docObj.video.el.currentTime=0;var unmute_bar=$("#unmute-bar");unmute_bar.css("visibility","hidden")};var pushPixel=function(type,url){var tmPixelTypes={creativeView:"VIEW",firstQuartile:"Complete25",midpoint:"Complete50",thirdQuartile:"Complete75",complete:"Completion",clickTracking:"ClickThrough"};adModel.theFeed.pixels.push({id:"3p."+Number(new Date()),trigger:tmPixelTypes[type],detail:url,type:"Flash"})};var addUnmuteBar=function(){var unmuteTextString="Click to Unmute";var speakerDiv=document.createElement("DIV");speakerDiv.id="speaker-div";var unmuteBar=document.createElement("DIV");unmuteBar.id="unmute-bar";var unmuteTextP=document.createElement("P");unmuteTextP.id="unmute-text";unmuteBar.appendChild(speakerDiv);speakerDiv.appendChild(unmuteTextP);document.body.appendChild(unmuteBar);document.getElementById("unmute-text").innerHTML=unmuteTextString;var barWidth=TM.Feed.width,barTop=(TM.Feed.height-60)/2,speakerLeft=barWidth-55;var speaker_div=$("#speaker-div");speaker_div.css("background-image",'url("https://playtime.tubemogul.com/mobile/img/speaker.png")');speaker_div.css("background-size","40px 40px").css("height","60px").css("top","0px");speaker_div.css("background-position",speakerLeft+"px center");speaker_div.css("background-repeat","no-repeat");var unmute_text=$("#unmute-text");unmute_text.css("width",barWidth+"px").css("display","inline");unmute_text.css("font-size","1.5em").css("color","#fff");var unmute_bar=$("#unmute-bar");unmute_bar.css("z-index","9000").css("border","none").css("background","#666");unmute_bar.css("opacity",".6").css("font-family","Arial").css("text-align","center");unmute_bar.css("width",barWidth+"px").css("height","60px").css("top",barTop+"px");unmute_bar.css("line-height","60px");unmute_bar.css("position","absolute");unmute_bar.css("cursor","pointer");unmuteBar.addEventListener("click",function(e){unmuteVideo()},false)};var prepPromotedVideo=function(){console.log("loading video");loadVideo(function(){videoContainer=$(".tm-video-container");if(adParts[0].type!="player"){console.log("Hiding videoContainer (because there is a teaser)");videoContainer.css("display","none")}$("#tm-video-container").css("display","none");setCanvasPosition(0,0)});videoObj.play();setTimeout(videoObj.pause,1)};var startAdObj=function(){console.log("startAdObj()");adObj=new AdClass(winplayInfo);adObj.start();canvasObj.bind("click",clickHandler);if(!isMraid||mraid.isViewable()!=false&&mraid.isViewable()!="false"){startAdPart()}addOrientationListeners();setupTestHooks()};var setupTestHooks=function(){TM.adUnit={};TM.adUnit.nextAdPart=function(){handleAdPartEnd()};TM.adUnit.pause=function(){videoObj.pause()};TM.adUnit.play=function(){videoObj.play()};TM.adUnit.clickAsset=function(asset_id){var e={};for(var i=0;i<ctUrls.length;i++){ctUrl=ctUrls[i];console.log("checking asset "+ctUrls[i].id);if(ctUrl.id==asset_id){e.pageX=(ctUrl.maxX-ctUrl.minX)/2+Number(ctUrl.minX);e.pageY=(ctUrl.maxY-ctUrl.minY)/2+Number(ctUrl.minY);console.log("Found asset "+asset_id+". Raw target: "+e.pageX+", "+e.pageY);e.pageX+=Number(canvasObj.el.offsetLeft);e.pageY+=Number(canvasObj.el.offsetTop);e.pageX+=Number(videoContainer.el.parentNode.offsetLeft);e.pageY+=Number(videoContainer.el.parentNode.offsetTop);console.log("Offset asset "+asset_id+". Clicking at "+e.pageX+", "+e.pageY);console.log("Bounds: "+ctUrl.minX+" - "+ctUrl.maxY+", "+ctUrl.minY+" - "+ctUrl.maxY);clickHandler(e);break}}}};var handleAdPartEnd=function(){console.log("handleAdPartEnd action for adPart "+activeAdPartSequence+": "+adParts[activeAdPartSequence].action);clearCurrentAdPart();if(adParts.length>1){var newAdPartIndex;if(!adParts[activeAdPartSequence].action){console.log("Treat null action like next");adParts[activeAdPartSequence].action="next"}switch(adParts[activeAdPartSequence].action.toLowerCase()){case"next":newAdPartIndex=activeAdPartSequence+1;break;case"back":newAdPartIndex=activeAdPartSequence-1;break;case"replay":if(adModel.theFeed.adClass=="BAP"&&docObj.video.el.volume==0){docObj.video.el.volume=1}newAdPartIndex=playerAdPartSequence;break}activeAdPartSequence=newAdPartIndex;if(activeAdPartSequence>=adParts.length||activeAdPartSequence<0){if(isMraid){mraid.close()}else{activeAdPartSequence=0}}startAdPart()}else{if(isMraid){mraid.close()}}};var clearCurrentAdPart=function(){var unmute_bar=$("#unmute-bar");if(!!unmute_bar.el){unmute_bar.css("visibility","hidden")}if(adParts[activeAdPartSequence].type=="player"){videoContainer.css("display","none");videoStarted=false}removeDomElements(iFrameAssets);removeDomElements(flashDivs)};var removeDomElements=function(array){var domElement;for(var i in array){domElement=document.getElementById(i);domElement.parentNode.removeChild(domElement);delete array[i]}};var startAdPart=function(){console.log("startAdPart() activeAdPartSequence: "+activeAdPartSequence+" playerAdPartSequence: "+playerAdPartSequence);if(activeAdPartSequence==playerAdPartSequence){startVideo();if(isMraid&&mraid.getState()!="expanded"&&adModel.adType==MRAID_TTP){mraid.expand()}}else{adObj.resizeAll()}util.clearCanvas(canvas2d,canvasObj,false);positionAssets(canvas2d,adParts[activeAdPartSequence].assets,true);canvasObj.css("cursor","pointer")};var loadVideo=function(nextCall){console.log("*** creating a video object ***");switch(promotedVideoJson.mimeType){case"YouTube":initDocObj();$("#tm-canvas-holder").css("z-index","1000");$("#tm-video-container").css("z-index","1003");videoObj={shouldBePlayingRightNow:false,isReady:false,ytUrl:promotedVideoJson.detail,ytId:promotedVideoJson.detail.substring(promotedVideoJson.detail.lastIndexOf("/")+1,promotedVideoJson.detail.indexOf("?")),ytPlayer:null,_height:promotedVideoJson.height,_width:promotedVideoJson.width,onPlayerReady:function(event){console.log("X X X X X X onPlayerReady() IT IS ALIVE!!!!");videoObj.ytPlayer.addEventListener("onStateChange",videoObj.onPlayerStateChange);videoObj.isReady=true;document.getElementById("tm-yt-div").removeAttribute("allowfullscreen");if(videoObj.shouldBePlayingRightNow){console.log("calling playVideo on yt thing.")}},onPlayerStateChange:function(event){console.log("YT Player state: "+event.data);switch(event.data){case YT.PlayerState.PLAYING:if(videoObj.shouldBePlayingRightNow){videoObj.pause}break}},play:function(){console.log("/////////////// play() /////////////////");console.log("isReady: "+videoObj.isReady);console.log("ytPlayer: "+!!videoObj.ytPlayer);if(!!videoObj.ytPlayer&&!videoObj.isReady){}if(videoObj.isReady||!!videoObj.ytPlayer){videoObj.ytPlayer.playVideo();if(videoObjectForWinplay==null){videoObjectForWinplay={dutration:videoObj.ytPlayer.getDuration(),playheadTime:0};window.addEventListener("message",function(e){videoObjectForWinplay.currentTime=videoObj.ytPlayer.getCurrentTime();if(videoObjectForWinplay.duration<6000&&videoObjectForWinplay.duration>1&&adObj.videoTracker==null){console.log("INITIALIZING VIDEO TRACKER");initializeVideoTracker();videoHandlers.handlePlay()}else{videoObjectForWinplay.duration=videoObj.ytPlayer.getDuration()}})}}this.shouldBePlayingRightNow=true},pause:function(){console.log("videoObj.pause()");if(videoObj.isReady&&!!videoObj.ytPlayer){console.log("Calling Pause on YT playerâ€¦");videoObj.ytPlayer.pauseVideo()}videoObj.shouldBePlayingRightNow=false},width:function(w){if(w!==undefined){videoObj._width=w;videoObj.setSize();return}else{return videoObj._width}},height:function(h){if(h!==undefined){videoObj._height=h;videoObj.setSize();return}else{return videoObj._height}},setSize:function(){if(!!videoObj.ytPlayer){videoObj.ytPlayer.setSize(videoObj._width,videoObj._height)}},fullscreen:false,onClick:function(){console.log("videoObj onClick set by css function.");adObj.clickThrough(promotedVideoJson.clickURL,"bannerClicks")}};console.log("doing the youtube thing.");document.addEventListener("ytIframeApiReady",function(){var newDiv=$("<div>").attr("id","tm-yt-div");$("#tm-video-container").prepend(newDiv);videoObj.ytPlayer=new YT.Player("tm-yt-div",{height:videoObj.height(),width:videoObj.width(),videoId:videoObj.ytId,events:{onReady:videoObj.onPlayerReady,onStateChange:videoObj.onPlayerStateChange},playerVars:{rel:0,showinfo:0,modestbranding:1,color:"white",controls:0}});window.postMessage("Hello","http://www.youtube.com")});util.loadJS("http://www.youtube.com/iframe_api",function(){console.log("yt loaded")});break;case"video/mp4":default:videoObj={tmVideo:new Video({src:{mp4:{url:promotedVideoJson.detail}},fullscreen:false,onFullscreen:function(){}},placementDiv),width:function(w){if(w!==undefined){docObj.video_container.css("width",w+"px");return}else{return docObj.video_container.width()}},height:function(h){if(h!==undefined){docObj.video_container.css("height",h+"px");return}else{return docObj.video_container.height()}},play:function(){console.log("videoObj.play()");tmVideoPlayer.play()},pause:function(){tmVideoPlayer.pause()}};break}videoObj.x=function(_x){if(_x!==undefined){docObj.video_container.css("left",(Number(_x)+videoContainer.el.parentNode.offsetLeft)+"px");return}else{return docObj.video_container.css("left")}};videoObj.y=function(_y){if(_y!==undefined){docObj.video_container.css("top",(Number(_y)+videoContainer.el.parentNode.offsetTop)+"px");return}else{return docObj.video_container.css("top")}};videoObj.width(getAbsFromPercent(promotedVideoJson.width,"width"));videoObj.height(getAbsFromPercent(promotedVideoJson.height,"height"));videoObj.onEnd=function(){console.log("videoObj.onEnd()");console.log("videoOjb.onEnd calling handleAdPartEnd()");handleAdPartEnd();if(ctUrls.length>0){videoContainer.css("display","none")}};nextCall()};var closeButtonDelay,closeButtonTimeout,startMraidCloseButtonDelay=function(){if(mraid.getState()=="expanded"){mraid.showCloseButton()}else{if(adModel.adType==MRAID_INTERSTITIAL){var vidAsset=TM.Util.getAssetsInAdPartsByType("player","promoted_video")[0];if(vidAsset&&typeof(vidAsset.videoDuration)=="number"){closeButtonDelay=(vidAsset.videoDuration>15)?5000:1000*vidAsset.videoDuration+1000;closeButtonTimeout=setTimeout(function(){mraid.showCloseButton()},closeButtonDelay)}else{console.log("No valid video asset found on MRAID Interstital feed")}}else{mraid.hideCloseButton()}}},positionAssets=function(canvas2d,assets,boolThatMightBeFullscreen){setAdDims();var vidDims=getVideoPosition();if(!!videoObj){videoObj.x(vidDims.x);videoObj.y(vidDims.y);videoObj.width(vidDims.w);videoObj.height(vidDims.h)}canvasObj.css({display:"block"});var overlays=assets.filter(function(element,index,array){return element.type=="overlay"||element.type=="survey"});var assetHolders=[];var loadedAssets=[];adParts[activeAdPartSequence].hasBg=false;ctUrls=[];console.log("Positioning "+overlays.length+" overlays.");for(var n=0;n<overlays.length;n++){var currentAsset=overlays[n];adParts[activeAdPartSequence].hasBg=adParts[activeAdPartSequence].hasBg||(currentAsset.layer<0);var assetXpos=getAbsFromPercent(currentAsset.currentX,"width"),assetYpos=getAbsFromPercent(currentAsset.currentY,"height"),assetWidth=getAbsFromPercent(currentAsset.currentWidth,"width"),assetHeight=getAbsFromPercent(currentAsset.currentHeight,"height");switch(currentAsset.mimeType){case"image/gif":case"image/png":case"image/jpeg":console.log("Loading "+currentAsset.detail+" "+assetXpos+", "+assetYpos);assetHolders[n]=loadAndDisplayImage(currentAsset,assetXpos,assetYpos,assetWidth,assetHeight,loadedAssets,assetHolders);break;case"text/html":if(!iFrameListenerSet){window.addEventListener("message",iFrameApiHelpers.receiveMessage,false)}if(!!assetHolders[n]){assetHolders[n].iFrameObj.style.top=assetYpos;assetHolders[n].iFrameObj.style.left=assetXpos;assetHolders[n].iFrameObj.style.width=assetWidth;assetHolders[n].iFrameObj.style.height=assetHeight}assetHolders[n]=loadAndStartIFrame(currentAsset,assetXpos,assetYpos,assetWidth,assetHeight,loadedAssets,assetHolders);break;case"application/javascript":case"text/javascript":assetHolders[n]=loadAndStartJavascript(currentAsset,assetXpos,assetYpos,assetWidth,assetHeight,loadedAssets,assetHolders);break;case"application/x-shockwave-flash":assetHolders[n]=loadAndDisplayFlash(currentAsset,assetXpos,assetYpos,assetWidth,assetHeight,loadedAssets,assetHolders);default:break}if(!util.isNull(currentAsset.clickURL)){ctUrls.push({minX:assetXpos,minY:assetYpos,maxX:parseInt(assetXpos)+assetWidth,maxY:parseInt(assetYpos)+assetHeight,id:currentAsset.id,winplayCall:currentAsset.inplayCall,url:currentAsset.clickURL,layer:currentAsset.layer})}}if(assets.some(function(element,index,array){if(element.type=="promoted_video"){return !!element.clickURL}else{return false}})){setPromotedVideoClick(promotedVideoJson.clickURL,promotedVideoJson.id)}else{if(assets.some(function(element,index,array){return element.type=="promoted_video"})){setPromotedVideoClick("VIDEO",promotedVideoJson.id)}}ctUrls.sort(util.dynamicSort("layer"))};var setPromotedVideoClick=function(clickString,id){console.log("setPromotedVideoClick() "+clickString);var vidDims=getVideoPosition();console.log("video height: "+vidDims.h+" docObj.video.height(): "+docObj.video.height());ctUrls.push({minX:vidDims.x,minY:vidDims.y,maxX:(Number(vidDims.x)+Number(vidDims.w)),maxY:(Number(vidDims.y)+Number(vidDims.h)),url:clickString,id:id,winplayCall:"bannerClicks",layer:0})};var loadAndDisplayImage=function(currentAsset,assetXpos,assetYpos,assetWidth,assetHeight,loadedAssets,assetHolders){var imageHolder=new Image();if(!!currentAsset.detail){imageHolder.onload=function(_imgObject,_xPos,_yPos,_width,_height,_canvas2d,_layer){return function(){loadedAssets.push({type:"image",assetObject:_imgObject,layer:_layer,x:_xPos||0,y:_yPos||0,width:_width,height:_height});console.log("Loaded "+loadedAssets.length+" of "+assetHolders.length);if(loadedAssets.length==assetHolders.length){addAssetsToCanvas(loadedAssets,_canvas2d)}}}(imageHolder,assetXpos,assetYpos,assetWidth,assetHeight,canvas2d,currentAsset.layer);imageHolder.src=currentAsset.detail}return imageHolder};var loadAndDisplayFlash=function(currentAsset,assetXpos,assetYpos,assetWidth,assetHeight,loadedAssets,assetHolders){console.log("flash? "+(TM.Util.flashDetect()>=9));if(TM.Util.flashDetect()>=9&&!!currentAsset.detail){var str=null,isIE=
/*@cc_on!@*/
false,assetUrl=currentAsset.detail;var clickTag=encodeURIComponent(getCtUrl(currentAsset.clickURL,"Flash"));assetUrl=(assetUrl.indexOf("?")>-1)?assetUrl+"&":assetUrl+"?";assetUrl+="clickTag="+clickTag+"&clickTAG="+clickTag;console.log("clickTag: "+clickTag);if(isIE){str='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" id="TMFlashUnit" name="TMFlashUnit" width="'+assetWidth+'" height="'+assetHeight+'" ><param name="movie" value="'+assetUrl+'" /><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="wmode" value="transparent" /><param name="auditAdClass" value="'+TM.Util.auditAdClass+'" /></object>'}else{console.log("Flash dims: "+assetWidth+" x "+assetHeight);str='<embed id="TMFlashUnit" name="TMFlashUnit" width="'+assetWidth+'" height="'+assetHeight+'" src="'+assetUrl+'" type="application/x-shockwave-flash" wmode="transparent" allowscriptaccess="always" allowfullscreen="true" />'}var overlayDiv=document.createElement("div");overlayDiv.id=currentAsset.id;overlayDiv.innerHTML=str;overlayDiv.style.position="absolute";overlayDiv.style.left=assetXpos;overlayDiv.style.top=assetYpos;overlayDiv.style.width=assetWidth;overlayDiv.style.height=assetHeight;overlayDiv.style.zIndex=1100+Number(currentAsset.layer);document.body.appendChild(overlayDiv);flashDivs[currentAsset.id]=overlayDiv;loadedAssets.push({type:"flash",assetObject:overlayDiv,layer:1100,x:assetXpos||0,y:assetYpos||0,width:assetHeight,height:assetHeight})}else{loadedAssets.push({type:"flash",assetObject:{},layer:0,x:0,y:0,width:0,height:0})}if(loadedAssets.length==assetHolders.length){addAssetsToCanvas(loadedAssets,canvas2d)}};var buildStatsUrl=function(topic,params){var str=TM.lc_params.statsurl+"/"+topic+"?";for(a in params){if(!TM.Util.isNull(params[a])){str+="&"+a+"="+encodeURIComponent(params[a])}}if(topic=="imp"&&!TM.Util.isNull(params.adEngImpQP)){str+="&"+params.adEngImpQP}if(topic=="ct"&&!TM.Util.isNull(params.adEngClickThruQP)){str+="&"+params.adEngClickThruQP}if(topic=="view"&&!TM.Util.isNull(params.adEngViewQP)){str+="&"+params.adEngViewQP}return str};var getCtUrl=function(ctUrl,rt){var params={};params.sessId=TM.Feed.session.sessId;params.paId=TM.Feed.paId;params.psId=TM.Feed.psId;params.rt=rt;params.burl=TM.Util.getBurl();params.bi=TM.Feed.bi;params.adEngClickThruQP=TM.Feed.adEngClickThruQP;params.adEngViewQP=TM.Feed.adEngViewQP;params.redir=ctUrl;return buildStatsUrl("ct",params)};var loadAndStartIFrame=function(currentAsset,assetXpos,assetYpos,assetWidth,assetHeight,loadedAssets,assetHolders){var iFrameAsset={};if(!!currentAsset.detail&&document.getElementById(currentAsset.id)==null){console.log("adding iFrame asset "+currentAsset.id);iFrameAsset={src:currentAsset.detail,uniqueId:""+currentAsset.id+"_"+Math.floor(Date.now()*Math.random()),x:assetXpos,y:assetYpos,width:assetWidth,height:assetHeight,winplayCall:currentAsset.inplayCall,clickthroughUrl:currentAsset.clickURL,assetHolders:assetHolders,loadedAssets:loadedAssets};var iFrameSrc=iFrameAsset.src+((iFrameAsset.src.indexOf("?")>-1)?"&":"?")+"tm_asset_id="+iFrameAsset.uniqueId+"&tm_origin="+encodeURI(myOrigin);iFrameAsset.iFrameObj=document.createElement("IFRAME");iFrameAsset.iFrameObj.id=currentAsset.id;iFrameAsset.iFrameObj.style.border="none";iFrameAsset.iFrameObj.style.padding=0;iFrameAsset.iFrameObj.style.margin=0;iFrameAsset.iFrameObj.style.position="absolute";iFrameAsset.iFrameObj.style.left=iFrameAsset.x;iFrameAsset.iFrameObj.style.top=Number(iFrameAsset.y);iFrameAsset.iFrameObj.style.width=iFrameAsset.width+"px";iFrameAsset.iFrameObj.style.height=iFrameAsset.height+"px";iFrameAsset.iFrameObj.style.zIndex=util.isNull(currentAsset.clickURL)?(1010+currentAsset.layer):999;iFrameAsset.iFrameObj.setAttribute("src",iFrameSrc);document.body.appendChild(iFrameAsset.iFrameObj);iFrameAssets[currentAsset.id]=iFrameAsset}return iFrameAsset},iFrameApiHelpers={receiveMessage:function(event){if(event.data.type=="handshake"){for(var indx in iFrameAssets){if(iFrameAssets[indx].uniqueId==event.data.uniqueId){iFrameAssets[indx].messageReceiver=event.source;iFrameApiHelpers.handshake(indx);iFrameAssets[indx].loadedAssets.push({type:"iframe",assetObject:iFrameAssets[indx],x:iFrameAssets[indx].x||0,y:iFrameAssets[indx].y||0,width:iFrameAssets[indx].width||adModel.width,height:iFrameAssets[indx].height||adModel.height,id:indx});if(iFrameAssets[indx].loadedAssets.length==iFrameAssets[indx].assetHolders.length){addAssetsToCanvas(iFrameAssets[indx].loadedAssets,canvas2d)}}}}else{var messageSender=iFrameApiHelpers.getSendingIFrame(event.data.uniqueId,event.source);if(!!messageSender){switch(event.data.type){case"playheadUpdate":iFrameApiHelpers.handlePlayheadUpdate(event.data);break;case"pause":videoObj.pause();break;case"resume":videoObj.play();break;case"nextAdPart":handleAdPartEnd();break;case"reportToWinplay":iFrameApiHelpers.handleReportToWinplay(event.data);break;case"stop":console.log("iFrame wants to stop (dismiss) the ad.");break;case"showCloseButton":clearTimeout(closeButtonTimeout);mraid.showCloseButton();break;case"supressCloseButton":clearTimeout(closeButtonTimeout);mraid.hideCloseButton();break;default:console.log("Unrecognized message type: "+message.type)}}}},handshake:function(assetId){console.log("Parent returning handshake with "+iFrameAssets[assetId].iFrameObj.src);var ctUrl,winplayCall;if(!!iFrameAssets[assetId].clickthroughUrl){ctUrl=iFrameAssets[assetId].clickthroughUrl;winplayCall=(!!iFrameAssets[assetId].winplayCall)?iFrameAssets[assetId].winplayCall:"bannerClicks"}else{ctUrl=promotedVideoJson.clickURL;winplayCall=(!!promotedVideoJson.inplayCall)?promotedVideoJson.inplayCall:"bannerClicks"}var messageObj={type:"handshake",version:version,uniqueId:iFrameAssets[assetId].uniqueId,winplayCall:winplayCall,clickthroughUrl:ctUrl,videos:iFrameApiHelpers.getVideosInAdPart(),contextualData:{zip:"18504"}};iFrameAssets[assetId].messageReceiver.postMessage(messageObj,iFrameAssets[assetId].iFrameObj.src)},startIFrame:function(assetId){if(!iFrameAssets[assetId].started){iFrameAssets[assetId].started=true;var messageObj={type:"start",uniqueId:iFrameAssets[assetId].uniqueId};iFrameAssets[assetId].messageReceiver.postMessage(messageObj,iFrameAssets[assetId].iFrameObj.src)}},handlePlayheadUpdate:function(playheadData){console.log("playheadUpdate! "+playheadData.time);if(!!adTracker&&!!videoObjectForWinplay&&!adObj.videoTracker){adObj.videoTracker=adTracker.newVideoTracker({pvId:playheadData.video_id,duration:playheadData.duration,autoplay:winplayInfo.autoplay,volume:videoObjectForWinplay.volume,playheadTime:playheadData.time})}adObj.videoTracker.streamUpdate(playheadData.time,1)},handleReportToWinplay:function(winplayData){if(!adObj.videoTracker){console.log("Creating new video tracker.");adObj.videoTracker=adTracker.newVideoTracker({pvId:0,duration:0,autoplay:false,volume:videoObjectForWinplay.volume,playheadTime:0})}adObj.videoTracker.userAction(winplayData.winplayType,winplayInfo);if(!!winplayData.clickthroughUrl){if(typeof mraid!="undefined"){mraid.open(winplayData.clickthroughUrl)}else{window.open(winplayData.clickthroughUrl)}}},getSendingIFrame:function(uniqueId,iFrameOrigin){var sendingFrame;for(var indx in iFrameAssets){if(iFrameAssets[indx].uniqueId==uniqueId&&iFrameAssets[indx].messageReceiver==iFrameOrigin){sendingFrame=iFrameAssets[indx];break}}return sendingFrame},getVideosInAdPart:function(){var videos=[];for(var i=0;i<adParts[activeAdPartSequence].assets.length;i++){if(adParts[activeAdPartSequence].assets[i]["type"]=="promoted_video"){videos.push({id:adParts[activeAdPartSequence].assets[i].pvId,url:adParts[activeAdPartSequence].assets[i].detail,clickthroughUrl:adParts[activeAdPartSequence].assets[i].clickURL})}}return videos},sendPlayheadUpdate:function(){for(var assetId in iFrameAssets){if(!!iFrameAssets[assetId].started){var messageObj={type:"playheadUpdate",uniqueId:iFrameAssets[assetId].uniqueId,video_id:promotedVideoJson.id,duration:videoObjectForWinplay.duration,time:videoObjectForWinplay.currentTime};iFrameAssets[assetId].messageReceiver.postMessage(messageObj,iFrameAssets[assetId].iFrameObj.src)}}},sendPause:function(){console.log("Sending pause to iFrames");for(var assetId in iFrameAssets){if(!!iFrameAssets[assetId].started){var messageObj={type:"pause",uniqueId:iFrameAssets[assetId].uniqueId};iFrameAssets[assetId].messageReceiver.postMessage(messageObj,iFrameAssets[assetId].iFrameObj.src)}}},sendResume:function(){for(var assetId in iFrameAssets){if(!!iFrameAssets[assetId].started){var messageObj={type:"resume",uniqueId:iFrameAssets[assetId].uniqueId};iFrameAssets[assetId].messageReceiver.postMessage(messageObj,iFrameAssets[assetId].iFrameObj.src)}}}};var loadAndStartJavascript=function(currentAsset,assetXpos,assetYpos,assetWidth,assetHeight,loadedAssets,assetHolders){if(!!currentAsset.detail&&document.getElementById(currentAsset.id)==null){var scriptElement=document.createElement("script");console.log("script element "+currentAsset.id+" "+document.getElementById(currentAsset.id));scriptElement.id=currentAsset.id;scriptElement.type="text/javascript";scriptElement.onload=function(assetObject,_xPos,_yPos,_width,_height,_canvas2d,_currentAsset){return function(){console.log("JS loaded");loadedAssets.push({type:"script",assetObject:assetObject,x:_xPos||0,y:_yPos||0,width:_width||adModel.width,height:_height||adModel.height,assetFeed:_currentAsset,statsLog:statsRequest,endCall:handleAdPartEnd,isLastAdPart:(activeAdPartSequence==adParts.length-1)});if(loadedAssets.length==assetHolders.length){addAssetsToCanvas(loadedAssets,_canvas2d)}}}(scriptElement,assetXpos,assetYpos,assetWidth,assetHeight,canvas2d,currentAsset);scriptElement.src=currentAsset.detail;document.getElementsByTagName("head")[0].appendChild(scriptElement)}return scriptElement||document.getElementById(currentAsset.id)};var statsRequest=function(request){if(!!adTracker&&!!request.request){request.request.data.sId="0";request.request.data.sessId=winplayInfo.sessId;request.request.data.paId=winplayInfo.paId;request.request.data.rt="HTML5";request.request.data.w=adModel.width;request.request.data.h=adModel.height;adTracker.sendRequest(request)}else{console.log("adTracker  IS NOT READY!?")}};var addAssetsToCanvas=function(loadedAssets,context){loadedAssets=loadedAssets.sort(util.numericSort("layer"));for(var n=0;n<loadedAssets.length;n++){if(loadedAssets[n].type=="image"){console.log("Adding asset "+n+" at "+loadedAssets[n].x+", "+loadedAssets[n].y+"; "+loadedAssets[n].width+" x "+loadedAssets[n].height);context.drawImage(loadedAssets[n].assetObject,loadedAssets[n].x,loadedAssets[n].y,loadedAssets[n].width,loadedAssets[n].height)}else{if(loadedAssets[n].type=="script"){if(!!externalOverlayScripts[loadedAssets[n].assetObject.id].handshake){externalOverlayScripts[loadedAssets[n].assetObject.id].handshake(loadedAssets[n])}}else{if(loadedAssets[n].type=="iframe"){iFrameApiHelpers.startIFrame(loadedAssets[n].id)}}}}if(adParts[activeAdPartSequence].hasBg){createVideoMask(context)}};var createVideoMask=function(context){var vidPos=getVideoPosition();context.globalCompositeOperation="destination-out";context.beginPath();context.fillStyle="red";context.rect(vidPos.x,vidPos.y,vidPos.w,vidPos.h);context.fill();context.closePath();context.globalCompositeOperation="source-over"};var getVideoPosition=function(){var vidPos={},vidXpos=0,vidYpos=0,vidW=0,vidH=0;if(!!promotedVideoJson){scaleDims(promotedVideoJson);vidW=getAbsFromPercent(promotedVideoJson.currentWidth,"width");vidH=getAbsFromPercent(promotedVideoJson.currentHeight,"height");setPosition(promotedVideoJson,"currentX","x",adModel.width,vidW);vidXpos=promotedVideoJson.currentX;setPosition(promotedVideoJson,"currentY","y",adModel.height,vidH);vidYpos=promotedVideoJson.currentY}vidPos.w=vidW;vidPos.h=vidH;vidPos.x=vidXpos;vidPos.y=vidYpos;return vidPos};var setCanvasPosition=function(topCoord,leftCoord){canvasObj.css({position:"absolute",left:leftCoord,top:topCoord,"z-index":1001})};var clickHandler=function(e){var ctUrl=getUrlFromTapPosition(e);if(!ctUrl){if(!!videoStarted&&adParts[activeAdPartSequence].type=="player"){videoObj.play()}else{if(adParts[activeAdPartSequence].trigger=="click"){handleAdPartEnd()}}}else{if(activeAdPartSequence==playerAdPartSequence){if(docObj.video_container.hasClass("tm-video-playing")&&!!ctUrl&&!util.isNull(ctUrl.url)&&ctUrl.url!="VIDEO"){adObj.clickThrough(ctUrl.url,ctUrl.winplayCall)}videoHandlers.handleClick()}else{if(adParts[activeAdPartSequence].type=="endcap"){adObj.clickThrough(ctUrl.url,ctUrl.winplayCall)}}}};var getUrlFromTapPosition=function(e){var x;var y;if(e.pageX||e.pageY){x=e.pageX;y=e.pageY}else{x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop}x-=canvasObj.el.offsetLeft;y-=canvasObj.el.offsetTop;x-=videoContainer.el.parentNode.offsetLeft;y-=videoContainer.el.parentNode.offsetTop;console.log("Tap position: "+x+", "+y);var ctUrl=null;for(var i=0;i<ctUrls.length;i++){console.log("Asset "+i+": "+ctUrls[i].minX+"-"+ctUrls[i].maxX+"; "+ctUrls[i].minY+"-"+ctUrls[i].maxY+" layer: "+ctUrls[i].layer);if(x>=ctUrls[i].minX&&x<=ctUrls[i].maxX&&y>=ctUrls[i].minY&&y<=ctUrls[i].maxY){if(ctUrl==null||ctUrl.layer<ctUrls[i].layer||(ctUrl=="VIDEO"&&ctUrl.layer<0)){ctUrl=ctUrls[i];console.log(" ^ chosen ^ "+ctUrl.url)}}}return ctUrl};var startVideo=function(){console.log("startVideo() activeAdPartSequence: "+activeAdPartSequence+" playerAdPartSequence: "+playerAdPartSequence+" promotedVideoJson.delay: "+promotedVideoJson.delay);if(!videoStarted&&promotedVideoJson.delay!="infinite"){videoStarted=true;videoContainer.css("display","block");videoObj.play();function streamUpdateHandler(){if(!util.isNull(videoObjectForWinplay)){adObj.videoTracker.streamUpdate(videoObjectForWinplay.currentTime,videoObjectForWinplay.volume);if(!!iFrameApiHelpers){iFrameApiHelpers.sendPlayheadUpdate()}}}streamUpdateInterval=setInterval(streamUpdateHandler,250)}if(isMraid){startMraidCloseButtonDelay()}};var startMraidAd=function(){console.log("startMraidAd() mraidAdStarted: "+mraidAdStarted+" mraid.isViewable: "+mraid.isViewable());if(!mraidAdStarted){fireImpression();mraid.hideCloseButton();if(mraid.isViewable()&&mraid.isViewable()!="false"){console.log("adType: "+adModel.adType+" videoObjectForWinplay: "+(!!videoObjectForWinplay));if(adModel.adType==MRAID_INTERSTITIAL&&!!videoObjectForWinplay){console.log("sending playhead update .1");adObj.videoTracker.streamUpdate(0,videoObjectForWinplay.volume);adObj.videoTracker.streamUpdate(0.1,videoObjectForWinplay.volume)}}mraidAdStarted=true;mraid.addEventListener("orientationChange",handleMraidOrientationChange)}};var fireImpression=function(){console.log("Firing Impression");TM.Util.firePixels("Impression")};var handleStateChange=function(){console.log("handleStateChange() "+mraid.getState());var newState=mraid.getState();mraidStateTrail.push(newState);switch(newState){case"hidden":videoObj.pause();break;case"expanded":tmVideoPlayer.videoReachedEnd=false;videoObj.play();break;case"default":if(adModel.adType==MRAID_TTP&&videoStarted&&mraidStateTrail[mraidStateTrail.length-2]=="expanded"){console.log("default state, mraidAdStarted: "+mraidAdStarted+" videoStarted: "+videoStarted);console.log("exiting full screen");tmVideoPlayer.exitFullScreen()}else{mraid.hideCloseButton()}break;default:}};var handleViewableChange=function(){console.log("handleViewableChange() videoStarted: "+videoStarted+" isViewable: "+mraid.isViewable());if(videoStarted&&(mraid.isViewable()==false||mraid.isViewable()==="false")){console.log(1);videoObj.pause()}else{if(videoStarted){console.log(2);if(adModel.adType==MRAID_TTP){if(mraid.getState()=="default"){videoObj.pause()}else{if(mraid.getState()=="expanded"){videoObj.play()}}}else{if(mraid.getState()=="hidden"){videoObj.pause()}else{if(mraid.getState()=="default"){videoObj.play()}}}}else{if(mraid.isViewable()!=="false"&&mraid.isViewable()){startAdPart()}}}};var getAdDim=function(dimension){if(!!preppedFeed[dimension].indexOf&&preppedFeed[dimension].indexOf("%")>0){return getScreenDim(dimension)*parseInt(preppedFeed[dimension])/100}else{return parseInt(preppedFeed[dimension])}};var getScreenDim=function(dimension){var screeDim;if(isMraid){screeDim=Math.max(mraid.getExpandProperties()[dimension],window["inner"+((dimension=="width")?"Width":"Height")]);console.log("inner "+dimension+": "+window["inner"+((dimension=="width")?"Width":"Height")]);console.log("MRAID "+dimension+": "+screeDim)}else{screeDim=window["inner"+((dimension=="width")?"Width":"Height")]}return screeDim};var setAdDims=function(){var preserveAspectRatio=false;var screenWidth=getScreenDim("width");var screenHeight=getScreenDim("height");var aspectRatio=0;var percentWidth;var percentHeight;if(isMraid&&adModel.adType==MRAID_TTP){preppedFeed.width=screenWidth;preppedFeed.height=screenHeight}if(preppedFeed.width.toString().indexOf("%")==-1&&preppedFeed.height.toString().indexOf("%")==-1){aspectRatio=preppedFeed.width/preppedFeed.height;if(!isMraid||adModel.adType==MRAID_TTP||mraid.getState()!="expanded"){preserveAspectRatio=true}}var isFullScreen=isMraid&&(mraid.getState()=="default"&&adModel.adType==MRAID_INTERSTITIAL||mraid.getState()=="expanded");if(preppedFeed.width.toString().indexOf("%")==-1&&(preppedFeed.width>screenWidth||isFullScreen)){percentWidth=1;if(aspectRatio>1){if(preppedFeed.height.toString().indexOf("%")==-1){percentHeight=1/aspectRatio}}else{if(aspectRatio>0){if(preppedFeed.height.toString().indexOf("%")==-1){if(preppedFeed.height<=screenHeight||isFullScreen){percentHeight=preppedFeed.height/screenHeight}else{percentHeight=1}}if(preppedFeed.width>screenWidth){percentWidth=percentHeight*aspectRatio}}}}if(preppedFeed.height.toString().indexOf("%")==-1&&(preppedFeed.height>screenHeight||isFullScreen)&&!percentHeight){percentHeight=1;if(aspectRatio>0&&aspectRatio<1){if(preppedFeed.width.toString().indexOf("%")==-1){percentWidth=aspectRatio}}else{if(aspectRatio>1){if(preppedFeed.width.toString().indexOf("%")==-1){if(preppedFeed.width<=screenWidth||isFullScreen){percentWidth=preppedFeed.width/screenWidth}else{percentWidth=1}}if(preppedFeed.height>screenWidth){percentHeight=percentWidth/aspectRatio}}}}adModel.width=(!!percentWidth)?(adModel.width=screenWidth*percentWidth):(preppedFeed.width.toString().indexOf("%")==-1)?preppedFeed.width:(adModel.width=parseInt(preppedFeed.width)/100*screenWidth);adModel.height=(!!percentHeight)?(adModel.height=screenHeight*percentHeight):(preppedFeed.height.toString().indexOf("%")==-1)?preppedFeed.height:(adModel.height=parseInt(preppedFeed.height)/100*screenHeight);if(preserveAspectRatio){var dims=getLockedDims(aspectRatio,adModel.width,adModel.height,screenWidth,screenHeight,isFullScreen);adModel.width=dims.width;adModel.height=dims.height}scaleAssets()};var getLockedDims=function(aspectRatio,startWidth,startHeight,maxWidth,maxHeight,isFullScreen){var dims={width:startWidth,height:startHeight};if(startWidth.toString().indexOf("%")==-1&&startHeight.toString().indexOf("%")==-1){if(aspectRatio>1){dims.height=Math.floor(startWidth/aspectRatio);if(dims.height>maxHeight||isFullScreen){dims.height=maxHeight}dims.width=Math.floor(dims.height*aspectRatio)}else{console.log("inIt: "+startHeight+", "+aspectRatio+", "+maxWidth);dims.width=Math.floor(startHeight*aspectRatio);if(dims.width>maxWidth||isFullScreen){dims.width=maxWidth}dims.height=Math.floor(dims.width/aspectRatio)}}return dims};var scaleAssets=function(){console.log("scaleAssets()");var overlays=preppedFeed.adParts[activeAdPartSequence].assets.filter(function(element,index,array){return element.type=="overlay"||element.type=="survey"});for(var n=0;n<overlays.length;n++){scaleDims(overlays[n])}if(!!promotedVideoJson){scaleDims(promotedVideoJson);if(promotedVideoJson.preserveAspectRatio=="F"){docObj.video.el.style.objectFit="fill"}}};var scaleDims=function(scalee){scaleDim(scalee,"currentWidth","width");scaleDim(scalee,"currentHeight","height");setPosition(scalee,"currentX","x",adModel.width,getAbsFromPercent(scalee.currentWidth,"width"));setPosition(scalee,"currentY","y",adModel.height,getAbsFromPercent(scalee.height,"height"))};var setPosition=function(target,targetProp,sourceProp,adSize,assetSize){var passedVal=target[sourceProp];var assetCoord;if(!!passedVal){if(parseInt(passedVal.toString())==Number(passedVal)&&!isNaN(Number(passedVal))){target[targetProp]=passedVal}else{if(passedVal.toString().charAt(passedVal.toString().length-1)=="%"){target[targetProp]=passedVal}else{var stringAndNum=[];var passedString=passedVal.toString();if(passedString.indexOf("+")>0){stringAndNum=passedString.split("+")}else{if(passedString.indexOf("-")>0){stringAndNum=passedString.split("-");stringAndNum[1]=parseInt(stringAndNum[1])*-1}else{stringAndNum[0]=passedString;stringAndNum[1]=0}}switch(stringAndNum[0]){case"center":assetCoord=(adSize-assetSize)/2;break;case"bottom":case"right":assetCoord=adSize-assetSize;break;case null:assetCoord=0;break;default:assetCoord=stringAndNum[1];break}assetCoord+=stringAndNum[1];target[targetProp]=assetCoord}}}};var hasInt=function(val){var foundInt=false;for(var i=0;i<val.length;i++){if(val.toString().charCodeAt(i)>=48&&val.toString().charCodeAt(i)<=57){foundInt=true;break}}return foundInt};var scaleDim=function(scalee,targetProp,sourceProp){var scale;if(!!preppedFeed.width.indexOf&&preppedFeed.width.indexOf("%")!=-1&&!!preppedFeed.height.indexOf&&preppedFeed.height.indexOf("%")!=-1){scale=1}else{scale=adModel.width/preppedFeed.width}scalee[targetProp]=(parseInt(scalee[sourceProp])==scalee[sourceProp])?scalee[sourceProp]*scale:scalee[sourceProp]};var getAbsFromPercent=function(value,dimension){value=value||0;if(!!value.indexOf&&value.indexOf("%")>0){return adModel[dimension]*parseInt(value)/100}else{return parseInt(value)}};var startAndHandleViewableChange=function(){console.log("startAndHandleViewableChange()");startIfViewable();handleViewableChange()};var startAndHandleStateChange=function(){startIfViewable();handleStateChange()};var startIfViewable=function(){if(mraid.getState()!="loading"&&mraid.getState()!="unknown"&&mraid.isViewable()!="false"&&mraid.isViewable()!=false){startMraidAd();handleStateChange()}};var findMraid=function(currentWait,maxWait){isMraid=!(typeof mraid==="undefined");if(isMraid){console.log("TM ad unit detected MRAID App in "+currentWait+" ticks.  State is "+mraid.getState());proceedAsMraid()}else{if(currentWait<maxWait){setTimeout(keepSearching(currentWait+1,maxWait),1)}else{console.log("Giving up on MRAID after "+currentWait+" ticks.");proceedAsNonMraid()}}};var keepSearching=function(currentWait,maxWait){return function(){findMraid(currentWait,maxWait)}};var proceedAsMraid=function(){mraid.showCloseButton=function(){mraid.useCustomClose(false)};mraid.hideCloseButton=function(){mraid.useCustomClose(true)};mraid.hideCloseButton();console.log("proceedAdMraid() state: "+mraid.getState());if(mraid.getState()=="loading"||mraid.getState()=="unknown"){mraid.addEventListener("ready",handleMraidLoaded)}else{handleMraidLoaded()}};var handleMraidLoaded=function(){if(mraid.getPlacementType()=="interstitial"&&(adModel.theFeed.adClass.toLowerCase()=="mobile_app_inter"||adModel.theFeed.adClass.toLowerCase()=="mobile_survey")){adModel.adType=MRAID_INTERSTITIAL}else{if(mraid.getPlacementType()=="inline"&&adModel.theFeed.adClass.toLowerCase()=="mobile_app_ctp"){adModel.adType=MRAID_TTP}else{console.log("Ad Type Mismatch "+mraid.getPlacementType()+" v "+adModel.theFeed.adClass.toLowerCase())}}console.log("handleMraidLoaded() getState() = "+mraid.getState());console.log("handleMraidLoaded() isViewable() = "+mraid.isViewable());console.log("adType: "+adModel.adType);setupAd();console.log("MRAID Ad: adding event listeners for state & viewable -=-=-==-=-=-=-=-=-=-=-=-=-=-=");mraid.addEventListener("stateChange",startAndHandleStateChange);mraid.addEventListener("viewableChange",startAndHandleViewableChange);if(mraid.getState()!="loading"&&mraid.getState()!="unknown"&&((adModel.adType==MRAID_INTERSTITIAL&&mraid.isViewable()!="false"&&mraid.isViewable()!=false)||(adModel.adType==MRAID_TTP))){console.log("handleMraidLoaded() is calling startMraidAd()");startMraidAd()}};var proceedAsNonMraid=function(){setupAd();fireImpression()};HTML5AdUnit=JRClass.extend({init:function(theFeed,notUsed){console.log("============================START=== v."+version+"\n\n\n\n");adModel.theFeed=theFeed;activeAdPartSequence=0;findMraid(0,100)}})})(thisTM)}catch(err){console.log("ERROR ENCOUNTERED.");console.log(err.toString())}try{var getErrorScriptNode=(function(){var b=function(d){var f,e=function(g,h){f=h};if("fileName" in d){f=d.fileName}else{if("stacktrace" in d){d.stacktrace.replace(/Line \d+ of .+ script (.*)/gm,e)}else{if("sourceURL" in d){f=d.sourceURL.replace(/:\d+:\d+$/,"")}else{if("stack" in d){d.stack.replace(/at (.*)/gm,e);f=f.replace(/:\d+:\d+$/,"")}}}}return f},c=document.createElement("a");return function(f){c.href=b(f);var h=c.href,d=document.getElementsByTagName("script");c.removeAttribute("href");for(var g=0,e=d.length;g<e;g++){c.href=d.item(g).src;if(c.href===h){c.removeAttribute("href");return d.item(g)}}}}());var externalOverlayScripts=[];var tm_registerOverlay=function(c,d){var b=getErrorScriptNode(d);console.log("Script ID: "+b.id);externalOverlayScripts[b.id]=c};function onYouTubeIframeAPIReady(){console.log("--+  --+  --+  --+  onYouTubeIframeAPIReady()");var b=document.createEvent("CustomEvent");b.initCustomEvent("ytIframeApiReady",true,true,{});console.log("Document: "+document);document.dispatchEvent(b)}}catch(err){console.log(err.toString())}var winplayLibVersion="2.3.0";thisTM.PlaytimeAnalytics=function(){if(!this.JSON){this.JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==="string"){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}());if((typeof thisTM.Util==="undefined")){thisTM.Util={}}thisTM.Util.getCurrentTime=function(){return(new Date()).getTime()/1000};thisTM.Util.dumpObject=function(name,obj){Log(DEBUG,"--------- <"+name+"> ----------");for(var a in obj){Log(DEBUG,a+": "+obj[a]+" ("+typeof obj[a]+")")}Log(DEBUG,"--------- </"+name+"> ---------")};thisTM.Util.isNull=function(obj){if(typeof(obj)=="undefined"){return true}switch(typeof(obj)){case"string":return !obj||obj==""||obj=="null"||obj=="undefined";case"object":case"function":return !obj;default:return false}};thisTM.Util.random=function(){return parseInt(Math.random()*99999999)};thisTM.Util.loadImage=function(src,callback){var img=new Image();img.src=src;if(typeof(callback)==="undefined"){return}var loaded=function(){callback()};if(img.complete){loaded()}else{img.onload=loaded}};thisTM.Util.loadScript=function(src,callback){var js=document.createElement("script");js.type="text/javascript";if(!!callback){js.onload=callback;js.onerror=callback;console.log("js callback: "+callback)}js.src=src;document.getElementsByTagName("head")[0].appendChild(js)};thisTM.Util.appendHTML=function(html){var d=document.createElement("div");document.body.appendChild(d);d.innerHTML=html};thisTM.Util.audit={startTimes:new Array(),cachedAudits:new Array(),start:function(command,subject,startTime){if(!startTime){startTime=new Date().getTime()}this.startTimes[subject]=startTime},complete:function(command,subject){if(this.cachedAudits.length>0){this.unspool()}if(this.startTimes[subject]!=null){var completionTime=new Date();var delta=completionTime.getTime()-this.startTimes[subject];this.dispatchPixel(subject,delta)}else{console.log("Unstarted audit event "+subject+" completed.")}},dispatchPixel:function(subject,delta){var pixels=thisTM.Feed.pixels;for(var p=0;p<pixels.length;p++){if(!!pixels[p]&&pixels[p].trigger==subject){pixels[p].detail+="&"+subject.toLowerCase().substring(subject.lastIndexOf("_")+1,subject.length)+"_delta="+delta.toString()+"&ad_type="+thisTM.Feed.adClass;if((typeof mraid==="undefined")==false&&!!mraid){pixels[p].detail+="_mraid"}}}thisTM.Util.firePixels(subject)},unspool:function unspool(){var unspoolee;while(this.cachedAudits.length>0){unspoolee=this.cachedAudits.shift();this[unspoolee[0]].apply(this,unspoolee)}}};var DEBUG=0;var INFO=1;var WARN=2;var ERROR=3;var FATAL=4;var OFF=5;var gLogFunction=null;var gLogLevel=OFF;var gLogLevelNames=new Array("DEBUG","INFO","WARN","ERROR","FATAL","OFF");function SetLogFunction(func){gLogFunction=func}function SetLogLevel(level){gLogLevel=level}function Log(level,msg){if(gLogFunction){if(level>=gLogLevel){gLogFunction(gLogLevelNames[level]+": "+msg)}}}var EMAIL_SHARE="eml";var FACEBOOK_SHARE="fbs";var TWITTER_SHARE="tws";var CLICK_THROUGH="ct";var FACEBOOK_FAN_PAGE_CLICK="fbf";var gAdTrackers=[];function newAdTracker(params){if(!document.createElement("video").canPlayType){Log(ERROR,"This browser does not support HTML5 video!");return}var p=new AdTracker(params);gAdTrackers.push(p);return p}function AdTracker(params){if(!params){params={}}this.pixels=[];this.actions=new Object();this.actionsCount=0;this.requestQueue=new Array();this.videoTrackers=[];this.activeVideoTracker=null;this.monitors=new Array();var feed=thisTM.Args.data[0];params.paId=feed.paId;params.sessId=feed.session.sessId;params.bi=feed.bi;params.pt=feed.pt;params.price=feed.price;if(thisTM.Util.isNull(params.statsBaseURL)){params.statsBaseURL="stats.tubemogul.com/stats/1"}var protocol=(document.location.protocol=="https:")?"https:":"http:";this.statsURL=protocol+"//"+params.statsBaseURL;try{this.addMonitor("adtag_clickurl","ClickThrough","Image",decodeURI(feed.tagParams.clickurl),false,"clickurl")}catch(e){Log(DEBUG,e+": "+feed.tagParams.clickurl)}try{this.addMonitor("adtag_winviewurl","View","Image",decodeURI(feed.tagParams.winviewurl),false)}catch(e){Log(DEBUG,e+": "+feed.tagParams.winviewurl)}try{this.addMonitor("adtag_clickthrough","ClickThrough","Image",decodeURI(feed.tagParams.bannerclickpixelurl),false,"bannerclickpixelurl")}catch(e){Log(DEBUG,e+": "+feed.tagParams.bannerclickpixelurl)}this.addPixelsFromFeed(params);this.params=params;var self=this}AdTracker.prototype.newVideoTracker=function(params){if(!params){params={}}this.activeVideoTracker=params.sId=this.videoTrackers.length;Log(DEBUG,"In newVideoTracker "+params.sId);var vt=new VideoTracker(this,params);this.videoTrackers.push(vt);return vt};AdTracker.prototype.sendRequest=function(request){TMRequest(this.statsURL,request.request);if(request.pixelTrigger){this.firePixels(request.pixelTrigger)}};AdTracker.prototype.enqueue=function(request,pixelTrigger){var obj={request:request,pixelTrigger:pixelTrigger};this.requestQueue.push(obj)};AdTracker.prototype.pumpQueue=function(){if(this.requestQueue.length){var request=this.requestQueue.shift();this.sendRequest(request)}};AdTracker.prototype.userAction=function(request,params){TMRequest(this.statsURL,request)};AdTracker.prototype.firePixels=function(trigger){for(var i=0;i<this.monitors.length;i++){var mon=this.monitors[i];if(mon.fired){continue}if(mon.event.toLowerCase()!=trigger.toLowerCase()){continue}if(!mon.pixel){continue}this.firePixel(trigger,mon.pixel.type,mon.pixel.value);mon.fired=true}};AdTracker.prototype.firePixel=function(trigger,type,src){src=src.replace("[[random]]",Math.random());src=src.replace("[[timestamp]]",(new Date()).getTime());src=src.replace("[timestamp]",(new Date()).getTime());Log(DEBUG,"Firing pixel. type = "+type+". src = "+src);switch(type){case"Flash":case"Image":thisTM.Util.loadImage(src);break;case"HTML":thisTM.Util.appendHTML(src);break;case"Javascript":thisTM.Util.loadScript(src);break;default:break}try{if(!testerName){testerName=trigger}PromoAdmin.MediaPlacement.Test.firePixel(testerName.toLowerCase(),src)}catch(e){}};AdTracker.prototype.addPixelsFromFeed=function(feed){var pixels=feed.pixels;var p;for(var i=0;i<pixels.length;i++){p=pixels[i];if(p){this.addMonitor(p.id,p.trigger,p.type,p.detail)}}};AdTracker.prototype.findMonitorById=function(id){for(var i in this.monitors){if(this.monitors[i].id==id){return this.monitors[i]}}return null};AdTracker.prototype.addMonitor=function(id,trigger,pixelType,pixelVal){if(thisTM.Util.isNull(id)||thisTM.Util.isNull(trigger)||thisTM.Util.isNull(pixelType)||thisTM.Util.isNull(pixelVal)){return}if(this.findMonitorById(id)){Log(DEBUG,"Already have monitor with id "+id);return}var mon={};mon.id=id;mon.fired=false;mon.event=trigger;mon.pixel={};mon.pixel.type=pixelType;mon.pixel.value=pixelVal;this.monitors.push(mon);if(mon.event=="NOW"){this.firePixels("NOW")}};function TMRequest(url,request){if(!request){return}url+="/"+request.type+"?";var kMaxItemLen=4000;Log(DEBUG,"In TMRequest");thisTM.Util.dumpObject(request.data);for(i in request.data){var val=request.data[i];if(!!val&&val.length>kMaxItemLen){val=val.substr(0,kMaxItemLen)}var escapedVal=encodeURIComponent(val);url+=i+"="+escapedVal+"&"}url=url.substr(0,url.length-1);thisTM.Util.loadImage(url);switch(request.type){case"pct100":thisTM.Util.audit.complete(null,"TM_AUDIT_COMP");break;case"view":thisTM.Util.audit.complete(null,"TM_AUDIT_VIEW");break}}function addParam(params,name,value){if(thisTM.Util.isNull(value)){return}Log(DEBUG,"In addParam. Adding "+name+" = "+value);params[name]=value}function CreateAdRequestData(request,type,adTracker){Log(DEBUG,"In CreateAdRequestData: "+type+". adTracker = "+adTracker);request.adTracker=adTracker;request.type=type;var params={};addParam(params,"sessId",adTracker.params.sessId);addParam(params,"paId",adTracker.params.paId);addParam(params,"psId",adTracker.params.psId);addParam(params,"eaId",adTracker.params.eaId);addParam(params,"eaName",adTracker.params.eaName);addParam(params,"did",adTracker.params.did);addParam(params,"didtype",adTracker.params.didtype);addParam(params,"nc",adTracker.params.nc);addParam(params,"rt","HTML5");if(adTracker.params.pt==type){addParam(params,"bi",adTracker.params.bi);addParam(params,"price",adTracker.params.price)}thisTM.Util.dumpObject("AdRequest params",params);request.data=params}function CreateVideoRequestData(request,type,videoTracker){Log(DEBUG,"In CreateVideoRequestData: "+type+". videoTracker = "+videoTracker);CreateAdRequestData(request,type,videoTracker.adTracker);addParam(request.data,"pvId",videoTracker.adTracker.params.pvId);var sId;if(videoTracker.params!=undefined&&videoTracker.params.sId!=undefined){sId=videoTracker.params.sId}else{if(videoTracker.adTracker!=undefined&&videoTracker.adTracker.params!=undefined&&videoTracker.adTracker.params.sId!=undefined){sId=videoTracker.adTracker.params.sId}}if(sId!=undefined){addParam(request.data,"sId",sId.toString())}}function VideoRequest(vt){Log(DEBUG,"In VideoRequest constructor. videoTracker = "+vt);CreateVideoRequestData(this,"view",vt);addParam(this.data,"dur",Math.round(vt.params.duration));addParam(this.data,"auto",vt.params.autoplay.toString());addParam(this.data,"burl",document.URL)}var pcts=new Array(null,"pct25","pct50","pct75","pct100");function TimeRequest(vt,q){Log(DEBUG,"TimeRequest(). videoTracker = "+vt);var eventType;var startRound=Math.round(vt.startTime);var endRound=Math.round(vt.endTime);if(q!=null){eventType=pcts[q];CreateVideoRequestData(this,eventType,vt);addParam(this.data,"dur",Math.round(vt.params.duration))}}function ViewableRequest(vt){Log(DEBUG,"In ViewableRequest constructor. videoTracker = "+vt);CreateVideoRequestData(this,"vimp",vt);addParam(this.data,"vinst","t");addParam(this.data,"vwbl","t");addParam(this.data,"vpct","100");addParam(this.data,"awin","t")}function ActionRequest(vt,type,params){Log(DEBUG,"ActionRequest(): "+type+". videoTracker = "+vt);thisTM.Util.dumpObject("videoTracker",vt);CreateVideoRequestData(this,type,vt);for(var a in params){addParam(this.data,a,params[a])}}var PLAYING="playing";var PAUSED="paused";var quartilePixelNames=new Array(null,"Complete25","Complete50","Complete75","Completion");var wiggleRoom=1;var currentWiggleRoom=0;function VideoTracker(adTracker,params){this.TRIGGER_NOW="NOW";this.TRIGGER_IMPRESSION="IMPRESSION";this.TRIGGER_VIMP="VIMP";this.TRIGGER_VIEW="VIEW";this.TRIGGER_COMPLETION="COMPLETION";this.TRIGGER_UNMUTE="UNMUTE";this.TRIGGER_CLICK_THROUGH="CLICKTHROUGH";this.TRIGGER_EMAIL_SHARE="EMAILSHARE";this.TRIGGER_FACEBOOK_SHARE="FACEBOOKSHARE";this.TRIGGER_TWITTER_SHARE="TWITTERSHARE";this.TRIGGER_FACEBOOK_FAN_PAGE_CLICK="FACEBOOKFANPAGECLICK";this.adTracker=adTracker;if(!params){params={}}thisTM.Util.dumpObject("videoTracker.params",params);if(thisTM.Util.isNull(params.duration)){Log(ERROR,"duration is required!");return}if(thisTM.Util.isNull(params.volume)){Log(WARN,"No volume parameter.  Defaulting to 1.");params.volume=1}if(thisTM.Util.isNull(params.autoplay)){Log(WARN,"No autoplay parameter.  Defaulting to false.");params.autoplay=false}this.quartilesReported=new Array(false,false,false,false,false);this.currentTime=0;this.lastCurrentTime=0;this.startTime=0;this.endTime=0;this.duration=params.duration;this.playStartTime=thisTM.Util.getCurrentTime();this.viewCounted=false;this.playState=PAUSED;this.lastPlayState=null;this.lastUpdateTime=thisTM.Util.getCurrentTime();this.params=params;this.clickThroughTracked=false;var self=this}VideoTracker.prototype.sendUpdate=function(end){var s=Math.round(this.startTime);var e=Math.round(end);if(e>s){this.endTime=end;this.lastUpdateTime=thisTM.Util.getCurrentTime();this.startTime=this.currentTime}};VideoTracker.prototype.sendVideoRequest=function(){Log(DEBUG,"In sendVideoRequest");this.adTracker.enqueue(new VideoRequest(this),this.TRIGGER_VIEW)};VideoTracker.prototype.sendViewableRequest=function(){Log(DEBUG,"In sendViewableRequest");this.adTracker.enqueue(new ViewableRequest(this),this.TRIGGER_VIMP)};VideoTracker.prototype.process=function(){if(this.currentTime>0){this.updateViewedHash(this.currentTime);this.reportQuartiles(this.getPercentViewed())}var now=thisTM.Util.getCurrentTime();var delta=this.currentTime-this.lastCurrentTime;if(this.lastPlayState!=this.playState){Log(DEBUG,"Play state changed from "+this.lastPlayState+" to "+this.playState)}if(this.playState==PAUSED){if(this.lastPlayState!=this.playState){this.sendUpdate(this.currentTime)}else{if(delta!=0){Log(DEBUG,"PAUSED. seeked, delta: "+delta)}}this.startTime=this.currentTime}else{if(this.playState==PLAYING){if(this.lastPlayState==PLAYING&&(delta>1||delta<0)){Log(DEBUG,"PLAYING. seeked, delta: "+delta);if(this.lastCurrentTime>this.startTime){this.sendUpdate(this.lastCurrentTime)}this.startTime=this.currentTime}else{if(this.currentTime<this.startTime){this.startTime=this.currentTime}if(!this.viewCounted){this.sendVideoRequest();this.viewCounted=true}}}}this.lastCurrentTime=this.currentTime;this.lastPlayState=this.playState;this.adTracker.pumpQueue()};VideoTracker.prototype.updateViewedHash=function(currentTime){if(!this.viewedHash){this.viewedHash=new Array();this.viewedHash[Math.floor(this.duration)]=false}this.viewedHash[Math.floor(currentTime)]=true};VideoTracker.prototype.getPercentViewed=function(){var viewedSeconds=this.viewedHash.filter(isElementTrue).length+currentWiggleRoom;return viewedSeconds/this.viewedHash.length};function isElementTrue(element,index,array){return element}VideoTracker.prototype.reportQuartiles=function(percentViewed){var quartilesCompleted=Math.floor(percentViewed/0.25);if(this.quartilesReported[quartilesCompleted]==false&&quartilesCompleted>0){switch(quartilesCompleted){case 4:thisTM.Util.audit.start(null,"TM_AUDIT_COMP");this.endTime=this.duration;break;case 1:if(thisTM.Feed.vtrusted&&String(thisTM.Feed.vtrusted).toLowerCase()=="t"){this.sendViewableRequest()}this.endTime=this.duration;break;case 3:currentWiggleRoom=wiggleRoom;default:this.endTime=this.currentTime;break}this.adTracker.enqueue(new TimeRequest(this,quartilesCompleted),quartilePixelNames[quartilesCompleted]);this.quartilesReported[quartilesCompleted]=true;this.lastUpdateTime=thisTM.Util.getCurrentTime();this.startTime=this.currentTime}};VideoTracker.prototype.getDuration=function(){return this.params.duration};VideoTracker.prototype.userAction=function(type){Log(DEBUG,"In userAction: "+type);trigger=null;switch(type){case EMAIL_SHARE:trigger=this.TRIGGER_EMAIL_SHARE;break;case FACEBOOK_SHARE:trigger=this.TRIGGER_FACEBOOK_SHARE;break;case TWITTER_SHARE:trigger=this.TRIGGER_TWITTER_SHARE;break;case CLICK_THROUGH:if(!this.clickThroughTracked){trigger=this.TRIGGER_CLICK_THROUGH;this.clickThroughTracked=true}break;case FACEBOOK_FAN_PAGE_CLICK:trigger=this.TRIGGER_FACEBOOK_FAN_PAGE_CLICK;break;default:Log(ERROR,"Unknown action");return}if(!!trigger){this.adTracker.userAction(new ActionRequest(this,type,this.params),trigger);this.adTracker.firePixels(trigger)}};VideoTracker.prototype.streamUpdate=function(playheadTime,volume){if(!this.viewCounted){this.sendVideoRequest();this.viewCounted=true}if(!volume){volume=1}if(playheadTime>this.lastCurrentTime){this.playState=PLAYING}else{if(playheadTime==this.lastCurrentTime){this.playState=PAUSED}else{}}this.volume=volume;this.currentTime=playheadTime;this.process()};return{EMAIL_SHARE:EMAIL_SHARE,FACEBOOK_SHARE:FACEBOOK_SHARE,TWITTER_SHARE:TWITTER_SHARE,CLICK_THROUGH:CLICK_THROUGH,FACEBOOK_FAN_PAGE_CLICK:FACEBOOK_FAN_PAGE_CLICK,DEBUG:DEBUG,INFO:INFO,WARN:WARN,ERROR:ERROR,FATAL:FATAL,OFF:OFF,SetLogFunction:SetLogFunction,SetLogLevel:SetLogLevel,Log:Log,newAdTracker:newAdTracker}}();(function(c){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=c()}else{if(typeof define==="function"&&define.amd){define([],c)}else{var b;if(typeof window!=="undefined"){b=window}else{if(typeof global!=="undefined"){b=global}else{if(typeof self!=="undefined"){b=self}else{b=this}}}b.DMVAST=c()}}})(function(){var f,c,b;return(function d(g,l,j){function h(r,p){if(!l[r]){if(!g[r]){var n=typeof require=="function"&&require;if(!p&&n){return n(r,!0)}if(e){return e(r,!0)}var q=new Error("Cannot find module '"+r+"'");throw q.code="MODULE_NOT_FOUND",q}var m=l[r]={exports:{}};g[r][0].call(m.exports,function(o){var s=g[r][1][o];return h(s?s:o)},m,m.exports,d,g,l,j)}return l[r].exports}var e=typeof require=="function"&&require;for(var k=0;k<j.length;k++){h(j[k])}return h})({1:[function(g,h,e){(function(){var j;j=(function(){function k(){this.id=null;this.errorURLTemplates=[];this.impressionURLTemplates=[];this.creatives=[]}return k})();h.exports=j}).call(this)},{}],2:[function(g,h,e){(function(){var j,k,l;k=g("./parser");l=g("./util");j=(function(){function m(){}m.cappingFreeLunch=0;m.cappingMinimumTimeInterval=0;m.options={withCredentials:false,timeout:0};m.get=function(q,r,n){var s,p,o;p=+new Date();s=e.extend=function(t,v){var u,w;for(u in v){w=v[u];t[u]=w}return t};if(!n){if(typeof r==="function"){n=r}o={}}o=s(this.options,r);if(this.totalCallsTimeout<p){this.totalCalls=1;this.totalCallsTimeout=p+(60*60*1000)}else{this.totalCalls++}if(this.cappingFreeLunch>=this.totalCalls){n(null);return}if(p-this.lastSuccessfullAd<this.cappingMinimumTimeInterval){n(null);return}return k.parse(q,o,(function(t){return function(u){return n(u)}})(this))};(function(){var n,o;o=l.storage;n=Object.defineProperty;["lastSuccessfullAd","totalCalls","totalCallsTimeout"].forEach(function(p){n(m,p,{get:function(){return o.getItem(p)},set:function(q){return o.setItem(p,q)},configurable:false,enumerable:true})});if(m.totalCalls==null){m.totalCalls=0}if(m.totalCallsTimeout==null){m.totalCallsTimeout=0}})();return m})();h.exports=j}).call(this)},{"./parser":7,"./util":13}],3:[function(g,h,e){(function(){var j;j=(function(){function k(){this.id=null;this.width=0;this.height=0;this.type=null;this.staticResource=null;this.htmlResource=null;this.iframeResource=null;this.companionClickThroughURLTemplate=null;this.trackingEvents={}}return k})();h.exports=j}).call(this)},{}],4:[function(g,h,e){(function(){var j,o,n,k,l={}.hasOwnProperty,m=function(s,q){for(var p in q){if(l.call(q,p)){s[p]=q[p]}}function r(){this.constructor=s}r.prototype=q.prototype;s.prototype=new r();s.__super__=q.prototype;return s};j=(function(){function p(){this.trackingEvents={}}return p})();n=(function(q){m(p,q);function p(){p.__super__.constructor.apply(this,arguments);this.type="linear";this.duration=0;this.skipDelay=null;this.mediaFiles=[];this.videoClickThroughURLTemplate=null;this.videoClickTrackingURLTemplates=[];this.videoCustomClickURLTemplates=[];this.adParameters=null}return p})(j);k=(function(q){m(p,q);function p(){return p.__super__.constructor.apply(this,arguments)}return p})(j);o=(function(q){m(p,q);function p(){this.type="companion";this.variations=[];this.videoClickTrackingURLTemplates=[]}return p})(j);h.exports={VASTCreativeLinear:n,VASTCreativeNonLinear:k,VASTCreativeCompanion:o}}).call(this)},{}],5:[function(g,h,e){(function(){h.exports={client:g("./client"),tracker:g("./tracker"),parser:g("./parser"),util:g("./util")}}).call(this)},{"./client":2,"./parser":7,"./tracker":9,"./util":13}],6:[function(g,h,e){(function(){var j;j=(function(){function k(){this.id=null;this.fileURL=null;this.deliveryType="progressive";this.mimeType=null;this.codec=null;this.bitrate=0;this.minBitrate=0;this.maxBitrate=0;this.width=0;this.height=0;this.apiFramework=null;this.scalable=null;this.maintainAspectRatio=null}return k})();h.exports=j}).call(this)},{}],7:[function(g,h,e){(function(){var t,m,o,k,r,l,j,n,q,p,s=[].indexOf||function(w){for(var v=0,u=this.length;v<u;v++){if(v in this&&this[v]===w){return v}}return -1};m=g("./urlhandler");q=g("./response");o=g("./ad");p=g("./util");l=g("./creative").VASTCreativeLinear;r=g("./creative").VASTCreativeCompanion;j=g("./mediafile");k=g("./companionad");t=g("events").EventEmitter;n=(function(){var u;function v(){}u=[];v.addURLTemplateFilter=function(w){if(typeof w==="function"){u.push(w)}};v.removeURLTemplateFilter=function(){return u.pop()};v.countURLTemplateFilters=function(){return u.length};v.clearUrlTemplateFilters=function(){return u=[]};v.parse=function(y,x,w){if(!w){if(typeof x==="function"){w=x}x={}}return this._parse(y,null,x,function(A,z){return w(z)})};v.vent=new t();v.track=function(w,x){this.vent.emit("VAST-error",x);return p.track(w,x)};v.on=function(x,w){return this.vent.on(x,w)};v.once=function(x,w){return this.vent.once(x,w)};v._parse=function(A,x,z,w){var B,C,y;if(!w){if(typeof z==="function"){w=z}z={}}for(C=0,y=u.length;C<y;C++){B=u[C];A=B(A)}if(x==null){x=[]}x.push(A);return m.get(A,z,(function(D){return function(K,O){var Q,G,P,H,M,L,I,F,E,N,J;if(K!=null){return w(K)}M=new q();if(!(((O!=null?O.documentElement:void 0)!=null)&&O.documentElement.nodeName==="VAST")){return w()}N=O.documentElement.childNodes;for(L=0,F=N.length;L<F;L++){H=N[L];if(H.nodeName==="Error"){M.errorURLTemplates.push(D.parseNodeText(H))}}J=O.documentElement.childNodes;for(I=0,E=J.length;I<E;I++){H=J[I];if(H.nodeName==="Ad"){Q=D.parseAdElement(H);if(Q!=null){M.ads.push(Q)}else{D.track(M.errorURLTemplates,{ERRORCODE:101})}}}G=function(S){var R,U,T;if(S==null){S=false}if(!M){return}T=M.ads;for(R=0,U=T.length;R<U;R++){Q=T[R];if(Q.nextWrapperURL!=null){return}}if(M.ads.length===0){if(!S){D.track(M.errorURLTemplates,{ERRORCODE:303})}M=null}return w(null,M)};P=M.ads.length;while(P--){Q=M.ads[P];if(Q.nextWrapperURL==null){continue}(function(R){var S,T;if(x.length>=10||(T=R.nextWrapperURL,s.call(x,T)>=0)){D.track(R.errorURLTemplates,{ERRORCODE:302});M.ads.splice(M.ads.indexOf(R),1);G();return}if(R.nextWrapperURL.indexOf("://")===-1){S=A.slice(0,A.lastIndexOf("/"));R.nextWrapperURL=""+S+"/"+R.nextWrapperURL}return D._parse(R.nextWrapperURL,x,z,function(ac,W){var af,al,ab,ad,ae,ah,X,ak,aj,ai,ag,U,an,am,aa,Z,Y,V;al=false;if(ac!=null){D.track(R.errorURLTemplates,{ERRORCODE:301});M.ads.splice(M.ads.indexOf(R),1);al=true}else{if(W==null){D.track(R.errorURLTemplates,{ERRORCODE:303});M.ads.splice(M.ads.indexOf(R),1);al=true}else{M.errorURLTemplates=M.errorURLTemplates.concat(W.errorURLTemplates);ad=M.ads.indexOf(R);M.ads.splice(ad,1);aa=W.ads;for(X=0,ak=aa.length;X<ak;X++){ae=aa[X];ae.errorURLTemplates=R.errorURLTemplates.concat(ae.errorURLTemplates);ae.impressionURLTemplates=R.impressionURLTemplates.concat(ae.impressionURLTemplates);if(R.trackingEvents!=null){Z=ae.creatives;for(U=0,aj=Z.length;U<aj;U++){af=Z[U];if(af.type==="linear"){Y=Object.keys(R.trackingEvents);for(an=0,ai=Y.length;an<ai;an++){ab=Y[an];(ah=af.trackingEvents)[ab]||(ah[ab]=[]);af.trackingEvents[ab]=af.trackingEvents[ab].concat(R.trackingEvents[ab])}}}}if(R.videoClickTrackingURLTemplates!=null){V=ae.creatives;for(am=0,ag=V.length;am<ag;am++){af=V[am];if(af.type==="linear"){af.videoClickTrackingURLTemplates=af.videoClickTrackingURLTemplates.concat(R.videoClickTrackingURLTemplates)}}}M.ads.splice(ad,0,ae)}}}delete R.nextWrapperURL;return G(al)})})(Q)}return G()}})(this))};v.childByName=function(y,x){var B,A,w,z;z=y.childNodes;for(A=0,w=z.length;A<w;A++){B=z[A];if(B.nodeName===x){return B}}};v.childsByName=function(y,x){var C,B,A,w,z;B=[];z=y.childNodes;for(A=0,w=z.length;A<w;A++){C=z[A];if(C.nodeName===x){B.push(C)}}return B};v.parseAdElement=function(z){var A,y,w,x;x=z.childNodes;for(y=0,w=x.length;y<w;y++){A=x[y];A.id=z.getAttribute("id");if(A.nodeName==="Wrapper"){return this.parseWrapperElement(A)}else{if(A.nodeName==="InLine"){return this.parseInLineElement(A)}}}};v.parseWrapperElement=function(w){var z,y,D,C,B,x,A;z=this.parseInLineElement(w);C=this.childByName(w,"VASTAdTagURI");if(C!=null){z.nextWrapperURL=this.parseNodeText(C)}else{C=this.childByName(w,"VASTAdTagURL");if(C!=null){z.nextWrapperURL=this.parseNodeText(this.childByName(C,"URL"))}}D=null;A=z.creatives;for(B=0,x=A.length;B<x;B++){y=A[B];if(y.type==="linear"){D=y;break}}if(D!=null){if(D.trackingEvents!=null){z.trackingEvents=D.trackingEvents}if(D.videoClickTrackingURLTemplates!=null){z.videoClickTrackingURLTemplates=D.videoClickTrackingURLTemplates}}if(z.nextWrapperURL!=null){return z}};v.parseInLineElement=function(F){var K,G,I,J,y,D,C,A,H,x,w,E,B,z;K=new o();K.id=F.id;E=F.childNodes;for(D=0,H=E.length;D<H;D++){y=E[D];switch(y.nodeName){case"Error":if(this.isUrl(y)){K.errorURLTemplates.push(this.parseNodeText(y))}break;case"Impression":if(this.isUrl(y)){K.impressionURLTemplates.push(this.parseNodeText(y))}break;case"Creatives":B=this.childsByName(y,"Creative");for(C=0,x=B.length;C<x;C++){I=B[C];z=I.childNodes;for(A=0,w=z.length;A<w;A++){J=z[A];switch(J.nodeName){case"Linear":G=this.parseCreativeLinearElement(J);if(G){K.creatives.push(G)}break;case"CompanionAds":G=this.parseCompanionAd(J);if(G){K.creatives.push(G)}}}}}}return K};v.parseCreativeLinearElement=function(Q){var y,T,P,F,U,af,O,X,ag,V,w,ae,C,x,S,G,R,N,ad,ac,ab,aa,M,E,D,B,A,z,Z,Y,W,L,K,J,I,H;P=new l();P.duration=this.parseDuration(this.parseNodeText(this.childByName(Q,"Duration")));if(P.duration===-1&&Q.parentNode.parentNode.parentNode.nodeName!=="Wrapper"){return null}C=Q.getAttribute("skipoffset");if(C==null){P.skipDelay=null}else{if(C.charAt(C.length-1)==="%"){w=parseInt(C,10);P.skipDelay=P.duration*(w/100)}else{P.skipDelay=this.parseDuration(C)}}R=this.childByName(Q,"VideoClicks");if(R!=null){P.videoClickThroughURLTemplate=this.parseNodeText(this.childByName(R,"ClickThrough"));W=this.childsByName(R,"ClickTracking");for(ad=0,M=W.length;ad<M;ad++){T=W[ad];P.videoClickTrackingURLTemplates.push(this.parseNodeText(T))}L=this.childsByName(R,"CustomClick");for(ac=0,E=L.length;ac<E;ac++){F=L[ac];P.videoCustomClickURLTemplates.push(this.parseNodeText(F))}}y=this.childByName(Q,"AdParameters");if(y!=null){P.adParameters=this.parseNodeText(y)}K=this.childsByName(Q,"TrackingEvents");for(ab=0,D=K.length;ab<D;ab++){S=K[ab];J=this.childsByName(S,"Tracking");for(aa=0,B=J.length;aa<B;aa++){x=J[aa];U=x.getAttribute("event");G=this.parseNodeText(x);if((U!=null)&&(G!=null)){if(U==="progress"){V=x.getAttribute("offset");if(!V){continue}if(V.charAt(V.length-1)==="%"){U="progress-"+V}else{U="progress-"+(Math.round(this.parseDuration(V)))}}if((N=P.trackingEvents)[U]==null){N[U]=[]}P.trackingEvents[U].push(G)}}}I=this.childsByName(Q,"MediaFiles");for(Z=0,A=I.length;Z<A;Z++){ag=I[Z];H=this.childsByName(ag,"MediaFile");for(Y=0,z=H.length;Y<z;Y++){X=H[Y];O=new j();O.id=X.getAttribute("id");O.fileURL=this.parseNodeText(X);O.deliveryType=X.getAttribute("delivery");O.codec=X.getAttribute("codec");O.mimeType=X.getAttribute("type");O.apiFramework=X.getAttribute("apiFramework");O.bitrate=parseInt(X.getAttribute("bitrate")||0);O.minBitrate=parseInt(X.getAttribute("minBitrate")||0);O.maxBitrate=parseInt(X.getAttribute("maxBitrate")||0);O.width=parseInt(X.getAttribute("width")||0);O.height=parseInt(X.getAttribute("height")||0);ae=X.getAttribute("scalable");if(ae&&typeof ae==="string"){ae=ae.toLowerCase();if(ae==="true"){O.scalable=true}else{if(ae==="false"){O.scalable=false}}}af=X.getAttribute("maintainAspectRatio");if(af&&typeof af==="string"){af=af.toLowerCase();if(af==="true"){O.maintainAspectRatio=true}else{if(af==="false"){O.maintainAspectRatio=false}}}P.mediaFiles.push(O)}}return P};v.parseCompanionAd=function(H){var L,P,O,K,Z,J,N,Q,z,I,R,E,C,A,x,V,X,W,U,T,S,w,Y,M,G,F,D,B,y;O=new r();M=this.childsByName(H,"Companion");for(E=0,V=M.length;E<V;E++){P=M[E];L=new k();L.id=P.getAttribute("id")||null;L.width=P.getAttribute("width");L.height=P.getAttribute("height");G=this.childsByName(P,"HTMLResource");for(C=0,X=G.length;C<X;C++){Z=G[C];L.type=Z.getAttribute("creativeType")||"text/html";L.htmlResource=this.parseNodeText(Z)}F=this.childsByName(P,"IFrameResource");for(A=0,W=F.length;A<W;A++){J=F[A];L.type=J.getAttribute("creativeType")||0;L.iframeResource=this.parseNodeText(J)}D=this.childsByName(P,"StaticResource");for(x=0,U=D.length;x<U;x++){N=D[x];L.type=N.getAttribute("creativeType")||0;L.staticResource=this.parseNodeText(N)}B=this.childsByName(P,"TrackingEvents");for(w=0,T=B.length;w<T;w++){z=B[w];y=this.childsByName(z,"Tracking");for(Y=0,S=y.length;Y<S;Y++){Q=y[Y];K=Q.getAttribute("event");I=this.parseNodeText(Q);if((K!=null)&&(I!=null)){if((R=L.trackingEvents)[K]==null){R[K]=[]}L.trackingEvents[K].push(I)}}}L.companionClickThroughURLTemplate=this.parseNodeText(this.childByName(P,"CompanionClickThrough"));O.variations.push(L)}return O};v.parseDuration=function(B){var z,w,y,A,x;if(!(B!=null)){return -1}z=B.split(":");if(z.length!==3){return -1}x=z[2].split(".");A=parseInt(x[0]);if(x.length===2){A+=parseFloat("0."+x[1])}y=parseInt(z[1]*60);w=parseInt(z[0]*60*60);if(isNaN(w||isNaN(y||isNaN(A||y>60*60||A>60)))){return -1}return w+y+A};v.parseNodeText=function(w){return w&&(w.textContent||w.text||"").trim()};v.isUrl=function(w){return/[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?//=]*)/i.test(this.parseNodeText(w))};return v})();h.exports=n}).call(this)},{"./ad":1,"./companionad":3,"./creative":4,"./mediafile":6,"./response":8,"./urlhandler":10,"./util":13,events:14}],8:[function(g,h,e){(function(){var j;j=(function(){function k(){this.ads=[];this.errorURLTemplates=[]}return k})();h.exports=j}).call(this)},{}],9:[function(g,h,e){(function(){var o,j,n,k,p,l={}.hasOwnProperty,m=function(t,r){for(var q in r){if(l.call(r,q)){t[q]=r[q]}}function s(){this.constructor=t}s.prototype=r.prototype;t.prototype=new s();t.__super__=r.prototype;return t};j=g("./client");p=g("./util");n=g("./creative").VASTCreativeLinear;o=g("events").EventEmitter;k=(function(r){m(q,r);function q(v,s){var t,u,w;this.ad=v;this.creative=s;this.muted=false;this.impressed=false;this.skipable=false;this.skipDelayDefault=-1;this.trackingEvents={};this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"];w=this.creative.trackingEvents;for(t in w){u=w[t];this.trackingEvents[t]=u.slice(0)}if(this.creative instanceof n){this.setDuration(this.creative.duration);this.skipDelay=this.creative.skipDelay;this.linear=true;this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate;this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates}else{this.skipDelay=-1;this.linear=false}this.on("start",function(){j.lastSuccessfullAd=+new Date()})}q.prototype.setDuration=function(s){this.assetDuration=s;return this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100}};q.prototype.setProgress=function(s){var w,B,x,y,A,t,u,z,v;A=this.skipDelay===null?this.skipDelayDefault:this.skipDelay;if(A!==-1&&!this.skipable){if(A>s){this.emit("skip-countdown",A-s)}else{this.skipable=true;this.emit("skip-countdown",0)}}if(this.linear&&this.assetDuration>0){B=[];if(s>0){B.push("start");x=Math.round(s/this.assetDuration*100);B.push("progress-"+x+"%");B.push("progress-"+(Math.round(s)));v=this.quartiles;for(y in v){t=v[y];if((t<=s&&s<=(t+1))){B.push(y)}}}for(u=0,z=B.length;u<z;u++){w=B[u];this.track(w,true)}if(s<this.progress){this.track("rewind")}}return this.progress=s};q.prototype.setMuted=function(s){if(this.muted!==s){this.track(s?"mute":"unmute")}return this.muted=s};q.prototype.setPaused=function(s){if(this.paused!==s){this.track(s?"pause":"resume")}return this.paused=s};q.prototype.setFullscreen=function(s){if(this.fullscreen!==s){this.track(s?"fullscreen":"exitFullscreen")}return this.fullscreen=s};q.prototype.setSkipDelay=function(s){if(typeof s==="number"){return this.skipDelay=s}};q.prototype.load=function(){if(!this.impressed){this.impressed=true;this.trackURLs(this.ad.impressionURLTemplates);return this.track("creativeView")}};q.prototype.errorWithCode=function(s){return this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:s})};q.prototype.complete=function(){return this.track("complete")};q.prototype.stop=function(){return this.track(this.linear?"closeLinear":"close")};q.prototype.skip=function(){this.track("skip");return this.trackingEvents=[]};q.prototype.click=function(){var s,u,t;if((t=this.clickTrackingURLTemplates)!=null?t.length:void 0){this.trackURLs(this.clickTrackingURLTemplates)}if(this.clickThroughURLTemplate!=null){if(this.linear){u={CONTENTPLAYHEAD:this.progressFormated()}}s=p.resolveURLTemplates([this.clickThroughURLTemplate],u)[0];return this.emit("clickthrough",s)}};q.prototype.track=function(u,v){var s,t;if(v==null){v=false}if(u==="closeLinear"&&((this.trackingEvents[u]==null)&&(this.trackingEvents.close!=null))){u="close"}t=this.trackingEvents[u];s=this.emitAlwaysEvents.indexOf(u);if(t!=null){this.emit(u,"");this.trackURLs(t)}else{if(s!==-1){this.emit(u,"")}}if(v===true){delete this.trackingEvents[u];if(s>-1){this.emitAlwaysEvents.splice(s,1)}}};q.prototype.trackURLs=function(s,t){if(t==null){t={}}if(this.linear){t.CONTENTPLAYHEAD=this.progressFormated()}return p.track(s,t)};q.prototype.progressFormated=function(){var w,t,u,v,x;x=parseInt(this.progress);w=x/(60*60);if(w.length<2){w="0"+w}t=x/60%60;if(t.length<2){t="0"+t}v=x%60;if(v.length<2){v="0"+t}u=parseInt((this.progress-x)*100);return""+w+":"+t+":"+v+"."+u};return q})(o);h.exports=k}).call(this)},{"./client":2,"./creative":4,"./util":13,events:14}],10:[function(g,h,e){(function(){var k,j,l;l=g("./urlhandlers/xmlhttprequest");j=g("./urlhandlers/flash");k=(function(){function m(){}m.get=function(p,o,n){if(!n){if(typeof o==="function"){n=o}o={}}if(o.urlhandler&&o.urlhandler.supported()){return o.urlhandler.get(p,o,n)}else{if(typeof window==="undefined"||window===null){return g("./urlhandlers/node").get(p,o,n)}else{if(l.supported()){return l.get(p,o,n)}else{if(j.supported()){return j.get(p,o,n)}else{return n()}}}}};return m})();h.exports=k}).call(this)},{"./urlhandlers/flash":11,"./urlhandlers/xmlhttprequest":12}],11:[function(g,h,e){(function(){var j;j=(function(){function k(){}k.xdr=function(){var l;if(window.XDomainRequest){l=new XDomainRequest()}return l};k.supported=function(){return !!this.xdr()};k.get=function(o,n,l){var m,p;if(p=typeof window.ActiveXObject==="function"?new window.ActiveXObject("Microsoft.XMLDOM"):void 0){p.async=false}else{return l()}m=this.xdr();m.open("GET",o);m.timeout=n.timeout||0;m.withCredentials=n.withCredentials||false;m.send();m.onprogress=function(){};return m.onload=function(){p.loadXML(m.responseText);return l(null,p)}};return k})();h.exports=j}).call(this)},{}],12:[function(g,h,e){(function(){var j;j=(function(){function k(){}k.xhr=function(){var l;l=new window.XMLHttpRequest();if("withCredentials" in l){return l}};k.supported=function(){return !!this.xhr()};k.get=function(n,m,l){var p;try{p=this.xhr();p.open("GET",n);p.timeout=m.timeout||0;p.withCredentials=m.withCredentials||false;p.send();return p.onreadystatechange=function(){if(p.readyState===4){return l(null,p.responseXML)}}}catch(o){return l()}};return k})();h.exports=j}).call(this)},{}],13:[function(g,h,e){(function(){var j;j=(function(){function k(){}k.track=function(r,s){var l,o,p,q,n,m;o=this.resolveURLTemplates(r,s);m=[];for(q=0,n=o.length;q<n;q++){l=o[q];if(typeof window!=="undefined"&&window!==null){p=new Image();m.push(p.src=l)}else{}}return m};k.resolveURLTemplates=function(l,v){var t,o,u,n,m,p,s,q,r;o=[];if(v==null){v={}}if(!("CACHEBUSTING" in v)){v.CACHEBUSTING=Math.round(Math.random()*10000000000)}v.random=v.CACHEBUSTING;for(q=0,r=l.length;q<r;q++){t=l[q];p=t;if(!p){continue}for(u in v){s=v[u];n="["+u+"]";m="%%"+u+"%%";p=p.replace(n,s);p=p.replace(m,s)}o.push(p)}return o};k.storage=(function(){var n,l,p,m;try{p=typeof window!=="undefined"&&window!==null?window.localStorage||window.sessionStorage:null}catch(o){m=o;p=null}l=function(q){var s,r;try{r="__VASTUtil__";q.setItem(r,r);if(q.getItem(r)!==r){return true}}catch(t){s=t;return true}return false};if((p==null)||l(p)){n={};p={length:0,getItem:function(q){return n[q]},setItem:function(q,r){n[q]=r;this.length=Object.keys(n).length},removeItem:function(q){delete n[q];this.length=Object.keys(n).length},clear:function(){n={};this.length=0}}}return p})();return k})();h.exports=j}).call(this)},{}],14:[function(k,l,h){function m(){this._events=this._events||{};this._maxListeners=this._maxListeners||undefined}l.exports=m;m.EventEmitter=m;m.prototype._events=undefined;m.prototype._maxListeners=undefined;m.defaultMaxListeners=10;m.prototype.setMaxListeners=function(o){if(!j(o)||o<0||isNaN(o)){throw TypeError("n must be a positive number")}this._maxListeners=o;return this};m.prototype.emit=function(t){var u,s,o,p,q,r;if(!this._events){this._events={}}if(t==="error"){if(!this._events.error||(e(this._events.error)&&!this._events.error.length)){u=arguments[1];if(u instanceof Error){throw u}throw TypeError('Uncaught, unspecified "error" event.')}}s=this._events[t];if(g(s)){return false}if(n(s)){switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:o=arguments.length;p=new Array(o-1);for(q=1;q<o;q++){p[q-1]=arguments[q]}s.apply(this,p)}}else{if(e(s)){o=arguments.length;p=new Array(o-1);for(q=1;q<o;q++){p[q-1]=arguments[q]}r=s.slice();o=r.length;for(q=0;q<o;q++){r[q].apply(this,p)}}}return true};m.prototype.addListener=function(p,q){var o;if(!n(q)){throw TypeError("listener must be a function")}if(!this._events){this._events={}}if(this._events.newListener){this.emit("newListener",p,n(q.listener)?q.listener:q)}if(!this._events[p]){this._events[p]=q}else{if(e(this._events[p])){this._events[p].push(q)}else{this._events[p]=[this._events[p],q]}}if(e(this._events[p])&&!this._events[p].warned){var o;if(!g(this._maxListeners)){o=this._maxListeners}else{o=m.defaultMaxListeners}if(o&&o>0&&this._events[p].length>o){this._events[p].warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[p].length);if(typeof console.trace==="function"){console.trace()}}}return this};m.prototype.on=m.prototype.addListener;m.prototype.once=function(o,q){if(!n(q)){throw TypeError("listener must be a function")}var r=false;function p(){this.removeListener(o,p);if(!r){r=true;q.apply(this,arguments)}}p.listener=q;this.on(o,p);return this};m.prototype.removeListener=function(q,t){var s,o,r,p;if(!n(t)){throw TypeError("listener must be a function")}if(!this._events||!this._events[q]){return this}s=this._events[q];r=s.length;o=-1;if(s===t||(n(s.listener)&&s.listener===t)){delete this._events[q];if(this._events.removeListener){this.emit("removeListener",q,t)}}else{if(e(s)){for(p=r;p-->0;){if(s[p]===t||(s[p].listener&&s[p].listener===t)){o=p;break}}if(o<0){return this}if(s.length===1){s.length=0;delete this._events[q]}else{s.splice(o,1)}if(this._events.removeListener){this.emit("removeListener",q,t)}}}return this};m.prototype.removeAllListeners=function(q){var o,p;if(!this._events){return this}if(!this._events.removeListener){if(arguments.length===0){this._events={}}else{if(this._events[q]){delete this._events[q]}}return this}if(arguments.length===0){for(o in this._events){if(o==="removeListener"){continue}this.removeAllListeners(o)}this.removeAllListeners("removeListener");this._events={};return this}p=this._events[q];if(n(p)){this.removeListener(q,p)}else{while(p.length){this.removeListener(q,p[p.length-1])}}delete this._events[q];return this};m.prototype.listeners=function(p){var o;if(!this._events||!this._events[p]){o=[]}else{if(n(this._events[p])){o=[this._events[p]]}else{o=this._events[p].slice()}}return o};m.listenerCount=function(q,p){var o;if(!q._events||!q._events[p]){o=0}else{if(n(q._events[p])){o=1}else{o=q._events[p].length}}return o};function n(o){return typeof o==="function"}function j(o){return typeof o==="number"}function e(o){return typeof o==="object"&&o!==null}function g(o){return o===void 0}},{}]},{},[5])(5)});