var qq=qq||{};qq.extend=function(a,d){for(var c in d)a[c]=d[c]};qq.indexOf=function(a,d,c){if(a.indexOf)return a.indexOf(d,c);var c=c||0,b=a.length;for(0>c&&(c+=b);c<b;c++)if(c in a&&a[c]===d)return c;return-1};qq.getUniqueId=function(){var a=0;return function(){return a++}}();qq.attach=function(a,d,c){a.addEventListener?a.addEventListener(d,c,!1):a.attachEvent&&a.attachEvent("on"+d,c)};
qq.detach=function(a,d,c){a.removeEventListener?a.removeEventListener(d,c,!1):a.attachEvent&&a.detachEvent("on"+d,c)};qq.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1};qq.insertBefore=function(a,d){d.parentNode.insertBefore(a,d)};qq.remove=function(a){a.parentNode.removeChild(a)};qq.contains=function(a,d){return a==d?!0:a.contains?a.contains(d):!!(d.compareDocumentPosition(a)&8)};
qq.toElement=function(){var a=document.createElement("div");return function(d){a.innerHTML=d;d=a.firstChild;a.removeChild(d);return d}}();qq.css=function(a,d){null!=d.opacity&&"string"!=typeof a.style.opacity&&"undefined"!=typeof a.filters&&(d.filter="alpha(opacity="+Math.round(100*d.opacity)+")");qq.extend(a.style,d)};qq.hasClass=function(a,d){return RegExp("(^| )"+d+"( |$)").test(a.className)};qq.addClass=function(a,d){qq.hasClass(a,d)||(a.className+=" "+d)};
qq.removeClass=function(a,d){a.className=a.className.replace(RegExp("(^| )"+d+"( |$)")," ").replace(/^\s+|\s+$/g,"")};qq.setText=function(a,d){a.innerText=d;a.textContent=d};qq.children=function(a){for(var d=[],a=a.firstChild;a;)1==a.nodeType&&d.push(a),a=a.nextSibling;return d};qq.getByClass=function(a,d){if(a.querySelectorAll)return a.querySelectorAll("."+d);for(var c=[],b=a.getElementsByTagName("*"),f=b.length,e=0;e<f;e++)qq.hasClass(b[e],d)&&c.push(b[e]);return c};
qq.obj2url=function(a,d,c){var b=[],f="&",e=function(a,e){var g=d?/\[\]$/.test(d)?d:d+"["+e+"]":e;"undefined"!=g&&"undefined"!=e&&b.push("object"===typeof a?qq.obj2url(a,g,!0):"[object Function]"===Object.prototype.toString.call(a)?encodeURIComponent(g)+"="+encodeURIComponent(a()):encodeURIComponent(g)+"="+encodeURIComponent(a))};if(!c&&d)f=/\?/.test(d)?/\?$/.test(d)?"":"&":"?",b.push(d),b.push(qq.obj2url(a));else if("[object Array]"===Object.prototype.toString.call(a)&&"undefined"!=typeof a)for(var g=
0,c=a.length;g<c;++g)e(a[g],g);else if("undefined"!=typeof a&&null!==a&&"object"===typeof a)for(g in a)e(a[g],g);else b.push(encodeURIComponent(d)+"="+encodeURIComponent(a));return b.join(f).replace(/^&/,"").replace(/%20/g,"+")};qq=qq||{};
qq.FileUploaderBasic=function(a){this._options={debug:!1,action:"/server/upload",params:{},button:null,multiple:!0,maxConnections:3,allowedExtensions:[],sizeLimit:0,minSizeLimit:0,onSubmit:function(){},onProgress:function(){},onComplete:function(){},onCancel:function(){},messages:{typeError:"{file} has invalid extension. Only {extensions} are allowed.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",
onLeave:"The files are being uploaded, if you leave now the upload will be cancelled."},showMessage:function(a){alert(a)}};qq.extend(this._options,a);this._filesInProgress=0;this._handler=this._createUploadHandler();this._options.button&&(this._button=this._createUploadButton(this._options.button));this._preventLeaveInProgress()};
qq.FileUploaderBasic.prototype={setParams:function(a){this._options.params=a},getInProgress:function(){return this._filesInProgress},_createUploadButton:function(a){var d=this;return new qq.UploadButton({element:a,multiple:this._options.multiple&&qq.UploadHandlerXhr.isSupported(),onChange:function(a){d._onInputChange(a)}})},_createUploadHandler:function(){var a=this,d;d=qq.UploadHandlerXhr.isSupported()?"UploadHandlerXhr":"UploadHandlerForm";return new qq[d]({debug:this._options.debug,action:this._options.action,
maxConnections:this._options.maxConnections,onProgress:function(c,b,d,e){a._onProgress(c,b,d,e);a._options.onProgress(c,b,d,e)},onComplete:function(c,b,d){a._onComplete(c,b,d);a._options.onComplete(c,b,d)},onCancel:function(c,b){a._onCancel(c,b);a._options.onCancel(c,b)}})},_preventLeaveInProgress:function(){var a=this;qq.attach(window,"beforeunload",function(d){if(a._filesInProgress)return d=d||window.event,d.returnValue=a._options.messages.onLeave})},_onSubmit:function(){this._filesInProgress++},
_onProgress:function(){},_onComplete:function(a,d,c){this._filesInProgress--;c.error&&this._options.showMessage(c.error)},_onCancel:function(){this._filesInProgress--},_onInputChange:function(a){this._handler instanceof qq.UploadHandlerXhr?this._uploadFileList(a.files):this._validateFile(a)&&this._uploadFile(a);this._button.reset()},_uploadFileList:function(a){for(var d=0;d<a.length;d++)if(!this._validateFile(a[d]))return;for(d=0;d<a.length;d++)this._uploadFile(a[d])},_uploadFile:function(a){var a=
this._handler.add(a),d=this._handler.getName(a);!1!==this._options.onSubmit(a,d)&&(this._onSubmit(a,d),this._handler.upload(a,this._options.params))},_validateFile:function(a){var d,c;a.value?d=a.value.replace(/.*(\/|\\)/,""):(d=null!=a.fileName?a.fileName:a.name,c=null!=a.fileSize?a.fileSize:a.size);if(this._isAllowedExtension(d)){if(0===c)return this._error("emptyError",d),!1;if(c&&this._options.sizeLimit&&c>this._options.sizeLimit)return this._error("sizeError",d),!1;if(c&&c<this._options.minSizeLimit)return this._error("minSizeError",
d),!1}else return this._error("typeError",d),!1;return!0},_error:function(a,d){var c=this._options.messages[a],b=this._formatFileName(d),c=c.replace("{file}",b),b=this._options.allowedExtensions.join(", "),c=c.replace("{extensions}",b),b=this._formatSize(this._options.sizeLimit),c=c.replace("{sizeLimit}",b),b=this._formatSize(this._options.minSizeLimit),c=c.replace("{minSizeLimit}",b);this._options.showMessage(c)},_formatFileName:function(a){33<a.length&&(a=a.slice(0,19)+"..."+a.slice(-13));return a},
_isAllowedExtension:function(a){var a=-1!==a.indexOf(".")?a.replace(/.*[.]/,"").toLowerCase():"",d=this._options.allowedExtensions;if(!d.length)return!0;for(var c=0;c<d.length;c++)if(d[c].toLowerCase()==a)return!0;return!1},_formatSize:function(a){var d=-1;do a/=1024,d++;while(99<a);return Math.max(a,0.1).toFixed(1)+"kB,MB,GB,TB,PB,EB".split(",")[d]}};
qq.FileUploader=function(a){qq.FileUploaderBasic.apply(this,arguments);qq.extend(this._options,{element:null,listElement:null,template:'<div class="qq-uploader"><div class="qq-upload-drop-area"><span>Drop files here to upload</span></div><div class="qq-upload-button">'+(null==a.uploadFileLabel?"Upload a file":a.uploadFileLabel)+'</div><ul class="qq-upload-list"></ul></div>',fileTemplate:'<li><span class="qq-upload-file"></span><span class="qq-upload-spinner"></span><span class="qq-upload-size"></span><a class="qq-upload-cancel" href="#">Cancel</a></li>',
classes:{button:"qq-upload-button",drop:"qq-upload-drop-area",dropActive:"qq-upload-drop-area-active",list:"qq-upload-list",file:"qq-upload-file",spinner:"qq-upload-spinner",size:"qq-upload-size",cancel:"qq-upload-cancel",success:"qq-upload-success",fail:"qq-upload-fail"}});qq.extend(this._options,a);this._element=this._options.element;this._element.innerHTML=this._options.template;this._listElement=this._options.listElement||this._find(this._element,"list");this._classes=this._options.classes;this._button=
this._createUploadButton(this._find(this._element,"button"));this._bindCancelEvent();this._setupDragDrop()};qq.extend(qq.FileUploader.prototype,qq.FileUploaderBasic.prototype);
qq.extend(qq.FileUploader.prototype,{_find:function(a,d){var c=qq.getByClass(a,this._options.classes[d])[0];if(!c)throw Error("element not found "+d);return c},_setupDragDrop:function(){var a=this,d=this._find(this._element,"drop"),c=new qq.UploadDropZone({element:d,onEnter:function(b){qq.addClass(d,a._classes.dropActive);b.stopPropagation()},onLeave:function(a){a.stopPropagation()},onLeaveNotDescendants:function(){qq.removeClass(d,a._classes.dropActive)},onDrop:function(b){d.style.display="none";
qq.removeClass(d,a._classes.dropActive);a._uploadFileList(b.dataTransfer.files)}});d.style.display="none";qq.attach(document,"dragenter",function(a){c._isValidFileDrag(a)&&(d.style.display="block")});qq.attach(document,"dragleave",function(a){if(c._isValidFileDrag(a)&&(a=document.elementFromPoint(a.clientX,a.clientY),!a||"HTML"==a.nodeName))d.style.display="none"})},_onSubmit:function(a,d){qq.FileUploaderBasic.prototype._onSubmit.apply(this,arguments);this._addToList(a,d)},_onProgress:function(a,
d,c,b){qq.FileUploaderBasic.prototype._onProgress.apply(this,arguments);var f=this._find(this._getItemByFileId(a),"size");f.style.display="inline";var e;e=c!=b?Math.round(100*(c/b))+"% from "+this._formatSize(b):this._formatSize(b);qq.setText(f,e)},_onComplete:function(a,d,c){qq.FileUploaderBasic.prototype._onComplete.apply(this,arguments);var b=this._getItemByFileId(a);qq.remove(this._find(b,"cancel"));qq.remove(this._find(b,"spinner"));c.success?qq.addClass(b,this._classes.success):qq.addClass(b,
this._classes.fail)},_addToList:function(a,d){var c=qq.toElement(this._options.fileTemplate);c.qqFileId=a;var b=this._find(c,"file");qq.setText(b,this._formatFileName(d));this._find(c,"size").style.display="none";this._listElement.appendChild(c)},_getItemByFileId:function(a){for(var d=this._listElement.firstChild;d;){if(d.qqFileId==a)return d;d=d.nextSibling}},_bindCancelEvent:function(){var a=this;qq.attach(this._listElement,"click",function(d){var d=d||window.event,c=d.target||d.srcElement;qq.hasClass(c,
a._classes.cancel)&&(qq.preventDefault(d),d=c.parentNode,a._handler.cancel(d.qqFileId),qq.remove(d))})}});qq.UploadDropZone=function(a){this._options={element:null,onEnter:function(){},onLeave:function(){},onLeaveNotDescendants:function(){},onDrop:function(){}};qq.extend(this._options,a);this._element=this._options.element;this._disableDropOutside();this._attachEvents()};
qq.UploadDropZone.prototype={_disableDropOutside:function(){qq.UploadDropZone.dropOutsideDisabled||(qq.attach(document,"dragover",function(a){a.dataTransfer&&(a.dataTransfer.dropEffect="none",a.preventDefault())}),qq.UploadDropZone.dropOutsideDisabled=!0)},_attachEvents:function(){var a=this;qq.attach(a._element,"dragover",function(d){if(a._isValidFileDrag(d)){var c=d.dataTransfer.effectAllowed;d.dataTransfer.dropEffect="move"==c||"linkMove"==c?"move":"copy";d.stopPropagation();d.preventDefault()}});
qq.attach(a._element,"dragenter",function(d){if(a._isValidFileDrag(d))a._options.onEnter(d)});qq.attach(a._element,"dragleave",function(d){if(a._isValidFileDrag(d)){a._options.onLeave(d);var c=document.elementFromPoint(d.clientX,d.clientY);if(!qq.contains(this,c))a._options.onLeaveNotDescendants(d)}});qq.attach(a._element,"drop",function(d){a._isValidFileDrag(d)&&(d.preventDefault(),a._options.onDrop(d))})},_isValidFileDrag:function(a){var a=a.dataTransfer,d=-1<navigator.userAgent.indexOf("AppleWebKit");
return a&&"none"!=a.effectAllowed&&(a.files||!d&&a.types.contains&&a.types.contains("Files"))}};qq.UploadButton=function(a){this._options={element:null,multiple:!1,name:"file",onChange:function(){},hoverClass:"qq-upload-button-hover",focusClass:"qq-upload-button-focus"};qq.extend(this._options,a);this._element=this._options.element;qq.css(this._element,{position:"relative",overflow:"hidden",direction:"ltr"});this._input=this._createInput()};
qq.UploadButton.prototype={getInput:function(){return this._input},reset:function(){this._input.parentNode&&qq.remove(this._input);qq.removeClass(this._element,this._options.focusClass);this._input=this._createInput()},_createInput:function(){var a=document.createElement("input");this._options.multiple&&a.setAttribute("multiple","multiple");a.setAttribute("type","file");a.setAttribute("name",this._options.name);qq.css(a,{position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:"118px",margin:0,
padding:0,cursor:"pointer",opacity:0});this._element.appendChild(a);var d=this;qq.attach(a,"change",function(){d._options.onChange(a)});qq.attach(a,"mouseover",function(){qq.addClass(d._element,d._options.hoverClass)});qq.attach(a,"mouseout",function(){qq.removeClass(d._element,d._options.hoverClass)});qq.attach(a,"focus",function(){qq.addClass(d._element,d._options.focusClass)});qq.attach(a,"blur",function(){qq.removeClass(d._element,d._options.focusClass)});window.attachEvent&&a.setAttribute("tabIndex",
"-1");return a}};qq.UploadHandlerAbstract=function(a){this._options={debug:!1,action:"/upload.php",maxConnections:999,onProgress:function(){},onComplete:function(){},onCancel:function(){}};qq.extend(this._options,a);this._queue=[];this._params=[]};
qq.UploadHandlerAbstract.prototype={log:function(a){this._options.debug&&window.console&&console.log("[uploader] "+a)},add:function(){},upload:function(a,d){var c=this._queue.push(a),b={};qq.extend(b,d);this._params[a]=b;c<=this._options.maxConnections&&this._upload(a,this._params[a])},cancel:function(a){this._cancel(a);this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++)this._cancel(this._queue[a]);this._queue=[]},getName:function(){},getSize:function(){},getQueue:function(){return this._queue},
_upload:function(){},_cancel:function(){},_dequeue:function(a){a=qq.indexOf(this._queue,a);this._queue.splice(a,1);var d=this._options.maxConnections;this._queue.length>=d&&a<d&&(a=this._queue[d-1],this._upload(a,this._params[a]))}};qq.UploadHandlerForm=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._inputs={}};qq.extend(qq.UploadHandlerForm.prototype,qq.UploadHandlerAbstract.prototype);
qq.extend(qq.UploadHandlerForm.prototype,{add:function(a){a.setAttribute("name","qqfile");var d="qq-upload-handler-iframe"+qq.getUniqueId();this._inputs[d]=a;a.parentNode&&qq.remove(a);return d},getName:function(a){return this._inputs[a].value.replace(/.*(\/|\\)/,"")},_cancel:function(a){this._options.onCancel(a,this.getName(a));delete this._inputs[a];if(a=document.getElementById(a))a.setAttribute("src","javascript:false;"),qq.remove(a)},_upload:function(a,d){var c=this._inputs[a];if(!c)throw Error("file with passed id was not added, or already uploaded or cancelled");
var b=this.getName(a),f=this._createIframe(a),e=this._createForm(f,d);e.appendChild(c);var g=this;this._attachLoadEvent(f,function(){g.log("iframe loaded");var e=g._getIframeContentJSON(f);g._options.onComplete(a,b,e);g._dequeue(a);delete g._inputs[a];setTimeout(function(){qq.remove(f)},1)});e.submit();qq.remove(e);return a},_attachLoadEvent:function(a,d){qq.attach(a,"load",function(){a.parentNode&&(!a.contentDocument||!(a.contentDocument.body&&"false"==a.contentDocument.body.innerHTML))&&d()})},
_getIframeContentJSON:function(a){var a=a.contentDocument?a.contentDocument:a.contentWindow.document,d;this.log("converting iframe's innerHTML to JSON");this.log("innerHTML = "+a.body.innerHTML);try{d=eval("("+a.body.innerHTML+")")}catch(c){d={}}return d},_createIframe:function(a){var d=qq.toElement('<iframe src="javascript:false;" name="'+a+'" />');d.setAttribute("id",a);d.style.display="none";document.body.appendChild(d);return d},_createForm:function(a,d){var c=qq.toElement('<form method="post" enctype="multipart/form-data"></form>'),
b=qq.obj2url(d,this._options.action);c.setAttribute("action",b);c.setAttribute("target",a.name);c.style.display="none";document.body.appendChild(c);return c}});qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){var a=document.createElement("input");a.type="file";return"multiple"in a&&"undefined"!=typeof File&&"undefined"!=typeof(new XMLHttpRequest).upload};
qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);
qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File))throw Error("Passed obj in not a File (in qq.UploadHandlerXhr)");return this._files.push(a)-1},getName:function(a){a=this._files[a];return null!=a.fileName?a.fileName:a.name},getSize:function(a){a=this._files[a];return null!=a.fileSize?a.fileSize:a.size},getLoaded:function(a){return this._loaded[a]||0},_upload:function(a,d){var c=this._files[a],b=this.getName(a);this.getSize(a);this._loaded[a]=0;var f=this._xhrs[a]=new XMLHttpRequest,
e=this;f.upload.onprogress=function(g){g.lengthComputable&&(e._loaded[a]=g.loaded,e._options.onProgress(a,b,g.loaded,g.total))};f.onreadystatechange=function(){4==f.readyState&&e._onComplete(a,f)};d=d||{};d.qqfile=b;var g=qq.obj2url(d,this._options.action);f.open("POST",g,!0);f.setRequestHeader("X-Requested-With","XMLHttpRequest");f.setRequestHeader("X-File-Name",encodeURIComponent(b));f.setRequestHeader("Content-Type","application/octet-stream");f.send(c)},_onComplete:function(a,d){if(this._files[a]){var c=
this.getName(a),b=this.getSize(a);this._options.onProgress(a,c,b,b);if(200==d.status){this.log("xhr - server response received");this.log("responseText = "+d.responseText);var f;try{f=eval("("+d.responseText+")")}catch(e){f={}}this._options.onComplete(a,c,f)}else this._options.onComplete(a,c,{});this._files[a]=null;this._xhrs[a]=null;this._dequeue(a)}},_cancel:function(a){this._options.onCancel(a,this.getName(a));this._files[a]=null;this._xhrs[a]&&(this._xhrs[a].abort(),this._xhrs[a]=null)}});(function(a,d){function c(e,c){var d,f;d=e.nodeName.toLowerCase();if("area"===d){d=e.parentNode;f=d.name;if(!e.href||!f||"map"!==d.nodeName.toLowerCase())return!1;d=a("img[usemap=#"+f+"]")[0];return!!d&&b(d)}return(/input|select|textarea|button|object/.test(d)?!e.disabled:"a"===d?e.href||c:c)&&b(e)}function b(b){return a.expr.filters.visible(b)&&!a(b).parents().andSelf().filter(function(){return"hidden"===a.css(this,"visibility")}).length}var f=0,e=/^ui-id-\d+$/;a.ui=a.ui||{};a.ui.version||(a.extend(a.ui,
{version:"1.9.2",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),a.fn.extend({_focus:a.fn.focus,focus:function(b,e){return"number"===typeof b?this.each(function(){var c=this;setTimeout(function(){a(c).focus();e&&e.call(c)},b)}):this._focus.apply(this,arguments)},scrollParent:function(){var b;
b=a.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(a.css(this,"position"))&&/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(a.css(this,"overflow")+a.css(this,"overflow-y")+a.css(this,"overflow-x"))}).eq(0);return/fixed/.test(this.css("position"))||!b.length?a(document):
b},zIndex:function(b){if(b!==d)return this.css("zIndex",b);if(this.length)for(var b=a(this[0]),e;b.length&&b[0]!==document;){e=b.css("position");if("absolute"===e||"relative"===e||"fixed"===e)if(e=parseInt(b.css("zIndex"),10),!isNaN(e)&&0!==e)return e;b=b.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++f)})},removeUniqueId:function(){return this.each(function(){e.test(this.id)&&a(this).removeAttr("id")})}}),a.extend(a.expr[":"],{data:a.expr.createPseudo?
a.expr.createPseudo(function(b){return function(e){return!!a.data(e,b)}}):function(b,e,c){return!!a.data(b,c[3])},focusable:function(b){return c(b,!isNaN(a.attr(b,"tabindex")))},tabbable:function(b){var e=a.attr(b,"tabindex"),d=isNaN(e);return(d||0<=e)&&c(b,!d)}}),a(function(){var b=document.body,e=b.appendChild(e=document.createElement("div"));e.offsetHeight;a.extend(e.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0});a.support.minHeight=100===e.offsetHeight;a.support.selectstart=
"onselectstart"in e;b.removeChild(e).style.display="none"}),a("<a>").outerWidth(1).jquery||a.each(["Width","Height"],function(b,e){function c(b,e,g,d){a.each(f,function(){e-=parseFloat(a.css(b,"padding"+this))||0;g&&(e-=parseFloat(a.css(b,"border"+this+"Width"))||0);d&&(e-=parseFloat(a.css(b,"margin"+this))||0)});return e}var f="Width"===e?["Left","Right"]:["Top","Bottom"],i=e.toLowerCase(),l={innerWidth:a.fn.innerWidth,innerHeight:a.fn.innerHeight,outerWidth:a.fn.outerWidth,outerHeight:a.fn.outerHeight};
a.fn["inner"+e]=function(b){return b===d?l["inner"+e].call(this):this.each(function(){a(this).css(i,c(this,b)+"px")})};a.fn["outer"+e]=function(b,g){return"number"!==typeof b?l["outer"+e].call(this,b):this.each(function(){a(this).css(i,c(this,b,!0,g)+"px")})}}),a("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(a.fn.removeData=function(b){return function(e){return arguments.length?b.call(this,a.camelCase(e)):b.call(this)}}(a.fn.removeData)),function(){var b=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||
[];a.ui.ie=b.length?true:false;a.ui.ie6=parseFloat(b[1],10)===6}(),a.fn.extend({disableSelection:function(){return this.bind((a.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(a){a.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),a.extend(a.ui,{plugin:{add:function(b,e,c){var d,b=a.ui[b].prototype;for(d in c){b.plugins[d]=b.plugins[d]||[];b.plugins[d].push([e,c[d]])}},call:function(a,b,e){var c=a.plugins[b];if(c&&a.element[0].parentNode&&
a.element[0].parentNode.nodeType!==11)for(b=0;b<c.length;b++)a.options[c[b][0]]&&c[b][1].apply(a.element,e)}},contains:a.contains,hasScroll:function(b,e){if(a(b).css("overflow")==="hidden")return false;var c=e&&e==="left"?"scrollLeft":"scrollTop",d=false;if(b[c]>0)return true;b[c]=1;d=b[c]>0;b[c]=0;return d},isOverAxis:function(a,b,e){return a>b&&a<b+e},isOver:function(b,e,c,d,f,l){return a.ui.isOverAxis(b,c,f)&&a.ui.isOverAxis(e,d,l)}}))})(jQuery);
(function(a,d){var c=0,b=Array.prototype.slice,f=a.cleanData;a.cleanData=function(b){for(var c=0,d;null!=(d=b[c]);c++)try{a(d).triggerHandler("remove")}catch(k){}f(b)};a.widget=function(b,c,d){var f,j,i,l,m=b.split(".")[0],b=b.split(".")[1];f=m+"-"+b;d||(d=c,c=a.Widget);a.expr[":"][f.toLowerCase()]=function(b){return!!a.data(b,f)};a[m]=a[m]||{};j=a[m][b];i=a[m][b]=function(a,b){if(!this._createWidget)return new i(a,b);arguments.length&&this._createWidget(a,b)};a.extend(i,j,{version:d.version,_proto:a.extend({},
d),_childConstructors:[]});l=new c;l.options=a.widget.extend({},l.options);a.each(d,function(b,e){a.isFunction(e)&&(d[b]=function(){var a=function(){return c.prototype[b].apply(this,arguments)},d=function(a){return c.prototype[b].apply(this,a)};return function(){var b=this._super,c=this._superApply,g;this._super=a;this._superApply=d;g=e.apply(this,arguments);this._super=b;this._superApply=c;return g}}())});i.prototype=a.widget.extend(l,{widgetEventPrefix:j?l.widgetEventPrefix:b},d,{constructor:i,
namespace:m,widgetName:b,widgetBaseClass:f,widgetFullName:f});j?(a.each(j._childConstructors,function(b,e){var c=e.prototype;a.widget(c.namespace+"."+c.widgetName,i,e._proto)}),delete j._childConstructors):c._childConstructors.push(i);a.widget.bridge(b,i)};a.widget.extend=function(e){for(var c=b.call(arguments,1),f=0,k=c.length,j,i;f<k;f++)for(j in c[f])i=c[f][j],c[f].hasOwnProperty(j)&&i!==d&&(e[j]=a.isPlainObject(i)?a.isPlainObject(e[j])?a.widget.extend({},e[j],i):a.widget.extend({},i):i);return e};
a.widget.bridge=function(e,c){var f=c.prototype.widgetFullName||e;a.fn[e]=function(k){var j="string"===typeof k,i=b.call(arguments,1),l=this,k=!j&&i.length?a.widget.extend.apply(null,[k].concat(i)):k;j?this.each(function(){var b,c=a.data(this,f);if(!c)return a.error("cannot call methods on "+e+" prior to initialization; attempted to call method '"+k+"'");if(!a.isFunction(c[k])||"_"===k.charAt(0))return a.error("no such method '"+k+"' for "+e+" widget instance");b=c[k].apply(c,i);if(b!==c&&b!==d)return l=
b&&b.jquery?l.pushStack(b.get()):b,!1}):this.each(function(){var b=a.data(this,f);b?b.option(k||{})._init():a.data(this,f,new c(k,this))});return l}};a.Widget=function(){};a.Widget._childConstructors=[];a.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(b,d){d=a(d||this.defaultElement||this)[0];this.element=a(d);this.uuid=c++;this.eventNamespace="."+this.widgetName+this.uuid;this.options=a.widget.extend({},this.options,
this._getCreateOptions(),b);this.bindings=a();this.hoverable=a();this.focusable=a();d!==this&&(a.data(d,this.widgetName,this),a.data(d,this.widgetFullName,this),this._on(!0,this.element,{remove:function(a){a.target===d&&this.destroy()}}),this.document=a(d.style?d.ownerDocument:d.document||d),this.window=a(this.document[0].defaultView||this.document[0].parentWindow));this._create();this._trigger("create",null,this._getCreateEventData());this._init()},_getCreateOptions:a.noop,_getCreateEventData:a.noop,
_create:a.noop,_init:a.noop,destroy:function(){this._destroy();this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(a.camelCase(this.widgetFullName));this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled");this.bindings.unbind(this.eventNamespace);this.hoverable.removeClass("ui-state-hover");this.focusable.removeClass("ui-state-focus")},_destroy:a.noop,widget:function(){return this.element},
option:function(b,c){var f=b,k,j,i;if(0===arguments.length)return a.widget.extend({},this.options);if("string"===typeof b)if(f={},k=b.split("."),b=k.shift(),k.length){j=f[b]=a.widget.extend({},this.options[b]);for(i=0;i<k.length-1;i++)j[k[i]]=j[k[i]]||{},j=j[k[i]];b=k.pop();if(c===d)return j[b]===d?null:j[b];j[b]=c}else{if(c===d)return this.options[b]===d?null:this.options[b];f[b]=c}this._setOptions(f);return this},_setOptions:function(a){for(var b in a)this._setOption(b,a[b]);return this},_setOption:function(a,
b){this.options[a]=b;"disabled"===a&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!b).attr("aria-disabled",b),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus"));return this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(b,c,d){var f,j=this;"boolean"!==typeof b&&(d=c,c=b,b=!1);d?(c=f=a(c),this.bindings=this.bindings.add(c)):(d=c,c=this.element,f=
this.widget());a.each(d,function(d,h){function m(){return!b&&(j.options.disabled===true||a(this).hasClass("ui-state-disabled"))?void 0:(typeof h==="string"?j[h]:h).apply(j,arguments)}if(typeof h!=="string")m.guid=h.guid=h.guid||m.guid||a.guid++;var p=d.match(/^(\w+)\s*(.*)$/),t=p[1]+j.eventNamespace;(p=p[2])?f.delegate(p,t,m):c.bind(t,m)})},_off:function(a,b){b=(b||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace;a.unbind(b).undelegate(b)},_delay:function(a,b){var c=this;return setTimeout(function(){return("string"===
typeof a?c[a]:a).apply(c,arguments)},b||0)},_hoverable:function(b){this.hoverable=this.hoverable.add(b);this._on(b,{mouseenter:function(b){a(b.currentTarget).addClass("ui-state-hover")},mouseleave:function(b){a(b.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(b){this.focusable=this.focusable.add(b);this._on(b,{focusin:function(b){a(b.currentTarget).addClass("ui-state-focus")},focusout:function(b){a(b.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(b,c,d){var f,
j=this.options[b],d=d||{},c=a.Event(c);c.type=(b===this.widgetEventPrefix?b:this.widgetEventPrefix+b).toLowerCase();c.target=this.element[0];if(b=c.originalEvent)for(f in b)f in c||(c[f]=b[f]);this.element.trigger(c,d);return!(a.isFunction(j)&&!1===j.apply(this.element[0],[c].concat(d))||c.isDefaultPrevented())}};a.each({show:"fadeIn",hide:"fadeOut"},function(b,c){a.Widget.prototype["_"+b]=function(d,f,j){"string"===typeof f&&(f={effect:f});var i,l=!f?b:!0===f||"number"===typeof f?c:f.effect||c,f=
f||{};"number"===typeof f&&(f={duration:f});i=!a.isEmptyObject(f);f.complete=j;f.delay&&d.delay(f.delay);if(i&&a.effects&&(a.effects.effect[l]||!1!==a.uiBackCompat&&a.effects[l]))d[b](f);else if(l!==b&&d[l])d[l](f.duration,f.easing,j);else d.queue(function(c){a(this)[b]();j&&j.call(d[0]);c()})}});!1!==a.uiBackCompat&&(a.Widget.prototype._getCreateOptions=function(){return a.metadata&&a.metadata.get(this.element[0])[this.widgetName]})})(jQuery);
(function(a,d){function c(a,b,c){return[parseInt(a[0],10)*(m.test(a[0])?b/100:1),parseInt(a[1],10)*(m.test(a[1])?c/100:1)]}function b(b,c){return parseInt(a.css(b,c),10)||0}a.ui=a.ui||{};var f,e=Math.max,g=Math.abs,h=Math.round,k=/left|center|right/,j=/top|center|bottom/,i=/[\+\-]\d+%?/,l=/^\w+/,m=/%$/,p=a.fn.position;a.position={scrollbarWidth:function(){if(f!==d)return f;var b,c,e=a("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>");
c=e.children()[0];a("body").append(e);b=c.offsetWidth;e.css("overflow","scroll");c=c.offsetWidth;b===c&&(c=e[0].clientWidth);e.remove();return f=b-c},getScrollInfo:function(b){var c=b.isWindow?"":b.element.css("overflow-x"),e=b.isWindow?"":b.element.css("overflow-y"),e="scroll"===e||"auto"===e&&b.height<b.element[0].scrollHeight;return{width:"scroll"===c||"auto"===c&&b.width<b.element[0].scrollWidth?a.position.scrollbarWidth():0,height:e?a.position.scrollbarWidth():0}},getWithinInfo:function(b){var b=
a(b||window),c=a.isWindow(b[0]);return{element:b,isWindow:c,offset:b.offset()||{left:0,top:0},scrollLeft:b.scrollLeft(),scrollTop:b.scrollTop(),width:c?b.width():b.outerWidth(),height:c?b.height():b.outerHeight()}}};a.fn.position=function(d){if(!d||!d.of)return p.apply(this,arguments);var d=a.extend({},d),f,n,v,q,s,u=a(d.of),z=a.position.getWithinInfo(d.within),A=a.position.getScrollInfo(z),r=u[0],m=(d.collision||"flip").split(" "),y={};9===r.nodeType?(n=u.width(),v=u.height(),q={top:0,left:0}):a.isWindow(r)?
(n=u.width(),v=u.height(),q={top:u.scrollTop(),left:u.scrollLeft()}):r.preventDefault?(d.at="left top",n=v=0,q={top:r.pageY,left:r.pageX}):(n=u.outerWidth(),v=u.outerHeight(),q=u.offset());s=a.extend({},q);a.each(["my","at"],function(){var a=(d[this]||"").split(" "),b,c;a.length===1&&(a=k.test(a[0])?a.concat(["center"]):j.test(a[0])?["center"].concat(a):["center","center"]);a[0]=k.test(a[0])?a[0]:"center";a[1]=j.test(a[1])?a[1]:"center";b=i.exec(a[0]);c=i.exec(a[1]);y[this]=[b?b[0]:0,c?c[0]:0];d[this]=
[l.exec(a[0])[0],l.exec(a[1])[0]]});1===m.length&&(m[1]=m[0]);"right"===d.at[0]?s.left+=n:"center"===d.at[0]&&(s.left+=n/2);"bottom"===d.at[1]?s.top+=v:"center"===d.at[1]&&(s.top+=v/2);f=c(y.at,n,v);s.left+=f[0];s.top+=f[1];return this.each(function(){var k,j,i=a(this),l=i.outerWidth(),r=i.outerHeight(),p=b(this,"marginLeft"),B=b(this,"marginTop"),C=l+p+b(this,"marginRight")+A.width,D=r+B+b(this,"marginBottom")+A.height,o=a.extend({},s),x=c(y.my,i.outerWidth(),i.outerHeight());if(d.my[0]==="right")o.left=
o.left-l;else if(d.my[0]==="center")o.left=o.left-l/2;if(d.my[1]==="bottom")o.top=o.top-r;else if(d.my[1]==="center")o.top=o.top-r/2;o.left=o.left+x[0];o.top=o.top+x[1];if(!a.support.offsetFractions){o.left=h(o.left);o.top=h(o.top)}k={marginLeft:p,marginTop:B};a.each(["left","top"],function(b,c){if(a.ui.position[m[b]])a.ui.position[m[b]][c](o,{targetWidth:n,targetHeight:v,elemWidth:l,elemHeight:r,collisionPosition:k,collisionWidth:C,collisionHeight:D,offset:[f[0]+x[0],f[1]+x[1]],my:d.my,at:d.at,within:z,
elem:i})});a.fn.bgiframe&&i.bgiframe();d.using&&(j=function(a){var b=q.left-o.left,c=b+n-l,f=q.top-o.top,h=f+v-r,k={target:{element:u,left:q.left,top:q.top,width:n,height:v},element:{element:i,left:o.left,top:o.top,width:l,height:r},horizontal:c<0?"left":b>0?"right":"center",vertical:h<0?"top":f>0?"bottom":"middle"};if(n<l&&g(b+c)<n)k.horizontal="center";if(v<r&&g(f+h)<v)k.vertical="middle";k.important=e(g(b),g(c))>e(g(f),g(h))?"horizontal":"vertical";d.using.call(this,a,k)});i.offset(a.extend(o,
{using:j}))})};a.ui.position={fit:{left:function(a,b){var c=b.within,d=c.isWindow?c.scrollLeft:c.offset.left,f=c.width,g=a.left-b.collisionPosition.marginLeft,c=d-g,h=g+b.collisionWidth-f-d;b.collisionWidth>f?0<c&&0>=h?(d=a.left+c+b.collisionWidth-f-d,a.left+=c-d):a.left=0<h&&0>=c?d:c>h?d+f-b.collisionWidth:d:a.left=0<c?a.left+c:0<h?a.left-h:e(a.left-g,a.left)},top:function(a,b){var c=b.within,d=c.isWindow?c.scrollTop:c.offset.top,f=b.within.height,g=a.top-b.collisionPosition.marginTop,c=d-g,h=g+
b.collisionHeight-f-d;b.collisionHeight>f?0<c&&0>=h?(d=a.top+c+b.collisionHeight-f-d,a.top+=c-d):a.top=0<h&&0>=c?d:c>h?d+f-b.collisionHeight:d:a.top=0<c?a.top+c:0<h?a.top-h:e(a.top-g,a.top)}},flip:{left:function(a,b){var c=b.within,d=c.offset.left+c.scrollLeft,e=c.width,f=c.isWindow?c.scrollLeft:c.offset.left,h=a.left-b.collisionPosition.marginLeft,c=h-f,k=h+b.collisionWidth-e-f,h="left"===b.my[0]?-b.elemWidth:"right"===b.my[0]?b.elemWidth:0,j="left"===b.at[0]?b.targetWidth:"right"===b.at[0]?-b.targetWidth:
0,i=-2*b.offset[0];if(0>c){if(d=a.left+h+j+i+b.collisionWidth-e-d,0>d||d<g(c))a.left+=h+j+i}else if(0<k&&(d=a.left-b.collisionPosition.marginLeft+h+j+i-f,0<d||g(d)<k))a.left+=h+j+i},top:function(a,b){var c=b.within,d=c.offset.top+c.scrollTop,e=c.height,f=c.isWindow?c.scrollTop:c.offset.top,h=a.top-b.collisionPosition.marginTop,c=h-f,k=h+b.collisionHeight-e-f,h="top"===b.my[1]?-b.elemHeight:"bottom"===b.my[1]?b.elemHeight:0,j="top"===b.at[1]?b.targetHeight:"bottom"===b.at[1]?-b.targetHeight:0,i=-2*
b.offset[1];if(0>c){if(d=a.top+h+j+i+b.collisionHeight-e-d,a.top+h+j+i>c&&(0>d||d<g(c)))a.top+=h+j+i}else if(0<k&&(d=a.top-b.collisionPosition.marginTop+h+j+i-f,a.top+h+j+i>k&&(0<d||g(d)<k)))a.top+=h+j+i}},flipfit:{left:function(){a.ui.position.flip.left.apply(this,arguments);a.ui.position.fit.left.apply(this,arguments)},top:function(){a.ui.position.flip.top.apply(this,arguments);a.ui.position.fit.top.apply(this,arguments)}}};(function(){var b,c,d,e,f=document.getElementsByTagName("body")[0];d=document.createElement("div");
b=document.createElement(f?"div":"body");c={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"};f&&a.extend(c,{position:"absolute",left:"-1000px",top:"-1000px"});for(e in c)b.style[e]=c[e];b.appendChild(d);c=f||document.documentElement;c.insertBefore(b,c.firstChild);d.style.cssText="position: absolute; left: 10.7432222px;";d=a(d).offset().left;a.support.offsetFractions=10<d&&11>d;b.innerHTML="";c.removeChild(b)})();!1!==a.uiBackCompat&&function(a){var b=a.fn.position;a.fn.position=
function(c){if(!c||!c.offset)return b.call(this,c);var e=c.offset.split(" "),f=c.at.split(" ");1===e.length&&(e[1]=e[0]);/^\d/.test(e[0])&&(e[0]="+"+e[0]);/^\d/.test(e[1])&&(e[1]="+"+e[1]);1===f.length&&(/left|center|right/.test(f[0])?f[1]="center":(f[1]=f[0],f[0]="center"));return b.call(this,a.extend(c,{at:f[0]+e[0]+" "+f[1]+e[1],offset:d}))}}(jQuery)})(jQuery);
jQuery.effects||function(a,d){var c=!1!==a.uiBackCompat;a.effects={effect:{}};(function(b,c){function d(a,b,c){var e=m[b.type]||{};if(null==a)return c||!b.def?null:b.def;a=e.floor?~~a:parseFloat(a);return isNaN(a)?b.def:e.mod?(a+e.mod)%e.mod:0>a?0:e.max<a?e.max:a}function g(a){var c=i(),d=c._rgba=[],a=a.toLowerCase();n(j,function(b,e){var f,g=e.re.exec(a);f=g&&e.parse(g);g=e.space||"rgba";if(f)return f=c[g](f),c[l[g].cache]=f[l[g].cache],d=c._rgba=f._rgba,!1});return d.length?("0,0,0,0"===d.join()&&
b.extend(d,w.transparent),c):w[a]}function h(a,b,c){c=(c+1)%1;return 1>6*c?a+6*(b-a)*c:1>2*c?b:2>3*c?a+6*(b-a)*(2/3-c):a}var k=/^([\-+])=\s*(\d+\.?\d*)/,j=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,
parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(a){return[a[1],a[2]/100,a[3]/100,a[4]]}}],i=b.Color=function(a,c,d,e){return new b.Color.fn.parse(a,c,d,e)},l={rgba:{props:{red:{idx:0,type:"byte"},
green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},m={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},p=i.support={},t=b("<p>")[0],w,n=b.each;t.style.cssText="background-color:rgba(1,1,1,.5)";p.rgba=-1<t.style.backgroundColor.indexOf("rgba");n(l,function(a,b){b.cache="_"+a;b.props.alpha={idx:3,type:"percent",def:1}});i.fn=b.extend(i.prototype,{parse:function(h,k,j,
u){if(h===c)return this._rgba=[null,null,null,null],this;if(h.jquery||h.nodeType)h=b(h).css(k),k=c;var m=this,p=b.type(h),r=this._rgba=[];k!==c&&(h=[h,k,j,u],p="array");if("string"===p)return this.parse(g(h)||w._default);if("array"===p)return n(l.rgba.props,function(a,b){r[b.idx]=d(h[b.idx],b)}),this;if("object"===p)return h instanceof i?n(l,function(a,b){h[b.cache]&&(m[b.cache]=h[b.cache].slice())}):n(l,function(b,c){var f=c.cache;n(c.props,function(a,b){if(!m[f]&&c.to){if(a==="alpha"||h[a]==null)return;
m[f]=c.to(m._rgba)}m[f][b.idx]=d(h[a],b,true)});if(m[f]&&a.inArray(null,m[f].slice(0,3))<0){m[f][3]=1;if(c.from)m._rgba=c.from(m[f])}}),this},is:function(a){var b=i(a),c=!0,d=this;n(l,function(a,e){var f,g=b[e.cache];g&&(f=d[e.cache]||e.to&&e.to(d._rgba)||[],n(e.props,function(a,b){if(null!=g[b.idx])return c=g[b.idx]===f[b.idx]}));return c});return c},_space:function(){var a=[],b=this;n(l,function(c,d){b[d.cache]&&a.push(c)});return a.pop()},transition:function(a,b){var c=i(a),f=c._space(),g=l[f],
h=0===this.alpha()?i("transparent"):this,k=h[g.cache]||g.to(h._rgba),j=k.slice(),c=c[g.cache];n(g.props,function(a,f){var g=f.idx,h=k[g],i=c[g],l=m[f.type]||{};null!==i&&(null===h?j[g]=i:(l.mod&&(i-h>l.mod/2?h+=l.mod:h-i>l.mod/2&&(h-=l.mod)),j[g]=d((i-h)*b+h,f)))});return this[f](j)},blend:function(a){if(1===this._rgba[3])return this;var c=this._rgba.slice(),d=c.pop(),e=i(a)._rgba;return i(b.map(c,function(a,b){return(1-d)*e[b]+d*a}))},toRgbaString:function(){var a="rgba(",c=b.map(this._rgba,function(a,
b){return null==a?2<b?1:0:a});1===c[3]&&(c.pop(),a="rgb(");return a+c.join()+")"},toHslaString:function(){var a="hsla(",c=b.map(this.hsla(),function(a,b){null==a&&(a=2<b?1:0);b&&3>b&&(a=Math.round(100*a)+"%");return a});1===c[3]&&(c.pop(),a="hsl(");return a+c.join()+")"},toHexString:function(a){var c=this._rgba.slice(),d=c.pop();a&&c.push(~~(255*d));return"#"+b.map(c,function(a){a=(a||0).toString(16);return 1===a.length?"0"+a:a}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":
this.toRgbaString()}});i.fn.parse.prototype=i.fn;l.hsla.to=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b=a[0]/255,c=a[1]/255,d=a[2]/255,a=a[3],e=Math.max(b,c,d),f=Math.min(b,c,d),g=e-f,h=e+f,k=0.5*h;return[Math.round(f===e?0:b===e?60*(c-d)/g+360:c===e?60*(d-b)/g+120:60*(b-c)/g+240)%360,0===k||1===k?k:0.5>=k?g/h:g/(2-h),k,null==a?1:a]};l.hsla.from=function(a){if(null==a[0]||null==a[1]||null==a[2])return[null,null,null,a[3]];var b=a[0]/360,c=a[1],d=a[2],a=a[3],
c=0.5>=d?d*(1+c):d+c-d*c,d=2*d-c;return[Math.round(255*h(d,c,b+1/3)),Math.round(255*h(d,c,b)),Math.round(255*h(d,c,b-1/3)),a]};n(l,function(a,g){var h=g.props,j=g.cache,l=g.to,m=g.from;i.fn[a]=function(a){l&&!this[j]&&(this[j]=l(this._rgba));if(a===c)return this[j].slice();var g,k=b.type(a),p="array"===k||"object"===k?a:arguments,q=this[j].slice();n(h,function(a,b){var c=p["object"===k?a:b.idx];null==c&&(c=q[b.idx]);q[b.idx]=d(c,b)});return m?(g=i(m(q)),g[j]=q,g):i(q)};n(h,function(c,d){i.fn[c]||
(i.fn[c]=function(e){var f=b.type(e),g="alpha"===c?this._hsla?"hsla":"rgba":a,h=this[g](),j=h[d.idx];if("undefined"===f)return j;"function"===f&&(e=e.call(this,j),f=b.type(e));if(null==e&&d.empty)return this;"string"===f&&(f=k.exec(e))&&(e=j+parseFloat(f[2])*("+"===f[1]?1:-1));h[d.idx]=e;return this[g](h)})})});n("backgroundColor,borderBottomColor,borderLeftColor,borderRightColor,borderTopColor,color,columnRuleColor,outlineColor,textDecorationColor,textEmphasisColor".split(","),function(a,c){b.cssHooks[c]=
{set:function(a,d){var e,f="";if(b.type(d)!=="string"||(e=g(d))){d=i(e||d);if(!p.rgba&&d._rgba[3]!==1){for(e=c==="backgroundColor"?a.parentNode:a;(f===""||f==="transparent")&&e&&e.style;)try{f=b.css(e,"backgroundColor");e=e.parentNode}catch(h){}d=d.blend(f&&f!=="transparent"?f:"_default")}d=d.toRgbaString()}try{a.style[c]=d}catch(k){}}};b.fx.step[c]=function(a){if(!a.colorInit){a.start=i(a.elem,c);a.end=i(a.end);a.colorInit=true}b.cssHooks[c].set(a.elem,a.start.transition(a.end,a.pos))}});b.cssHooks.borderColor=
{expand:function(a){var b={};n(["Top","Right","Bottom","Left"],function(c,d){b["border"+d+"Color"]=a});return b}};w=b.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}})(jQuery);(function(){function b(){var b=this.ownerDocument.defaultView?
this.ownerDocument.defaultView.getComputedStyle(this,null):this.currentStyle,c={},d,e;if(b&&b.length&&b[0]&&b[b[0]])for(e=b.length;e--;)d=b[e],"string"===typeof b[d]&&(c[a.camelCase(d)]=b[d]);else for(d in b)"string"===typeof b[d]&&(c[d]=b[d]);return c}var c=["add","remove","toggle"],e={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};a.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(b,c){a.fx.step[c]=
function(a){if("none"!==a.end&&!a.setAttr||1===a.pos&&!a.setAttr)jQuery.style(a.elem,c,a.end),a.setAttr=!0}});a.effects.animateClass=function(d,h,k,j){var i=a.speed(h,k,j);return this.queue(function(){var h=a(this),j=h.attr("class")||"",k,t=i.children?h.find("*").andSelf():h,t=t.map(function(){return{el:a(this),start:b.call(this)}});k=function(){a.each(c,function(a,b){if(d[b])h[b+"Class"](d[b])})};k();t=t.map(function(){this.end=b.call(this.el[0]);var c=this.start,d=this.end,f={},g,h;for(g in d)if(h=
d[g],c[g]!==h&&!e[g]&&(a.fx.step[g]||!isNaN(parseFloat(h))))f[g]=h;this.diff=f;return this});h.attr("class",j);t=t.map(function(){var b=this,c=a.Deferred();this.el.animate(this.diff,jQuery.extend({},i,{queue:!1,complete:function(){c.resolve(b)}}));return c.promise()});a.when.apply(a,t.get()).done(function(){k();a.each(arguments,function(){var b=this.el;a.each(this.diff,function(a){b.css(a,"")})});i.complete.call(h[0])})})};a.fn.extend({_addClass:a.fn.addClass,addClass:function(b,c,d,e){return c?a.effects.animateClass.call(this,
{add:b},c,d,e):this._addClass(b)},_removeClass:a.fn.removeClass,removeClass:function(b,c,d,e){return c?a.effects.animateClass.call(this,{remove:b},c,d,e):this._removeClass(b)},_toggleClass:a.fn.toggleClass,toggleClass:function(b,c,e,f,i){return"boolean"===typeof c||c===d?e?a.effects.animateClass.call(this,c?{add:b}:{remove:b},e,f,i):this._toggleClass(b,c):a.effects.animateClass.call(this,{toggle:b},c,e,f)},switchClass:function(b,c,d,e,f){return a.effects.animateClass.call(this,{add:c,remove:b},d,
e,f)}})})();(function(){function b(b,c,d,f){a.isPlainObject(b)&&(c=b,b=b.effect);b={effect:b};null==c&&(c={});a.isFunction(c)&&(f=c,d=null,c={});if("number"===typeof c||a.fx.speeds[c])f=d,d=c,c={};a.isFunction(d)&&(f=d,d=null);c&&a.extend(b,c);d=d||c.duration;b.duration=a.fx.off?0:"number"===typeof d?d:d in a.fx.speeds?a.fx.speeds[d]:a.fx.speeds._default;b.complete=f||c.complete;return b}function f(b){return!b||"number"===typeof b||a.fx.speeds[b]?!0:"string"===typeof b&&!a.effects.effect[b]?c&&a.effects[b]?
!1:!0:!1}a.extend(a.effects,{version:"1.9.2",save:function(a,b){for(var c=0;c<b.length;c++)null!==b[c]&&a.data("ui-effects-"+b[c],a[0].style[b[c]])},restore:function(a,b){var c,f;for(f=0;f<b.length;f++)null!==b[f]&&(c=a.data("ui-effects-"+b[f]),c===d&&(c=""),a.css(b[f],c))},setMode:function(a,b){"toggle"===b&&(b=a.is(":hidden")?"show":"hide");return b},getBaseline:function(a,b){var c,d;switch(a[0]){case "top":c=0;break;case "middle":c=0.5;break;case "bottom":c=1;break;default:c=a[0]/b.height}switch(a[1]){case "left":d=
0;break;case "center":d=0.5;break;case "right":d=1;break;default:d=a[1]/b.width}return{x:d,y:c}},createWrapper:function(b){if(b.parent().is(".ui-effects-wrapper"))return b.parent();var c={width:b.outerWidth(!0),height:b.outerHeight(!0),"float":b.css("float")},d=a("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),f={width:b.width(),height:b.height()},j=document.activeElement;try{j.id}catch(i){j=document.body}b.wrap(d);(b[0]===
j||a.contains(b[0],j))&&a(j).focus();d=b.parent();"static"===b.css("position")?(d.css({position:"relative"}),b.css({position:"relative"})):(a.extend(c,{position:b.css("position"),zIndex:b.css("z-index")}),a.each(["top","left","bottom","right"],function(a,d){c[d]=b.css(d);isNaN(parseInt(c[d],10))&&(c[d]="auto")}),b.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"}));b.css(f);return d.css(c).show()},removeWrapper:function(b){var c=document.activeElement;b.parent().is(".ui-effects-wrapper")&&
(b.parent().replaceWith(b),(b[0]===c||a.contains(b[0],c))&&a(c).focus());return b},setTransition:function(b,c,d,f){f=f||{};a.each(c,function(a,c){var g=b.cssUnit(c);0<g[0]&&(f[c]=g[0]*d+g[1])});return f}});a.fn.extend({effect:function(){function d(b){function c(){a.isFunction(h)&&h.call(e[0]);a.isFunction(b)&&b()}var e=a(this),h=f.complete,k=f.mode;(e.is(":hidden")?"hide"===k:"show"===k)?c():j.call(e[0],f,c)}var f=b.apply(this,arguments),h=f.mode,k=f.queue,j=a.effects.effect[f.effect],i=!j&&c&&a.effects[f.effect];
return a.fx.off||!j&&!i?h?this[h](f.duration,f.complete):this.each(function(){f.complete&&f.complete.call(this)}):j?!1===k?this.each(d):this.queue(k||"fx",d):i.call(this,{options:f,duration:f.duration,callback:f.complete,mode:f.mode})},_show:a.fn.show,show:function(a){if(f(a))return this._show.apply(this,arguments);var c=b.apply(this,arguments);c.mode="show";return this.effect.call(this,c)},_hide:a.fn.hide,hide:function(a){if(f(a))return this._hide.apply(this,arguments);var c=b.apply(this,arguments);
c.mode="hide";return this.effect.call(this,c)},__toggle:a.fn.toggle,toggle:function(c){if(f(c)||"boolean"===typeof c||a.isFunction(c))return this.__toggle.apply(this,arguments);var d=b.apply(this,arguments);d.mode="toggle";return this.effect.call(this,d)},cssUnit:function(b){var c=this.css(b),d=[];a.each(["em","px","%","pt"],function(a,b){0<c.indexOf(b)&&(d=[parseFloat(c),b])});return d}})})();(function(){var b={};a.each(["Quad","Cubic","Quart","Quint","Expo"],function(a,c){b[c]=function(b){return Math.pow(b,
a+2)}});a.extend(b,{Sine:function(a){return 1-Math.cos(a*Math.PI/2)},Circ:function(a){return 1-Math.sqrt(1-a*a)},Elastic:function(a){return 0===a||1===a?a:-Math.pow(2,8*(a-1))*Math.sin((80*(a-1)-7.5)*Math.PI/15)},Back:function(a){return a*a*(3*a-2)},Bounce:function(a){for(var b,c=4;a<((b=Math.pow(2,--c))-1)/11;);return 1/Math.pow(4,3-c)-7.5625*Math.pow((3*b-2)/22-a,2)}});a.each(b,function(b,c){a.easing["easeIn"+b]=c;a.easing["easeOut"+b]=function(a){return 1-c(1-a)};a.easing["easeInOut"+b]=function(a){return 0.5>
a?c(2*a)/2:1-c(-2*a+2)/2}})})()}(jQuery);
(function(a){a.effects.effect.drop=function(d,c){var b=a(this),f="position,top,bottom,left,right,opacity,height,width".split(","),e=a.effects.setMode(b,d.mode||"hide"),g="show"===e,h=d.direction||"left",k="up"===h||"down"===h?"top":"left",h="up"===h||"left"===h?"pos":"neg",j={opacity:g?1:0},i;a.effects.save(b,f);b.show();a.effects.createWrapper(b);i=d.distance||b["top"===k?"outerHeight":"outerWidth"](!0)/2;g&&b.css("opacity",0).css(k,"pos"===h?-i:i);j[k]=(g?"pos"===h?"+=":"-=":"pos"===h?"-=":"+=")+
i;b.animate(j,{queue:!1,duration:d.duration,easing:d.easing,complete:function(){"hide"===e&&b.hide();a.effects.restore(b,f);a.effects.removeWrapper(b);c()}})}})(jQuery);var indulgy={Template:function(a){this.$parent=a;this.remove=function(){null!=$parent&&$parent.html("")};this.close=function(){null!=$parent&&$parent.modal("hide")};this.init=function(a){$parent=a;null!=$parent&&($parent.on("hidden",self.remove),$parent.modal())};this.validate=function(a,c){var b=!0,f=$(a,self.$element),e=$.trim(f.val());!_.isString(e)||!e.length?(f.addClass("error_border"),f.focus(),notification(c),b=!1):f.removeClass("error_border");return b};this.view=function(a,c){null==a.code?
$.get(a.url,function(b){a.code=b;c(a.code)}):c(a.code);return self};this.disableButton=function(a,c){a.attr("disabled","disabled");a.addClass("btn-disabled");c&&a.addClass("loading")};this.enableButton=function(a){a.removeAttr("disabled","disabled");a.removeClass("loading");a.removeClass("btn-disabled")}}};indulgy.templates={};indulgy.templates.UserProfile=function(){};var LANG={collect_to_favorites:"Collect to Favorites",inappropriate:"Inappropriate"},followers=[],collections=[],loginTemplate=null,forgotPasswordTemplate=null,registerTemplate=null,editCollectionTemplate={url:"/do/service/template/edit-collection"},deleteCollectionTemplate={url:"/do/service/template/delete-collection"},mergeCollectionTemplate={url:"/do/service/template/merge-collection"},newCollectionTemplate={url:"/do/service/template/new-collection"},userProfileTemplate={url:"/do/service/template/user-profile"},
editProfileTemplate={url:"/do/service/template/edit-profile"};
Ind.Base=function(){var a=_.extend({},Ind.Events),d=null;a.remove=function(){null!=d&&d.html("")};a.close=function(){null!=d&&d.modal("hide")};a.init=function(c){d=c;null!=d&&(d.on("hidden",a.remove),d.modal())};a.validate=function(c,b){var d=!0,e=$(c,a.$element),g=$.trim(e.val());!_.isString(g)||!g.length?(e.addClass("error_border"),e.focus(),notification(b),d=!1):e.removeClass("error_border");return d};a.view=function(c,b){null==c.code?$.get(c.url,function(a){c.code=a;b(c.code)}):b(c.code);return a};
a.disableButton=function(a,b){a.attr("disabled","disabled");a.addClass("btn-disabled");b&&a.addClass("loading")};a.enableButton=function(a){a.removeAttr("disabled");a.removeClass("loading");a.removeClass("btn-disabled")};return a}();
function SingleUpload(a){var d=_.extend({},Ind.Events);d.data=a.data||{};var c=a.parent;d.render=function(b){var f={"class":"modal-inner"};b&&(f.style="opacity:0");b=$(_.make("div",f));b.html(a.render_image_tmpl(d.data));b.appendTo(c);d.$el=b;0==collections.length?$.getJSON("/do/service/collections",function(a){if(!_.isNull(a.userCollections)&&!_.isUndefined(a.userCollections))collections=a.userCollections;d.fire("render")}):d.fire("render");return d};d.update_view=function(){d.$el.html(a.render_image_tmpl(d.data));
d.fire("render")};d.update_data=function(a){var c={},e=$("form",d.$el).serializeArray();_.each(e,function(a){c[a.name]=a.value});d.data=_.extend(d.data,c,a)};d.autocomplete=function(){$(".fieldCollection",d.$el).autocomplete({height:250,appendTo:d.$el,position:"below",autoFocus:!0,source:collections})};d.validate=function(){var a=!0,c=function(c,f){var h=$(c,d.$el),k=$.trim(h.val());!_.isString(k)||!k.length?(h.addClass("error_border"),h.focus(),notification(f),a=!1):h.removeClass("error_border")};
c(".fieldCollection","Collestion is required");"repost"!=d.data.action&&"edit"!=d.data.action&&c(".picDescription","Description is required");return a};d.submit=function(){if(!d.validate())return!1;$(".save",$(this)).attr("disabled","disabled");$(".save",$(this)).toggleClass("loading");$(".closeModal",$(this)).attr("disabled","disabled");var b=_.isString(d.data.action)?d.data.action:"save",c=$(".fieldCollection",$(this)),e=$.trim(c.val()).replace(/\"/g,"'");_.include(collections,e)||collections.push(e);
c.val(e);$("#img-"+d.data.postId).fadeTo(300,0.5);$.post(_.makeUrl("/do/service/submit/"+b,$(this).serialize()),function(c){"Ok"===c.status&&("edit"==b&&($("#desc-"+c.postId).html(c.description),$("#col-"+c.postId).html(c.categoryName)),$("#img-"+d.data.postId).fadeTo(300,1),"save"==b&&(d.$el.replaceWith($(a.post_tmpl(c))),$(".bricks-container").masonry("reload")),!c["private"]&&("submit-plugin"==b||"repost"==b||"save"==b)&&FB.getLoginStatus(function(a){a.status=="connected"&&FB.api("https://graph.facebook.com/me/"+
fbNamespace+":collect","post",{access_token:a.authResponse.accessToken,website:"http://indulgy.com/post/"+c.postId},function(){})}))});!_.isNull($("#addPanel").modal)&&!_.isUndefined($("#addPanel").modal)&&$("#addPanel").modal("hide");return!1};d.close=function(){!_.isNull($.modal)&&!_.isUndefined($.modal)&&$("#addPanel").modal("hide");$("#addPanel").html("")};d.remove=function(){d.$el.remove();$(".bricks-container").masonry("reload")};d.descriptionClick=function(){var a=$(".picDescription",d.$el);
createSelection(a.get(0),0,a.val().length)};d.on("render",function(){d.autocomplete();$("form",d.$el).submit(d.submit);0<$("#submit").length&&$(".btn-close",d.$el).click(d.remove);$(".picDescription",d.$el).click(d.descriptionClick);$("#addPanel").on("hidden",d.close)});return d}
function Login(a){function d(){var a=_.template(loginTemplate),a=$(a({email:$("#email",g.$element).val()}));h.html(a);g.$element=a;$("form",a).submit(g.login);$("#btnNotReg",a).click(g.viewRegister);$("#btnForgot",a).click(g.viewForgotPassword);c()}function c(){"undefined"!=typeof FB&&FB.XFBML.parse();k||(h.on("hidden",g.remove),h.modal(),$("body").bind("indulgy.user.login",g.onLogin),k=!0)}function b(){var a=_.template(forgotPasswordTemplate),a=$(a({email:$("#email",g.$element).val()}));h.html(a);
g.$element=a;$("form",a).submit(g.sendPassword);$("#btnNotReg",a).click(g.viewRegister);$("#btnReg",a).click(g.viewLogin);c()}function f(){var a=_.template(registerTemplate),a=$(a({email:$("#email",g.$element).val()}));h.html(a);g.$element=a;$("form",a).submit(g.register);$("#btnReg",a).click(g.viewLogin);$("#btnForgot",a).click(g.viewForgotPassword);c()}function e(a,b){var c=!0,d=$(a,g.$element),e=$.trim(d.val());!_.isString(e)||!e.length?(d.addClass("error_border"),d.focus(),notification(b),c=!1):
d.removeClass("error_border");return c}var g=_.extend({},Ind.Events),h=a,k=!1;g.viewLogin=function(){null==loginTemplate?$.get("/do/service/template/login",function(a){loginTemplate=a;d()}):d();return!1};g.viewRegister=function(){null==registerTemplate?$.get("/do/service/template/register",function(a){registerTemplate=a;f()}):f();return!1};g.viewForgotPassword=function(){null==forgotPasswordTemplate?$.get("/do/service/template/forgot-password",function(a){forgotPasswordTemplate=a;b()}):b();return!1};
g.login=function(){g.validateLogin()&&($("#btnLogin",g.$element).attr("disabled","disabled"),$("#btnLogin",g.$element).toggleClass("loading"),$("#btnLogin",g.$element).addClass("btn-disabled"),$.getJSON("/do/api/login",{email:$("#email",g.$element).val(),password:$("#password",g.$element).val()},function(a){"Ok"===a.status?($(".alert",g.$element).hide(),$("body").trigger($.Event("indulgy.user.login")),$.post("/do/service/template/header",function(a){var b=_.template(a);$("#header").hide("drop",{direction:"up"},
200,function(){$(this).replaceWith($(b()).hide());$("#header").show("drop",{direction:"up"},200);initLiveSearch()})})):"Email is not confirmed"===a.status?window.location.href="/do/confirm/need/"+$("#email",g.$element).val():$(".alert",g.$element).show();$("#btnLogin",g.$element).removeAttr("disabled","disabled");$("#btnLogin",g.$element).toggleClass("loading");$("#btnLogin",g.$element).removeClass("btn-disabled")}));return!1};g.sendPassword=function(){g.validateSendPassword()&&($("#btnLogin",g.$element).attr("disabled",
"disabled"),$("#btnLogin",g.$element).toggleClass("loading"),$("#btnLogin",g.$element).addClass("btn-disabled"),$.getJSON("/do/api/forgot-password",{email:$("#email",g.$element).val()},function(a){"Ok"===a.status?($("#error",g.$element).hide(),$("#ok",g.$element).show()):($("#ok",g.$element).hide(),$("#error",g.$element).html(a.status),$("#error",g.$element).show());$("#btnLogin",g.$element).removeAttr("disabled","disabled");$("#btnLogin",g.$element).toggleClass("loading");$("#btnLogin",g.$element).removeClass("btn-disabled")}));
return!1};g.register=function(){g.validateRegister()&&($("#btnLogin",g.$element).attr("disabled","disabled"),$("#btnLogin",g.$element).toggleClass("loading"),$("#btnLogin",g.$element).addClass("btn-disabled"),$.getJSON("/do/api/register",{email:$("#email",g.$element).val(),password:$("#password",g.$element).val(),confirmPassword:$("#confirmPassword",g.$element).val(),screenName:$("#screenName",g.$element).val()},function(a){"Ok"===a.status?window.location.href="/do/confirm/need/"+$("#email",g.$element).val():
($(".alert",g.$element).html(a.message),$(".alert",g.$element).show());$("#btnLogin",g.$element).removeAttr("disabled","disabled");$("#btnLogin",g.$element).toggleClass("loading");$("#btnLogin",g.$element).removeClass("btn-disabled")}));return!1};g.validateLogin=function(){var a=e("#email","Email is required"),b=e("#password","Password is required");return a&&b};g.validateRegister=function(){var a=e("#email","Email is required"),b=e("#password","Password is required"),c=e("#confirmPassword","Password is required"),
d=e("#screenName","Screen Name is required"),f=/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,6}$/i.test($("#email").val());f?$("#email").removeClass("error_border"):($("#email").addClass("error_border"),$("#email").focus());return a&&b&&c&&d&&f};g.validateSendPassword=function(){return e("#email","Email is required")};g.close=function(){h.modal("hide")};g.remove=function(){h.html("")};g.onLogin=function(){$("body").addClass("loggedin")};$("body").bind("indulgy.user.login",g.onLogin);return g}
function DeleteCollection(a,d){var c=_.extend({},Ind.Base);c.$parent=d;c.viewDelete=function(){c.view(deleteCollectionTemplate,function(a){a=_.template(a);a=$(a({}));c.$parent.html(a);c.$element=a;$("#deleteCol",a).click(c.deleteCollection);c.init(c.$parent)});return c};c.deleteCollection=function(){c.disableButton($("#deleteCol",c.$element),!0);$.getJSON("/do/api/collection/delete/"+a,function(b){if("Ok"===b.status){$("#cat-"+a).remove();var c=$("#countCollections").text();0<c&&$("#countCollections").text(--c);
c=$("#countPosts").text();0<c&&$("#countPosts").text(c-b.postsDeleted)}});c.close();return!1};return c}
function EditCollection(a,d){var c=_.extend({},Ind.Base);c.$parent=d;c.viewEdit=function(){c.view(editCollectionTemplate,function(b){b=_.template(b);b=$(b({collectionName:$("#cat-"+a+" .collection-name a").text(),collectionImgUrl:$("#cat-"+a+" img").attr("src"),collectionId:a,collectionPrivate:0<$("#cat-"+a+" .collection-private").size()}));c.$parent.html(b);c.$element=b;b.submit(c.submitEditCollection);c.init(c.$parent)});return c};c.viewMerge=function(b,d){c.view(mergeCollectionTemplate,function(e){e=
_.template(e);e=$(e({collectionName:b,originalName:$("#cat-"+a+" .collection-name a").text(),existCollectionId:d}));c.$parent.html(e);c.$element=e;$("#yes",e).click(c.mergeCollections);$("#no",e).click(c.viewEdit)});return c};c.submitEditCollection=function(){c.validate("#collectionName")&&(c.disableButton($(".save",c.$element),!0),$.getJSON("/do/api/collection/edit",{collectionId:a,collectionName:$("#collectionName",c.$element).val(),collectionPrivate:$("#collectionPrivate",c.$element).attr("checked")},
function(b){if("Ok"===b.status||"Nothing changed"===b.status){var d=$("#cat-"+a+" .collection-name a");d.text(b.collection.categoryName);d=d.attr("href");$("#cat-"+a+" a").attr("href",d.substring(0,d.lastIndexOf("/")+1)+b.collection.categoryName);$("#cat-"+a+" a.editCol").removeAttr("href");"undefined"!==typeof $("#collectionPrivate",c.$element).attr("checked")?$("#cat-"+a+" .collection-name a").before('<span class="collection-private">Private</span>'):$("#cat-"+a).find(".collection-private").remove();
c.close()}else"Collection Name exists"===b.status?c.viewMerge(b.collectionName,b.existCollectionId):$("#collectionName").addClass("error_border");c.enableButton($(".save",c.$element))}));return!1};c.mergeCollections=function(){c.disableButton($("#yes",c.$element),!0);c.disableButton($("#no",c.$element),!1);var b=$(this).attr("data");$.getJSON("/do/api/collection/merge",{mergeToCollectionId:b,mergeFromCollectionId:a},function(d){c.close();$("#cat-"+a).remove();var e="/resources/img/avatar-collection.png";
null!=d.collection.badgeUrl&&(e=d.imageServer+d.collection.badgeUrl);$("#cat-"+b+" img").attr("src",e);$(".bricks-container").masonry("reload")})};return c}
function UserProfile(a){var d=_.extend({},Ind.Base);d.$parent=a;d.viewProfile=function(a,b,f,e,g,h,k,j){$.getJSON("/do/api/user/statistics",{userId:a},function(i){i=i[0];d.view(userProfileTemplate,function(l){l=_.template(l);l=$(l({screenName:b,screenNameForUrl:f,avatarUrl:e,userId:a,followId:g,myProfile:h,joinedLabel:k,isMe:j,stat:{posts:i.posts,collections:i.collections,followers:i.followers,following:i.following}}));d.$parent.html(l);d.$element=l;d.init(d.$parent)})});return d};return d}
function EditProfile(a){function d(a,b,c){$(".src-avatar").attr("style","background-image: url("+c.avatarUrl+");");$(".menu .avatar").attr("src",c.avatarUrl)}function c(){e.enableButton($(".btn",e.$element));$("#edit-form").toggleClass("show");return!1}function b(){e.disableButton($(".btn",e.$element),!0);e.disableButton($(".close",e.$element),!1);$.getJSON("/do/service/profile/edit?"+$("form",e.$parent).serialize(),function(a){if("Ok"===a.status){f($("#email",e.$parent),{});f($("#confirmPassword",
e.$parent),{});f($("#screenName",e.$parent),{});var b=$("#screenName",e.$parent).val(),d=b.replace("%","%25").replace("?","%3F").replace("#","%23").replace("&","%26").replace("+","%2B").replace("$","%24");$(".user-panel .userprofile a").attr("href","/"+d);$(".username").text(b);$(".userinfoul li").first().find("a").first().attr("href","/"+d);$(".userinfoul li").first().find("a").first().contents().filter(function(){return 3===this.nodeType}).replaceWith(b);$(".user-stat a").each(function(){var a=
$(this).attr("href").replace(g,d);$(this).attr("href",a)});$(".collection-name a").each(function(){var a=$(this).attr("href"),a="/"+d+a.substring(a.lastIndexOf("/"),a.length);$(this).attr("href",a)});$(".collect-link").each(function(){var a=$(this).attr("href"),a="/"+d+a.substring(a.lastIndexOf("/"),a.length);$(this).attr("href",a)});var i="/"+g;$(".user-link.desk").attr("href","/"+d);$(".user-link span.desk").text(d);$(".notes-brick a").each(function(){if($(this).attr("href")===i){$(this).attr("href",
"/"+d);$(this).find(".user-name").contents().filter(function(){return 3===this.nodeType}).replaceWith(b);var a=$(this).parent().find(".collection-name"),c=a.attr("href"),c="/"+d+c.substring(c.lastIndexOf("/"),c.length);a.attr("href",c)}});g=b;c()}else f($("#email",e.$parent),a.errors),f($("#confirmPassword",e.$parent),a.errors),f($("#screenName",e.$parent),a.errors),e.enableButton($(".btn",e.$element)),e.enableButton($(".close",e.$element))});return!1}function f(a,b){null!=b[a.attr("id")]?(a.addClass("error_border"),
a.popover({content:b[a.attr("id")]}),a.popover("enable")):(a.popover("hide"),a.popover("disable"),$(".popover").remove(),a.removeClass("error_border"))}var e=_.extend({},Ind.Base);e.$parent=a;var g=null;e.openProfile=function(){$.getJSON("/do/api/user/profile",{},function(a){"Ok"===a.status&&(g=a.user.screenName,e.view(editProfileTemplate,function(f){f=_.template(f);e.$parent.html(f(a));$("#edit-form").toggleClass("show");$(".btn-close",e.$parent).click(c);$("form",e.$parent).submit(b);new qq.FileUploader({element:document.getElementById("file-uploader"),
action:"/do/service/user/avatar",debug:!1,uploadFileLabel:"Update Profile Picture",allowedExtensions:["jpg","jpeg","jpe","png","gif"],onComplete:d})}))});return e};return e}
function AddCollection(a){function d(){b.disableButton($(".btn",b.$parent),!0);b.disableButton($(".btn-close",b.$parent),!1);$.getJSON("/do/api/collection/new",{collectionName:$("#collectionName",b.$parent).val(),collectionPrivate:$("#collectionPrivate",b.$parent).attr("checked")},function(a){"Ok"===a.status?(c($("#collectionName",b.$parent),{}),-1==location.href.indexOf("/collections")?($("#countCollections").html(parseInt($("#countCollections").html())+1),b.$parent.slideToggle(300),b.enableButton($(".btn",
b.$parent)),b.enableButton($(".btn-close",b.$parent)),b.$parent.modal("hide")):setTimeout("location.reload()",1E3)):(c($("#collectionName",b.$parent),a.errors),b.enableButton($(".btn",b.$parent)),b.enableButton($(".close",b.$parent)))});return!1}function c(a,b){null!=b[a.attr("id")]?(a.addClass("error_border"),a.popover({content:b[a.attr("id")]}),a.popover("enable")):(a.popover("hide"),a.popover("disable"),$(".popover").remove(),a.removeClass("error_border"))}var b=_.extend({},Ind.Base);b.$parent=
a;b.isInitialized=!1;$.browser.msie&&"10.0"<=$.browser.version&&$("#addPanel").removeClass("fade");b.openProfile=function(){b.view(newCollectionTemplate,function(a){b.$parent.html(a);b.$parent.slideToggle(300);b.isInitialized||(b.$parent.on("hidden",b.remove),b.$parent.modal(),b.isInitialized=!0);$(".btn",b.$parent).click(d)});return b};return b};!function(a){a(function(){var d=a.support,c;a:{c=document.createElement("bootstrap");var b={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"},f;for(f in b)if(void 0!==c.style[f]){c=b[f];break a}c=void 0}d.transition=c&&{end:c}})}(window.jQuery);
!function(a){var d=function(b,c){this.options=c;this.$element=a(b).delegate('[data-dismiss="modal"]',"click.dismiss.modal",a.proxy(this.hide,this));this.options.remote&&this.$element.find(".modal-body").load(this.options.remote)};d.prototype={constructor:d,toggle:function(){return this[this.isShown?"hide":"show"]()},show:function(){var b=this,c=a.Event("show");this.$element.trigger(c);!this.isShown&&!c.isDefaultPrevented()&&(this.isShown=!0,this.escape(),this.backdrop(function(){var c=a.support.transition&&
b.$element.hasClass("fade");b.$element.parent().length||b.$element.appendTo(document.body);b.$element.show();c&&b.$element[0].offsetWidth;b.$element.addClass("in").attr("aria-hidden",!1);b.enforceFocus();c?b.$element.one(a.support.transition.end,function(){b.$element.focus().trigger("shown")}):b.$element.focus().trigger("shown")}))},hide:function(b){b&&b.preventDefault();b=a.Event("hide");this.$element.trigger(b);this.isShown&&!b.isDefaultPrevented()&&(this.isShown=!1,this.escape(),a(document).off("focusin.modal"),
this.$element.removeClass("in").attr("aria-hidden",!0),a.support.transition&&this.$element.hasClass("fade")?this.hideWithTransition():this.hideModal())},enforceFocus:function(){var b=this;a(document).on("focusin.modal",function(a){b.$element[0]!==a.target&&!b.$element.has(a.target).length&&b.$element.focus()})},escape:function(){var a=this;this.isShown&&this.options.keyboard?this.$element.on("keyup.dismiss.modal",function(c){27==c.which&&a.hide()}):this.isShown||this.$element.off("keyup.dismiss.modal")},
hideWithTransition:function(){var b=this,c=setTimeout(function(){b.$element.off(a.support.transition.end);b.hideModal()},500);this.$element.one(a.support.transition.end,function(){clearTimeout(c);b.hideModal()})},hideModal:function(){var a=this;this.$element.hide();this.backdrop(function(){a.removeBackdrop();a.$element.trigger("hidden")})},removeBackdrop:function(){this.$backdrop&&this.$backdrop.remove();this.$backdrop=null},backdrop:function(b){var c=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&
this.options.backdrop){var d=a.support.transition&&c;this.$backdrop=a('<div class="modal-backdrop '+c+'" />').appendTo(document.body);this.$backdrop.click("static"==this.options.backdrop?a.proxy(this.$element[0].focus,this.$element[0]):a.proxy(this.hide,this));d&&this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");b&&(d?this.$backdrop.one(a.support.transition.end,b):b())}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?
this.$backdrop.one(a.support.transition.end,b):b()):b&&b()}};var c=a.fn.modal;a.fn.modal=function(b){return this.each(function(){var c=a(this),e=c.data("modal"),g=a.extend({},a.fn.modal.defaults,c.data(),"object"==typeof b&&b);e||c.data("modal",e=new d(this,g));"string"==typeof b?e[b]():g.show&&e.show()})};a.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0};a.fn.modal.Constructor=d;a.fn.modal.noConflict=function(){return a.fn.modal=c,this};a(document).on("click.modal.data-api",'[data-toggle="modal"]',
function(b){var c=a(this),d=c.attr("href"),g=a(c.attr("data-target")||d&&d.replace(/.*(?=#[^\s]+$)/,"")),d=g.data("modal")?"toggle":a.extend({remote:!/#/.test(d)&&d},g.data(),c.data());b.preventDefault();g.modal(d).one("hide",function(){c.focus()})})}(window.jQuery);
!function(a){var d=function(a,c){this.init("tooltip",a,c)};d.prototype={constructor:d,init:function(b,c,d){var g,h;this.type=b;this.$element=a(c);this.options=this.getOptions(d);this.enabled=!0;b=this.options.trigger.split(" ");for(d=b.length;d--;)c=b[d],"click"==c?this.$element.on("click."+this.type,this.options.selector,a.proxy(this.toggle,this)):"manual"!=c&&(g="hover"==c?"mouseenter":"focus",h="hover"==c?"mouseleave":"blur",this.$element.on(g+"."+this.type,this.options.selector,a.proxy(this.enter,
this)),this.$element.on(h+"."+this.type,this.options.selector,a.proxy(this.leave,this)));this.options.selector?this._options=a.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},getOptions:function(b){return b=a.extend({},a.fn[this.type].defaults,this.$element.data(),b),b.delay&&"number"==typeof b.delay&&(b.delay={show:b.delay,hide:b.delay}),b},enter:function(b){var c=a.fn[this.type].defaults,d={},g;this._options&&a.each(this._options,function(a,b){c[a]!=b&&(d[a]=b)},this);g=
a(b.currentTarget)[this.type](d).data(this.type);if(!g.options.delay||!g.options.delay.show)return g.show();clearTimeout(this.timeout);g.hoverState="in";this.timeout=setTimeout(function(){"in"==g.hoverState&&g.show()},g.options.delay.show)},leave:function(b){var c=a(b.currentTarget)[this.type](this._options).data(this.type);this.timeout&&clearTimeout(this.timeout);if(!c.options.delay||!c.options.delay.hide)return c.hide();c.hoverState="out";this.timeout=setTimeout(function(){"out"==c.hoverState&&
c.hide()},c.options.delay.hide)},show:function(){var b,c,d,g,h;c=a.Event("show");if(this.hasContent()&&this.enabled&&(this.$element.trigger(c),!c.isDefaultPrevented())){b=this.tip();this.setContent();this.options.animation&&b.addClass("fade");g="function"==typeof this.options.placement?this.options.placement.call(this,b[0],this.$element[0]):this.options.placement;b.detach().css({top:0,left:0,display:"block"});this.options.container?b.appendTo(this.options.container):b.insertAfter(this.$element);c=
this.getPosition();d=b[0].offsetWidth;b=b[0].offsetHeight;switch(g){case "bottom":h={top:c.top+c.height,left:c.left+c.width/2-d/2};break;case "top":h={top:c.top-b,left:c.left+c.width/2-d/2};break;case "left":h={top:c.top+c.height/2-b/2,left:c.left-d};break;case "right":h={top:c.top+c.height/2-b/2,left:c.left+c.width}}this.applyPlacement(h,g);this.$element.trigger("shown")}},applyPlacement:function(a,c){var d=this.tip(),g=d[0].offsetWidth,h=d[0].offsetHeight,k,j,i,l;d.offset(a).addClass(c).addClass("in");
k=d[0].offsetWidth;j=d[0].offsetHeight;"top"==c&&j!=h&&(a.top=a.top+h-j,l=!0);"bottom"==c||"top"==c?(i=0,0>a.left&&(i=-2*a.left,a.left=0,d.offset(a),k=d[0].offsetWidth),this.replaceArrow(i-g+k,k,"left")):this.replaceArrow(j-h,j,"top");l&&d.offset(a)},replaceArrow:function(a,c,d){this.arrow().css(d,a?50*(1-a/c)+"%":"")},setContent:function(){var a=this.tip(),c=this.getTitle();a.find(".tooltip-inner")[this.options.html?"html":"text"](c);a.removeClass("fade in top bottom left right")},hide:function(){function b(){var b=
setTimeout(function(){c.off(a.support.transition.end).detach()},500);c.one(a.support.transition.end,function(){clearTimeout(b);c.detach()})}var c=this.tip(),d=a.Event("hide");this.$element.trigger(d);return d.isDefaultPrevented()?void 0:(c.removeClass("in"),a.support.transition&&this.$tip.hasClass("fade")?b():c.detach(),this.$element.trigger("hidden"),this)},fixTitle:function(){var a=this.$element;(a.attr("title")||"string"!=typeof a.attr("data-original-title"))&&a.attr("data-original-title",a.attr("title")||
"").attr("title","")},hasContent:function(){return this.getTitle()},getPosition:function(){var b=this.$element[0];return a.extend({},"function"==typeof b.getBoundingClientRect?b.getBoundingClientRect():{width:b.offsetWidth,height:b.offsetHeight},this.$element.offset())},getTitle:function(){var a,c=this.$element,d=this.options;return a=c.attr("data-original-title")||("function"==typeof d.title?d.title.call(c[0]):d.title),a},tip:function(){return this.$tip=this.$tip||a(this.options.template)},arrow:function(){return this.$arrow=
this.$arrow||this.tip().find(".tooltip-arrow")},validate:function(){this.$element[0].parentNode||(this.hide(),this.$element=null,this.options=null)},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(b){b=b?a(b.currentTarget)[this.type](this._options).data(this.type):this;b.tip().hasClass("in")?b.hide():b.show()},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}};var c=a.fn.tooltip;
a.fn.tooltip=function(b){return this.each(function(){var c=a(this),e=c.data("tooltip"),g="object"==typeof b&&b;e||c.data("tooltip",e=new d(this,g));"string"==typeof b&&e[b]()})};a.fn.tooltip.Constructor=d;a.fn.tooltip.defaults={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1};a.fn.tooltip.noConflict=function(){return a.fn.tooltip=c,this}}(window.jQuery);
!function(a){var d=function(a,c){this.init("popover",a,c)};d.prototype=a.extend({},a.fn.tooltip.Constructor.prototype,{constructor:d,setContent:function(){var a=this.tip(),c=this.getTitle(),d=this.getContent();a.find(".popover-title")[this.options.html?"html":"text"](c);a.find(".popover-content")[this.options.html?"html":"text"](d);a.removeClass("fade top bottom left right in")},hasContent:function(){return this.getTitle()||this.getContent()},getContent:function(){var a,c=this.$element,d=this.options;
return a=("function"==typeof d.content?d.content.call(c[0]):d.content)||c.attr("data-content"),a},tip:function(){return this.$tip||(this.$tip=a(this.options.template)),this.$tip},destroy:function(){this.hide().$element.off("."+this.type).removeData(this.type)}});var c=a.fn.popover;a.fn.popover=function(b){return this.each(function(){var c=a(this),e=c.data("popover"),g="object"==typeof b&&b;e||c.data("popover",e=new d(this,g));"string"==typeof b&&e[b]()})};a.fn.popover.Constructor=d;a.fn.popover.defaults=
a.extend({},a.fn.tooltip.defaults,{placement:"right",trigger:"click",content:"",template:'<div class="popover"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'});a.fn.popover.noConflict=function(){return a.fn.popover=c,this}}(window.jQuery);
!function(a){var d=function(b,c){this.$element=a(b);this.options=a.extend({},a.fn.typeahead.defaults,c);this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.updater=this.options.updater||this.updater;this.source=this.options.source;this.$menu=a(this.options.menu);this.shown=!1;this.listen()};d.prototype={constructor:d,select:function(){return this.$element.val(this.updater(this.$menu.find(".active").attr("data-value"))).change(),
this.hide()},updater:function(a){return a},show:function(){var b=a.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:b.top+b.height,left:b.left}).show(),this.shown=!0,this},hide:function(){return this.$menu.hide(),this.shown=!1,this},lookup:function(){var b;return this.query=this.$element.val(),!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(b=a.isFunction(this.source)?this.source(this.query,
a.proxy(this.process,this)):this.source,b?this.process(b):this)},process:function(b){var c=this;return b=a.grep(b,function(a){return c.matcher(a)}),b=this.sorter(b),b.length?this.render(b.slice(0,this.options.items)).show():this.shown?this.hide():this},matcher:function(a){return~a.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(a){for(var c=[],d=[],g=[],h;h=a.shift();)h.toLowerCase().indexOf(this.query.toLowerCase())?~h.indexOf(this.query)?d.push(h):g.push(h):c.push(h);return c.concat(d,
g)},highlighter:function(a){var c=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return a.replace(RegExp("("+c+")","ig"),function(a,b){return"<strong>"+b+"</strong>"})},render:function(b){var c=this;return b=a(b).map(function(b,d){return b=a(c.options.item).attr("data-value",d),b.find("a").html(c.highlighter(d)),b[0]}),b.first().addClass("active"),this.$menu.html(b),this},next:function(){var b=this.$menu.find(".active").removeClass("active").next();b.length||(b=a(this.$menu.find("li")[0]));
b.addClass("active")},prev:function(){var a=this.$menu.find(".active").removeClass("active").prev();a.length||(a=this.$menu.find("li").last());a.addClass("active")},listen:function(){this.$element.on("focus",a.proxy(this.focus,this)).on("blur",a.proxy(this.blur,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this));this.eventSupported("keydown")&&this.$element.on("keydown",a.proxy(this.keydown,this));this.$menu.on("click",a.proxy(this.click,this)).on("mouseenter","li",
a.proxy(this.mouseenter,this)).on("mouseleave","li",a.proxy(this.mouseleave,this))},eventSupported:function(a){var c=a in this.$element;return c||(this.$element.setAttribute(a,"return;"),c="function"==typeof this.$element[a]),c},move:function(a){if(this.shown){switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault();this.prev();break;case 40:a.preventDefault(),this.next()}a.stopPropagation()}},keydown:function(b){this.suppressKeyPressRepeat=~a.inArray(b.keyCode,
[40,38,9,13,27]);this.move(b)},keypress:function(a){this.suppressKeyPressRepeat||this.move(a)},keyup:function(a){switch(a.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}a.stopPropagation();a.preventDefault()},focus:function(){this.focused=!0},blur:function(){this.focused=!1;!this.mousedover&&this.shown&&this.hide()},click:function(a){a.stopPropagation();a.preventDefault();
this.select();this.$element.focus()},mouseenter:function(b){this.mousedover=!0;this.$menu.find(".active").removeClass("active");a(b.currentTarget).addClass("active")},mouseleave:function(){this.mousedover=!1;!this.focused&&this.shown&&this.hide()}};var c=a.fn.typeahead;a.fn.typeahead=function(b){return this.each(function(){var c=a(this),e=c.data("typeahead"),g="object"==typeof b&&b;e||c.data("typeahead",e=new d(this,g));"string"==typeof b&&e[b]()})};a.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',
item:'<li><a href="#"></a></li>',minLength:1};a.fn.typeahead.Constructor=d;a.fn.typeahead.noConflict=function(){return a.fn.typeahead=c,this};a(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(){var b=a(this);b.data("typeahead")||b.typeahead(b.data())})}(window.jQuery);!function(a){var d=function(b,c){this.$element=a(b);this.options=a.extend({},a.fn.typeahead.defaults,c);this.matcher=this.options.matcher||this.matcher;this.sorter=this.options.sorter||this.sorter;this.highlighter=this.options.highlighter||this.highlighter;this.updater=this.options.updater||this.updater;this.source=this.options.source;this.$menu=a(this.options.menu);this.shown=!1;this.listen()};d.prototype={constructor:d,select:function(){this.$element.val(this.updater(this.$menu.find(".active").attr("data-value"))).change();
return this.hide()},updater:function(a){return a},show:function(){a.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});this.$menu.insertAfter(this.$element).show();this.shown=!0;return this},hide:function(){this.$menu.hide();this.shown=!1;return this},lookup:function(){var b;this.query=this.$element.val();return!this.query||this.query.length<this.options.minLength?this.shown?this.hide():this:(b=a.isFunction(this.source)?this.source(this.query,a.proxy(this.process,this)):this.source)?
this.process(b):this},process:function(b){var c=this,b=a.grep(b,function(a){return c.matcher(a)}),b=this.sorter(b);return!b.length?this.shown?this.hide():this:this.render(b.slice(0,this.options.items)).show()},matcher:function(a){return~a.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(a){for(var c=[],d=[],g=[],h;h=a.shift();)h.toLowerCase().indexOf(this.query.toLowerCase())?~h.indexOf(this.query)?d.push(h):g.push(h):c.push(h);return c.concat(d,g)},highlighter:function(a){var c=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,
"\\$&");return a.replace(RegExp("("+c+")","ig"),function(a,b){return"<strong>"+b+"</strong>"})},render:function(b){var c=this,b=a(b).map(function(b,d){b=a(c.options.item).attr("data-value",d);b.find("a").html(c.highlighter(d));return b[0]});b.first().addClass("active");this.$menu.html(b);return this},next:function(){var b=this.$menu.find(".active").removeClass("active").next();b.length||(b=a(this.$menu.find("li")[0]));b.addClass("active")},prev:function(){var a=this.$menu.find(".active").removeClass("active").prev();
a.length||(a=this.$menu.find("li").last());a.addClass("active")},listen:function(){this.$element.on("focus",a.proxy(this.focus,this)).on("blur",a.proxy(this.blur,this)).on("keypress",a.proxy(this.keypress,this)).on("keyup",a.proxy(this.keyup,this));if(this.eventSupported("keydown"))this.$element.on("keydown",a.proxy(this.keydown,this));this.$menu.on("click",a.proxy(this.click,this)).on("mouseenter","li",a.proxy(this.mouseenter,this)).on("mouseleave","li",a.proxy(this.mouseleave,this))},eventSupported:function(a){var c=
a in this.$element;c||(this.$element.setAttribute(a,"return;"),c="function"===typeof this.$element[a]);return c},move:function(a){if(this.shown){switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault();this.prev();break;case 40:a.preventDefault(),this.next()}a.stopPropagation()}},keydown:function(b){this.suppressKeyPressRepeat=~a.inArray(b.keyCode,[40,38,9,13,27]);this.move(b)},keypress:function(a){this.suppressKeyPressRepeat||this.move(a)},keyup:function(a){switch(a.keyCode){case 40:case 38:case 16:case 17:case 18:break;
case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.lookup()}a.stopPropagation();a.preventDefault()},focus:function(){this.focused=!0},blur:function(){this.focused=!1;!this.mousedover&&this.shown&&this.hide()},click:function(a){a.stopPropagation();a.preventDefault();this.select();this.$element.focus()},mouseenter:function(b){this.mousedover=!0;this.$menu.find(".active").removeClass("active");a(b.currentTarget).addClass("active")},mouseleave:function(){this.mousedover=
!1;!this.focused&&this.shown&&this.hide()}};var c=a.fn.typeahead;a.fn.typeahead=function(b){return this.each(function(){var c=a(this),e=c.data("typeahead"),g="object"==typeof b&&b;e||c.data("typeahead",e=new d(this,g));if("string"==typeof b)e[b]()})};a.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead"></ul>',item:'<li class="th-item"><a href="#" class="th-link"></a></li>',minLength:1};a.fn.typeahead.Constructor=d;a.fn.typeahead.noConflict=function(){a.fn.typeahead=c;return this};
a(document).on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(){var b=a(this);b.data("typeahead")||b.typeahead(b.data())})}(window.jQuery);function initIndEvents(){$(".favorite").tooltip({placement:"left",title:LANG.collect_to_favorites});$(".block-brick").tooltip({placement:"left",title:LANG.inappropriate});$(window).resize(function(){mobDeviseGrid($(".bricks-container .item"));$(".bricks-container").masonry({isAnimated:!1,itemSelector:".item",columnWidth:function(){var a=$(window).width();return 600>=a&&$("#home, #main")[0]?a/2-20:324}(),isFitWidth:!0})})}function toggleMobileMenu(){$("#mob-menu").toggleClass("show")}
function supportsHistory(){return"pushState"in window.history&&null!==window.history.pushState}function initIndCollectionsEvents(){$(".editCol").unbind("click");$(".bricks-container").on("click",".editCol",editCollection);$(".deleteCol").unbind("click");$(".bricks-container").on("click",".deleteCol",deleteCollection)}
function addImageFromHome(){var a=$("#simplemodal-container img").height();a<0.9*$(window).height()&&($("#simplemodal-container .item").addClass("addOnList"),$("#simplemodal-container .item").css("margin-top","-"+a/2-70+"px"))}function initAutoShowSearch(){var a=$("body"),d=$(".single");if(0<d.length){var c=d.height()+d.position().top-100;if(a.hasClass("SEARCH"))$(window).on("scroll",function(b){a.scrollTop()>=+c?showSearchForm(b):hideSearchForm(b)})}}
function mobDeviseGrid(a){var d=$(window).width(),c=!$(a[0]).hasClass("collection");if(600>=d&&$("#home, #main")[0]){var b,f,e,g,c=0;for(b=a.length;c<b;c++){e=$(a[c]).hasClass("ad")?d-50:d/2-30;var h={width:e};g=$(a[c]).find(".photo-brick");if(0<$(a[c]).find(".small-img").length)f=g.height(),h.height=f,$(a[c]).css(h),g.css({height:"auto"});else{f=e/g.attr("width");f=parseInt(g.attr("height")*f,10);if(300<e){var k=$(a[c]).attr("id"),j=null;null!=k&&(j=k.substring(k.length-1));h.height=null==j?310:
"4"===j||"6"===j?310:"0"===j||"1"===j?290:640;h.paddingLeft=(e-300)/2;h.width-=h.paddingLeft;k=$(a[c]).find(".notes-brick");k.show();k.css({marginLeft:-h.paddingLeft})}else $.isNumeric(f)||(f=parseInt(250*(e/300),10)),h.height=f;$(a[c]).hasClass("triplelift")?g.css({width:e,height:f,margin:0}):g.css({height:"auto"});$(a[c]).css(h)}}}else if(c){c=0;for(b=a.length;c<b;c++)$(a[c]).hasClass("ad")?$(a[c]).css({width:"300px",paddingLeft:0}):$(a[c]).css({width:"300px",height:"auto",paddingLeft:0}),$(a[c]).find(".notes-brick").css({marginLeft:0})}}
function initMain(a,d){initAutoShowSearch();window.onpopstate=function(a){"ind"===a.state&&window.location.replace(document.location.href)};var c=$(".bricks-container");c.masonry({isAnimated:!1,itemSelector:".item",columnWidth:function(){var a=$(window).width();return 600>=a&&$("#home, #main")[0]?a/2-20:324}(),isFitWidth:!0});if(supportsHistory()&&0>document.referrer.substring(9).indexOf("/post/")){var b=window.location.href;window.history.replaceState("ind",$("#page-nav-next").text(),$("#page-nav-next").attr("href"));
window.history.pushState("ind",$("title").text(),b)}c.infinitescroll({navSelector:"#page-nav",nextSelector:"#page-nav-next",itemSelector:".item",bufferPx:400,debug:!1,loading:{finishedMsg:"",msgText:"",img:"/resources/img/loadinfo.net.gif"}},function(b,e){var g=$(b).css({opacity:0});mobDeviseGrid(g);c.masonry("appended",g);g.animate({opacity:1},300);initIndEvents();initAd(g);initLoadedConetntAd(g);$.browser.msie&&120<=$(".item").size()&&10>parseInt($.browser.version,10)&&($("#page-nav-next").attr("href",
e.path[0]),c.infinitescroll("destroy"),$("#page-nav").show());_gaq.push(["_trackPageview","/"+a+d])});600>=$(window).width()&&$("#home, #main")[0]&&(b=$(".bricks-container .item"),mobDeviseGrid(b),$(".bricks-container").masonry("reload"));$(".bricks-container .item").animate({opacity:1},300);initIndEvents();initLiveSearch()}
function initView(a,d,c){window.location.hash&&"editProfile"===window.location.hash.substring(1)&&editProfile();window.onpopstate=function(a){"ind"===a.state&&window.location.replace(document.location.href)};var b=$(".bricks-container");b.masonry({isAnimated:!1,itemSelector:".item",isFitWidth:!0,columnWidth:function(){var a=$(window).width();return 600>=a&&$("#home, #main")[0]?a/2-20:324}()});b.infinitescroll({navSelector:"#page-nav",nextSelector:"#page-nav-next",itemSelector:".item",bufferPx:400,
debug:!1,loading:{finishedMsg:"",msgText:"",img:"/resources/img/loadinfo.net.gif"}},function(a,d){var g=$(a).css({opacity:0});mobDeviseGrid(g);b.masonry("appended",g);g.animate({opacity:1},300);initIndEvents();$.browser.msie&&120<=$(".item").size()&&10>parseInt($.browser.version,10)&&($("#page-nav-next").attr("href",d.path[0]),b.infinitescroll("destroy"),$("#page-nav").show());initAd(g);initLoadedConetntAd(g);_gaq.push(["_trackPageview",d.path[0]]);!c&&supportsHistory()&&window.history.pushState("ind",
$("title"),d.path[0])});600>=$(window).width()&&$("#home, #main")[0]&&(a=$(".bricks-container .item"),mobDeviseGrid(a),$(".bricks-container").masonry("reload"));$(".bricks-container .item").animate({opacity:1},300);initIndEvents();initLiveSearch()}
function initLiveSearch(){$("#q").unbind();$("#q").typeahead({source:function(a,d){$.get("/do/api/livesearch",{phrase:a}).always(function(a){var b=$("#q").val();if(!a||"Ok"!=a.status)a={collection:[]};a.collection.unshift({name:"search/"+b,imageUrl:""});var b=a.collection.map(function(a){return a.name}),f={};$(a.collection).each(function(a,b){f[b.name]=b});d(b);$("#q").next().find("a").each(function(a,b){$(b).bind("click",typeheadItemOnClick).prepend('<img src="'+f[$(b).text()].imageUrl+'" class="th-avatar" width="32" height="32" alt="sudo" />')});
a=$("#q").next();a.find("li").first().hide();1==a.find("li").length&&a.css("display","none")})},updater:typeheadItemSelect,sorter:function(a){return a},minLength:2})}function typeheadItemOnClick(){typeheadItemSelect($(this).text());return!1}function typeheadItemSelect(a){location.href="/"+a.replace(" ","--");return a}
function initAd(a){$.each(a,function(a,c){var b=$(c);if(b.hasClass("ad")){var f=b.attr("id");if(null!=f){var e,g,b=f.substring(f.length-1);"0"===b?(e="/5445743/Indulgy-300x250-archive",g=[300,250]):"1"===b?(e="/5445743/Indulgy-300x250-single",g=[300,250]):"2"===b?(e="/5445743/Indulgy-300x600-archive",g=[300,600]):"3"===b?(e="/5445743/Indulgy-300x600-single",g=[300,600]):"4"===b?(e="/2270745/ind-300x250",g=[300,250],f+="t"):"5"===b?(e="/2270745/ind-300x600",g=[300,600],f+="t"):"6"===b&&(e="/2270745/ind-300x310",
g=[300,310]);googletag.cmd.push(function(){googletag.pubads().enableAsyncRendering();googletag.defineSlot(e,g,f).addService(googletag.pubads());googletag.enableServices();googletag.display(f)})}}})}var loadFollowers=!0;
function initSuggests(){loadFollowers=!0;$(".suggest").click(function(){loadFollowers&&($(".dropdown-menu").html('<li><span class="label label-info">Loading followers...</span></li>'),$.getJSON("/do/service/followers",function(a){loadFollowers=!1;var d;0==a.followers.length?d='<li><span class="label label-info">You have no followers</span></li>':(d='<li><a class="sug-to-all" href="#">To all my followers</a></li><li class="divider"></li>',$.each(a.followers,function(){d+='<li><a id="sug-'+this.userId+
'" class="sug-link" href="#"><img src="'+this.avatarUrl+'" alt="'+this.screenName+'" class="profilepic" />'+this.screenName+"</a></li>"}));$(".dropdown-menu").html(d);$(".sug-to-all").click(function(){var a=$(this).closest(".item").attr("id").substring(5);$.ajax({url:"/do/service/suggest/all",data:{postId:a}});$(".btn-group").removeClass("open");return false});$(".sug-link").click(function(){$(this).attr("disabled","disabled");$(this).addClass("btn-disabled");var a=this.id.substring(4),b=$(this).closest(".item").attr("id").substring(5);
$.ajax({url:"/do/service/suggest",data:{postId:b,suggestedTo:a}});$(".btn-group").removeClass("open");return false})}))})}function searchTxt(a){13==(a.keyCode||a.which)&&searchFn();window.setTimeout("searchTxtDoRequest($('#q').val() || '')",0)}searchTxt.requestIsContinue=!1;searchTxt.lastSearchedPhrase=null;function searchFn(){document.location="/search/"+$("#q").val()}
function searchTxtDoRequest(a){0<a.length&&!searchTxt.requestIsContinue&&searchTxt.lastSearchedPhrase!=a&&(searchTxt.lastSearchedPhrase=a,searchTxt.requestIsContinue=!0,$.get("/do/api/livesearch",{phrase:a}).always(searchTxtRequest))}function searchTxtRequest(a){a&&$("#q").typeahead({source:a.items});a=$("#q").val()||"";searchTxt.requestIsContinue=!1;searchTxt.lastSearchedPhrase!=a&&searchTxtDoRequest(a)}function showSearchForm(a){a.preventDefault();$("#search").addClass("show");return!1}
function hideSearchForm(a){a.preventDefault();$("#search").removeClass("show")}function toggleSearchForm(a){a=a||window.event;a.preventDefault?a.preventDefault():a.returnValue=!1;var d=$("#search");d.toggleClass("show");d.hasClass("show")&&setTimeout(function(){d.find(".search-query").focus()},200);return!1}function onLoginButtonClick(a){document.location.href="/do/fblogin?fbAccessToken="+a.authResponse.accessToken+"&uid="+a.authResponse.userID}
function onLoginAndPreviewButtonClick(a){$("#fbAccessToken").val(a.authResponse.accessToken);$("#frm-contact").submit()}
function followAllCollections(){var a=$(".item.collection.masonry-brick .icon-star-empty:visible").closest(".item");$.post("/do/api/livecollections/favorite/update",{ids:$.makeArray(a.map(function(a,c){return calcLiveCollectionId($(c).attr("id"))}))},function(d){"OK"==d.status&&($("#couldFollowHeader").remove(),$("#couldFollowResult").show(),a.each(function(a,b){$(b).find(".icon-star-empty").addClass("hov").hide();$(b).find(".icon-star").addClass("vis").show()}))})}
function followAllView(){followAll();$("#couldFollowHeader").remove();$("#couldFollowResult").show()}function followAllFollowing(){followAll();$("#couldFollowHeader").remove()}
function followAll(){$("#followAll").attr("disabled","disabled");$("#followAll").toggleClass("loading");$("#followAll").addClass("btn-disabled");$(".user-card").each(function(){doFollow($(this).attr("data-id"),!0)});$("#followAll").removeAttr("disabled");$("#followAll").toggleClass("loading");$("#followAll").removeClass("btn-disabled")}
function follow(a,d){if(""==$("meta[name='indulgy:userId']").attr("content")){var c=new Login($("#addPanel"));c.onLogin=function(){c.close();doFollow(a,d)};c.viewLogin()}else doFollow(a,d)}
function toFavorite(a,d){$(d).hasClass("disabled")||$.get("/do/api/tofavorite/"+a+($(d).hasClass("icon-star")?"/sub":"/add"),function(a,b,f){"Ok"==a.status?$(d).hasClass("follow")?($(d).addClass("disabled"),a=$("#countLiveCollections span"),a.text(Math.max(parseInt(a.text()),1))):$(d).toggleClass("icon-star").toggleClass("icon-star-empty"):lCExchangeFail(a,b,f)},"json").fail(lCExchangeFail)}
function collect(a,d,c,b){b?($.get("/do/api/livecollections/"+b+($(c).hasClass("fav")?"/sub/":"/add/")+a,function(a,b,c){"Ok"!=a.status&&lCExchangeFail(a,b,c)},"json").fail(lCExchangeFail),$(c).toggleClass("fav")):("undefined"===typeof collectWindow?collectWindow=$("#live-collection-input").removeClass("hide"):$("#liveCollectionInput").autocomplete("destroy"),$.get("/do/api/livecollections/"+a,function(a){var b=[],c={},a=a.collection,d;for(d in a){var k=a[d].name;b.push(k);c[k]=a[d].lighted}$("#liveCollectionInput").autocomplete({source:b,
open:function(){$(".ui-autocomplete.col-autocomplate li a").each(function(a,b){c[$(b).text()]&&$(b).addClass("lighted")})}})},"json").fail(lCExchangeFail),$("#addPanel").on("hidden",closeCollectWindow).append(collectWindow).modal("show"),$("#live-collection-input .pic").empty(),d?$("#live-collection-input .pic").append($(c).closest(".masonry-brick").find(".images-wall").clone()):$("body").hasClass("COLLECTION")?$("#live-collection-input .pic").append($(".wrapper .collection-image").clone().removeClass("hide")):
($("#live-collection-input .pic").css({padding:"5px 0 10px 0"}).append($(".user-avatar").clone()),$("#live-collection-input .pic img").css({width:"100px",height:"100px"})),$("#liveCollectionInput").val(""),$("#live-collection-input").submit(function(){var b=$("#liveCollectionInput").val();if(!b)return false;$.get("/do/api/livecollections/"+encodeURIComponent(b)+"/add/"+a,lCExchangeSuccess,"json").fail(lCExchangeFail);$("#addPanel").modal("hide");return false}))}
function doFollow(a,d){$("#followLi_"+a).attr("disabled","disabled");$("#followLi_"+a).toggleClass("loading");$("#followLi_"+a).addClass("btn-disabled");$.ajax({url:"/do/service/follow/"+a,success:function(c){c=$.parseJSON(c);"Ok"==c.status&&($("#followLi_"+a).replaceWith('<button id="unfollowLi_'+a+'" class="btn save unfollow" title="Unfollow" onclick="unfollow(\''+c.followId+"', '"+a+"', "+d+');">Unfollow</button>'),d&&(c=$("#countFollowing").text(),$("#countFollowing").text(++c)),c=$("#countFollowers_"+
a).text(),$("#countFollowers_"+a).text(++c))}})}
function unfollow(a,d,c){0<$("#unfollowLi_"+d).length&&($("#unfollowLi_"+d).attr("disabled","disabled"),$("#unfollowLi_"+d).toggleClass("loading"),$("#unfollowLi_"+d).addClass("btn-disabled"),$.ajax({url:"/do/service/unfollow/"+a+"/"+d,success:function(a){"Ok"==$.parseJSON(a).status&&($("#unfollowLi_"+d).replaceWith('<button id="followLi_'+d+'" class="btn save follow" onclick="follow(\''+d+"', "+c+');">Collect</button>'),c&&(a=$("#countFollowing").text(),0<a&&$("#countFollowing").text(--a)),a=$("#countFollowers_"+
d).text(),0<a&&$("#countFollowers_"+d).text(--a))}}))}
function deletePost(a){var d=getPostId(a),a=_.template($("#delete-confirmation").html()),c=$(a({postDescription:$("#desc-"+d).text()}));c.modal({backdrop:!0});c.find("#deletePicture").click(function(a){a.preventDefault();$("#deletePicture",c).attr("disabled","disabled");$("#deletePicture",c).toggleClass("loading");$.ajax({url:"/do/service/delete/"+d,context:$(this)});c.modal("hide");0<$("#item-"+d).length?$("#item-"+d).remove():$("#single").remove();a=$("#countPosts").text();0<a&&$("#countPosts").text(--a)})}
function submitPlugin(a){if(""==$("meta[name='indulgy:userId']").attr("content")){var d=new Login($("#addPanel"));d.onLogin=function(){d.remove();showSubmitPlugin(a)};d.viewLogin()}else showSubmitPlugin(a)}function showSubmitPlugin(a){(new SingleUpload({parent:$("#addPanel"),render_image_tmpl:render_image_tmpl,post_tmpl:post_tmpl,data:a})).render();$("#addPanel").modal({})}
function addPost(a){if(""==$("meta[name='indulgy:userId']").attr("content")){var d=new Login($("#addPanel"));d.onLogin=function(){d.remove();showAddPost(a)};d.viewLogin()}else showAddPost(a)}
function showAddPost(a){var a=getPostId(a),d=$("#img-"+a);(new SingleUpload({parent:$("#addPanel"),render_image_tmpl:render_image_tmpl,post_tmpl:post_tmpl,data:{action:"repost",saved_filename:d.attr("src"),width:d.attr("width"),height:d.attr("height"),title:$.trim($("#desc-"+a).text()),link_to_pic:"http://indulgy.com/post/"+a,category:"",postId:a,saveButtonLabel:"Collect",token:""}})).render();$("#addPanel").modal({});addImageFromHome()}
function flagPost(a){var d=getPostId(a);$("#img-"+d).fadeTo(300,0.01);$.ajax({url:"/do/service/flag/"+d,context:$(a)}).done(function(a){"Ok"===a.status&&(this.tooltip("hide"),this.replaceWith('<div class="block-brick" onclick="unflagPost(this)"><i class="icon-block"><jsp:text/></i></div>'),$(".block-brick").tooltip({placement:"left",title:"Appropriate"}))})}
function unflagPost(a){var d=getPostId(a);$("#img-"+d).fadeTo(500,1);$.ajax({url:"/do/service/unflag/"+d,context:$(a)}).done(function(a){"Ok"===a.status&&(this.tooltip("hide"),this.replaceWith('<div class="block-brick" onclick="flagPost(this)"><i class="icon-block"><jsp:text/></i></div>'),$(".block-brick").tooltip({placement:"left",title:"Inappropriate"}))})}
function favPost(a){if(""==$("meta[name='indulgy:userId']").attr("content")){var d=new Login($("#addPanel"));d.onLogin=function(){d.close();execFavPost(a)};d.viewLogin()}else execFavPost(a)}
function execFavPost(a){var d=$(a);d.prop("onclick",null);d.toggleClass("fav");d.tooltip("hide").tooltip("destroy");d.tooltip({placement:"left",title:"Remove from Favorites"});d.tooltip("show");a=getPostId(a);$.ajax({url:"/do/service/fav/"+a,context:d}).done(function(a){"Ok"===a.status&&this.attr("onclick","unfavPost(this, '"+a.postId+"')")})}
function unfavPost(a,d){if(""==$("meta[name='indulgy:userId']").attr("content")){var c=new Login($("#addPanel"));c.onLogin=function(){c.close();execUnfavPost(a,d)};c.viewLogin()}else execUnfavPost(a,d)}
function execUnfavPost(a,d){var c=$(a);c.prop("onclick",null);c.toggleClass("fav");c.tooltip("hide").tooltip("destroy");c.tooltip({placement:"left",title:"Collect to Favorites"});c.tooltip("show");$.ajax({url:"/do/service/delete/"+d,context:c}).done(function(a){"Ok"===$.parseJSON(a).status&&this.attr("onclick","favPost(this)")})}
function editPost(a){$.getJSON("/do/service/post/"+getPostId(a),function(a){(new SingleUpload({parent:$("#addPanel"),render_image_tmpl:render_image_tmpl,post_tmpl:post_tmpl,data:{action:"edit",saved_filename:imageServer+a.post.imgUrl,width:a.post.imgWidth,height:a.post.imgHeight,title:a.post.description,link_to_pic:a.post.linkUrl,category:a.collection.categoryName,postId:a.post.postId,token:""}})).render();$("#addPanel").modal({});addImageFromHome()})}
function suggestPost(){var a=this;if(""==$("meta[name='indulgy:userId']").attr("content")){var d=new Login($("#addPanel"));d.onLogin=function(){d.remove();showSuggestPost(a)};d.viewLogin()}else showSuggestPost(a)}function showSuggestPost(a){(new Suggest({postId:getPostId(a),parent:$("#addPanel"),template:$("#suggestTmpl")})).render();$("#addPanel").modal()}
function logout(){"undefined"!=typeof FB?FB.getLoginStatus(function(a){"connected"==a.status?FB.logout(function(){window.location.href="/do/logout"}):window.location.href="/do/logout"}):window.location.href="/do/logout";return!1}function login(){var a=new Login($("#addPanel"));a.onLogin=function(){a.close()};a.viewLogin();return!1}function register(){var a=new Login($("#addPanel"));a.onLogin=function(){a.close()};a.viewRegister();return!1}
function getPostId(a){return $(a).closest(".item").attr("id").substring(5)}function adminPost(a,d){$.getJSON("/do/service/featured/"+a+"/"+d,function(a){$("#ftrLabel").html(a.featured)})}function replicaPost(a){$.getJSON("/do/service/replica/"+a,function(a){$("#replicaLabel")[a.replica?"show":"hide"]()})}function editCollection(){(new EditCollection($(this).closest(".item").attr("id").substring(4),$("#addPanel"))).viewEdit()}
function deleteCollection(){(new DeleteCollection($(this).closest(".item").attr("id").substring(4),$("#addPanel"))).viewDelete()}function onBestClick(){var a=$("#page-nav-next");document.location=0<a.size()&&0==a.attr("href").indexOf("/do/from")?a.attr("href"):"/do/continue"}function onLiveClick(){var a=$("#page-nav-next");document.location=0<a.size()&&0==a.attr("href").indexOf("/do/live")?a.attr("href"):"/do/live"}function editProfile(){(new EditProfile($("#edit-form"))).openProfile()}
function addCollection(){(new AddCollection($("#addPanel"))).openProfile()}function initClickToUpload(){new qq.FileUploader({element:document.getElementById("upload-avatar"),action:"/do/service/user/avatar",debug:!1,uploadFileLabel:"Click to Upload",allowedExtensions:["jpg","jpeg","jpe","png","gif"],onComplete:function(a,d,c){$(".user-avatar .qq-uploader").remove();$(".src-avatar").attr("style","background-image:url("+c.avatarUrl+");");$(".menu .avatar").attr("src",c.avatarUrl)}})}
function validateDmcaForm(a){a=$(a);if(a=validate("#dmcaName",a)&&validate("#dmcaSource",a)&&validate("#dmcaPages",a)&&validate("#dmcaContactInfo",a)&&validateCheckbox("#dmcaFaith",a)&&validateCheckbox("#dmcaAccurate",a)){var d=$("#dmcaSubmit");d.attr("disabled","disabled");d.addClass("btn-disabled");d.addClass("loading")}return a}
function validate(a,d){var c=$(a,d),b=$.trim(c.val());if(!_.isString(b)||!b.length)return c.addClass("error_border"),c.focus(),!1;c.removeClass("error_border");return!0}function validateCheckbox(a,d){var c=$(a,d);if(c.is(":checked"))return c.removeClass("error_border"),!0;c.addClass("error_border");c.focus();return!1}
function initTools(a){$("#linkToPicturePage").keyup(a,toolsKeyUp);$("#urlPicture").keyup(a,toolsKeyUp);$("#picDescription").keyup(a,toolsKeyUp);$("#buttonCode").mouseup(function(a){a.preventDefault()}).keydown(function(a){9!=a.keyCode&&65!=a.keyCode&&67!=a.keyCode&&a.preventDefault()}).focus(function(){$(this).select();var a=this;setTimeout(function(){a.select()},100)})}
function toolsKeyUp(a){var d=$("#urlPicture").val(),c=$("#linkToPicturePage").val(),b="";0===d.toLowerCase().lastIndexOf("http",0)&&0===c.toLowerCase().lastIndexOf("http",0)&&(b=$("#picDescription").val(),b='<a target="_blank" href="'+a.data+"/do/submit?linkToGetPictureFrom="+encodeURIComponent(d)+"&linkToPicturePage="+encodeURIComponent(c)+"&picDescription="+encodeURIComponent(b)+'"><img src="'+a.data+'/resources/img/hotlink-ok/indulgy-button.png"/></a>');$("#buttonCode").val(b);$("#toolsBtn").html(b)}
function closeCollectWindow(){$("#addPanel").off("hidden");$("#live-collection-input .save").off("click");collectWindow.remove()}function lCExchangeSuccess(){}function lCExchangeFail(){}function initIndLiveCollectionsEvents(){$(".editCol").unbind("click");$("#container").on("click",".editCol",editLiveCollection);$(".deleteCol").unbind("click");$("#container").on("click",".deleteCol",deleteLiveCollection)}
function calcLiveCollectionId(a){return(("string"===typeof a?a:!1)||$(a).closest(".item").attr("id")||$(a).closest(".live-collection").attr("id")).substring(4)}function getEditLiveCollectionContentWindow(){"undefined"==typeof editLiveCollectionContentWindow&&(editLiveCollectionContentWindow=$("#editLiveCollectionContent").removeClass("hide"));return editLiveCollectionContentWindow}
function getRenameLiveCollectionContentWindow(){"undefined"==typeof renameLiveCollectionContentWindow&&(renameLiveCollectionContentWindow=$("#renameLiveCollectionContent").removeClass("hide"));return renameLiveCollectionContentWindow}
function editLiveCollection(){var a=calcLiveCollectionId(this),d=$(this).closest(".live-collection"),c=null;$("#addPanel").empty().on("hidden",closeEditLiveCollectionWindow).append(getEditLiveCollectionContentWindow()).modal("show");var b=function(){var a=$("input[name=liveCollectionName]").val().replace(/\"/g,"'");-1!=$.inArray(a,c)?(closeEditLiveCollectionWindow(),$("#addPanel").modal("hide"),$("#confirmPanel").empty().on("hidden",closeConfirmWindow).append(getRenameLiveCollectionContentWindow()).modal("show"),
$("#confirmPanel .liveCollectionName").text(a),$("#confirmPanel .btn.save").on("click",function(){$("#confirmPanel").modal("hide");closeConfirmWindow();f()})):f()};$("#editLiveCollectionContent .btn.save").on("click",b);$("#editLiveCollectionContent input[name=liveCollectionName]").on("keypress",function(a){a=a||window.event;13==a.keyCode&&b()});var f=function(){var b=$("input[name=liveCollectionName]").val().replace(/\"/g,"'"),c=$("input[name=liveCollectionPrivate]").is(":checked");$.post("/do/api/livecollections/"+
a+"/update",{"private":c,categoryName:b,ids:$.makeArray($("#liveCollectionUsers li:not(.deleted-collection), #liveCollectionCollections li:not(.deleted-collection)").map(function(a,b){return $(b).attr("itemId")}))},function(a){$("#container h2").each(function(a,c){if(b.toLowerCase()==$(c).text().toLowerCase()&&$(c).closest(".live-collection").attr("id")!=d.attr("id")){$(c).closest(".live-collection").remove();var f=$("#countLiveCollections"),g=parseInt(f.text())-1;f.text(g);g||f.closest("a").toggleClass("hide")}});
d.find("h2 a").text(b);d.find("h2 a").attr("href",d.find("h2 a").attr("href").replace(/[^/]+$/,b));d.find("a.live-collection__link").attr("href",d.find("a.live-collection__link").attr("href").replace(/[^/]+$/,b));d.find(".collection-private")[c?"removeClass":"addClass"]("hide");d.find(".col-number").text($(a).find(".col-number").text());d.find(".wrap-imgs").replaceWith($(a).find(".wrap-imgs"));d.find(".live-collection__number").replaceWith($(a).find(".live-collection__number"));d.find(".item").css("opacity",
1)},"html").fail(lCExchangeFail);$("#addPanel").modal("hide")};$("#liveCollectionUsers").empty();$("#liveCollectionCollections").empty();$.get("/do/api/livecollections/"+a+"/get",function(a){"Ok"==a.status&&(a=a.data,c=a.lCNames,$("#liveCollectionPrivate").attr("checked",a["private"]),$("input[name=liveCollectionName]").val(a.categoryName),createLiveCollectionSubList("liveCollectionCollections","categoryIds"in a?a.categoryIds:null),createLiveCollectionSubList("liveCollectionUsers","userIds"in a?a.userIds:
null))},"json").fail(lCExchangeFail)}function createLiveCollectionSubList(a,d){var c=$("#"+a),b;for(b in d)c.append("<li class='edit-list__item' itemId='"+b+"'><span class='icon-trash' style='display: inline-block;'></span>"+("string"===typeof d[b]?d[b]:d[b].categoryName+" by "+d[b].userName)+"</li>");d||$("#"+a).prev("label").hide();$("#"+a+" li").on("click",function(){$(this).toggleClass("deleted-collection")})}
function deleteLiveCollection(){"undefined"==typeof deleteLiveCollectionWindow&&(deleteLiveCollectionWindow=$("#deleteLiveCollectionContent").removeClass("hide"));var a=calcLiveCollectionId(this);$("#addPanel").empty().on("hidden",closeDeleteLiveCollectionWindow).append(deleteLiveCollectionWindow).modal("show");$("#deleteLiveCollectionContent .btn.save").on("click",function(){$.get("/livecollections/"+a+"/delete",function(){var d=$("#countLiveCollections");d.text(parseInt(d.text())-1);$("#cat-"+a).remove()},
"json").fail(lCExchangeFail);$("#addPanel").modal("hide")})}function closeEditLiveCollectionWindow(){$("#addPanel").off("hidden")}function closeDeleteLiveCollectionWindow(){$("#addPanel").off("hidden").empty()}function closeConfirmWindow(){$("#confirmPanel").off("hidden");$("#addPanel").on("hidden",closeEditLiveCollectionWindow).modal("show")}
function shiftCollections(a,d){var c=$($(".live-collection")[0]).width(),b=Math.floor(0.9*c),f=$(a).closest(".live-collection"),e=f.find(".wrap-imgs").position().left,g=f.find(".item:last"),h=g.position().left+g.width(),k=calcLiveCollectionId(f.attr("id")),j=g&&g.attr("sequence"),i=0;if(0>d)i=Math.min(-e,b);else if(2!==arguments.length||e+h-c>=b)i=-Math.abs(Math.min(e+h-c,b));else{g&&$.get("/livecollections/"+k+"/from/"+j,function(b,c){if("success"===c){var e=$(b).find(".item").css({opacity:1}),h=
f.find(".wrap-imgs .item").length;f.find(".wrap-imgs").append(e).css("width",(e.length+h)*(g.width()+10)+"px")}shiftCollections(a,d,!0)},"html").fail(lCExchangeFail);return}f.find(".shift-left")[i+e?"removeClass":"addClass"]("hide");f.find(".shift-right")[e+i+h<=c?"addClass":"removeClass"]("hide");i&&f.find(".wrap-imgs").animate({left:"+="+i},1E3)}
function recalculateRightShiftButtonVisibility(a,d){var c=$($(".live-collection")[0]).width();(d||$(".live-collection")).each(function(a,d){var e=$(d).find(".item:last"),e=e.length&&e.position().left+e.width(),g=$(d).find(".wrap-imgs"),g=g.length?g.position().left:0;$(d).find(".shift-right")[g+e<=c?"addClass":"removeClass"]("hide")})}function initLoadedConetntAd(a){a=a.filter(".contentad");0<a.length&&(a=a.attr("id").substring(10),null!=a&&initContentAd(a))}
function initContentAd(a,d){5>=d&&$.get("/do/api/ad/contentad",function(c){"error"===c.status?initContentAd(a,d++):(c=c.articles[0],null!=c&&($(".contad-"+a).attr("href",c.url),$("#img-"+a).attr("src",c.image),$("#desc-"+a).text(c.title),$("#sponsr-"+a).text("sponsored by "+c.sponsored_by)))})};function createSelection(a,d,c){if(a.createTextRange){var b=a.createTextRange();b.collapse(!0);b.moveStart("character",d);b.moveEnd("character",c);b.select()}else a.setSelectionRange?a.setSelectionRange(d,c):a.selectionStart&&(a.selectionStart=d,a.selectionEnd=c);a.focus()}
(function(a){var d=0;a.widget("ui.autocomplete",{version:"1.9.2",defaultElement:"<input>",options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null,width:null,height:300},currentKeyCode:null,pending:0,_create:function(){var c,b,d;switch(this.options.position){case "below":this.options.position={my:"left top",at:"left bottom",collision:"fit flip"};
break;case "above":this.options.position={my:"left top-"+this.options.height,at:"left top",collision:"fit flip"};break;case "left":this.options.position={my:"right top",at:"left top"};break;case "right":this.options.position={my:"left top",at:"right top"}}this.isMultiLine=this._isMultiLine();this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"];this.isNewMenu=!0;this.element.addClass("ui-autocomplete-input").attr("autocomplete","off");this._on(this.element,{keydown:function(e){this.currentKeyCode=
e.keyCode;if(this.element.prop("readOnly"))b=d=c=!0;else{b=d=c=!1;var g=a.ui.keyCode;if((e.ctrlKey||e.keyCode==g.DELETE||16==e.keyCode||e.shiftKey&&(e.keyCode==g.LEFT||e.keyCode==g.RIGHT))&&0<this._value().length)d=!0;else switch(e.keyCode){case g.PAGE_UP:c=!0;this._move("previousPage",e);break;case g.PAGE_DOWN:c=!0;this._move("nextPage",e);break;case g.UP:c=!0;this._keyEvent("previous",e);break;case g.DOWN:c=!0;this._keyEvent("next",e);break;case g.ENTER:case g.NUMPAD_ENTER:this.menu.active&&(c=
!0,e.preventDefault(),this.menu.select(e));break;case g.TAB:this.menu.active&&this.menu.select(e);break;case g.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(e),e.preventDefault());break;default:b=!0,this._searchTimeout(e)}}},keypress:function(d){if(c)c=!1,d.preventDefault();else if(!b){var f=a.ui.keyCode;switch(d.keyCode){case f.PAGE_UP:this._move("previousPage",d);break;case f.PAGE_DOWN:this._move("nextPage",d);break;case f.UP:this._keyEvent("previous",d);break;case f.DOWN:this._keyEvent("next",
d)}}},input:function(a){d?(d=!1,a.preventDefault()):this._searchTimeout(a)},focus:function(){this.selectedItem=null;this.previous=this._value();this._searchTimeout(event);createSelection(this.element[0],0,this._value().length)},click:function(a){this._searchTimeout(a);createSelection(this.element[0],0,this._value().length)},blur:function(a){this.cancelBlur?delete this.cancelBlur:(clearTimeout(this.searching),this.close(a),this._change(a))}});this._initSource();this.menu=a("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo||
"body")[0]).menu({input:a(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu");this._on(this.menu.element,{mousedown:function(b){b.preventDefault();this.cancelBlur=!0;this._delay(function(){delete this.cancelBlur});var c=this.menu.element[0];a(b.target).closest(".ui-menu-item").length||this._delay(function(){var b=this;this.document.one("mousedown",function(d){d.target!==b.element[0]&&d.target!==c&&!a.contains(c,d.target)&&b.close()})})},menufocus:function(b,c){if(this.isNewMenu&&(this.isNewMenu=
!1,b.originalEvent&&/^mouse/.test(b.originalEvent.type))){this.menu.blur();this.document.one("mousemove",function(){a(b.target).trigger(b.originalEvent)});return}var d=c.item.data("ui-autocomplete-item")||c.item.data("item.autocomplete");!1!==this._trigger("focus",b,{item:d})?b.originalEvent&&/^key/.test(b.originalEvent.type)&&this._value(d.value):this.liveRegion.text(d.value)},menuselect:function(a,b){var c=b.item.data("ui-autocomplete-item")||b.item.data("item.autocomplete"),d=this.previous;this.element[0]!==
this.document[0].activeElement&&(this.element.focus(),this.previous=d,this._delay(function(){this.previous=d;this.selectedItem=c}));!1!==this._trigger("select",a,{item:c})&&this._value(c.value);this.term=this._value();this.close(a);this.selectedItem=c}});this.liveRegion=a("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element);a.fn.bgiframe&&this.menu.element.bgiframe();this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},
_destroy:function(){clearTimeout(this.searching);this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete");this.menu.element.remove();this.liveRegion.remove()},_setOption:function(a,b){this._super(a,b);"source"===a&&this._initSource();"appendTo"===a&&this.menu.element.appendTo(this.document.find(b||"body")[0]);"disabled"===a&&b&&this.xhr&&this.xhr.abort()},_isMultiLine:function(){return this.element.is("textarea")?!0:this.element.is("input")?!1:this.element.prop("isContentEditable")},
_initSource:function(){var c,b,d=this;a.isArray(this.options.source)?(c=this.options.source,this.source=function(b,d){d(a.ui.autocomplete.filter(c,b.term))}):"string"===typeof this.options.source?(b=this.options.source,this.source=function(c,g){d.xhr&&d.xhr.abort();d.xhr=a.ajax({url:b,data:c,dataType:"json",success:function(a){g(a)},error:function(){g([])}})}):this.source=this.options.source},_searchTimeout:function(a){clearTimeout(this.searching);this.searching=this._delay(function(){this.selectedItem=
null;this.search(null,a)},this.options.delay)},search:function(a,b){a=null!=a?a:this._value();this.term=this._value();return a.length&&a.length<this.options.minLength&&"click"!=b.type?this.close(b):!1===this._trigger("search",b)?void 0:this._search(a,b)},_search:function(a){this.pending++;this.element.addClass("ui-autocomplete-loading");this.cancelSearch=!1;this.source({term:a},this._response())},_response:function(){var a=this,b=++d;return function(f){b===d&&a.__response(f);a.pending--;a.pending||
a.element.removeClass("ui-autocomplete-loading")}},__response:function(a){a&&(a=this._normalize(a));this._trigger("response",null,{content:a});!this.options.disabled&&a&&a.length&&!this.cancelSearch?(this._suggest(a),this._trigger("open")):this._close()},close:function(a){this.cancelSearch=!0;this._close(a)},_close:function(a){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",a))},_change:function(a){this.previous!==this._value()&&
this._trigger("change",a,{item:this.selectedItem})},_normalize:function(c){return c.length&&c[0].label&&c[0].value?c:a.map(c,function(b){return"string"===typeof b?{label:b,value:b}:a.extend({label:b.label||b.value,value:b.value||b.label},b)})},_suggest:function(c){var b=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(b,c);this.menu.refresh();b.show();this._resizeMenu();b.position(a.extend({of:this.element},this.options.position));if(this.currentKeyCode!=a.ui.keyCode.BACKSPACE&&
this.currentKeyCode!=a.ui.keyCode.LEFT&&this.options.autoFocus&&(c=a.grep(c,function(a){return a.isMatch}).shift())&&this._value())this.menu.next(),c=c.label,b=this._value(),this._value(c),createSelection(this.element[0],b.length,c.length)},_resizeMenu:function(){var a=this.menu.element;a.outerHeight()>this.options.height&&a.outerHeight(this.options.height);a.outerWidth(Math.max(a.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(c,b){var d=this;a.each(b,function(a,b){d._renderItemData(c,
b)})},_renderItemData:function(a,b){return this._renderItem(a,b).data("ui-autocomplete-item",b)},_renderItem:function(c,b){return a('<li class="'+(b.isMatch?"is-match":"no-match")+'">').append(a("<a>").text(b.label)).appendTo(c)},_move:function(a,b){if(this.menu.element.is(":visible"))if(this.menu.isFirstItem()&&/^previous/.test(a)||this.menu.isLastItem()&&/^next/.test(a))this._value(this.term),this.menu.blur();else this.menu[a](b);else this.search(null,b)},widget:function(){return this.menu.element},
_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(a,b){if(!this.isMultiLine||this.menu.element.is(":visible"))this._move(a,b),b.preventDefault()}});a.extend(a.ui.autocomplete,{escapeRegex:function(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(c,b){var d=RegExp("^"+a.ui.autocomplete.escapeRegex(b),"i"),e=a.map(c,function(a){return{isMatch:!b||d.test(a.label||a.value||a),label:a.label||a.value||a,value:a.value||a.label||a}});return a.grep(e,
function(a){return a.isMatch}).concat(a.grep(e,function(a){return!a.isMatch}))}})})(jQuery);
(function(a){var d=!1;a.widget("ui.menu",{version:"1.9.2",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element;this.element.uniqueId().addClass("col-autocomplate").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,a.proxy(function(a){this.options.disabled&&
a.preventDefault()},this));this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true");this._on({"mousedown .ui-menu-item > a":function(a){a.preventDefault()},"click .ui-state-disabled > a":function(a){a.preventDefault()},"click .ui-menu-item:has(a)":function(c){var b=a(c.target).closest(".ui-menu-item");!d&&b.not(".ui-state-disabled").length&&(d=!0,this.select(c),b.has(".ui-menu").length?this.expand(c):this.element.is(":focus")||(this.element.trigger("focus",[!0]),
this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(c){var b=a(c.currentTarget);b.siblings().children(".ui-state-active").removeClass("ui-state-active");this.focus(c,b)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(a,b){var d=this.active||this.element.children(".ui-menu-item").eq(0);b||this.focus(a,d)},blur:function(c){this._delay(function(){a.contains(this.element[0],this.document[0].activeElement)||
this.collapseAll(c)})},keydown:"_keydown"});this.refresh();this._on(this.document,{click:function(c){a(c.target).closest(".ui-menu").length||this.collapseAll(c);d=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("col-autocomplate").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show();this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var c=
a(this);c.data("ui-menu-submenu-carat")&&c.remove()});this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(c){function b(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var d,e,g,h,k=!0;switch(c.keyCode){case a.ui.keyCode.PAGE_UP:this.previousPage(c);break;case a.ui.keyCode.PAGE_DOWN:this.nextPage(c);break;case a.ui.keyCode.HOME:this._move("first","first",c);break;case a.ui.keyCode.END:this._move("last","last",c);break;case a.ui.keyCode.UP:this.previous(c);
break;case a.ui.keyCode.DOWN:this.next(c);break;case a.ui.keyCode.LEFT:this.collapse(c);break;case a.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(c);break;case a.ui.keyCode.ENTER:case a.ui.keyCode.SPACE:this._activate(c);break;case a.ui.keyCode.ESCAPE:this.collapse(c);break;default:(k=!1,d=this.previousFilter||"",e=String.fromCharCode(c.keyCode),g=!1,clearTimeout(this.filterTimer),e===d?g=!0:e=d+e,h=RegExp("^"+b(e),"i"),d=this.activeMenu.children(".ui-menu-item").filter(function(){return h.test(a(this).children("a").text())}),
d=g&&-1!==d.index(this.active.next())?this.active.nextAll(".ui-menu-item"):d,d.length||(e=String.fromCharCode(c.keyCode),h=RegExp("^"+b(e),"i"),d=this.activeMenu.children(".ui-menu-item").filter(function(){return h.test(a(this).children("a").text())})),d.length)?(this.focus(c,d),1<d.length?(this.previousFilter=e,this.filterTimer=this._delay(function(){delete this.previousFilter},1E3)):delete this.previousFilter):delete this.previousFilter}k&&c.preventDefault()},_activate:function(a){this.active.is(".ui-state-disabled")||
(this.active.children("a[aria-haspopup='true']").length?this.expand(a):this.select(a))},refresh:function(){var c,b=this.options.icons.submenu;c=this.element.find(this.options.menus);c.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var c=a(this),d=c.prev("a"),g=a("<span>").addClass("ui-menu-icon ui-icon "+b).data("ui-menu-submenu-carat",!0);d.attr("aria-haspopup",
"true").prepend(g);c.attr("aria-labelledby",d.attr("id"))});c=c.add(this.element);c.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()});c.children(":not(.ui-menu-item)").each(function(){var b=a(this);/[^\-\u2014\u2013\s]/.test(b.text())||b.addClass("ui-widget-content ui-menu-divider")});c.children(".ui-state-disabled").attr("aria-disabled","true");this.active&&!a.contains(this.element[0],
this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},focus:function(a,b){var d;this.blur(a,a&&"focus"===a.type);this._scrollIntoView(b);this.active=b.first();d=this.active.addClass("active");this.options.role&&this.element.attr("aria-activedescendant",d.attr("id"));this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active");a&&"keydown"===a.type?this._close():this.timer=this._delay(function(){this._close()},
this.delay);d=b.children(".ui-menu");d.length&&/^mouse/.test(a.type)&&this._startOpening(d);this.activeMenu=b.parent();this._trigger("focus",a,{item:b})},_scrollIntoView:function(c){var b,d,e;this._hasScroll()&&(b=parseFloat(a.css(this.activeMenu[0],"borderTopWidth"))||0,d=parseFloat(a.css(this.activeMenu[0],"paddingTop"))||0,b=c.offset().top-this.activeMenu.offset().top-b-d,d=this.activeMenu.scrollTop(),e=this.activeMenu.height(),c=c.height(),0>b?this.activeMenu.scrollTop(d+b):b+c>e&&this.activeMenu.scrollTop(d+
b-e+c))},blur:function(a,b){b||clearTimeout(this.timer);this.active&&(this.active.removeClass("active"),this.active=null,this._trigger("blur",a,{item:this.active}))},_startOpening:function(a){clearTimeout(this.timer);"true"===a.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close();this._open(a)},this.delay))},_open:function(c){var b=a.extend({of:this.active},this.options.position);clearTimeout(this.timer);this.element.find(".ui-menu").not(c.parents(".ui-menu")).hide().attr("aria-hidden",
"true");c.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(b)},collapseAll:function(c,b){clearTimeout(this.timer);this.timer=this._delay(function(){var d=b?this.element:a(c&&c.target).closest(this.element.find(".ui-menu"));d.length||(d=this.element);this._close(d);this.blur(c);this.activeMenu=d},this.delay)},_close:function(a){a||(a=this.active?this.active.parent():this.element);a.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},
collapse:function(a){var b=this.active&&this.active.parent().closest(".ui-menu-item",this.element);b&&b.length&&(this._close(),this.focus(a,b))},expand:function(a){var b=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();b&&b.length&&(this._open(b.parent()),this._delay(function(){this.focus(a,b)}))},next:function(a){this._move("next","first",a)},previous:function(a){this._move("prev","last",a)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},
isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(a,b,d){var e;this.active&&(e="first"===a||"last"===a?this.active["first"===a?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[a+"All"](".ui-menu-item").eq(0));if(!e||!e.length||!this.active)e=this.activeMenu.children(".ui-menu-item")[b]();this.focus(d,e)},nextPage:function(c){var b,d,e;this.active?this.isLastItem()||(this._hasScroll()?(d=this.active.offset().top,e=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){b=
a(this);return 0>b.offset().top-d-e}),this.focus(c,b)):this.focus(c,this.activeMenu.children(".ui-menu-item")[!this.active?"first":"last"]())):this.next(c)},previousPage:function(c){var b,d,e;this.active?this.isFirstItem()||(this._hasScroll()?(d=this.active.offset().top,e=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){b=a(this);return 0<b.offset().top-d+e}),this.focus(c,b)):this.focus(c,this.activeMenu.children(".ui-menu-item").first())):this.next(c)},_hasScroll:function(){return this.element.outerHeight()<
this.element.prop("scrollHeight")},select:function(c){this.active=this.active||a(c.target).closest(".ui-menu-item");var b={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(c,!0);this._trigger("select",c,b)}})})(jQuery);function notification(){}
var urlRegex=function(){return function(a){a="^"+(a&&a.length?"(?:"+a.join("|")+")://":"(?:(?:http|https)://|//)")+"(?:(?:[-_.!~*'()a-z\\d;:&=+$,]|%[a-f\\d]{2})*@)?(?:(?:(?:[a-z\\d](?:[-a-z\\d]*[a-z\\d])?)\\.)*(?:[a-z](?:[-a-z\\d]*[a-z\\d])?)\\.?|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}|\\[(?:(?:[a-f\\d]{1,4}:)*(?:[a-f\\d]{1,4}|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3})|(?:(?:[a-f\\d]{1,4}:)*[a-f\\d]{1,4})?::(?:(?:[a-f\\d]{1,4}:)*(?:[a-f\\d]{1,4}|\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}\\.\\d{1,3}))?)\\])(?:\\:\\d+)?(?:/(?:[-_.!~*'()a-z\\d:@&=+$,]|%[a-f\\d]{2})*(?:;(?:[-_.!~*'()a-z\\d:@&=+$,]|%[a-f\\d]{2})*)*(?:/(?:[-_.!~*'()a-z\\d:@&=+$,]|%[a-f\\d]{2})*(?:;(?:[-_.!~*'()a-z\\d:@&=+$,]|%[a-f\\d]{2})*)*)*)?(?:\\?(?:[-_.!~*'()a-z\\d;/?:@&=+$,\\[\\]]|%[a-f\\d]{2})*)?(?:#(?:[-_.!~*'()a-z\\d;/?:@&=+$,\\[\\]]|%[a-f\\d]{2})*)?$";return RegExp(a,
"i")}}();_.mixin({isUrl:function(){var a=slice(arguments),d=a.shift();return(a.length?urlRegex(a):defaultUrlRegex).test(d)},make:function(a,d,c){a=document.createElement(a);d&&$(a).attr(d);c&&$(a).html(c);return a},makeUrl:function(a,d,c){if(_.isString(d))return a+"?"+d;"undefined"===typeof c&&(c={});c=_.defaults(c,{func:jQuery.param,nulls:!1});if(!1===c.nulls){var b={};_.each(d,function(a,c){!_.isNull(a)&&!_.isUndefined(a)&&!1!==a&&!(_.isString(a)&&0==a.length)&&(b[c]=a)});d=b}return a+"?"+c.func(d)}});
(function(){Ind.Events={on:function(a,d,c){var b=this._callbacks||(this._callbacks={});(b[a]||(b[a]=[])).push([d,c]);return this},off:function(a,d){var c;if(a){if(c=this._callbacks)if(d){c=c[a];if(!c)return this;for(var b=0,f=c.length;b<f;b++)if(c[b]&&d===c[b][0]){c[b]=null;break}}else c[a]=[]}else this._callbacks={};return this},fire:function(a){var d,c,b,f,e=2;if(!(c=this._callbacks))return this;for(;e--;)if(d=e?a:"all",d=c[d])for(var g=0,h=d.length;g<h;g++)(b=d[g])?(f=e?Array.prototype.slice.call(arguments,
1):arguments,b[0].apply(b[1]||this,f)):(d.splice(g,1),g--,h--);return this}}})();(function(a,d,c){d.infinitescroll=function(a,b,c){this.element=d(c);this._create(a,b)};d.infinitescroll.defaults={loading:{finished:c,finishedMsg:"<em>Congratulations, you've reached the end of the internet.</em>",img:"http://www.infinite-scroll.com/loading.gif",msg:null,msgText:"<em>Loading the next set of posts...</em>",selector:null,speed:"fast",start:c},state:{isDuringAjax:!1,isInvalidPage:!1,isDestroyed:!1,isDone:!1,isPaused:!1,currPage:1},callback:c,debug:!1,behavior:c,binder:d(a),nextSelector:"div.navigation a:first",
navSelector:"div.navigation",contentSelector:null,extraScrollPx:150,itemSelector:"div.post",animate:!1,pathParse:c,dataType:"html",appendCallback:!0,bufferPx:40,errorCallback:function(){},infid:0,pixelsFromNavToBottom:c,path:c};d.infinitescroll.prototype={_binding:function(a){var b=this,d=b.options;d.v="2.0b2.111027";if(d.behavior&&this["_binding_"+d.behavior]!==c)this["_binding_"+d.behavior].call(this);else{if("bind"!==a&&"unbind"!==a)return this._debug("Binding value  "+a+" not valid"),!1;if("unbind"==
a)this.options.binder.unbind("smartscroll.infscr."+b.options.infid);else this.options.binder[a]("smartscroll.infscr."+b.options.infid,function(){b.scroll()});this._debug("Binding",a)}},_create:function(a,b){if(!this._validate(a))return!1;var f=this.options=d.extend(!0,{},d.infinitescroll.defaults,a),k=d(f.nextSelector).attr("href");f.contentSelector=f.contentSelector||this.element;f.loading.selector=f.loading.selector||f.contentSelector;k?(f.path=[k],f.loading.msg=d('<div id="infscr-loading"><div>'+
f.loading.msgText+"</div></div>"),(new Image).src=f.loading.img,f.pixelsFromNavToBottom=d(document).height()-d(f.navSelector).offset().top,f.loading.start=f.loading.start||function(){d(f.navSelector).hide();f.loading.msg.appendTo(f.loading.selector).show(f.loading.speed,function(){beginAjax(f)})},f.loading.finished=f.loading.finished||function(){f.loading.msg.fadeOut("normal")},f.callback=function(a,e){f.behavior&&a["_callback_"+f.behavior]!==c&&a["_callback_"+f.behavior].call(d(f.contentSelector)[0],
e);b&&b.call(d(f.contentSelector)[0],e,f)},this._setup()):this._debug("Navigation selector not found")},_debug:function(){if(this.options&&this.options.debug)return a.console&&console.log.call(console,arguments)},_determinepath:function(a){var b=this.options;if(b.behavior&&this["_determinepath_"+b.behavior]!==c)this["_determinepath_"+b.behavior].call(this,a);else{if(b.pathParse)return this._debug("pathParse manual"),b.pathParse();if(a.match(/^(.*?)\b2\b(.*?$)/))a=a.match(/^(.*?)\b2\b(.*?$)/).slice(1);
else if(a.match(/^(.*?)2(.*?$)/)){if(a.match(/^(.*?page=)2(\/.*|$)/))return a=a.match(/^(.*?page=)2(\/.*|$)/).slice(1);a=a.match(/^(.*?)2(.*?$)/).slice(1)}else{if(a.match(/^(.*?page=)1(\/.*|$)/))return a=a.match(/^(.*?page=)1(\/.*|$)/).slice(1);this._debug("Sorry, we couldn't parse your Next (Previous Posts) URL. Verify your the css selector points to the correct A tag. If you still get this error: yell, scream, and kindly ask for help at infinite-scroll.com.");b.state.isInvalidPage=!0}this._debug("determinePath",
a);return a}},_error:function(a){var b=this.options;b.behavior&&this["_error_"+b.behavior]!==c?this["_error_"+b.behavior].call(this,a):("destroy"!==a&&"end"!==a&&(a="unknown"),this._debug("Error",a),"end"==a&&this._showdonemsg(),b.state.isDone=!0,b.state.currPage=1,b.state.isPaused=!1,this._binding("unbind"))},_loadcallback:function(b,f){var h=this.options,k=this.options.callback,j=h.state.isDone?"done":!h.appendCallback?"no-append":"append",i;if(h.behavior&&this["_loadcallback_"+h.behavior]!==c)this["_loadcallback_"+
h.behavior].call(this,b,f);else{switch(j){case "done":return this._showdonemsg(),!1;case "no-append":"html"==h.dataType&&(f=d("<div>"+f+"</div>").find(h.itemSelector));break;case "append":j=b.children();if(0==j.length)return this._error("end");for(i=document.createDocumentFragment();b[0].firstChild;)i.appendChild(b[0].firstChild);this._debug("contentSelector",d(h.contentSelector)[0]);d(h.contentSelector)[0].appendChild(i);i=d(f).find(h.nextSelector).attr("href");this._debug("nextHREF",i);i?this.options.path=
[i]:(this.options.path=[],h.state.isDone=!0);f=j.get()}h.loading.finished.call(d(h.contentSelector)[0],h);h.animate&&(j=d(a).scrollTop()+d("#infscr-loading").height()+h.extraScrollPx+"px",d("html,body").animate({scrollTop:j},800,function(){h.state.isDuringAjax=!1}));h.animate||(h.state.isDuringAjax=!1);k(this,f)}},_nearbottom:function(){var b=this.options,f=0+d(document).height()-b.binder.scrollTop()-d(a).height();if(b.behavior&&this["_nearbottom_"+b.behavior]!==c)this["_nearbottom_"+b.behavior].call(this);
else return this._debug("math:",f,b.pixelsFromNavToBottom),f-b.bufferPx<b.pixelsFromNavToBottom},_pausing:function(a){var b=this.options;if(b.behavior&&this["_pausing_"+b.behavior]!==c)this["_pausing_"+b.behavior].call(this,a);else{"pause"!==a&&"resume"!==a&&null!==a&&this._debug("Invalid argument. Toggling pause value instead");switch(a&&("pause"==a||"resume"==a)?a:"toggle"){case "pause":b.state.isPaused=!0;break;case "resume":b.state.isPaused=!1;break;case "toggle":b.state.isPaused=!b.state.isPaused}this._debug("Paused",
b.state.isPaused);return!1}},_setup:function(){var a=this.options;if(a.behavior&&this["_setup_"+a.behavior]!==c)this["_setup_"+a.behavior].call(this);else return this._binding("bind"),!1},_showdonemsg:function(){var a=this.options;a.behavior&&this["_showdonemsg_"+a.behavior]!==c?this["_showdonemsg_"+a.behavior].call(this):(a.loading.msg.find("img").hide().parent().find("div").html(a.loading.finishedMsg).animate({opacity:1},2E3,function(){d(this).parent().fadeOut("normal")}),a.errorCallback.call(d(a.contentSelector)[0],
"done"))},_validate:function(a){for(var b in a)return b.indexOf&&-1<b.indexOf("Selector")&&0===d(a[b]).length?(this._debug("Your "+b+" found no elements."),!1):!0},bind:function(){this._binding("bind")},destroy:function(){this.options.state.isDestroyed=!0;return this._error("destroy")},pause:function(){this._pausing("pause")},resume:function(){this._pausing("resume")},retrieve:function(a){var b=this,f=b.options,k=f.path,j,i,l,m,a=a||null;beginAjax=function(a){a.state.currPage++;b._debug("heading into ajax",
k);j=d(a.contentSelector).is("table")?d("<tbody/>"):d("<div/>");i=k.join(a.state.currPage);l="html"==a.dataType||"json"==a.dataType?a.dataType:"html+callback";a.appendCallback&&"html"==a.dataType&&(l+="+callback");switch(l){case "html+callback":b._debug("Using HTML via .load() method");j.load(i+" "+a.itemSelector,null,function(a){b._loadcallback(j,a)});break;case "html":case "json":b._debug("Using "+l.toUpperCase()+" via $.ajax() method"),d.ajax({url:i,dataType:a.dataType,complete:function(a,c){(m=
"undefined"!==typeof a.isResolved?a.isResolved():"success"===c||"notmodified"===c)?b._loadcallback(j,a.responseText):b._error("end")}})}};if(f.behavior&&this["retrieve_"+f.behavior]!==c)this["retrieve_"+f.behavior].call(this,a);else{if(f.state.isDestroyed)return this._debug("Instance is destroyed"),!1;f.state.isDuringAjax=!0;f.loading.start.call(d(f.contentSelector)[0],f)}},scroll:function(){var a=this.options,b=a.state;a.behavior&&this["scroll_"+a.behavior]!==c?this["scroll_"+a.behavior].call(this):
!b.isDuringAjax&&!b.isInvalidPage&&!b.isDone&&!b.isDestroyed&&!b.isPaused&&this._nearbottom()&&this.retrieve()},toggle:function(){this._pausing()},unbind:function(){this._binding("unbind")},update:function(a){d.isPlainObject(a)&&(this.options=d.extend(!0,this.options,a))}};d.fn.infinitescroll=function(a,b){switch(typeof a){case "string":var c=Array.prototype.slice.call(arguments,1);this.each(function(){var b=d.data(this,"infinitescroll");if(!b||!d.isFunction(b[a])||"_"===a.charAt(0))return!1;b[a].apply(b,
c)});break;case "object":this.each(function(){var c=d.data(this,"infinitescroll");c?c.update(a):d.data(this,"infinitescroll",new d.infinitescroll(a,b,this))})}return this};var b=d.event,f;b.special.smartscroll={setup:function(){d(this).bind("scroll",b.special.smartscroll.handler)},teardown:function(){d(this).unbind("scroll",b.special.smartscroll.handler)},handler:function(a,b){var c=this,k=arguments;a.type="smartscroll";f&&clearTimeout(f);f=setTimeout(function(){d.event.handle.apply(c,k)},"execAsap"===
b?0:100)}};d.fn.smartscroll=function(a){return a?this.bind("smartscroll",a):this.trigger("smartscroll",["execAsap"])}})(window,jQuery);indulgy.Categorypicker={};
(function(a){function d(){this.debug=!0;this._curInst=null;this._keyEvent=!1;this._mainDivId="ui-catpicker-div";this._defaults={showOn:"focus",showAnim:"fadeIn",duration:"fast",onSelect:null,onClose:null,disabled:!1};this.dpDiv=a('<div id="'+this._mainDivId+'" class="ui-catpicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all"></div>')}a.extend(a.ui,{categorypicker:{version:"1.0.0"}});var c=(new Date).getTime();a.extend(d.prototype,{markerClassName:"hasCatpicker",log:function(){this.debug&&
console.log.apply("",arguments)},_attachPicker:function(b,c){b.id||(this.uuid+=1,b.id="cp"+this.uuid);var d=a(b);if(!d.hasClass(this.markerClassName)){var g={id:d[0].id.replace(/([^A-Za-z0-9_-])/g,"\\\\$1"),input:d,dpDiv:this.dpDiv,settings:c||{}};d.focus(this._show).addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp);a.data(b,"categorypicker",g)}},_destroyDatepicker:function(b){var c=a(b);c.hasClass(this.markerClassName)&&(a.removeData(b,"categorypicker"),
c.removeClass(this.markerClassName).unbind("focus",this._show).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp))},_getInst:function(b){try{return a.data(b,"categorypicker")}catch(c){throw"Missing instance data for this categorypicker";}},_doKeyDown:function(b){var c=a.categorypicker._getInst(b.target),d=!0,g=c.dpDiv.is(".ui-datepicker-rtl");c._keyEvent=!0;console.log(a.categorypicker._datepickerShowing);if(a.categorypicker._datepickerShowing)switch(b.keyCode){case 9:a.categorypicker._hide();
d=!1;break;case 13:return d=a("td."+a.categorypicker._dayOverClass+":not(."+a.categorypicker._currentClass+")",c.dpDiv),d[0]&&a.datepicker._selectDay(b.target,c.selectedMonth,c.selectedYear,d[0]),(b=a.categorypicker._get(c,"onSelect"))?(d=a.categorypicker._formatDate(c),b.apply(c.input?c.input[0]:null,[d,c])):a.categorypicker._hide(),!1;case 27:a.categorypicker._hide();break;case 35:(b.ctrlKey||b.metaKey)&&a.categorypicker._clearDate(b.target);d=b.ctrlKey||b.metaKey;break;case 36:(b.ctrlKey||b.metaKey)&&
a.datepicker._gotoToday(b.target);d=b.ctrlKey||b.metaKey;break;case 37:if(b.ctrlKey||b.metaKey)a.categorypicker._adjustDate(b.target,g?1:-1,"D");d=b.ctrlKey||b.metaKey;b.originalEvent.altKey&&a.datepicker._adjustDate(b.target,b.ctrlKey?-a.datepicker._get(c,"stepBigMonths"):-a.datepicker._get(c,"stepMonths"),"M");break;case 38:c.currentPos?0===c.currentPos?c.currentPos=c.settings.categories.length-1:c.currentPos--:c.currentPos=0;a.categorypicker._updatePicker();break;case 40:a.categorypicker._updatePicker();
break;default:d=!1}else 36==b.keyCode&&b.ctrlKey?a.categorypicker._show(this):d=!1;d&&(b.preventDefault(),b.stopPropagation())},_doKeyPress:function(b){var c=a.categorypicker._getInst(b.target);if(a.categorypicker._get(c,"constrainInput")){var c=a.categorypicker._possibleChars(a.categorypicker._get(c,"dateFormat")),d=String.fromCharCode(void 0==b.charCode?b.keyCode:b.charCode);return b.ctrlKey||b.metaKey||" ">d||!c||-1<c.indexOf(d)}},_doKeyUp:function(b){a.categorypicker._getInst(b.target);return!0},
_show:function(b){b=b.target||b;if(a.categorypicker._lastInput!=b){var c=a.categorypicker._getInst(b);a.categorypicker._curInst&&a.categorypicker._curInst!=c&&(a.categorypicker._curInst.dpDiv.stop(!0,!0),c&&a.categorypicker._datepickerShowing&&a.categorypicker._hide(a.categorypicker._curInst.input[0]));var d=a.categorypicker._get(c,"beforeShow");if(!1!==(d?d.apply(b,[b,c]):{})){c.lastVal=null;a.categorypicker._lastInput=b;a.categorypicker._pos||(a.categorypicker._pos=a.categorypicker._findPos(b),
a.categorypicker._pos[1]+=b.offsetHeight);var g=!1;a(b).parents().each(function(){g=g|a(this).css("position")=="fixed";return!g});var d=a.categorypicker._pos[0],h=a.categorypicker._pos[1];a.categorypicker._pos=null;c.dpDiv.empty();c.dpDiv.css({position:"absolute",display:"block",top:"-1000px"});a.categorypicker._updatePicker(c);c.dpDiv.css({position:a.categorypicker._inDialog&&a.blockUI?"static":g?"fixed":"absolute",display:"none",left:d+"px",top:h+"px"});var d=a.categorypicker._get(c,"showAnim"),
h=a.categorypicker._get(c,"duration"),k=function(){var b=c.dpDiv.find("iframe.ui-datepicker-cover");if(b.length){var d=a.categorypicker._getBorders(c.dpDiv);b.css({left:-d[0],top:-d[1],width:c.dpDiv.outerWidth(),height:c.dpDiv.outerHeight()})}};c.dpDiv.zIndex(a(b).zIndex()+1);a.categorypicker._datepickerShowing=!0;c.dpDiv[d||"show"](d?h:null,k);(!d||!h)&&k();c.input.is(":visible")&&!c.input.is(":disabled")&&c.input.focus();a.categorypicker._curInst=c}}},_updatePicker:function(b){b.dpDiv.empty().append(this._generateHTML(b));
this._attachHandlers(b);var c=b.dpDiv.find("iframe.ui-catpicker-cover");c.length&&c.css({left:-borders[0],top:-borders[1],width:b.dpDiv.outerWidth(),height:b.dpDiv.outerHeight()});b==a.categorypicker._curInst&&a.categorypicker._datepickerShowing&&b.input&&b.input.is(":visible")&&!b.input.is(":disabled")&&b.input[0]!=document.activeElement&&b.input.focus()},_findPos:function(b){for(var c=this._get(this._getInst(b),"isRTL");b&&("hidden"==b.type||1!=b.nodeType||a.expr.filters.hidden(b));)b=b[c?"previousSibling":
"nextSibling"];b=a(b).offset();return[b.left,b.top]},_hide:function(b){var c=this._curInst;if(c&&!(b&&c!=a.data(b,"categorypicker"))&&this._datepickerShowing){var b=this._get(c,"showAnim"),d=this._get(c,"duration");c.dpDiv["slideDown"==b?"slideUp":"fadeIn"==b?"fadeOut":"hide"](b?d:null);this._datepickerShowing=!1;(b=this._get(c,"onClose"))&&b.apply(c.input?c.input[0]:null,[c.input?c.input.val():"",c]);this._lastInput=null;this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),
a.blockUI&&(a.unblockUI(),a("body").append(this.dpDiv)));this._inDialog=!1}},_checkExternalClick:function(b){if(a.categorypicker._curInst){var b=a(b.target),c=a.categorypicker._getInst(b[0]);(b[0].id!=a.categorypicker._mainDivId&&0==b.parents("#"+a.categorypicker._mainDivId).length&&!b.hasClass(a.categorypicker.markerClassName)&&!b.closest("."+a.categorypicker._triggerClass).length&&a.categorypicker._datepickerShowing&&(!a.categorypicker._inDialog||!a.blockUI)||b.hasClass(a.categorypicker.markerClassName)&&
a.categorypicker._curInst!=c)&&a.categorypicker._hide()}},_get:function(a,c){return void 0!==a.settings[c]?a.settings[c]:this._defaults[c]},_attachHandlers:function(b){var d=this._get(b,"stepMonths"),e="#"+b.id.replace(/\\\\/g,"\\");b.dpDiv.find("[data-handler]").map(function(){a(this).bind(this.getAttribute("data-event"),{prev:function(){window["DP_jQuery_"+c].datepicker._adjustDate(e,-d,"M")},next:function(){window["DP_jQuery_"+c].datepicker._adjustDate(e,+d,"M")},hide:function(){window["DP_jQuery_"+
c].datepicker._hide()},today:function(){window["DP_jQuery_"+c].datepicker._gotoToday(e)},selectDay:function(){window["DP_jQuery_"+c].datepicker._selectDay(e,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this);return!1},selectMonth:function(){window["DP_jQuery_"+c].datepicker._selectMonthYear(e,this,"M");return!1},selectYear:function(){window["DP_jQuery_"+c].datepicker._selectMonthYear(e,this,"Y");return!1}}[this.getAttribute("data-handler")])})},_generateHTML:function(a){console.log(a);
var c=this._get(a,"categories"),a=a.input.val().toLowerCase(),d="<ul>",g;for(g in c){var h=c[g];0===h.toLowerCase().lastIndexOf(a,0)&&(d+='<li class="match">'+h+"</li>")}for(g in c)h=c[g],0!=h.toLowerCase().lastIndexOf(a,0)&&(d+="<li>"+h+"</li>");return d+"</ul>"}});a.categorypicker=new d;a.categorypicker.initialized=!1;a.categorypicker.uuid=(new Date).getTime();a.categorypicker.version="1.0.0";a.fn.categorypicker=function(b){a.categorypicker.initialized||(a(document).mousedown(a.categorypicker._checkExternalClick).find(document.body).append(a.categorypicker.dpDiv),
a.categorypicker.initialized=!0);return this.each(function(){a.categorypicker._attachPicker(this,b)})}})(jQuery);var uploads={},post_tmpl=0<$("#submit_view").length?_.template($("#submit_view").html()):{},render_image_tmpl=0<$("#submit_input").length?_.template($("#submit_input").html()):{},alertTmpl=0<$("#alertTmpl").length?_.template($("#alertTmpl").html()):{},smallImages=[],bigImages=[];
function render_unsaved_image(a){var d=new SingleUpload({render_image_tmpl:render_image_tmpl,post_tmpl:post_tmpl,parent:$(".bricks-container"),data:{closeButtonLabel:"Cancel",saved_filename:"/resources/img/loadinfo.net.gif",width:48,height:48,title:"",category:"",link_to_pic:"",postId:""}});d.render();uploads[a]=d;$(".bricks-container").masonry("reload")}function update_progress_bar(){}
function render_saved_image(a,d,c){"true"==c.success&&(a=uploads[a],a.update_data({saved_filename:c.saved_filename,width:c.width,height:c.height,postId:c.postId}),a.update_view(),$(".bricks-container").waitForImages(function(){$(".bricks-container").masonry("reload")}))}function render_image_selector(a){$(image_select_tmpl(a)).prependTo($(".bricks-container"))}
function post_link(a){$.post("/do/service/submit/link",{urlToGetPictureFrom:a},function(a){if("true"!=a.success){var c=_.template($("#alertTmpl").html()),c=$(c({alertTitle:"Wrong Link",alertMessage:"The URL you provided is failed.<br/><span class='label label-info'>Tip:</span> There is <a href='/do/tools'>a plugin for browser</a> which helps to collect pictures from any web page."})),b=$("#addPanel");c.appendTo(b);b.on("hidden",function(){b.html("")});c.bind("shown",function(){$("#ok").focus()});
b.modal()}$(".modal-inner").fadeOut(300).remove();var f=0;$.each(a.posts,function(){300<=this.width?(f++,bigImages.push(this)):smallImages.push(this)});0!=f?($.each(bigImages,function(){this.closeButtonLabel="Cancel";this.action="save";(new SingleUpload({parent:$(".bricks-container"),render_image_tmpl:render_image_tmpl,post_tmpl:post_tmpl,data:this})).render(!0)}),bigImages=[],$(".bricks-container").waitForImages(function(){$(".bricks-container").masonry("reload");$(".modal-inner").animate({opacity:1},
300);0!=smallImages.length&&$("#showSmall").show();$("#linkToGetPictureFrom").removeAttr("disabled");$("#get_from_link").removeAttr("disabled");$("#get_from_link").toggleClass("loading");$("#linkToGetPictureFrom").val(a.urlToGetPictureFrom)})):showSmallImages()})}
function showSmallImages(){$.each(smallImages,function(){(new SingleUpload({parent:$(".bricks-container"),render_image_tmpl:render_image_tmpl,post_tmpl:post_tmpl,data:this})).render(!0)});$("#showSmall").attr("disabled","disabled").toggleClass("loading");smallImages=[];bigImages=[];$(".bricks-container").waitForImages(function(){$(".bricks-container").masonry("reload");$("#showSmall").fadeOut(200).removeAttr("disabled").toggleClass("loading");$(".modal-inner").animate({opacity:1},300);$("#linkToGetPictureFrom").removeAttr("disabled");
$("#get_from_link").removeAttr("disabled");$("#get_from_link").toggleClass("loading");$("#linkToGetPictureFrom").val(res.urlToGetPictureFrom)})}
function submitReady(){$(".select_image").live("mouseover",function(){$(this).find("img").css("border","1px solid red");return!1});$(".select_image").live("mouseout",function(){$(this).find("img").css("border","0px solid red");return!1});$(".select_image").live("click",function(){var a=$(this).find("img").attr("src");$(".image_selector").remove();post_link(a);return!1});$("#get_from_link").click(function(){$("#linkToGetPictureFrom").attr("disabled","disabled");$("#get_from_link").attr("disabled",
"disabled");$("#get_from_link").toggleClass("loading");$(".image_selector").remove();var a=$.trim($("#linkToGetPictureFrom").val());post_link(a);return!1});$("#linkToGetPictureFrom").keypress(function(a){13==a.which&&$("#get_from_link").click()});$(".bricks-container").masonry({isAnimated:!1,itemSelector:".modal-inner",columnWidth:324,isFitWidth:!0})};!function(a){function d(){var b=this,d=setTimeout(function(){b.$element.off(a.support.transition.end);c.call(b)},500);this.$element.one(a.support.transition.end,function(){clearTimeout(d);c.call(b)})}function c(){this.$element.hide().trigger("hidden");b.call(this)}function b(b){var c=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var d=a.support.transition&&c;this.$backdrop=a('<div class="modal-backdrop '+c+'" />').appendTo(document.body);"static"!=this.options.backdrop&&
this.$backdrop.click(a.proxy(this.hide,this));d&&this.$backdrop[0].offsetWidth;this.$backdrop.addClass("in");d?this.$backdrop.one(a.support.transition.end,b):b()}else!this.isShown&&this.$backdrop?(this.$backdrop.removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one(a.support.transition.end,a.proxy(f,this)):f.call(this)):b&&b()}function f(){this.$backdrop.remove();this.$backdrop=null}function e(){var b=this;if(this.isShown&&this.options.keyboard)a(document).on("keyup.dismiss.modal",
function(a){27==a.which&&b.hide()});else this.isShown||a(document).off("keyup.dismiss.modal")}var g=function(b,c){this.options=c;this.$element=a(b).delegate('[data-dismiss="modal"]',"click.dismiss.modal",a.proxy(this.hide,this))};g.prototype={constructor:g,toggle:function(){return this[!this.isShown?"show":"hide"]()},show:function(){var c=this;this.isShown||(a("body").addClass("modal-open"),this.isShown=!0,this.$element.trigger("show"),e.call(this),b.call(this,function(){var b=a.support.transition&&
c.$element.hasClass("fade");!c.$element.parent().length&&c.$element.appendTo(document.body);c.$element.show();b&&c.$element[0].offsetWidth;c.$element.addClass("in");b?c.$element.one(a.support.transition.end,function(){c.$element.trigger("shown")}):c.$element.trigger("shown")}))},hide:function(b){b&&b.preventDefault();this.isShown&&(this.isShown=!1,a("body").removeClass("modal-open"),e.call(this),this.$element.trigger("hide").removeClass("in"),a.support.transition&&this.$element.hasClass("fade")?d.call(this):
c.call(this))}};a.fn.modal=function(b){return this.each(function(){var c=a(this),d=c.data("modal"),e=a.extend({},a.fn.modal.defaults,c.data(),"object"==typeof b&&b);d||c.data("modal",d=new g(this,e));if("string"==typeof b)d[b]();else e.show&&d.show()})};a.fn.modal.defaults={backdrop:!0,keyboard:!0,show:!0};a.fn.modal.Constructor=g;a(function(){a("body").on("click.modal.data-api",'[data-toggle="modal"]',function(b){var c=a(this),d,e=a(c.attr("data-target")||(d=c.attr("href"))&&d.replace(/.*(?=#[^\s]+$)/,
"")),c=e.data("modal")?"toggle":a.extend({},e.data(),c.data());b.preventDefault();e.modal(c)})})}(window.jQuery);!function(a){a(function(){var d=a.support,c=(document.body||document.documentElement).style;if(c=void 0!==c.transition||void 0!==c.WebkitTransition||void 0!==c.MozTransition||void 0!==c.MsTransition||void 0!==c.OTransition)c="TransitionEnd",a.browser.webkit?c="webkitTransitionEnd":a.browser.mozilla?c="transitionend":a.browser.opera&&(c="oTransitionEnd"),c={end:c};d.transition=c})}(window.jQuery);