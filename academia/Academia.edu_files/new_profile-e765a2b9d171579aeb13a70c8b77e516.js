(function(){this.AddCoauthor={}}).call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;AddCoauthor.SuggestedCoauthor=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.defaults={accepted:null},n.prototype.saveSuggestion=function(t){return this.set("accepted",t),this.set("source","profile_add_coauthor_button"),$.ajax({type:"POST",dataType:"json",contentType:"application/json",url:$r.api_v0_suggestions_coauthors_path({subdomain_param:"api"}),data:JSON.stringify(this.attributes)})},n}(Backbone.Model)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;AddCoauthor.AddCoauthorsCollection=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.url=$r.by_works_api_v0_suggestions_coauthors_path({subdomain_param:"api"}),n.prototype.parse=function(t){return _(t.work_suggestions).map(function(t){return new Backbone.Model({workId:t.work_id,suggestions:new AddCoauthor.SuggestedCoauthors(t.suggestions)})})},n}(Backbone.Collection)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;AddCoauthor.SuggestedCoauthors=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=AddCoauthor.SuggestedCoauthor,n.prototype.numUnconfirmedCoAuthors=function(){return this.where({accepted:null}).length},n}(Backbone.Collection)}.call(this),function(){this.JST||(this.JST={}),this.JST["add_coauthor/templates/add_coauthor_button"]=function(t){var e,n=[],o=t||{};return function(t,o){n.push('<span class="DesignSystem"><span class="js-add-coauthor-button-clickable u-clickable"><i class="fa fa-user-plus u-mr1x add-coauthor-button-icon u-tcGrayDark"></i><span class="js-add-coauthor-button-text u-tcGrayDark">'+jade.escape(null==(e=t.numberAndNoun(o,"Unconfirmed Co-Author"))?"":e)+"</span></span></span>")}.call(this,"$h"in o?o.$h:"undefined"!=typeof $h?$h:void 0,"numSuggestions"in o?o.numSuggestions:"undefined"!=typeof numSuggestions?numSuggestions:void 0),n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["add_coauthor/templates/add_coauthor_popover"]=function(t){var e,n=[],o=t||{};return function(t){n.push('<div class="DesignSystem js-add-coauthor-button-popover"><div class="media_v2"><div class="media-left media-top"><img'+jade.attr("src",t.profile_picture_url,!0,!1)+' class="Avatar Avatar--med"/></div><div class="media-body u-pl0x"><div class="u-fw700 u-tcGrayDarker">'+jade.escape(null==(e=t.name)?"":e)+'</div><small class="u-tcGrayDark">'+jade.escape(null==(e=t.email)?"":e)+'</small></div></div><div class="u-taCenter u-mt5x"><div class="Button Button--lg Button--green js-confirm-button"><div class="fa fa-check u-mr2x"></div><span class="u-fw700 js-confirm-button-text">CONFIRM CO-AUTHOR</span></div><!-- would be nice to replace this with something like Button--link at some point--><a url="" class="u-displayBlock u-mt1x u-p2x u-clickable u-tcGray u-fs12 u-textDecorationUnderline js-dismiss-button">Person is not a Co-Author</a></div></div>')}.call(this,"model"in o?o.model:"undefined"!=typeof model?model:void 0),n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["add_coauthor/templates/add_coauthor_popover_finished"]=function(){var t=[];return t.push('<div class="js-add-coauthor-button-popover add-coauthor-button-finished"><div class="u-taCenter u-tcGreen"><i class="fa fa-check-circle-o fa-5x u-mt5x"></i><div class="u-fs24 u-mt10x">Thanks for confirming your co-authors!</div></div></div>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["add_coauthor/templates/add_coauthor_popover_title"]=function(t){var e,n=[],o=t||{};return function(t){n.push('<div class="u-tcGrayDarker u-taCenter u-fw700">'+jade.escape(null==(e=t)?"":e)+' REMAINING</div><!-- close button--><i style="position:absolute;top:10px;right:10px;" class="fa fa-times u-clickable u-tcGray js-popover-close"></i>')}.call(this,"numUnconfirmedCoAuthors"in o?o.numUnconfirmedCoAuthors:"undefined"!=typeof numUnconfirmedCoAuthors?numUnconfirmedCoAuthors:void 0),n.join("")}}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;AddCoauthor.AddCoauthorButtonView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.template="add_coauthor/templates/add_coauthor_button",n.prototype.initialize=function(){return this.suggestions=this.model.get("suggestions"),this.render()},n.prototype.render=function(){return this.$el.html(JST[this.template]({numSuggestions:this.suggestions.numUnconfirmedCoAuthors()})),this.postRender(),this},n.prototype.postRender=function(){return this.ui={$buttonText:this.$(".js-add-coauthor-button-text"),$clickable:this.$(".js-add-coauthor-button-clickable")},this.popoverView=new AddCoauthor.AddCoauthorPopoverView({el:this.ui.$clickable,model:this.model,collection:this.suggestions}),this.listenTo(this.suggestions,"change:accepted",this.updateText),this.listenToOnce(this.model,"change:finished",this.remove)},n.prototype.updateText=function(){var t;return t=$h.numberAndNoun(this.suggestions.numUnconfirmedCoAuthors(),"Unconfirmed Co-Author"),this.ui.$buttonText.text(t)},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;AddCoauthor.AddCoauthorPopoverView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.template="add_coauthor/templates/add_coauthor_popover",n.prototype.titleTemplate="add_coauthor/templates/add_coauthor_popover_title",n.prototype.finishedTemplate="add_coauthor/templates/add_coauthor_popover_finished",n.prototype.initialize=function(){return this.currentSuggestion=0,this.render()},n.prototype.render=function(){return this.$el.popover({html:!0,content:this.templateHTML(),placement:"right",title:this.titleHTML()}),this.postRender()},n.prototype.postRender=function(){return this.$el.on("shown.bs.popover",function(t){return function(){return t.reRenderPopover()}}(this)),this.listenTo(this.collection,"change:accepted",this.updateTitle)},n.prototype.reRenderPopover=function(){return this.currentSuggestion>=this.collection.length?(this.popoverTitleEl().remove(),this.popoverEl().html(JST[this.finishedTemplate]),setTimeout(function(t){return function(){return t.remove()}}(this),800)):(this.popoverEl().html(this.templateHTML()),this.popoverTitleEl().html(this.titleHTML()),this.enablePopoverClickHandlers())},n.prototype.updateTitle=function(){return this.popoverTitleEl().html(this.titleHTML())},n.prototype.templateHTML=function(){return JST[this.template]({model:this.currentSuggestionModel().toJSON()})},n.prototype.titleHTML=function(){return JST[this.titleTemplate]({numUnconfirmedCoAuthors:this.collection.numUnconfirmedCoAuthors()})},n.prototype.currentSuggestionModel=function(){return this.collection.at(this.currentSuggestion)},n.prototype.enablePopoverClickHandlers=function(){return this.confirmButtonEl().on("click",function(t){return function(){return t.buttonClicked(!0)}}(this)),this.dismissButtonEl().on("click",function(t){return function(){return t.buttonClicked(!1)}}(this)),this.closeButtonEl().on("click",function(t){return function(){return t.closePopover()}}(this))},n.prototype.buttonClicked=function(t){return this.confirmButtonEl().addClass("disabled"),this.dismissButtonEl().addClass("disabled"),this.currentSuggestionModel().saveSuggestion(t),this.currentSuggestion+=1,this.reRenderPopover()},n.prototype.closePopover=function(){return this.$el.popover("hide")},n.prototype.popoverTipEl=function(){var t;return null!=(t=this.$el.data("bs.popover"))?t.tip():void 0},n.prototype.popoverEl=function(){return this.popoverTipEl().find(".js-add-coauthor-button-popover").parent()},n.prototype.popoverTitleEl=function(){return this.popoverTipEl().find(".popover-title")},n.prototype.confirmButtonEl=function(){return this.popoverTipEl().find(".js-confirm-button")},n.prototype.dismissButtonEl=function(){return this.popoverTipEl().find(".js-dismiss-button")},n.prototype.closeButtonEl=function(){return this.popoverTipEl().find(".js-popover-close")},n.prototype.remove=function(){return this.popoverTipEl().fadeOut(400,function(t){return function(){return t.$el.popover("destroy"),t.model.set("finished",!0)}}(this))},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;AddCoauthor.AddCoauthorsController=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(){return this.collection=new AddCoauthor.AddCoauthorsCollection,this.collection.fetch().done(function(t){return function(){return t.render()}}(this))},n.prototype.render=function(){return this.addCoauthorViews=this.collection.map(function(t){var e;return e=$("[data-work-id='"+t.get("workId")+"'] .js-add-coauthor-button"),e.removeClass("hidden"),new AddCoauthor.AddCoauthorButtonView({el:e,model:t})})},n}(Backbone.View)}.call(this),function(){var t,e,n,o,r,i,s,a,p;p=function(t,e){return t&&t[e]?_.isFunction(t[e])?t[e]():t[e]:null},this.Academia.FormBuilder=n=Backbone.View.extend({tagName:"form",options:{single_click:!0,include_cancel_and_submit:!1},initialize:function(t){return this.fields=[],this.options.record_events_for&&(this.notifier=new c.Server.Notification(this.options.record_events_for)),this.submit_handler=this._generate_submit_handler(t)},add_field:function(t,e){var n;return null==e&&(e={}),e=_.extend({model:this.model,sync_to_model:this.options.sync_to_model},e),n="string"==typeof t?new Academia.FormBuilder.Fields[t](e):new t(e),this.fields.push(n),n},clear_fields:function(){return this.fields=[]},form_data:function(){return this.$el.serializeObject()},process_error_response:function(t){var e,n;try{if(422!==t.status)throw"Unexpected error status";n=JSON.parse(t.responseText).errors}catch(o){e=o,alert("Sorry, there's been an error. Please try again.")}return this.process_error_hash(n)},process_error_hash:function(t){return _.each(this.fields,function(){return function(e){return"function"==typeof e.render_errors?e.render_errors(t[e.name]):void 0}}(this))},render:function(){return this.$el.empty(),this.$el.off("submit"),this.$el.on("submit",this.submit_handler),_.each(this.fields,function(t){return function(e){return t.$el.append(e.render().$el)}}(this)),this.options.include_cancel_and_submit&&this.$el.append('<div class="cancel_or_submit"> <a href="#" class="cancel_link">cancel</a> <input type="submit" class="button blue" value="Save"></input> </div>'),this},_record_event:function(t){return("undefined"!=typeof $a&&null!==$a?$a.log:void 0)&&$a.log(t),null!=this.notifier?this.notifier.notify({event:t,user_id:$current_user.id,source:this.options.source,user_time:parseInt((new Date).getTime()/1e3)}):void 0},save:function(t){var e;return e=this.form_data(),("function"==typeof t.before_submit?t.before_submit(e,t):void 0)!==!1?this.model.save(e,t):void 0},submit:function(){return this.$el.submit()},_generate_submit_handler:function(t){var e,n;return n=!1,e={params:{},before_submit:t.before_submit,success:t.success,error:function(e){return function(o,r){return n=!1,e.process_error_response(r),t.error?t.error.apply(e,arguments):void 0}}(this)},function(o){return function(r){return r.preventDefault(),n&&t.single_click?void 0:(n=!0,o.save(e))}}(this)}}),t=n.BaseField=Backbone.View.extend({className:"clearfix",inputType:"text",events:{"change input":"sync_changes","keyup  input":"sync_changes","change textarea":"sync_changes","keyup  textarea":"sync_changes","change select":"sync_changes"},initialize:function(t){return this.name=t.name,t.value_fn?this.value=t.value_fn:void 0},focus:function(){return this.$("input, textarea").focus()},human_name:function(){var t;return t=this.options.label||this.name,t.charAt(0).toUpperCase()+t.slice(1)},inputId:function(){var t;return t=this.model.modelName+"_"+this.model.cid+"_"+p(this,"name"),t.replace(/[\[\]]/g,"_")},render:function(){var t;return this.$el.html(""),this.options.label!==!1&&this.$el.append(this._generate_label()),t=$("<div></div>"),t.attr("class","input input_"+p(this,"name")),(this.input=this._generate_input()).appendTo(t),(this.errors=this._generate_errors()).appendTo(t),this.$el.append(t),this},render_errors:function(t){return null==t&&(t=[]),this.errors.html(""),t.length>0?(_.each(t,function(t){return function(e){var n;return n=$('<div class="error_message"></div>'),n.text(t.human_name()+" "+e),n.appendTo(t.errors)}}(this)),this.errors.show()):this.errors.hide()},value:function(t){return"undefined"==typeof t?this.model.get(this.name):this.model.set(this.name,t)},sync_changes:function(){return this.options.sync_to_model?this.value(this.input.val()):void 0},_generate_label:function(){var t;return t=$("<label></label>"),t.attr("for",p(this,"inputId")),t.html(this.human_name()+":"),t},_generate_input:function(){var t;return t=$("<input></input>"),t.attr("name",p(this,"name")),t.attr("type",p(this,"inputType")),t.attr("value",p(this,"value")),t.attr("id",p(this,"inputId")),t.attr("class",this.options.input_class||"")},_generate_errors:function(){var t;return t=$('<div class="error_messages" style="display:none"></div>')}}),s=n.TextareaField=t.extend({render:function(){return t.prototype.render.apply(this,arguments),this},_generate_input:function(){var t;return t=$("<textarea></textarea>"),this.options.no_autoexpand||t.attr("class","autoexpand_on_focus"),t.attr("name",p(this,"name")),t.attr("value",p(this,"value")),t.attr("id",p(this,"inputId")),t.attr("class",this.options.input_class||""),t}}),r=[["January",31],["February",29],["March",31],["April",30],["May",31],["June",30],["July",31],["August",31],["September",30],["October",31],["November",30],["December",31]],e=n.DateEntryField=t.extend({events:{"change input":"sync_changes","change select":"sync_changes"},value_for:function(t){var e;return null!=(e=this.model.get("metadata")[this.options.field_name])?e[t]:void 0},id_for:function(t){return p(this,"inputId")+"_"+t},sync_changes:function(){var t;return this.options.sync_to_model?(t={},_.each(["month","day","year"],function(e){return function(n){return t[n]=e.$("#"+e.id_for(n)).val()}}(this)),this.value(t),this.render()):void 0},_generate_input:function(){var t,e;return e=p(this,"name"),t=$("<div></div>"),t.append(this._generate_month_input(e)),t.append(this._generate_day_input(e)),t.append(this._generate_year_input(e)),$(t.html())},_generate_month_input:function(t){var e,n,o,i,s,a,p,u,l;for(a=parseInt(this.value_for("month")),o=$("<select></select>"),o.attr("class","input_month"),o.attr("name",t+"[month]"),o.attr("id",this.id_for("month")),o.append("<option></option>"),n=i=0,s=r.length;s>i;n=++i)l=r[n],p=l[0],e=l[1],u=$("<option></option>"),u.val(n+1),u.text(p),n+1===a&&u.attr("selected","selected"),u.appendTo(o);return o},_generate_day_input:function(t){var e,n,o,i,s,a,p;if(s=parseInt(this.value_for("month")),e=parseInt(this.value_for("day")),o=$("<select></select>"),o.attr("class","input_day"),o.attr("name",t+"[day]"),o.attr("id",this.id_for("day")),o.append("<option></option>"),!s||isNaN(s))return o;for(n=i=0,p=r[s-1][1];p>=0?p>i:i>p;n=p>=0?++i:--i)a=$("<option></option>"),a.val(n+1),a.text(n+1),n+1===e&&a.attr("selected","selected"),a.appendTo(o);return o},_generate_year_input:function(t){var e;return e=$("<input></input>"),e.attr("class","input_year"),e.attr("name",t+"[year]"),e.attr("type","text"),e.attr("value",this.value_for("year")),e.attr("id",this.id_for("year")),e}}),a=n.TimeEntryField=t.extend({value_for:function(t){var e;return null!=(e=this.model.get("metadata")[this.options.field_name])?e[t]:void 0},id_for:function(t){return p(this,"inputId")+"_"+t},sync_changes:function(){var t;return this.options.sync_to_model?(t={},_.each(["start_hour","end_hour"],function(e){return function(n){return t[n]=e.$("#"+e.id_for(n)).val()}}(this)),this.value(t)):void 0},render:function(){return t.prototype.render.apply(this,arguments),this.$el.addClass("time_entry_container"),this},_generate_input:function(){var t,e;return e=p(this,"name"),t=$("<div></div>"),t.append(this._generate_time_input(e,"start_hour")),t.append(" to "),t.append(this._generate_time_input(e,"end_hour")),$(t.html())},_generate_time_input:function(t,e){var n,o,r,i;for(o=$("<select></select>"),o.attr("class","time_entry"),o.attr("name",t+"["+e+"]"),o.attr("id",this.id_for(e)),o.append("<option></option>"),n=r=0;23>=r;n=++r)i=$("<option></option>"),i.val(n),i.text(0===n?"12 am":12>n?n+" am":12===n?"12 pm":n-12+" pm"),n===this.value_for(e)&&i.attr("selected","selected"),i.appendTo(o);return o}}),i=n.SelectField=t.extend({_generate_input:function(){var t;return t=$("<select></select>"),t.attr("name",p(this,"name")),t.attr("id",p(this,"inputId")),t.attr("class",this.options.input_class||""),this._generate_options(t,p(this,"value")),t},_generate_options:function(t,e){var n;return n=this.options.options||[],_.each(n,function(){return function(n){var o;return o=$("<option></option>"),o.attr("value",n.value),n.value===e&&o.attr("selected","selected"),o.html(n.label||n.value),o.appendTo(t)}}(this))}}),o=n.HiddenField=Backbone.View.extend({className:"hidden",initialize:function(t){return this.value=t.value,this.name=t.name},render:function(){var t;return this.$el.html(""),t=$('<input type="hidden"/>'),t.attr("value",this.value),t.attr("name",this.name),this.$el.append(t),this}}),this.Academia.FormBuilder.Fields={string:t,integer:t,text:s,date:t,timestamp:t,"boolean":t,date_entry:e,time_entry:a,select:i,hidden:o}}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.Academia.PopoverWidget=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.className="popover",n.prototype.wrapper=_.template('<span class="arrow"></span><%= content %>'),n.prototype.events={click:"stopPropagation"},n.prototype.initialize=function(){var t;if(n.__super__.initialize.apply(this,arguments),this.properties||(this.properties={}),!this.options.element)throw"Must pass an element to create a popover widget";return(t=this.options).position||(t.position="right")},n.prototype.render=function(t){var e;return null==t&&(t={}),e=this.template||JST[this.jstTemplate],t.template=function(t){return function(n){return t.wrapper({content:e(n)})}}(this),n.__super__.render.call(this,_.extend(t,this.properties)),_.defer(function(t){return function(){return t.bind_removes()}}(this)),this},n.prototype.render_and_show=function(){return this.render.apply(this,arguments).$el.insertAfter(this.options.container||this.options.element),this.position(),this},n.prototype.position=function(){var t;return this.$el.addClass(this.options.position),"right"===this.options.position?(this.$el.css("left",this.options.element.position().left+this.options.element.width()+10),this.$el.css("top",this.options.element.position().top+parseInt(this.options.element.css("margin-top"))+this.options.element.innerHeight()/2-18)):(t=this.options.element.position().left,t>505?(this.$el.css("left",t-this.$el.width()/1.5),this.$el.addClass("two_thirds")):(this.$el.css("left",t-this.$el.width()/3),this.$el.addClass("one_third")),this.$el.css("top",this.options.element.position().top+23))},n.prototype.bind_removes=function(){return this.remove_on_external_click(),this.remove_on_esc_key_up()},n.prototype.remove_on_external_click=function(){return $(document).click(function(t){return function(){return t.remove()}}(this))},n.prototype.remove_on_esc_key_up=function(){return $(document).keyup(function(t){return function(e){return 27===e.keyCode?t.remove():void 0}}(this))},n.prototype.stopPropagation=function(t){return t.stopPropagation()},n}(Academia.View),this.Academia.PopoverHoverWidget=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.bind_removes=function(){return this.remove_on_mouseout(),this.remove_on_esc_key_up()},n.prototype.remove_on_mouseout=function(){var t,e,n,o;return o=null,t=function(){return function(){return null!=o?(clearTimeout(o),o=null):void 0}}(this),e=function(){return function(){return o||(o=setTimeout(n,200))}}(this),n=function(t){return function(){return t.$el.fadeOut(100,function(){return t.remove(),t.options.element.off("mouseenter"),t.options.element.off("mouseleave")})}}(this),this.$el.on("mouseenter",t),this.$el.on("mouseleave",e),this.options.element.on("mouseenter",t),this.options.element.on("mouseleave",e)},n}(Academia.PopoverWidget)}.call(this),function(){var t,e=function(t,e){function o(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},n={}.hasOwnProperty;window.app=window.app||{},app.models=app.models||{},app.views=app.views||{},app.config=app.config||{},app.config.max_file_size=104857600,app.config.max_file_name_length=125,app.config.accepted_file_types=["pdf","txt","ps","rtf","epub","odt","odp","ods","odg","odf","sxw","sxc","sxi","sxd","doc","ppt","pps","xls","docx","pptx","ppsx","xlsx","csv","tsv"],Academia.BasicUploader=function(n){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,n),o.prototype.template=_.template('<button class="button upload"><%= button_text %></button> <input type=file <%= multiple %>>'),o.prototype.elements={uploader:"input[type=file]",upload_button:"button"},o.prototype.initialize=function(){var t,e;return o.__super__.initialize.apply(this,arguments),(t=this.options).max_size||(t.max_size=app.config.max_file_size),(e=this.options).button_text||(e.button_text="Upload"),req("jquery.fileupload")},o.prototype.render=function(){return o.__super__.render.call(this,{defaults:{button_text:this.options.button_text,multiple:this.options.multiple?"multiple":""}}),this._fix_min_width_and_height(),req("jquery.fileupload",function(e){return function(){var n;return e.$els.uploader.fileupload({url:e.options.url,dataType:"json",formData:{document_domain:$no_document_domain?null:document.domain},dropZone:("function"==typeof(n=e.options).drop_zone?n.drop_zone():void 0)||e.$el,add:function(n,o){return e.options.max_size&&!e._size_ok(o.files[0])||e.options.file_types&&!e._file_type_ok(o.files[0])?void 0:o.files[0].name.length>125?void alert("Sorry, your file name is too long to upload. Please shorten to 125 characters or less."):(o.uploading_file=new t(o),o.submit(),e._record_event("upload_started"),e.trigger("add",o.uploading_file))},progress:function(t,e){return e.uploading_file.trigger("progress",e.progress())},done:function(t,e){return e.uploading_file.trigger("done",e)},fail:function(t,n){return e._record_event("upload_failed",$a.fileUploadErrorString(n),"basic_uploader"),n.uploading_file.trigger("fail",n)}})}}(this))},o.prototype.set_button_html=function(t){return this.$els.upload_button.html(t)},o.prototype.show_spinner=function(){var t;return t=$image_url("loaders/loader-green.gif"),this.set_button_html("<img src='"+t+"'>")},o.prototype.reset_button_html=function(){return this.$els.upload_button.html(this.options.button_text)},o.prototype._fix_min_width_and_height=function(){var t,e;return e=this.$els.upload_button.outerWidth(),t=this.$els.upload_button.outerHeight(),e>0&&t>0?(this.$els.upload_button.css("min-width",e),this.$els.upload_button.css("min-height",t)):setTimeout(function(t){return function(){return t._fix_min_width_and_height()}}(this),500)},o.prototype._size_ok=function(t){return t.size>this.options.max_size?(this.trigger("maximum_file_size_exceeded"),!1):!0},o.prototype._file_type_ok=function(t){var e;return e=_.last(t.name.split(/\./)).toLowerCase(),_.include(this.options.file_types,e)?!0:(this.trigger("invalid_file_type",e),this._report_invalid_extensions_upload_attempt(e),!1)},o.prototype._report_invalid_extensions_upload_attempt=function(t){var e;return e=$r.record_invalid_extension_api_v0_attachments_path({subdomain_param:"api"}),$.post(e,{extensions:[t]})},o}(Academia.View),t=function(){function t(t){this.file=t.files[0]}return _.extend(t.prototype,Backbone.Events),t}(),Academia.Uploader=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="uploader",n.prototype.template=_.template("<div class='errors'> <p class='file_size_warning'>Please choose a smaller file<%= max_size_message %>.</p> <p class='file_type_warning'>Sorry, we don't support that file type.</p> <p class='server_error_warning'> Sorry, something went wrong! Your upload may or may not have finished. Please refresh the page, and try again if the uploaded file does not appear. </p> </div> <div class='upload_container'></div> <div class='progress_bar'> <div class='progress'>&nbsp;</div> </div>"),n.prototype.elements={upload_container:".upload_container",upload_button:"button",upload_progress:".progress",progress_bar:".progress_bar",file_size_warning:".file_size_warning",file_type_warning:".file_type_warning",server_error_warning:".server_error_warning"},n.prototype.initialize=function(){var t;return n.__super__.initialize.apply(this,arguments),"allow_multiple"in this.options||(this.options.allow_multiple=!0),(t=this.options).max_size||(t.max_size=app.config.max_file_size),this._create_uploader()},n.prototype.render=function(){return n.__super__.render.call(this,{defaults:{max_size_message:this._max_size_message(this.options.max_size)}}),this.uploader.setElement(this.$els.upload_container).render(),this},n.prototype.render_and_insert=function(t,e){return null==e&&(e="insertAfter"),this.render(),this.$el[e](t),this},n.prototype.reset=function(){return this.$els.progress_bar.hide(),this.$els.file_size_warning.hide(),this.$els.file_type_warning.hide(),this.$els.server_error_warning.hide(),this.uploader.reset_button_html()},n.prototype.update_upload_progress=function(t){return this.$els.progress_bar.show(),this.$els.upload_progress.css("width",t+"%"),this.uploader.set_button_html(t>=100?"99%":t+"%")},n.prototype.upload_complete=function(){return this.$els.progress_bar.hide(),this.uploader.set_button_html('<i class="fa fa-ok"></i>')},n.prototype._create_uploader=function(){return this.uploader=this.options.uploader||this._create_basic_uploader(),this.uploader.on("add",function(t){return function(e){return t._add(e)}}(this)),this.uploader.on("maximum_file_size_exceeded",function(t){return function(){return t.trigger("maximum_file_size_exceeded"),t.$els.file_size_warning.show()}}(this)),this.uploader.on("invalid_file_type",function(t){return function(e){return t.trigger("invalid_file_type",e),t.$els.file_type_warning.show()}}(this))},n.prototype._add=function(t){return this.options.add&&this.options.add(),this.uploader.show_spinner(),this.options.uploading&&this.options.uploading(this),this.options.disable_during_upload&&$(this.options.disable_during_upload()).attr("disabled","disabled"),t.on("progress",function(t){return function(e){return t._progress(e)}}(this)),t.on("done",function(t){return function(e){return t._done(e)}}(this)),t.on("fail",function(t){return function(){return t._failure()}}(this))},n.prototype._progress=function(t){var e;return e=parseInt(t.loaded/t.total*100,10),this.update_upload_progress(e)},n.prototype._done=function(t){return this.upload_complete(),this.options.done&&this.options.done(t,this),this.options.disable_during_upload&&$(this.options.disable_during_upload()).removeAttr("disabled"),this.options.allow_multiple?setTimeout(function(t){return function(){return t.reset()}}(this),2e3):void 0},n.prototype._failure=function(){return this.reset(),this.$els.server_error_warning.show()},n.prototype._create_basic_uploader=function(){return new Academia.BasicUploader(_.pick(this.options,"url","button_text","multiple","max_size","file_types"))},n.prototype._max_size_message=function(t){return" (less than "+window.$h.humanFileSize(t)+")"},n}(Academia.View),Academia.BasicUploader.WorkAttachments=function(t){function n(t){var e;this.work_id=t.work_id,delete t.work_id,this.source=t.source,e={multiple:!0,max_size:app.config.max_file_size,file_types:app.config.accepted_file_types,url:this._attachment_url()},t=_.extend({},e,t),n.__super__.constructor.call(this,t)}return e(n,t),n.prototype._attachment_url=function(){var t;return t={work_id:this.work_id,subdomain_param:"api"},this.source&&(t.source=this.source),$r.api_v0_attachments_path(t)},n}(Academia.BasicUploader),app.views.Uploader_v2=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.initialize=function(t){return this.max_file_size=t.max_file_size||app.config.max_file_size,this.max_file_name_length=t.max_file_name_length||app.config.max_file_name_length,this.accepted_file_types=t.accepted_file_types||app.config.accepted_file_types,this.notifier=t.event_recorder,req("jquery.fileupload",function(e){return function(){return t.input.fileupload({url:t.url||e._attachment_url(t.work_id,t.source),dataType:"json",formData:{document_domain:$no_document_domain?null:document.domain},dropZone:t.dropZone,add:function(t,n){var o,r;return o=n.files[0],(r=e._validate_file(o))?void e.trigger("error",r,o):(n.submit(),e._record_event("upload_started"),e.trigger("add",o))},progress:function(t,n){var o,r;return r=n.files[0],null!=(o=r.model)&&o.trigger("progress",n.progress()),e.trigger("progress",n.progress())},done:function(t,n){var o,r;return r=n.files[0],null!=(o=r.model)&&o.trigger("done",n),e.trigger("done",n)},fail:function(t,n){var o,r;return r=n.files[0],null!=(o=r.model)&&o.trigger("fail",n),e.trigger("fail",n),e._record_event("upload_failed",$a.fileUploadErrorString(n),"v2_uploader")}})}}(this))},n.prototype._validate_file=function(t){var e;return e=_.compact([this._validate_file_size(t),this._validate_file_type(t),this._validate_file_name_length(t)]),0!==e.length?e:void 0},n.prototype._validate_file_size=function(t){return t.size>this.max_file_size?{file_size:t.size}:void 0},n.prototype._validate_file_name_length=function(t){return t.name.length>this.max_file_name_length?{file_name_length:t.name.length}:void 0},n.prototype._validate_file_type=function(t){var e;return e=_.last(t.name.split(/\./)).toLowerCase(),_.include(this.accepted_file_types,e)?void 0:{file_type:e}},n.prototype._attachment_url=function(t,e){var n;return n={work_id:t,subdomain_param:"api"},e&&(n.source=e),$r.api_v0_attachments_path(n)},n.prototype._record_event=function(t,e,n){return("undefined"!=typeof $a&&null!==$a?$a.log:void 0)&&$a.log(t),null!=this.notifier?this.notifier.notify({event:t,user_id:$current_user.id,source:n||this.options.source,error:e,user_time:parseInt((new Date).getTime()/1e3)}):void 0},n}(Backbone.View)}.call(this),function(){this.NewProfile||(this.NewProfile=_.extend({},Backbone.Events)),NewProfile.sections=function(){var t;return t=new Works.Sections,NewProfile.sections=function(){return t},t}}.call(this),function(){this.JST||(this.JST={}),this.JST["new_profile/templates/add_section_popover"]=function(){var t=[];return t.push('<form method="post"><div class="input section_name_picker"></div> <a href="#" class="button blue">Add</a><div style="display: none" class="error_messages"></div></form>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["new_profile/templates/add_social_profiles_popover"]=function(){var t=[];return t.push('<div id="social_profiles_popover"><h3>Social Profiles<span>(Facebook, Twitter, etc.)</span></h3><ul id="social_profiles"><li id="empty_social_profile" style="display: none">Enter a new social profile link below.</li></ul><p id="social_profiles_validation"></p><div class="input"><div class="clearfix"><select id="social-networks"><option value="Facebook">Facebook</option><option value="Google Scholar">Google Scholar</option><option value="Twitter">Twitter</option><option value="Linkedin">Linkedin</option><option value="Flickr">Flickr</option><option value="Google">Google+</option><option value="Instagram">Instagram</option><option value="Quora">Quora</option><option value="Skype">Skype</option><option value="Tumblr">Tumblr</option><option value="WordPress">WordPress</option><option value="about.me">about.me</option><option value="Homepage">Homepage</option><option value="Other">Other</option></select><div class="inputs"><input type="text" name="name" value="" placeholder="Link Description e.g. My Research Group" style="display:none" class="description"/><input type="text" name="link" value="" placeholder="Enter URL or Username"/></div></div><button type="button" name="add" class="add_sp add button blue">Add</button></div></div>'),t.join("")
}}.call(this),function(){this.JST||(this.JST={}),this.JST["new_profile/templates/coauthor_tag_list"]=function(){var t=[];return t.push('<div class="bootstrap select2-no-default-pills"><input id="authors-input" type="hidden" placeholder="add co-authors..." class="work-creator-tag-input"/><div class="work-creator-tag-list panel-body bg-off-white margin-bottom-2x"><ul id="authors-list" class="list-pills list-inline"></ul></div></div>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["new_profile/templates/connect_prompt"]=function(){var t=[];return t.push('<div class="bootstrap"><div class="profile-center-prompt panel panel-flat bg-gray-lightest padding-top-12x padding-bottom-12x solid-gray-border"><i class="attachment-icon fa fa-times fa-2x close close-profile-prompt"></i><div class="panel-heading text-center"><div> <i class="attachment-icon fa fa-envelope-o fa-5x"></i></div><div class="h4 text-bold">Get more followers </div><div class="h4">Identify friends & colleagues who can see updates on your research </div><div> <button type="button" class="btn btn-success add-google-connect"><span>IMPORT CONTACTS</span></button></div></div></div></div>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["new_profile/templates/research_interest_list"]=function(t){var e,n=[],o=t||{};return function(t,o,r){n.push("<!-- locals: before_fold, after_fold--><!-- slim: app/views/components/_research_interest_list.html.slim-->"),n.push(o.length>0?(null==(e=r.join(", ")+", ")?"":e)+'<span class="and_n_more"> and <a href="#" class="more_link">'+jade.escape(null==(e=o.length)?"":e)+' more</a></span><span class="hidden invisible_research_interests">'+(null==(e=t.to_sentence(o))?"":e)+"</span>":r.length>0?null==(e=t.to_sentence(r))?"":e:"<em>none</em>"),n.push('<a href="#" class="owner_only edit_mode_only edit_link">edit</a>')}.call(this,"$h"in o?o.$h:"undefined"!=typeof $h?$h:void 0,"after_fold"in o?o.after_fold:"undefined"!=typeof after_fold?after_fold:void 0,"before_fold"in o?o.before_fold:"undefined"!=typeof before_fold?before_fold:void 0),n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["new_profile/templates/search_research_interests"]=function(){var t=[];return t.push('<div id="list_view"></div><p class="info_text">Adding research interests helps us show you more relevant people and papers.</p>'),t.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["new_profile/templates/section_link"]=function(t){var e,n=[],o=t||{};return function(t,o,r,i,s){var a=t.new_profile_works_path({page_name:o.page_name,section_name:i});n.push("<a"+jade.attr("href",a,!0,!1)+' class="menu_item pjax"><div class="section_name_and_count"><span class="section_name">'+jade.escape(null==(e=r)?"":e)+'</span><span class="section_count">'+jade.escape(null==(e=s)?"":e)+'</span></div><span class="handle owner_only"><i class="fa icon-dark fa-pencil rename"></i><i class="fa icon-dark fa-bars order"></i></span></a><div class="rename_section input hidden"><input name="name" type="text"/><a href="#" class="button blue">OK</a></div>')}.call(this,"$r"in o?o.$r:"undefined"!=typeof $r?$r:void 0,"$viewed_user"in o?o.$viewed_user:"undefined"!=typeof $viewed_user?$viewed_user:void 0,"name"in o?o.name:"undefined"!=typeof name?name:void 0,"public_id"in o?o.public_id:"undefined"!=typeof public_id?public_id:void 0,"works_count"in o?o.works_count:"undefined"!=typeof works_count?works_count:void 0),n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["new_profile/templates/send_message_popover"]=function(t){var e,n=[],o=t||{};return function(t,o){n.push('<h3><i class="fa icon-dark fa-pencil-square-o"></i> Send '+jade.escape(null==(e=o.first_name)?"":e)+' a message:</h3><form id="send_message_form"><input type="hidden" name="message[sender_id]"'+jade.attr("value",t.id,!0,!1)+'/><input type="hidden" name="message[recipient_id]"'+jade.attr("value",o.id,!0,!1)+'/><div class="input"><textarea cols="50" rows="4" name="message[body]" class="autoexpand_on_focus"></textarea></div><a style="float: right" class="button blue">Send</a></form>')}.call(this,"$current_user"in o?o.$current_user:"undefined"!=typeof $current_user?$current_user:void 0,"$viewed_user"in o?o.$viewed_user:"undefined"!=typeof $viewed_user?$viewed_user:void 0),n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["new_profile/templates/social_profile"]=function(t){var e,n=[],o=t||{};return function(t,o,r,i){n.push('<div style="float: right"><a href="#" class="remove">remove</a></div><a'+jade.attr("href",o,!0,!1)+jade.attr("title",r,!0,!1)+jade.attr("style",i,!0,!1)+jade.cls([t+" js-tooltip tooltip"],[!0])+"></a><a"+jade.attr("href",o,!0,!1)+">"+jade.escape(null==(e=r)?"":e)+"</a>")}.call(this,"html_class"in o?o.html_class:"undefined"!=typeof html_class?html_class:void 0,"link"in o?o.link:"undefined"!=typeof link?link:void 0,"name"in o?o.name:"undefined"!=typeof name?name:void 0,"style"in o?o.style:"undefined"!=typeof style?style:void 0),n.join("")}}.call(this),function(){this.JST||(this.JST={}),this.JST["new_profile/templates/upload_photo"]=function(t){var e=[],n=t||{};return function(t){e.push('<div class="clearfix"><p id="upload-photo-text" class="main-text">Upload a new photo:</p></div>'),t||e.push('<p class="subtext">Or,<a id="remove-photo-link" href="#">remove current photo</a></p>')}.call(this,"profilePictureGenerated"in n?n.profilePictureGenerated:"undefined"!=typeof profilePictureGenerated?profilePictureGenerated:void 0),e.join("")}}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.Details=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.modelName="details",n.prototype.routeKey="api_v0_user_details",n.prototype.urlArgs=function(){return{user_id:this.id}},n.prototype.emailVisible=function(){return!!this.get("public_email")},n.prototype.addressVisible=function(){return!!this.get("address")},n.prototype.phoneVisible=function(){return!!this.get("phone1")},n.prototype.toJSON=function(){return this.changes_since_last_sync()},n}(Academia.Model)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.SocialProfile=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.modelName="social_profile",n.prototype.routeKey="api_v0_user_social_profile",n.prototype.urlArgs=function(){return{user_id:$current_user.id}},n.prototype.jstTemplate="new_profile/views/social_profile",n.prototype.networks={instagram:{linkTemplate:"http://instagram.com/%s"},facebook:{linkTemplate:"http://facebook.com/%s"},flickr:{linkTemplate:"http://www.flickr.com/people/%s"},"about.me":{linkTemplate:"http://about.me/%s"},wordpress:{linkTemplate:"http://%s.wordpress.com"},google:{},linkedin:{linkTemplate:"http://www.linkedin.com/in/%s"},quora:{linkTemplate:"http://www.quora.com/%s"},skype:{linkTemplate:"skype:%s?userinfo",iconTemplate:"http://mystatus.skype.com/smallicon/%s"},tumblr:{linkTemplate:"http://%s.tumblr.com"},twitter:{linkTemplate:"http://twitter.com/%s"},other:{linkTemplate:"http://%s"}},n.prototype.url_regexp=/^https?:\/\/.*/,n.prototype.find_network=function(){return _.find(_.keys(this.networks),function(t){return function(e){return-1!==t.get("link").indexOf(e)}}(this))},n.prototype.initialize=function(){var t,e,o,r,i,s;return(t=this.attributes).network||(t.network=this.find_network()||""),i=this.networks[this.attributes.network.toLowerCase()]||{},null!=this.attributes.link&&""!==this.attributes.link&&(this.url_regexp.test(this.attributes.link)||!/^skype:.*/.test(this.attributes.link)&&i.linkTemplate&&(this.attributes.link=i.linkTemplate.replace("%s",this.attributes.link))),i.iconTemplate&&(r=new RegExp("^"+this.escape_regex(i.linkTemplate).replace("%s","(.*?)")),s=this.attributes.link.match(r)[1],this.attributes.icon=i.iconTemplate.replace("%s",s)),this.url_regexp.test(this.attributes.link)&&(o=document.createElement("a"),o.href=this.attributes.link,this.attributes.link_domain=o.hostname,(e=this.attributes).icon||(e.icon="http://www.google.com/s2/u/0/favicons?domain="+this.get("link_domain"))),this.on("remove",function(){return this.destroy()}),n.__super__.initialize.apply(this,arguments)},n.prototype.validate=function(t){var e;return e=[],""===t.name&&e.push("You're missing the name."),""===t.link&&e.push("You're missing the link."),t.link&&!this.link_is_okay(t.link)&&e.push("Looks like your link isn't a valid URL."),_.isEmpty(e)?!1:e},n.prototype.link_is_okay=function(t){return this.url_regexp.test(t)||/^skype:.*/.test(t)},n.prototype.escape_regex=function(t){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")},n}(Academia.Model)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.AddCVPopover=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.template=function(){return"<h3>Add Your CV</h3>"},n.prototype.initialize=function(){var t;return n.__super__.initialize.apply(this,arguments),t=$r.new_profile_curriculum_vitae_path({page_name:$viewed_user.page_name}),this.uploader=new Academia.Uploader({max_size:52428800,file_types:["pdf","txt","ps","rtf","epub","odt","odp","ods","odg","odf","sxw","sxc","sxi","sxd","doc","ppt","pps","xls","docx","pptx","ppsx","xlsx"],url:t,done:function(e){return function(){return e.remove(),document.location=t,$("a#add_cv_link").hide(),$("li#cv").show()}}(this)})},n.prototype.render=function(){return n.__super__.render.apply(this,arguments),this.uploader.render_and_insert(this.$("h3")),this},n}(Academia.PopoverWidget)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;NewProfile.AddSectionPopover=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.template=function(){return"<h3>Add New Section</h3>"},n.prototype.events={click:"stopPropagation"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.view=new NewProfile.AddSectionView({success:function(t,e){var n;return n=$("meta[name=csrf-token]").attr("content"),t.$els.form.prepend("<input type='hidden' name='authenticity_token' value='"+n+"'>"),t.$els.form.attr("action",$r.new_profile_works_path({page_name:$viewed_user.page_name,section_name:e.section.public_id})),t.$els.form.off("submit"),t.$els.form.submit()}})},n.prototype.render=function(){return n.__super__.render.apply(this,arguments),this.view.render().$el.appendTo(this.$el),this},n}(Academia.PopoverWidget)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;NewProfile.AddSectionView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.jstTemplate="new_profile/templates/add_section_popover",n.prototype.elements={form:"form",picker:".section_name_picker",errors:".error_messages",new_section_input_add_link:"a.button",new_section_input_box:".section_name_picker input"},n.prototype.events={"click %new_section_input_add_link":"handle_button_click"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.picker=new NewProfile.SectionNamePickerView},n.prototype.render=function(){return n.__super__.render.apply(this,arguments),this.picker.setElement(this.$els.picker).render(),this.$els.form.on("submit",function(t){return function(e){return t.submit(e)}}(this)),this},n.prototype.handle_button_click=function(t){return t.stopPropagation(),t.preventDefault(),this.$els.form.submit()},n.prototype.submit=function(t){var e,n;return t.stopPropagation(),t.preventDefault(),e=this.picker.val(),n=$r.validate_api_v0_sections_path({subdomain_param:"api"}),$.ajax({type:"POST",url:n,data:{name:e},success:function(t){return function(e){return t.handle_success(e)}}(this),error:function(t){return function(e){return t.handle_error(e)}}(this)})},n.prototype.handle_success=function(t){return this.options.success.call(this,this,t)},n.prototype.handle_error=function(t){var e,n,o;try{if(n=JSON.parse(t.responseText).errors,o=n.name[0])return this.$els.errors.text("Section name "+o).show();throw"oops"}catch(r){return e=r,alert("Sorry, there's been an error. Please try again.")}},n}(Academia.View)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty,n=[].slice;NewProfile.AddSocialProfilesPopover=function(e){function o(){return o.__super__.constructor.apply(this,arguments)}return t(o,e),o.prototype.jstTemplate="new_profile/templates/add_social_profiles_popover",o.prototype.events={"keyup input[name=link]":"submit_on_enter","click button[name=add]":"submit_on_add",click:"stopPropagation"},o.prototype.initialize=function(){var t;return(t=this.constructor.prototype).collection||(t.collection=new NewProfile.SocialProfiles),this.collection.on("add",this.addOne,this),this.collection.on("reset",this.addAll,this),this.collection.on("remove",this.zeroCase,this),this.views=[],this.properties={collection:this.collection}},o.prototype.addOne=function(t){var e;return this.zeroCase(),e=new NewProfile.SocialProfileView({model:t}),this.views.push(e),this.$("#social_profiles").append(e.render().el)},o.prototype.addAll=function(){return this.zeroCase(),this.collection.each(this.addOne.bind(this))},o.prototype.zeroCase=function(){return 0===this.collection.length?this.$("#empty_social_profile").show():this.$("#empty_social_profile").hide()},o.prototype.inputs=function(){return{name:this.$("input[name=name]"),link:this.$("input[name=link]"),opt:this.$("option:selected")}},o.prototype.submit_on_enter=function(t){return 13!==t.keyCode?!1:(this.submit(),!1)},o.prototype.submit_on_add=function(){return this.submit(),!1},o.prototype.submit=function(){var t,e;return t=this.inputs(),e=new NewProfile.SocialProfile({name:t.name.val(),link:t.link.val(),network:t.opt.val()}),e.isValid()?(this.collection.add(e),e.save(null,{validate:!1,success:function(){return t.link.val(""),t.link.blur()}})):$("#social_profiles_validation").html(e.validationError.join("<br>")).fadeIn(500).delay(2e3).fadeOut(500)},o.prototype.supersend=function(){var t,e;return e=arguments[0],t=2<=arguments.length?n.call(arguments,1):[],this.constructor.__super__[e].apply(this,t)},o.prototype.render=function(){var t;return o.__super__.render.apply(this,arguments),t=function(t){return function(e){var n,o;return n=t.inputs(),o=$(e.target).find("option:selected"),"Other"===o.val()?(n.link.attr("placeholder","Enter URL"),n.name.val("").show().focus()):"Homepage"===o.val()||"Google Scholar"===o.val()||"Google"===o.val()?(n.link.attr("placeholder","Enter URL").focus(),n.name.val(o.val()).hide()):(n.link.attr("placeholder","Enter URL or Username").focus(),n.name.val(o.val()).hide())}}(this),this.$("select#social-networks").change(t),this.addAll.apply(this),t({target:this.$("select#social-networks")}),this},o.prototype.render_and_show=function(){return this.collection.fetched?o.__super__.render_and_show.apply(this,arguments):(this.collection.fetch({silent:!0,success:function(t){return function(e){return e.fetched=!0,t.supersend("render_and_show")}}(this)}),this)},o.prototype.remove=function(){return this.collection.off(null,null,this),_.each(this.views,function(t){return t.remove()}),o.__super__.remove.apply(this,arguments)},o}(Academia.PopoverWidget)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.CoauthorTagListView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.template="new_profile/templates/coauthor_tag_list",n.prototype.render=function(){return this.$el.html(JST[this.template]),this.postRender(),this},n.prototype.postRender=function(){var t,e;return this.ui={$authorsInput:this.$("#authors-input"),$authorsList:this.$("#authors-list")},null!=(t=this.coauthorPicker)&&t.remove(),this.coauthorPicker=new Works.CoauthorPicker({collection:this.collection,searchInput:this.ui.$authorsInput,instantSave:!0}),null!=(e=this.coauthorsView)&&e.remove(),this.coauthorsView=new Works.CoauthorTagsView({el:this.ui.$authorsList,collection:this.collection}),this.coauthorsView.render(),this},n}(Backbone.View)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.ConnectPrompt=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.template="new_profile/templates/connect_prompt",n.prototype.events={"click .add-google-connect":"gotoConnectPage","click .close-profile-prompt":"close"},n.prototype.initialize=function(t){return this.sectionName=t.section},n.prototype.render=function(){return this.$el.html(JST[this.template]()),heap.track("Profile Google Connnect: View Prompt",{}),this},n.prototype.gotoConnectPage=function(){return window.location="/google_connect"},n.prototype.close=function(){return heap.track("Profile Google Connnect: Close Prompt",{}),$.post("/add_closed_popup",{popup:this.options.popup_name},function(t){return function(){return t.remove()}}(this))},n}(Backbone.View)}.call(this),function(){var t,e=function(t,e){function o(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},n={}.hasOwnProperty;this.NewProfile.EditContactDetailsPopover=function(n){function o(){return o.__super__.constructor.apply(this,arguments)}return e(o,n),o.prototype.template=function(){return"<h3>Update contact details</h3>"},o.prototype.elements={header:"h3",cancel_link:"a.cancel_link"},o.prototype.events={click:"stopPropagation","click %cancel_link":"cancel_clicked"},o.prototype.initialize=function(){return this.details=new NewProfile.Details({id:$current_user.id})},o.prototype.render=function(){return o.__super__.render.apply(this,arguments),this.details.fetch({success:function(e){return function(){return e.form=new t({model:e.details,include_cancel_and_submit:!0,success:function(){return e.remove(),e.renderProfileAddresses()}}),e.form.render().$el.insertAfter(e.$els.header)}}(this)}),this},o.prototype.renderProfileAddresses=function(){return $("#addresses").html(""),$("#addresses").append("<ul></ul>"),this.details.emailVisible()&&($("#addresses ul").append("<label>Email</label><li><a>"+this.details.get("public_email")+"</a></li>"),$("#addresses ul li a").attr("href","mailto:"+this.details.get("public_email"))),this.details.addressVisible()&&$("#addresses ul").append("<label>Address</label><li>"+this.details.get("address")+"</li>"),this.details.phoneVisible()?$("#addresses ul").append("<label>Phone</label><li>"+this.details.get("phone1")+"</li>"):void 0},o.prototype.cancel_clicked=function(t){return t.preventDefault(),this.remove()},o}(Academia.PopoverWidget),t=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.className="contact_details_form",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.add_field("string",{name:"public_email",input_class:"medium",label:"Email"}),this.add_field("text",{name:"address",input_class:"medium",label:"Address"}),this.add_field("string",{name:"phone1",input_class:"medium",label:"Phone"})},n}(Academia.FormBuilder)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.LinkToPopover=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.events={click:"show_popover"},n.prototype.initialize=function(t){if(!t.popover)throw"Must pass popover";return t.position||(t.position="right"),n.__super__.initialize.apply(this,arguments)},n.prototype.show_popover=function(t){var e;return t.preventDefault(),e=new NewProfile[this.options.popover]({element:$(t.currentTarget),position:this.options.position}),e.render_and_show()},n}(Academia.StaticView)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;NewProfile.OrderSectionsPopover=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.template=function(){return'<p>Use the <i class="fa icon-dark fa-bars"></i> handles to reorder sections. The order will save automatically.</p>'},n.prototype.render=function(){return this.$el.addClass("order_section_popover"),n.__super__.render.apply(this,arguments),this},n}(Academia.PopoverHoverWidget)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.OrderWorksPopover=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.events={click:"stopPropagation","click button":"done"},n.prototype.template=_.template("<h3>Organize your papers</h3> <p> Use the <i class='fa icon-dark fa-bars'></i> handles to drag your paper up or down. </p> <br> <p> Alternatively you can use the <i class='fa icon-dark fa-arrow-up'></i>, <i class='fa icon-dark fa-chevron-up'></i>, <i class='fa icon-dark fa-chevron-down'></i> and <i class='fa icon-dark fa-arrow-down'></i>. </p> <br> <p> The order will save automatically. </p> <br/> <button class='button blue'>Done</button>"),n.prototype.render=function(){return this.$el.addClass("order_works_popover"),n.__super__.render.apply(this,arguments),this},n.prototype.done=function(){return this.trigger("remove"),this.remove()},n.prototype.bind_removes=function(){},n}(Academia.PopoverWidget)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.PlaceholderPopover=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.template=function(){return"<img src='"+$image_url("work_placeholder.jpeg")+"' width=200 height=200>"},n}(Academia.PopoverWidget)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.PopUp=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.template=function(){return"<div class='action close'><i class='fa fa-times'></i></div> <div class='action minimize'><i class='fa fa-minus'></i></div> <h1 class='title'></h1> <div class='content'></div>"},n.prototype.elements={title:"h1.title",close_button:".close",minimize_button:".minimize",content:".content"},n.prototype.events={"click %close_button":"_close","click %minimize_button":"_minimize","click %title":"_maximize"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this._handle_resize(),$(".pop_ups").append(this.render().$el),this},n.prototype.render=function(){return n.__super__.render.apply(this,arguments),this.$el.addClass("pop_up"),this.$els.title.html(this.options.title),this.$els.content.html(this.options.header),this._render_view(),this._resize(),this},n.prototype._render_view=function(){var t;return _.isFunction(this.options.view)?(t=this.options.view(),this.$els.content.append(t.render().$el),t.popup=this):this.$els.content.append(this.options.view)},n.prototype._handle_resize=function(){return this._debounced_resize=_.debounce(function(t){return function(){return t._resize()}}(this),100),$(window).on("resize",function(t){return function(){return t._debounced_resize()}}(this))},n.prototype._resize=function(){var t;return t=.8*$(window).height(),t-=40,this.$els.content.css("max-height",t)},n.prototype._minimize=function(){return this.$el.addClass("minimized")},n.prototype._maximize=function(){return this.$el.removeClass("minimized")},n.prototype._close=function(){return this.remove(),null==this.options.remember_close||this.options.remember_close?$.post("/add_closed_popup",{popup:this.options.popup_name}):void 0},n}(Academia.View)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.ResearchInterestListView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.className="profile_research_interest_list",n.prototype.elements={research_interest_links:"a.research_interest_link",more_link:"a.more_link",edit_link:"a.edit_link",done_link:"a.done_link","delete":"span.delete"},n.prototype.events={"click %edit_link":"handle_edit_click","click %done_link":"handle_done_click","click %delete":"handle_delete_click"},n.prototype.jstTemplate="new_profile/templates/research_interest_list",n.prototype.before_fold=6,n.prototype.initialize=function(t){var e,o;return n.__super__.initialize.apply(this,arguments),null!=this.collection?(t.target_type=this.collection.options.target_type,t.target_id=this.collection.options.target_id):(this.collection=new NewProfile.Taggings([],{tag_type:"ResearchInterest",target_type:t.target_type,target_id:t.target_id,tag_source:t.tag_source}),o=function(){var t,n,o,r;for(o=this.$els.research_interest_links,r=[],t=0,n=o.length;n>t;t++)e=o[t],r.push($(e));return r}.call(this),this.collection.add(_.map(o,function(){return function(t){return{url:t.attr("href"),id:parseInt(t.data("id")),name:t.text()}}}(this))))},n.prototype.expand=function(){return this.$els.more_link.trigger("show_more")},n.prototype.collapse=function(){return this.leave_edit_mode()},n.prototype.handle_edit_click=function(t){return t.preventDefault(),this.edit_mode()},n.prototype.handle_done_click=function(t){return t.preventDefault(),this.leave_edit_mode()},n.prototype.handle_delete_click=function(t){return t.preventDefault(),this.remove_tag($(t.currentTarget).parent())},n.prototype.handle_sorting_update=function(t){var e,n,o,r;return e=this.$("div.ui-sortable"),n=e.sortable("toArray",{attribute:"data-id"}),r=null!=t?t.data("id"):void 0,o=1e3,this.collection.comparator=function(t){var e;return e=_.indexOf(n,t.id.toString()),-1===e?o+=1:e},this.collection.sort(),this.collection.persist_ordering(r)},n.prototype.render=function(){var t,e,o;return o=this.collection.map(function(t){return function(e){return t._generate_link(e)}}(this)),this.before_fold&&o.length>this.before_fold+1?(e=o.splice(0,this.before_fold),t=o):(e=o,t=[]),n.__super__.render.call(this,{override:{before_fold:e,after_fold:t}}),this.$el.more_link(".more_link",".and_n_more",".invisible_research_interests"),this.options.always_editable&&this.edit_mode(),this},n.prototype.edit_mode=function(){var t,e,n;return this.$el.empty(),this.$el.addClass("edit_mode"),t=$("<div/>"),e=this.collection.map(function(t){return function(e){return t._generate_link(e,{editable:!0})}}(this)),n=function(n){return function(){var o;return t.append(e.join("")),o=new NewProfile.ResearchInterestPickerView({collection:n.collection}),o.on("research_interest_chosen",function(t){return n.add_tag(t)}),t.append(o.render().$el),n.$el.append(t),n.options.always_editable||n.$el.append('<a href="#" class="done_link">done</a>'),o.focus(),n._find_elements()}}(this),this.options.sortable?(n(),t.sortable({placeholder:"ui-state-highlight",containment:"parent",items:"a.research_interest_link",forcePlaceholderSize:!0,cursorAt:{left:5},update:function(t){return function(e,n){return t.handle_sorting_update(null!=n?n.item:void 0)}}(this)})):n()},n.prototype.leave_edit_mode=function(){return this.$el.removeClass("edit_mode"),this.render()},n.prototype.add_tag=function(t){return this._add_fake_ri(t.name),this.options.target_id?this.collection.tag(t,function(t){return function(){return t.edit_mode()}}(this)):(this.collection.add(t),this.edit_mode())},n.prototype.remove_tag=function(t){var e;return this.options.target_id?(e=parseInt(t.data("id")),this.collection.untag({id:e},function(t){return function(){return t.edit_mode()}}(this))):(this.collection.remove_by_cid(t.data("cid")),this.edit_mode())},n.prototype._add_fake_ri=function(t){var e;return e=$('<a class="research_interest_link stff">STFF </a>'),e.text(t),e.append('&nbsp;<span class="delete fa-spin"><i class="fa fa-times"></i></span>'),$(".research_interest_picker").parent().append(e)},n.prototype._generate_link=function(t,e){var n;return null==e&&(e={}),n=$('<a class="research_interest_link"></a>'),n.attr("data-id",t.id),n.attr("data-cid",t.cid),n.text(t.get("name")),e.editable?n.append('&nbsp;<span class="delete"><i class="fa fa-times"></i></span>'):n.attr("href",t.get("url")),$("<div></div>").append(n).html()},n}(Academia.View)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.ResearchInterestPickerView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.className="input research_interest_picker select2-no-default-pills",n.prototype.template=function(){return"<input type='text' placeholder='Find a Research Interest'></input>"},n.prototype.elements={input:"input"},n.prototype.focus=function(){return this.$els.input.focus()},n.prototype.render=function(){var t;return null!=(t=this.search)&&t.remove(),n.__super__.render.apply(this,arguments),this.search=new Search.ResearchInterestSearch({el:this.$els.input,collection:this.collection,useExistingInput:!0}),this.listenTo(this.search,"item-selected",function(t){return function(e){return t.trigger("research_interest_chosen",e.toJSON())}}(this)),this.listenTo(this.collection,"add",function(t){return function(e){return e.has("id")?void 0:t.trigger("research_interest_chosen",e.toJSON())}}(this)),this},n}(Academia.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=function(t,e){function o(){this.constructor=t}for(var r in e)n.call(e,r)&&(t[r]=e[r]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},n={}.hasOwnProperty;NewProfile.SectionLink=function(n){function o(e){this.commit_rename=t(this.commit_rename,this),this.end_rename=t(this.end_rename,this),this.handle_esc_press=t(this.handle_esc_press,this),this.id=e.model.left_menu_id(),o.__super__.constructor.apply(this,arguments),this.model.on("change:name change:works_count",function(t){return function(){return t.render()}}(this))}return e(o,n),o.prototype.tagName="li",o.prototype.className="left-menu-item",o.prototype.jstTemplate="new_profile/templates/section_link",o.prototype.elements={link:"a.menu_item",edit:"div.rename_section",name_input:"input[type='text']",name_submit:"a.button"},o.prototype.events={"click i.rename":"handle_rename_click","click %name_submit":"handle_submit_click","keyup %edit":"handle_keyup","click %edit":"stopPropagation"},o.prototype.render=function(){return o.__super__.render.apply(this,arguments),this.$el.attr("data-section-id",this.model.get("id")),this},o.prototype.handle_rename_click=function(t){return this.stopPropagation(t),this.start_rename()},o.prototype.handle_submit_click=function(t){return this.stopPropagation(t),this.commit_rename()},o.prototype.handle_keyup=function(t){return 13===t.keyCode?(this.stopPropagation(t),this.commit_rename()):void 0},o.prototype.handle_esc_press=function(t){return 27===t.keyCode?this.end_rename():void 0
},o.prototype.start_rename=function(){return $a.log("start_rename"),$(document).on("click",this.end_rename),$(document).on("keyup",this.handle_esc_press),this.$els.link.hide(),this.$els.edit.show(),this.$els.name_input.val(this.model.get("name")).focus()},o.prototype.end_rename=function(){return $a.log("end_rename"),$(document).off("click",this.end_rename),$(document).off("keyup",this.handle_esc_press),this.render()},o.prototype.commit_rename=function(){var t;return t=this.$els.name_input.val(),t?this.model.save({name:t},{success:function(t){return function(){return t.end_rename()}}(this),error:function(e){return function(n,o){var r,i,s;return r=null!=(i=JSON.parse(o.responseText).errors)&&null!=(s=i.name)?s[0]:void 0,$w.flash("Sorry, this name "+(r||"is invalid"),{nextTo:e.$el}),e.model.revert(),e.start_rename(),e.$els.name_input.val(t)}}(this)}):this.end_rename()},o.prototype.stopPropagation=function(t){return t.preventDefault(),t.stopPropagation()},o}(Academia.View)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;NewProfile.SectionNamePickerView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.className="input section_name_picker",n.prototype.template=function(){return'<input name="name" type="text"></input>'},n.prototype.elements={input:"input"},n.prototype.render=function(){var t;return n.__super__.render.apply(this,arguments),this.$els.input.select2({placeholder:"Enter a section name",data:function(){var e,n,o,r;for(o=NewProfile.sections().suggested(),r=[],e=0,n=o.length;n>e;e++)t=o[e],r.push({id:t,text:t});return r}(),width:"200px",createSearchChoice:function(t){return{id:t,text:t}}}),this},n.prototype.val=function(){return this.$els.input.select2("val")},n}(Academia.View)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;NewProfile.SectionNavigation=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.events={"mouseover i.order":"ordering_handle_hovered"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.init_sortable_sections(),this.collection.on("add remove",function(t){return function(){return t.render()}}(this)),this.render()},n.prototype.init_sortable_sections=function(){return this.$el.sortable({items:"li",containment:"parent",handle:".handle",update:function(t){return function(e,n){var o,r,i;return o=null!=n&&null!=(r=n.item)?r.data("section-id"):void 0,i=t.$el.sortable("toArray",{attribute:"data-section-id"}),$.ajax({url:$r.set_order_api_v0_sections_path({subdomain_param:"api"}),type:"POST",data:{order:i,moved:o,_method:"PUT"},success:function(){return document.location.pathname==="/"+$viewed_user.page_name?$(".name-and-affiliation h1 a").click():void 0},error:function(){return location.reload()}})}}(this)})},n.prototype.ordering_handle_hovered=function(t){return t.preventDefault(),null==this.ordering_popover?(this.ordering_popover=new NewProfile.OrderSectionsPopover({container:this.$el,element:$(t.target),position:"right"}),this.ordering_popover.render_and_show(),this.ordering_popover.on("remove",function(t){return function(){return t.ordering_popover=null}}(this))):void 0},n.prototype.render=function(){var t;return this.$el.empty(),this.collection.size()>0?this.collection.each(function(t){return function(e){var n;return n=new NewProfile.SectionLink({model:e}),t.$el.append(n.render().$el)}}(this)):(t=new NewProfile.SectionLink({model:new Works.Section}),this.$el.append(t.render().$el)),"function"==typeof highlight_left_menu&&highlight_left_menu(),this},n}(Academia.View)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.SendMessagePopover=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.jstTemplate="new_profile/templates/send_message_popover",n.prototype.elements={form:"form#send_message_form",submit:"a.button"},n.prototype.events={click:"stopPropagation","click %submit":"handle_form_submit"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments)},n.prototype.render=function(t){return null==t&&(t={}),n.__super__.render.apply(this,arguments),this},n.prototype.handle_form_submit=function(t){return t.preventDefault(),Messages.send_message_from_form({form:this.$els.form,button:this.$els.submit,success:function(){return function(t){return window.location.href=t.message.message_thread_url}}(this)})},n}(Academia.PopoverWidget)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.SocialProfileBadgeView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.tagName="a",n.prototype.attributes={"class":""},n.prototype.initialize=function(t){var e,n;null==t&&(t={});for(e in t)n=t[e],this[e]=n;return this.attributes=_.clone(this.attributes),this.model.id?this.set_attrs_and_render():this.model.on("change:id",this.set_attrs_and_render,this)},n.prototype.set_attrs_and_render=function(){var t,e;return this.attributes.id="social_profile_"+this.model.id,this.attributes.href=this.model.get("link"),this.attributes.title=this.model.get("name"),e=this.model.find_network(),this.attributes["class"]+="js-tooltip tooltip "+this.view.html_class(),t=$("#"+this.attributes.id),t.length?(this.appended=!0,this.$el=t):(this.render(),this.append())},n.prototype.render=function(){var t,e,n,o;e=this.attributes,n=[];for(t in e)o=e[t],n.push(this.$el.attr(t,o));return n},n.prototype.append=function(){return this.appended?void 0:($("#social").append(this.$el),this.appended=!0)},n}(Academia.View)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.SocialProfileView=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.jstTemplate="new_profile/templates/social_profile",n.prototype.tagName="li",n.prototype.attributes={"class":"social_profile"},n.prototype.events={"click a.remove":"clear"},n.prototype.initialize=function(){return this.badge=new NewProfile.SocialProfileBadgeView({model:this.model,view:this})},n.prototype.html_class=function(){var t;return/^(Homepage|Website)$/.test(this.model.get("name"))?"social homepage":"Google Scholar"===this.model.get("name")?"social googlescholar":"about.me"===this.model.get("name")?"social aboutme":(t=this.model.find_network())?"social "+t:"social no_favicon"},n.prototype.style=function(){return""},n.prototype.render=function(){return n.__super__.render.call(this,{defaults:{html_class:this.html_class(),style:this.style()}})},n.prototype.clear=function(){return this.model.destroy(),this.remove(),this.badge.remove(),!1},n}(Academia.View)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.UploadPhotoPopover=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.jstTemplate="new_profile/templates/upload_photo",n.prototype.elements={"remove-photo-link":"#remove-photo-link"},n.prototype.events={click:"stopPropagation","click %remove-photo-link":"removeCurrentPhoto"},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.uploader=new Academia.Uploader({max_size:10485760,url:this.path(),done:function(t){return function(e){return e.result&&t.replaceProfilePhoto(e.result.photo_url_profile,!1),e.result&&t.replaceTopIcon(e.result.photo_url_top),t.remove()}}(this)})},n.prototype.render=function(){return n.__super__.render.call(this,{override:{profilePictureGenerated:$("#change-photo-link").attr("class").indexOf("has_photo")<0}}),this.uploader.render_and_insert(this.$("#upload-photo-text")),this},n.prototype.path=function(){return $r.new_profile_profile_picture_path({page_name:$viewed_user.page_name})},n.prototype.removeCurrentPhoto=function(t){return t.stopPropagation(),$.ajax({url:this.path(),type:"POST",data:{_method:"DELETE"},success:function(t){return function(e){return e.photo_url_profile&&t.replaceProfilePhoto($image_url(e.photo_url_profile),!0),e.photo_url_top&&t.replaceTopIcon($image_url(e.photo_url_top)),t.remove()}}(this)})},n.prototype.replaceProfilePhoto=function(t,e){return $("#profile-photo").attr("src",t),e?($("#change-photo-link").text("Upload a new photo"),$("#change-photo-link").removeClass("has_photo")):($("#change-photo-link").text("Change photo"),$("#change-photo-link").addClass("has_photo"))},n.prototype.replaceTopIcon=function(t){return $("#top-avatar-sm").attr("src",t)},n}(Academia.PopoverWidget)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.SocialProfiles=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.model=NewProfile.SocialProfile,n.prototype.root="social_profiles",n.prototype.url=function(t){return null==t&&(t=!1),t?$r.api_v0_user_social_profiles_path({user_id:$current_user.id,subdomain_param:"api"}):$r.api_v0_user_social_profiles_url({user_id:$current_user.id})},n}(Academia.Collection)}.call(this),function(){var t=function(t,n){function o(){this.constructor=t}for(var r in n)e.call(n,r)&&(t[r]=n[r]);return o.prototype=n.prototype,t.prototype=new o,t.__super__=n.prototype,t},e={}.hasOwnProperty;this.NewProfile.Taggings=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.initialize=function(t,e){return n.__super__.initialize.apply(this,arguments),this.root="tags",this.options=e},n.prototype.url=function(){return $r.api_v0_taggings_path(this._url_params())},n.prototype.tag=function(t,e,n){var o;return o=$r.add_api_v0_taggings_path(this._url_params()),$.ajax({type:"POST",url:o,data:{tag:t,source:this.options.tag_source,source_details:n},success:function(t){return function(n){return t.add(n.research_interest),"function"==typeof e?e(!0):void 0}}(this),error:function(){return"function"==typeof e?e(!1):void 0}})},n.prototype.untag=function(t,e){var n;return n=$r.remove_api_v0_taggings_path(this._url_params()),$.ajax({type:"POST",url:n,data:{tag:t},success:function(n){return function(){return n.remove_by_id(t.id),"function"==typeof e?e(!0):void 0}}(this),error:function(){return"function"==typeof e?e(!1):void 0}})},n.prototype.persist_ordering=function(t,e){var n,o;return n=this.map(function(t){return t.id}),o=$r.set_order_api_v0_taggings_path(this._url_params()),$.ajax({type:"POST",url:o,data:{order:n,moved:t},success:function(){return"function"==typeof e?e(!0):void 0},error:function(){return"function"==typeof e?e(!1):void 0}})},n.prototype.remove_by_id=function(t){var e;return e=this.detect(function(e){return e.id===t}),e?this.remove(e):void 0},n.prototype.remove_by_cid=function(t){var e;return e=this.detect(function(e){return e.cid===t}),e?this.remove(e):void 0},n.prototype._url_params=function(){return{subdomain_param:"api",target_type:this.options.target_type,target_id:this.options.target_id,tag_type:this.options.tag_type}},n}(Academia.Collection)}.call(this);